
/****** Object:  Schema [etl]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE SCHEMA [etl]
GO
/****** Object:  Schema [kpods]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE SCHEMA [kpods]
GO
/****** Object:  Schema [rpt]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE SCHEMA [rpt]
GO
/****** Object:  Schema [rpt_prm]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE SCHEMA [rpt_prm]
GO
/****** Object:  UserDefinedFunction [rpt_prm].[GetMVParam]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [rpt_prm].[GetMVParam]
   (@RepParam nvarchar(MAX), @Delim char(1)= ',')
RETURNS @Values TABLE (Param nvarchar(MAX))AS
  BEGIN
  DECLARE @chrind INT
  DECLARE @Piece nvarchar(MAX)
  SELECT @chrind = 1 
  WHILE @chrind > 0
    BEGIN
      SELECT @chrind = CHARINDEX(@Delim,@RepParam)
      IF @chrind  > 0
        SELECT @Piece = LEFT(@RepParam,@chrind - 1)
      ELSE
        SELECT @Piece = @RepParam
      INSERT  @Values(Param) VALUES(CAST(@Piece AS VARCHAR))
      SELECT @RepParam = RIGHT(@RepParam,LEN(@RepParam) - @chrind)
      IF LEN(@RepParam) = 0 BREAK
    END
  RETURN
  END
GO
/****** Object:  Table [dbo].[DW_ACTOR_ADDRESSES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_ADDRESSES](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ADDRESS_ID] [numeric](12, 0) NOT NULL,
	[ACT_ADR_LNK_CREATED_BY_CODE] [varchar](30) NOT NULL,
	[ACT_ADR_LNK_CREATED_BY_DESC] [varchar](50) NOT NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[REPLACED_BY_ORDER_NBR] [numeric](10, 0) NULL,
	[START_DT] [date] NULL,
	[COMPLEMENT_DESC] [varchar](50) NULL,
	[ACT_ADR_LNK_MODIFIED_DT] [date] NULL,
	[REPLACEMENT_DT] [date] NULL,
	[HEAD_OFFICE_IND] [numeric](1, 0) NULL,
	[MAILING_ADDRESS_IND] [numeric](1, 0) NULL,
	[INVOICING_ADDRESS_IND] [numeric](1, 0) NULL,
	[DELIVERY_ADDRESS_IND] [numeric](1, 0) NULL,
	[ADDRESS_TYPE_CODE] [varchar](15) NULL,
	[ADDRESS_TYPE_DESC] [varchar](250) NULL,
	[FLOW_CHANNEL_CODE] [varchar](15) NULL,
	[FLOW_CHANNEL_DESC] [varchar](110) NULL,
	[LAST_CONTACT_USED_DT] [date] NULL,
	[ERROR_CODE] [varchar](15) NULL,
	[ERROR_DESC] [varchar](110) NULL,
	[CONTACT_RESULT_CODE] [varchar](15) NULL,
	[CONTACT_RESULT_DESC] [varchar](110) NULL,
	[CONTACT_SUCCESS_CODE] [varchar](15) NULL,
	[CONTACT_SUCCESS_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_ACTOR_ADDRESS_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_BAFI_ATTRIBUTES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_BAFI_ATTRIBUTES](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[COUNTRY_CODE] [varchar](7) NOT NULL,
	[START_DT] [date] NOT NULL,
	[ATTRIBUTE_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ATTRIBUTE_DESC] [varchar](100) NULL,
	[END_DT] [date] NULL,
	[ENTRY_DT] [date] NULL,
	[DESCRIPTION_DESC] [varchar](50) NULL,
	[COUNTRY_DESC] [varchar](50) NULL,
 CONSTRAINT [DW_ACTOR_BAFI_ATTRIBUTES_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[COUNTRY_CODE] ASC,
	[START_DT] ASC,
	[ATTRIBUTE_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_BANK_ACCOUNTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_BANK_ACCOUNTS](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[REPLACING_BANK_ID] [numeric](10, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[REPLACEMENT_DT] [date] NULL,
	[START_DT] [date] NULL,
	[ACCOUNT_TYPE_CODE] [varchar](15) NULL,
	[ACCOUNT_TYPE_DESC] [varchar](250) NULL,
	[INTERMEDIATE_BANK_ID] [numeric](10, 0) NULL,
	[ACCOUNT_BLOCKED_IND] [numeric](1, 0) NULL,
	[BLOCKING_REASON_CODE] [varchar](15) NULL,
	[BLOCKING_REASON_DESC] [varchar](110) NULL,
	[BANK_PROVIDED_CODE_DESC] [varchar](250) NULL,
	[DACOM_CODE_DESC] [varchar](250) NULL,
	[DACOM2_CODE_DESC] [varchar](250) NULL,
	[BANK_CODE_PASSWORD_DESC] [varchar](250) NULL,
	[ACCOUNT_CHECK_DT] [date] NULL,
	[CERT_LETTER_REQUEST_IND] [numeric](1, 0) NULL,
	[CERT_REQUEST_REASON_CODE] [varchar](15) NULL,
	[CERT_REQUEST_REASON_DESC] [varchar](110) NULL,
	[SSN_DESC] [varchar](100) NULL,
 CONSTRAINT [DW_ACTOR_BANK_ACCOUNTS_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[BANK_ACCOUNT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_CHARACTERISTICS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_CHARACTERISTICS](
	[ACTOR_CHARACTERISTIC_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[CHARACTERISTIC_CODE] [varchar](150) NULL,
	[CHARACTERISTIC_DESC] [varchar](150) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DATA_TYPE_DESC] [varchar](12) NOT NULL,
	[NUMERIC_VALUE_AMT] [numeric](22, 7) NULL,
	[STRING_VALUE_DESC] [varchar](2000) NULL,
	[DATE_VALUE_DT] [date] NULL,
	[BOOLEAN_VALUE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_ACTOR_CHARACTERISTICS_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_COMPANY_ROLES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_COMPANY_ROLES](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ROLE_CODE] [varchar](7) NOT NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NOT NULL,
	[VALID_DT] [date] NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ROLE_DESC] [varchar](50) NULL,
	[PAYMENT_METHOD_CODE] [varchar](7) NULL,
	[PAYMENT_METHOD_DESC] [varchar](50) NULL,
	[RATE_CODE] [varchar](7) NULL,
	[RATE_DESC] [varchar](50) NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[INTEREST_CALC_METHOD_CODE] [numeric](3, 0) NULL,
	[INTEREST_CALC_METHOD_DESC] [varchar](50) NULL,
	[CASH_IN_PMT_METHOD_CODE] [varchar](7) NULL,
	[CASH_IN_PMT_METHOD_DESC] [varchar](50) NULL,
	[VAR_RATE_CEILING_FORMULA_CODE] [numeric](5, 0) NULL,
	[VAR_RATE_CEILING_FORMULA_DESC] [varchar](100) NULL,
	[VAR_RATE_FLOOR_FORMULA_CODE] [numeric](5, 0) NULL,
	[VAR_RATE_FLOOR_FORMULA_DESC] [varchar](100) NULL,
	[END_DT] [date] NULL,
	[PAYMENT_GRACE_PERIOD_CODE] [varchar](7) NULL,
	[PAYMENT_GRACE_PERIOD_DESC] [varchar](50) NULL,
	[START_BASIS_CODE] [varchar](7) NULL,
	[START_BASIS_DESC] [varchar](110) NULL,
	[DAYS_IN_MONTH_OR_FIXED_DAY_NBR] [numeric](3, 0) NULL,
	[EARLY_PAYMENT_REBATE_PCT] [numeric](5, 2) NULL,
	[LATE_PAYMENT_IND] [numeric](1, 0) NULL,
	[SEPARATE_INVOICE_IND] [numeric](1, 0) NULL,
	[FORCED_CHECK_PAYMENT_IND] [numeric](1, 0) NULL,
	[LATE_PMT_MINIMUM_BASIS_AMT] [numeric](15, 2) NULL,
	[LATE_PMT_LUMP_SUM_AMT] [numeric](15, 2) NULL,
	[FLOOR_RATE_PCT] [numeric](11, 8) NULL,
	[CEILING_RATE_PCT] [numeric](11, 8) NULL,
	[LATE_PAYMENT_MARGIN_PCT] [numeric](11, 8) NULL,
	[LATE_PAYMENT_FIXED_RATE_PCT] [numeric](11, 8) NULL,
	[OPEN_REC_APPLIED_PCT] [numeric](11, 8) NULL,
	[BLOCK_REMINDERS_CODE] [varchar](7) NULL,
	[BLOCK_REMINDERS_DESC] [varchar](110) NULL,
	[NO_REMINDERS_REASON_CODE] [varchar](15) NULL,
	[NO_REMINDERS_REASON_DESC] [varchar](250) NULL,
	[MEANS_OF_TRANSFER_NOTICE_CODE] [varchar](7) NULL,
	[MEANS_OF_TRANSFER_NOTICE_DESC] [varchar](110) NULL,
	[LATE_PAYMENT_TRIGGER_NBR] [numeric](3, 0) NULL,
	[LATE_PAYMENT_TOLERANCE_NBR] [numeric](3, 0) NULL,
	[LATE_PAYMENT_DELAY_NBR] [numeric](3, 0) NULL,
	[STOP_REMINDERS_END_DT] [date] NULL,
	[STOP_REMINDERS_TYPE_CODE] [varchar](15) NULL,
	[STOP_REMINDERS_TYPE_DESC] [varchar](110) NULL,
	[LATE_CHARGE_FLOOR_TYPE_CODE] [varchar](15) NULL,
	[LATE_CHARGE_FLOOR_TYPE_DESC] [varchar](110) NULL,
	[LATE_CHARGE_CEILING_TYPE_CODE] [varchar](15) NULL,
	[LATE_CHARGE_CEILING_TYPE_DESC] [varchar](110) NULL,
	[INVOICING_OFFSET_CODE] [varchar](7) NULL,
	[INVOICING_OFFSET_DESC] [varchar](110) NULL,
	[GRACE_PERIOD_COLL_RULE_CODE] [varchar](15) NULL,
	[GRACE_PERIOD_COLL_RULE_DESC] [varchar](110) NULL,
	[CARD_ID] [numeric](10, 0) NULL,
	[PHASE_CODE] [varchar](7) NULL,
	[PHASE_DESC] [varchar](25) NULL,
	[STEP_CODE] [varchar](7) NULL,
	[STEP_DESC] [varchar](100) NULL,
	[TARGET_CODE] [varchar](15) NULL,
	[TARGET_DESC] [varchar](110) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[EXTERNAL_REFERENCE_CODE] [varchar](15) NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](110) NULL,
	[FLEET_REGISTER_REASON_CODE] [varchar](15) NULL,
	[FLEET_REGISTER_REASON_DESC] [varchar](110) NULL,
	[CW_BRANCH_DEPTARTMENT_CODE] [varchar](7) NULL,
	[CW_BRANCH_DEPTARTMENT_DESC] [varchar](110) NULL,
	[CW_REJECT_REASON_CODE] [varchar](15) NULL,
	[CW_REJECT_REASON_DESC] [varchar](110) NULL,
	[AAGREGDOC_DESC] [varchar](100) NULL,
	[AAGCANREGDOC_DESC] [varchar](100) NULL,
	[AAGCANREATYPE_CODE] [varchar](15) NULL,
	[AAGCANREATYPE_DESC] [varchar](110) NULL,
	[AAGCANREASON_CODE] [varchar](15) NULL,
	[AAGCANREASON_DESC] [varchar](110) NULL,
	[AAGFLAGREREG_IND] [numeric](1, 0) NULL,
	[VAT_PAID_LOCAL_CURR_COLL_IND] [numeric](1, 0) NULL,
	[VAT_PAID_LOCAL_CURR_DISB_IND] [numeric](1, 0) NULL,
	[TERMINATION_CHANNEL_CODE] [varchar](15) NULL,
	[TERMINATION_CHANNEL_DESC] [varchar](110) NULL,
	[TERMINATION_REASON_CODE] [varchar](15) NULL,
	[TERMINATION_REASON_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_ACTOR_COMPANY_ROLES_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[ROLE_CODE] ASC,
	[COMPANY_ACTOR_ID] ASC,
	[VALID_DT] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_CONTACT]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_CONTACT](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CONTACT_TYPE_CODE] [varchar](15) NOT NULL,
	[CONTACT_TYPE_DESC] [varchar](250) NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[START_DT] [date] NULL,
	[MEMO_TXT] [varchar](2000) NULL,
	[BUILDING_ID] [numeric](10, 0) NULL,
	[INVESTMENT_ID] [numeric](10, 0) NULL,
	[SITE_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
	[WORK_ORDER_ID] [numeric](10, 0) NULL,
	[TRANSACTION_ID] [numeric](10, 0) NULL,
	[MANDATE_ID] [numeric](10, 0) NULL,
	[INSURANCE_POLICY_ID] [numeric](10, 0) NULL,
	[CLAIM_ID] [numeric](10, 0) NULL,
	[SERVICING_AGREEMENT_ID] [numeric](10, 0) NULL,
	[TENDER_ID] [numeric](10, 0) NULL,
	[NOTE_OBJECT_CODE] [varchar](15) NULL,
	[NOTE_OBJECT_DESC] [varchar](110) NULL,
	[MODIFIED_DT] [date] NULL,
	[COVENANT_ID] [numeric](10, 0) NULL,
	[COVENANT_ORDER_NBR] [numeric](10, 0) NULL,
	[PARENT_ACTOR_ID] [numeric](10, 0) NULL,
	[PARENT_ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[COLLATERAL_ID] [numeric](10, 0) NULL,
	[CONFIDENTIALITY_TYPE_CODE] [varchar](7) NULL,
	[CONFIDENTIALITY_TYPE_DESC] [varchar](110) NULL,
	[METHOD_CODE] [varchar](15) NULL,
	[METHOD_DESC] [varchar](250) NULL,
	[REPLY_CODE] [varchar](15) NULL,
	[REPLY_DESC] [varchar](250) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[NOTE_CHARACTER_CODE] [varchar](15) NULL,
	[NOTE_CHARACTER_DESC] [varchar](15) NULL,
	[RESULT_LEVEL_1_DESC] [varchar](15) NULL,
	[RESULT_LEVEL_2_DESC] [varchar](15) NULL,
	[RESULT_LEVEL_3_DESC] [varchar](15) NULL,
	[COUNSELING_TYPE_CODE] [varchar](15) NULL,
	[COUNSELING_TYPE_DESC] [varchar](15) NULL,
	[RESPONDED_RELATION_CODE] [varchar](15) NULL,
	[RESPONDED_RELATION_DESC] [varchar](15) NULL,
	[RESPONDED_PERSON_CODE] [varchar](15) NULL,
	[RESPONDED_PERSON_DESC] [varchar](15) NULL,
	[CALL_DURATION_NBR] [numeric](5, 0) NULL,
	[SOURCE_NUMBER_DESC] [varchar](250) NULL,
	[TARGET_NUMBER_DESC] [varchar](250) NULL,
	[COUNSELING_NUMBER_DESC] [varchar](250) NULL,
	[NOTE_ID] [numeric](10, 0) NULL,
	[CONTACT_CHANNEL_CODE] [varchar](15) NULL,
	[CONTACT_CHANNEL_DESC] [varchar](110) NULL,
	[CARD_ID] [numeric](10, 0) NULL,
	[APPLICANT_TYPE_CODE] [varchar](15) NULL,
	[APPLICANT_TYPE_DESC] [varchar](110) NULL,
	[CONT_RELATIVE_ZIP_CODE_DESC] [varchar](30) NULL,
	[RELATIVE_ADDRESS] [varchar](100) NULL,
	[RELATIVE_SSN_DESC] [varchar](100) NULL,
	[RELATIVE_NAME] [varchar](100) NULL,
	[RELATIVE_CALL_TIME_DT] [date] NULL,
 CONSTRAINT [DW_ACTOR_CONTACT_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_CORRESPONDANTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_CORRESPONDANTS](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[SURNAME_DESC] [varchar](50) NOT NULL,
	[TITLE_CODE] [varchar](7) NULL,
	[TITLE_DESC] [varchar](250) NULL,
	[POSITION_CODE] [varchar](7) NULL,
	[POSITION_DESC] [varchar](250) NULL,
	[PREFERRED_IND] [numeric](1, 0) NULL,
	[FIRST_NAME_DESC] [varchar](50) NULL,
	[MIDDLE_INITIAL_DESC] [varchar](7) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[CHARACTER_CODE] [varchar](15) NULL,
	[CHARACTER_DESC] [varchar](110) NULL,
	[DECISION_POWER_CODE] [varchar](15) NULL,
	[DECISION_POWER_DESC] [varchar](110) NULL,
	[QUALIFICATION_CODE] [varchar](15) NULL,
	[QUALIFICATION_DESC] [varchar](110) NULL,
	[FEDERAL_TAXID_DESC] [varchar](32) NULL,
	[BIRTHDAY_DT] [date] NULL,
	[BIRTHDAY_CALENDAR_CODE] [varchar](15) NULL,
	[BIRTHDAY_CALENDAR_DESC] [varchar](250) NULL,
	[WEDDING_DT] [date] NULL,
	[SEX_NBR] [numeric](1, 0) NULL,
	[MEMO_TXT] [varchar](2000) NULL,
	[MARITAL_STATUS_CODE] [varchar](15) NULL,
	[MARITAL_STATUS_DESC] [varchar](110) NULL,
	[FOREIGN_NAME_DESC] [varchar](50) NULL,
	[EMPLOYER_ACTOR_ID] [numeric](10, 0) NULL,
	[QUALIFICATION_CLASS_CODE] [varchar](15) NULL,
	[QUALIFICATION_CLASS_DESC] [varchar](110) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[ERROR_CODE] [varchar](15) NULL,
	[ERROR_DESC] [varchar](110) NULL,
	[CUSTOMER_CONTACT_RESULT_CODE] [varchar](15) NULL,
	[CUSTOMER_CONTACT_RESULT_DESC] [varchar](110) NULL,
	[CUSTOMER_CONTACT_SUCCESS_CODE] [varchar](15) NULL,
	[CUSTOMER_CONTACT_SUCCESS_DESC] [varchar](110) NULL,
	[DECISION_DT] [date] NULL,
 CONSTRAINT [DW_ACTOR_CORRESPONDANTS_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_INDIVIDUALS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_INDIVIDUALS](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[COUNTRY_CODE] [varchar](7) NULL,
	[COUNTRY_DESC] [varchar](50) NULL,
	[BIRTH_DT] [date] NULL,
	[COUNTY_OF_BIRTH_CODE] [varchar](2) NULL,
	[COUNTY_OF_BIRTH_DESC] [varchar](2) NULL,
	[BIRTH_PLACE_CODE] [varchar](3) NULL,
	[BIRTH_PLACE_DESC] [varchar](3) NULL,
	[NUMBER_OF_CHILDREN_NBR] [numeric](2, 0) NULL,
	[GENDER_NBR] [numeric](1, 0) NULL,
	[EMPLOYER_REFERENCE_DESC] [varchar](254) NULL,
	[MARITAL_STATUS_CODE] [varchar](7) NULL,
	[MARITAL_STATUS_DESC] [varchar](250) NULL,
	[REAL_ESTATE_OWNERSHIP_IND] [numeric](1, 0) NULL,
	[POSITION_CODE] [varchar](7) NULL,
	[POSITION_DESC] [varchar](110) NULL,
	[MARRIED_NAME_DESC] [varchar](32) NULL,
	[MARITAL_FISCAL_STATUS_CODE] [varchar](15) NULL,
	[MARITAL_FISCAL_STATUS_DESC] [varchar](250) NULL,
	[TOWN_OF_BIRTH_DESC] [varchar](200) NULL,
	[MAIDEN_NAME_DESC] [varchar](32) NULL,
	[BANK_REFUSAL_IND] [numeric](1, 0) NULL,
	[CAPITAL_OWNERSHIP_PCT] [numeric](11, 8) NULL,
	[YEARS_EXP_IN_BUS_TYPE_NBR] [numeric](3, 0) NULL,
	[YEARS_EXPERIENCE_NBR] [numeric](3, 0) NULL,
	[EDUCATION_LEVEL_CODE] [varchar](15) NULL,
	[EDUCATION_LEVEL_DESC] [varchar](110) NULL,
	[INHERITANCE_PREPARED_IND] [numeric](1, 0) NULL,
	[KEY_MAN_INSURED_IND] [numeric](1, 0) NULL,
	[MARITAL_FISCAL_STAT_CHNGE_CODE] [varchar](7) NULL,
	[MARITAL_FISCAL_STAT_CHNGE_DESC] [varchar](250) NULL,
	[HEAD_MANAGER_IND] [numeric](1, 0) NULL,
	[HEAD_MANAGER_FUNCTION_CODE] [varchar](15) NULL,
	[HEAD_MANAGER_FUNCTION_DESC] [varchar](110) NULL,
	[DRIVING_TEST_PASSED_DT] [date] NULL,
	[FIRST_NAME_DESC] [varchar](50) NULL,
	[LAST_MARRIAGE_CONTRACT_UPD_DT] [date] NULL,
	[BIRTHDAY_CALENDAR_CODE] [varchar](15) NULL,
	[BIRTHDAY_CALENDAR_DESC] [varchar](250) NULL,
	[ANALYST_DESC] [varchar](200) NULL,
	[EXECUTOR_DESC] [varchar](200) NULL,
	[PROBATE_CASE_NUMBER_DESC] [varchar](50) NULL,
	[DEATH_DT] [date] NULL,
	[DEATH_CERTIFICATE_DT] [date] NULL,
	[INVOLVED_ASSET_CODE] [varchar](15) NULL,
	[INVOLVED_ASSET_DESC] [varchar](1110) NULL,
	[STATE_COUNTRY_CODE] [varchar](7) NULL,
	[STATE_COUNTRY_DESC] [varchar](50) NULL,
	[REGION_CODE] [varchar](7) NULL,
	[REGION_DESC] [varchar](50) NULL,
	[STATE_TYPE_CODE] [varchar](15) NULL,
	[STATE_TYPE_DESC] [varchar](250) NULL,
	[PROBATE_FILE_DT] [date] NULL,
	[PROBATE_OPEN_DT] [date] NULL,
	[POSTAL_CODE_PREFIX_CODE] [varchar](7) NULL,
	[POSTAL_CODE_PREFIX_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_ACTOR_INDIVIDUALS_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_PHASE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_PHASE](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[PHASE_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PHASE_DESC] [varchar](25) NULL,
	[PHASE_DESTINATION_CODE] [varchar](15) NOT NULL,
	[PHASE_DESTINATION_DESC] [varchar](110) NULL,
	[PHASE_STEP_CODE] [varchar](7) NULL,
	[PHASE_STEP_DESC] [varchar](100) NULL,
	[PHASE_START_DT] [date] NOT NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[PHASE_END_DT] [date] NULL,
	[MODIFIED_DT] [date] NULL,
 CONSTRAINT [DW_ACTOR_PHASE_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[ORDER_NBR] ASC,
	[PHASE_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_RELATIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_RELATIONS](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[RELATION_CODE] [varchar](15) NOT NULL,
	[RELATED_ACTOR_ID] [numeric](10, 0) NOT NULL,
	[START_DT] [date] NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ASCENDING_RELATION_DESC] [varchar](50) NULL,
	[DESCENDING_RELATION_DESC] [varchar](50) NULL,
	[NUMBER_OF_SHARES_AMT] [numeric](10, 0) NULL,
	[END_DT] [date] NULL,
	[FRONT_OFFICE_AGGREGATE_ID] [numeric](10, 0) NULL,
	[CUSTOMER_INCOMING_PATH_CODE] [varchar](15) NULL,
	[CUSTOMER_INCOMING_PATH_DESC] [varchar](110) NULL,
	[ROLE_CODE] [varchar](7) NULL,
	[ROLE_DESC] [varchar](50) NULL,
	[ROLE_RELATION_NBR] [numeric](10, 0) NULL,
 CONSTRAINT [DW_ACTOR_RELATIONS_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[RELATION_CODE] ASC,
	[RELATED_ACTOR_ID] ASC,
	[START_DT] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_RISK_RATING]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_RISK_RATING](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[RATING_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[RATING_DESC] [varchar](100) NULL,
	[START_DT] [date] NOT NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[MODIFIED_DT] [date] NULL,
	[END_DT] [date] NULL,
	[COTATION_TXT] [varchar](50) NULL,
	[LEAD_SUBSIDIARY_CODE] [varchar](15) NULL,
	[LEAD_SUBSIDIARY_DESC] [varchar](110) NULL,
	[RATING_SUBSIDIARY_CODE] [varchar](15) NULL,
	[RATING_SUBSIDIARY_DESC] [varchar](110) NULL,
	[OVERRIDE_IND] [numeric](1, 0) NULL,
	[COMMENT_TXT] [varchar](500) NULL,
	[SCORE_NBR] [numeric](10, 2) NULL,
	[RATING_VALID_DT] [date] NULL,
	[PERIOD_CODE] [varchar](15) NULL,
	[PERIOD_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_ACTOR_RISK_RATING_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[ORDER_NBR] ASC,
	[RATING_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_ROLES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_ROLES](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ROLE_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ROLE_DESC] [varchar](50) NULL,
	[OUTVOICE_COPIES_NBR] [numeric](1, 0) NULL,
	[INVOICE_RECAPITULATION_CODE] [varchar](7) NULL,
	[INVOICE_RECAPITULATION_DESC] [varchar](110) NULL,
	[INVOICE_GROUPING_NBR] [numeric](1, 0) NULL,
	[DIRECT_DEBIT_GROUPING_NBR] [numeric](1, 0) NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](15) NULL,
	[INVOICE_IN_ADVANCE_NBR] [numeric](3, 0) NULL,
	[INVOICING_PERIODICITY_CODE] [varchar](7) NULL,
	[INVOICING_PERIODICITY_DESC] [varchar](50) NULL,
	[PERIOD_MULTIPLE_NBR] [numeric](3, 0) NULL,
	[INVOICE_PRINTING_TYPE_CODE] [varchar](7) NULL,
	[INVOICE_PRINTING_TYPE_DESC] [varchar](50) NULL,
	[AUTO_TOTAL_OUTLAY_IND] [numeric](1, 0) NULL,
	[TRANSFER_MEANS_NOTICE_CODE] [varchar](7) NULL,
	[TRANSFER_MEANS_NOTICE_DESC] [varchar](50) NULL,
	[OUTPUT_FORMAT_CODE] [varchar](15) NULL,
	[OUTPUT_FORMAT_DESC] [varchar](110) NULL,
	[BILLING_STMT_METHOD_CODE] [varchar](15) NULL,
	[BILLING_STMT_METHOD_DESC] [varchar](110) NULL,
	[SPECIAL_CARE_IND] [numeric](1, 0) NULL,
	[SPECIAL_CARE_TYPE_CODE] [varchar](15) NULL,
	[SPECIAL_CARE_TYPE_DESC] [varchar](110) NULL,
	[SPECIAL_CARE_MEMO_TXT] [varchar](2000) NULL,
	[SPECIAL_CARE_DOCUMENT_DESC] [varchar](150) NULL,
	[SPECIAL_CARE_REGISTRATION_DT] [date] NULL,
	[SPECIAL_CARE_DEPARTMENT_CODE] [varchar](7) NULL,
	[SPECIAL_CARE_DEPARTMENT_DESC] [varchar](110) NULL,
	[SPECIAL_CARE_USER1_CODE] [varchar](30) NULL,
	[SPECIAL_CARE_USER1_DESC] [varchar](50) NULL,
	[SPECIAL_CARE_USER2_CODE] [varchar](30) NULL,
	[SPECIAL_CARE_USER2_DESC] [varchar](50) NULL,
 CONSTRAINT [DW_ACTOR_ROLES_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[ROLE_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTOR_TELECOM]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTOR_TELECOM](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[NUMBER_EMAIL_DESC] [varchar](250) NOT NULL,
	[TYPE_CODE] [varchar](7) NOT NULL,
	[TYPE_DESC] [varchar](250) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[PREFERRED_IND] [numeric](1, 0) NULL,
	[DOMAIN_CODE] [varchar](15) NULL,
	[DOMAIN_DESC] [varchar](110) NULL,
	[ASSENT_IND] [numeric](1, 0) NULL,
	[EXTENSION_DESC] [varchar](7) NULL,
	[INCOMING_PATH_CODE] [varchar](15) NULL,
	[INCOMING_PATH_DESC] [varchar](110) NULL,
	[LAST_CONTACT_DT] [date] NULL,
	[ERROR_CODE] [varchar](15) NULL,
	[ERROR_DESC] [varchar](110) NULL,
	[CONTACT_RESULT_CODE] [varchar](15) NULL,
	[CONTACT_RESULT_DESC] [varchar](110) NULL,
	[CONTACT_SUCCESS_CODE] [varchar](15) NULL,
	[CONTACT_SUCCESS_DESC] [varchar](110) NULL,
	[PREFERRED_NON_BUSINESS_HRS_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_ACTOR_TELECOM_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ACTORS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ACTORS](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[MANAGEMENT_UNIT_CODE] [varchar](7) NOT NULL,
	[MANAGEMENT_UNIT_DESC] [varchar](110) NULL,
	[JUDICIAL_CATEGORY_CODE] [varchar](7) NOT NULL,
	[JUDICIAL_CATEGORY_DESC] [varchar](65) NULL,
	[LANGUAGE_CODE] [varchar](7) NOT NULL,
	[LANGUAGE_DESC] [varchar](25) NULL,
	[CREATED_BY_CODE] [varchar](30) NOT NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[COUNTRY_CODE] [varchar](7) NOT NULL,
	[COUNTRY_DESC] [varchar](50) NULL,
	[ACTOR_CODE_DESC] [varchar](15) NOT NULL,
	[SHORT_NAME_DESC] [varchar](200) NOT NULL,
	[TRADE_NAME_DESC] [varchar](200) NOT NULL,
	[MODIFIED_BY_CODE] [varchar](30) NULL,
	[MODIFIED_BY_DESC] [varchar](50) NULL,
	[NAF_CODE] [varchar](7) NULL,
	[NAF_DESC] [varchar](200) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[SECOND_TRADE_NAME_DESC] [varchar](200) NULL,
	[FEDERAL_TAX_ID_NBR] [varchar](32) NULL,
	[PROFESSIONAL_TAX_IND] [numeric](1, 0) NULL,
	[FIRST_ENTRY_DT] [date] NULL,
	[LAST_UPDATE_DT] [date] NULL,
	[EU_VAT_CODE] [varchar](32) NULL,
	[COMMERCIAL_REGISTRY_TYPE_CODE] [varchar](2) NULL,
	[COMMERCIAL_REGISTRY_TYPE_DESC] [varchar](110) NULL,
	[LAST_FISCAL_YEAR_MONTH_NBR] [numeric](2, 0) NULL,
	[COMPANY_REGISTER_ID_DESC] [varchar](50) NULL,
	[MEMO_TXT] [varchar](2000) NULL,
	[REGULAR_CAPITAL_AMT] [numeric](15, 2) NULL,
	[PRINT_ON_CHECK_DESC] [varchar](32) NULL,
	[VAT_REGIME_CODE] [varchar](1) NULL,
	[VAT_REGIME_DESC] [varchar](110) NULL,
	[SUPPLIER_APPROVAL_IND] [numeric](1, 0) NULL,
	[SUPP_ACTOR_RELATION_LEVEL_CODE] [varchar](15) NULL,
	[SUPP_ACTOR_RELATION_LEVEL_DESC] [varchar](15) NULL,
	[COMPANY_CREATION_DT] [date] NULL,
	[NUMBER_OF_EMPLOYEES_NBR] [numeric](7, 0) NULL,
	[ACTIVITY_CODE] [varchar](7) NULL,
	[ACTIVITY_DESC] [varchar](110) NULL,
	[DECLASSIFY_IND] [numeric](1, 0) NULL,
	[DOMAIN_CODE] [varchar](7) NULL,
	[DOMAIN_DESC] [varchar](110) NULL,
	[COMPOUNDING_ACTOR_IND] [numeric](1, 0) NULL,
	[ACTIVITY_EFFECTIVE_DT] [date] NULL,
	[ACTIVITY_COUNTRY_CODE] [varchar](7) NULL,
	[ACTIVITY_COUNTRY_DESC] [varchar](50) NULL,
	[JUDICIAL_CATEGORY_COUNTRY_CODE] [varchar](7) NOT NULL,
	[JUDICIAL_CATEGORY_COUNTRY_DESC] [varchar](50) NULL,
	[ACTOR_TYPE_CODE] [varchar](15) NULL,
	[ACTOR_TYPE_DESC] [varchar](110) NULL,
	[CREATION_CHANNEL_CODE] [varchar](15) NULL,
	[CREATION_CHANNEL_DESC] [varchar](110) NULL,
	[CREATION_CHANNEL_ACTOR_CODE] [varchar](50) NULL,
	[EXTERNAL_DEPARTMENT_DESC] [varchar](50) NULL,
	[HIRE_DT] [date] NULL,
	[RESIDENT_CODE] [varchar](15) NULL,
	[RESIDENT_DESC] [varchar](110) NULL,
	[REPRESENTATIVE_DESC] [varchar](32) NULL,
	[REPRESENTATIVE_NAME_DESC] [varchar](50) NULL,
	[CORPORATE_DESC] [varchar](32) NULL,
	[GUARANTOR_IND] [numeric](1, 0) NULL,
	[QUALIFICATION_CLASS_CODE] [varchar](15) NULL,
	[QUALIFICATION_CLASS_DESC] [varchar](110) NULL,
	[ASYNC_MODE_STATUS_CODE] [varchar](7) NULL,
	[ASYNC_MODE_STATUS_DESC] [varchar](110) NULL,
	[EMPLOYEE_ID_NBR] [varchar](15) NULL,
 CONSTRAINT [DW_ACTORS_KEY] PRIMARY KEY CLUSTERED 
(
	[ACTOR_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ADDRESSES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ADDRESSES](
	[ADDRESS_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[COUNTRY_CODE] [varchar](7) NOT NULL,
	[COUNTRY_DESC] [varchar](50) NULL,
	[CREATED_BY_CODE] [varchar](30) NOT NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[STATE_CODE] [varchar](7) NULL,
	[STATE_DESC] [varchar](50) NULL,
	[ADDRESS_1_DESC] [varchar](200) NULL,
	[ADDRESS_2_DESC] [varchar](200) NULL,
	[POSTAL_CODE_DESC] [varchar](30) NULL,
	[CITY_DESC] [varchar](200) NULL,
	[UPDATE_DT] [date] NULL,
	[CEDEX_DESC] [varchar](20) NULL,
	[SUB_REGION_DESC] [varchar](50) NULL,
	[REGION_TYPE_CODE] [varchar](15) NULL,
	[REGION_TYPE_DESC] [varchar](110) NULL,
	[MSA_CODE_DESC] [varchar](15) NULL,
	[LATITUDE_ANGLE_NBR] [numeric](18, 6) NULL,
	[LATITUDE_CARDINAL_REF_DESC] [varchar](1) NULL,
	[LONGITUTE_ANGLE_NBR] [numeric](18, 6) NULL,
	[LONGITUDE_CARDINAL_REF_DESC] [varchar](1) NULL,
	[BUILDING_NAME_DESC] [varchar](25) NULL,
	[APPARTMENT_NUMBER_DESC] [varchar](25) NULL,
	[TAX_AREA_CODE_DESC] [varchar](25) NULL,
	[DISTRICT_DESC] [varchar](200) NULL,
	[TOWN_DESC] [varchar](200) NULL,
	[NEW_STREET_FORMAT_DESC] [varchar](200) NULL,
	[NEW_POSTAL_CODE_FORMAT_DESC] [varchar](30) NULL,
	[NEW_CITY_FORMAT_DESC] [varchar](200) NULL,
	[NEW_BLOCK_NBR_FORMAT_DESC] [varchar](20) NULL,
	[NEW_SUB_REGION_FORMAT_DESC] [varchar](50) NULL,
	[NEW_BUILDING_NAME_FORMAT_DESC] [varchar](25) NULL,
	[NEW_APARTMENT_NBR_FORMAT_DESC] [varchar](25) NULL,
	[NEW_DISTRICT_FORMAT_DESC] [varchar](200) NULL,
	[TAXABLE_PCT] [numeric](11, 8) NULL,
	[TAX_CODE] [varchar](7) NULL,
	[TAX_DESC] [varchar](50) NULL,
	[TAXABLE_BALANCE_AMT] [numeric](15, 2) NULL,
	[ADRSUBBUNJI_CODE] [varchar](7) NULL,
	[ADRSUBBUNJI_DESC] [varchar](110) NULL,
	[ADRSTREETCODESEQ_CODE] [varchar](7) NULL,
	[ADRSTREETCODESEQ_DESC] [varchar](110) NULL,
	[ADRBASGRNDAIR_CODE] [varchar](7) NULL,
	[ADRBASGRNDAIR_DESC] [varchar](110) NULL,
	[ADRBLDGMAIN_CODE] [varchar](7) NULL,
	[ADRBLDGMAIN_DESC] [varchar](110) NULL,
	[ADRBLDGSUB_CODE] [varchar](7) NULL,
	[ADRBLDGSUB_DESC] [varchar](110) NULL,
	[ADRSTRTADDUSE_CODE] [varchar](7) NULL,
	[ADRSTRTADDUSE_DESC] [varchar](110) NULL,
	[ADRMAINBUNJI_CODE] [varchar](7) NULL,
	[ADRMAINBUNJI_DESC] [varchar](110) NULL,
	[ADRRANGE_DESC] [varchar](20) NULL,
	[BUILDING_CODE_SEQUENCE_CODE] [varchar](7) NULL,
	[BUILDING_CODE_SEQUENCE_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_ADDRESSES_KEY] PRIMARY KEY CLUSTERED 
(
	[ADDRESS_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ANALYSIS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ANALYSIS](
	[ANALYSIS_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[DEAL_VERSION_CODE] [varchar](7) NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[AGGREGATE_ID] [numeric](10, 0) NULL,
	[ANALYSIS_TARGET_CODE] [varchar](110) NULL,
	[ANALYSIS_TARGET_DESC] [varchar](110) NULL,
	[ANALYSIS_TYPE_CODE] [varchar](15) NULL,
	[ANALYSIS_TYPE_DESC] [varchar](250) NULL,
	[CREATED_DT] [date] NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[TYPE_OF_ANALYSIS_CODE] [varchar](7) NULL,
	[TYPE_OF_ANALYSIS_DESC] [varchar](110) NULL,
	[PARENT_ANALYSIS_ID] [numeric](10, 0) NULL,
	[ANALYSIS_MATRIX_ID] [numeric](10, 0) NULL,
	[NUMBER_OF_POINTS_NBR] [numeric](8, 0) NULL,
	[AUTO_SCORING_NOTICE_CODE] [varchar](7) NULL,
	[AUTO_SCORING_NOTICE_DESC] [varchar](110) NULL,
	[AUTO_SCORING_COMMENT_CODE] [varchar](7) NULL,
	[AUTO_SCORING_COMMENT_DESC] [varchar](110) NULL,
	[AUTO_NOTATION_CODE] [varchar](15) NULL,
	[AUTO_NOTATION_DESC] [varchar](110) NULL,
	[ANALYST_OPINION_CODE] [varchar](7) NULL,
	[ANALYST_OPINION_DESC] [varchar](110) NULL,
	[ANALYST_COMMENT_TXT] [varchar](2000) NULL,
	[ANALYSIS_STATUS_CODE] [varchar](7) NULL,
	[ANALYSIS_STATUS_DESC] [varchar](110) NULL,
	[REFERENCE_YEAR_NBR] [numeric](4, 0) NULL,
	[FINANCIAL_PROPOSAL_ID] [numeric](10, 0) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[PROCESS_ID] [numeric](10, 0) NULL,
	[ANALYSIS_MATRIX_CODE] [varchar](15) NULL,
	[ANALYSIS_MATRIX_DESC] [varchar](80) NULL,
 CONSTRAINT [DW_ANALYSIS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[ANALYSIS_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ANALYSIS_DETAILS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ANALYSIS_DETAILS_FO](
	[ANALYSIS_ID] [numeric](10, 0) NOT NULL,
	[RATIO_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[VALUE_DESC] [varchar](250) NULL,
	[N_MINUS_1_VALUE_DESC] [varchar](15) NULL,
	[N_MINUS_2_VALUE_DESC] [varchar](15) NULL,
	[ALLOCATED_POINTS_NBR] [numeric](4, 0) NULL,
	[AUTO_CONCLUSION_DESC] [varchar](80) NULL,
	[RETURN_CODE_DESC] [varchar](7) NULL,
	[RETURN_MESSAGE_DESC] [varchar](80) NULL,
	[DISPLAY_STYLE_CODE] [varchar](15) NULL,
	[DISPLAY_STYLE_DESC] [varchar](110) NULL,
	[POPULATION_ID] [numeric](10, 0) NULL,
	[ANALYSIS_MEMO_TXT] [varchar](max) NULL,
	[RATIO_CODE] [varchar](15) NULL,
	[RATLABEL] [varchar](100) NULL,
	[RATTYPE] [varchar](15) NULL,
 CONSTRAINT [DW_ANALYSIS_DETAILS_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[ANALYSIS_ID] ASC,
	[RATIO_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_AUTHORIZED_FUNDING_TYPES_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_AUTHORIZED_FUNDING_TYPES_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[ACTIVITY_CODE] [varchar](7) NULL,
	[ACTIVITY_DESC] [varchar](50) NULL,
	[FINANCING_TYPE_CODE] [varchar](7) NULL,
	[FINANCING_TYPE_DESC] [varchar](110) NULL,
	[MAIN_BUSINESS_IND] [numeric](1, 0) NULL,
	[END_DT] [date] NULL,
	[LIMIT_AMT] [numeric](15, 2) NULL,
	[MIN_MONTHS_NBR] [numeric](3, 0) NULL,
	[MAX_MONTHS_NBR] [numeric](3, 0) NULL,
 CONSTRAINT [DW_AUTH_FUNDING_TYPES_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_BANK_ACCOUNTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_BANK_ACCOUNTS](
	[BANK_ACCOUNT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BANK_CODE_DESC] [varchar](25) NOT NULL,
	[BANK_BRANCH_DESC] [varchar](25) NOT NULL,
	[INVARIANT_BANK_BRANCH_DESC] [varchar](25) NULL,
	[BANK_ACCOUNT_NUMBER_DESC] [varchar](100) NOT NULL,
	[SECURITY_NUMBER_CODE] [varchar](7) NOT NULL,
	[SECURITY_NUMBER_DESC] [varchar](110) NULL,
	[BANK_ACCOUNT_NAME_DESC] [varchar](200) NULL,
	[IBAN_SECURITY_NBR] [numeric](2, 0) NULL,
	[IBAN_ACCOUNT_DESC] [varchar](100) NULL,
	[CONTRACT_CURRENCY_CODE] [varchar](3) NULL,
	[CONTRACT_CURRENCY_DESC] [varchar](25) NULL,
	[ACCOUNT_TYPE_CODE] [varchar](15) NULL,
	[ACCOUNT_TYPE_DESC] [varchar](250) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[VIRTUAL_ACCOUNT_IND] [numeric](1, 0) NULL,
	[BANK_ACCOUNT_OWNER_DESC] [varchar](150) NULL,
 CONSTRAINT [DW_BANK_ACCOUNTS_KEY] PRIMARY KEY CLUSTERED 
(
	[BANK_ACCOUNT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_BATCH]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_BATCH](
	[BATCH_RUN_ID] [numeric](10, 0) NOT NULL,
	[BATCH_RUN_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BATCH_START_DT] [date] NOT NULL,
	[BATCH_CMD] [varchar](2000) NOT NULL,
	[USERNAME_CODE] [varchar](30) NULL,
	[USERNAME_DESC] [varchar](100) NULL,
	[BATCH_END_DT] [date] NULL,
	[BATCH_RETURN_CODE] [numeric](2, 0) NULL,
	[BATCH_PROCESS_DT] [date] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_BATCH_ERR_INVOICING]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_BATCH_ERR_INVOICING](
	[BATCH_INV_RUN_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BATCH_INV_ERR_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[CONTRACT_NUM_ID] [numeric](10, 0) NULL,
	[CONTRACT_NUM_DESC] [varchar](15) NULL,
	[CONTRACT_STATUS] [varchar](7) NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[MISC_INV_ID] [numeric](10, 0) NULL,
	[MISC_STATUS] [varchar](7) NULL,
	[BATCH_INV_DUE_DT] [date] NULL,
	[INVOICE_ID] [numeric](10, 0) NULL,
	[INVOICE_LINE_NBR] [numeric](10, 0) NULL,
	[INVOICE_NBR_DESC] [varchar](15) NULL,
	[BATCH_INV_ERR_MSG_ID] [numeric](10, 0) NULL,
	[BATCH_INV_ERR_MSG_DESC] [varchar](250) NULL,
	[COMPANY_ID] [numeric](10, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_BATCH_ERR_TRANSACTION]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_BATCH_ERR_TRANSACTION](
	[BATCH_TRANS_RUN_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BATCH_TRANS_ERR_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[BATCH_TRANS_ERR_EXPENSE_ID] [numeric](10, 0) NULL,
	[BATCH_TRANS_ERR_INVOICE_ID] [numeric](10, 0) NULL,
	[ERR_EXP_ORDER_NBR] [numeric](10, 0) NULL,
	[BATCH_INV_ERR_MSG_ID] [numeric](10, 0) NULL,
	[BATCH_INV_ERR_MSG_DESC] [varchar](2000) NULL,
	[BATCH_TRANS_ERR_TRANS_ID] [numeric](10, 0) NULL,
	[ERR_LINE_NBR] [numeric](10, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_BATCH_ERROR]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_BATCH_ERROR](
	[BATCH_RUN_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BATCH_ERR_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[ERROR_ID] [numeric](10, 0) NULL,
	[ERROR_DESC] [varchar](2000) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_BATCH_INVOICING]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_BATCH_INVOICING](
	[BATCH_INV_RUN_ID] [numeric](10, 0) NOT NULL,
	[BATCH_INV_RUN_CODE] [varchar](7) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BATCH_INV_DT] [date] NULL,
	[CONTRACT_NUM_DESC_START] [varchar](15) NULL,
	[CONTRACT_NUM_DESC_END] [varchar](15) NULL,
	[ACTOR_NUM_DESC_START] [varchar](15) NULL,
	[ACTOR_NUM_DESC_END] [varchar](15) NULL,
	[COMPANY_LIST_ID] [varchar](250) NULL,
	[BUSINESS_LIST] [varchar](250) NULL,
	[BATCH_INV_START_DT] [date] NULL,
	[BATCH_INV_END_DT] [date] NULL,
	[BATCH_RCVBL_ID_START] [numeric](10, 0) NULL,
	[BATCH_RCVBL_ID_END] [numeric](10, 0) NULL,
	[BATCH_INV_DUE_DT] [date] NULL,
	[BATCH_INV_COMMAND_LINE] [varchar](2000) NULL,
	[BATCH_INV_MODE] [varchar](15) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_BATCH_TRANSACTION]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_BATCH_TRANSACTION](
	[BATCH_TRANS_RUN_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BATCH_TRANS_METHOD_CODE] [varchar](7) NULL,
	[BATCH_TRANS_METHOD_DESC] [varchar](255) NULL,
	[BATCH_CURRENCY_CODE] [varchar](7) NULL,
	[BATCH_TRANS_END_DUE_DT] [date] NULL,
	[BATCH_TRANS_START_DT] [date] NULL,
	[BATCH_TRANS_END_DT] [date] NULL,
	[BATCH_TRANS_FAST_IND] [numeric](1, 0) NULL,
	[BATCH_TRANS_ID_START] [numeric](10, 0) NULL,
	[BATCH_TRANS_ID_END] [numeric](10, 0) NULL,
	[COMPANY_LIST_ID] [varchar](250) NULL,
	[FILE_LIST] [varchar](2000) NULL,
	[BATCH_TRANS_USER_CODE] [varchar](10) NULL,
	[BATCH_TRANS_USER_DESC] [varchar](250) NULL,
	[BATCH_TRANS_REJECT_IND] [numeric](1, 0) NULL,
	[BATCH_TRANS_RECORD_NBR] [numeric](10, 0) NULL,
	[BATCH_TRANS_RECORD_PROCESSED] [numeric](10, 0) NULL,
	[BATCH_TRANS_COMMAND_LINE] [varchar](2000) NULL,
	[BATCH_TRANS_BANK_ACCT_ID] [numeric](10, 0) NULL,
	[BATCH_TRANS_COMPANY_ID] [numeric](10, 0) NULL,
	[BATCH_TRANS_COUNT] [numeric](10, 0) NULL,
	[BATCH_TRANS_TOTAL_AMT] [numeric](10, 2) NULL,
	[BATCH_TRANS_COUNT_ADJUST] [numeric](10, 0) NULL,
	[BATCH_TRANS_TOTAL_AMT_ADJUST] [numeric](10, 2) NULL,
	[BATCH_TRANS_SEND_DT] [date] NULL,
	[BATCH_TRANS_VERIF_IND] [numeric](1, 0) NULL,
	[BATCH_TRANS_REJECT_END_DT] [date] NULL,
	[BATCH_TRANS_PREV_ID] [numeric](10, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CHART_OF_ACCOUNTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CHART_OF_ACCOUNTS](
	[CHART_OF_ACCOUNTS_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[GL_BOOK_CODE] [varchar](15) NULL,
	[GL_BOOK_DESC] [varchar](250) NULL,
	[GL_ACCOUNT_DESC] [varchar](200) NULL,
	[GL_ACCOUNT_NUMBER_DESC] [varchar](20) NULL,
	[GL_ACCOUNT_CLASS_CODE] [varchar](7) NULL,
	[GL_ACCOUNT_CLASS_DESC] [varchar](110) NULL,
	[INCORPORATED_ACCOUNT_IND] [numeric](1, 0) NULL,
	[GL_ACCOUNT_TYPE_CODE] [varchar](7) NULL,
	[GL_ACCOUNT_TYPE_DESC] [varchar](110) NULL,
	[INACTIVE_IND] [numeric](1, 0) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[BALANCE_IND] [numeric](1, 0) NULL,
	[CONTRACT_TO_BALANCE_IND] [numeric](1, 0) NULL,
	[ACTOR_TO_BALANCE_IND] [numeric](1, 0) NULL,
	[COUNTERPART_TO_BALANCE_IND] [numeric](1, 0) NULL,
	[MANAGEMENT_TO_BALANCE_IND] [numeric](1, 0) NULL,
	[COUNTERPART_TYPE_CODE] [varchar](15) NULL,
	[COUNTERPART_TYPE_DESC] [varchar](110) NULL,
	[MANAGEMENT_TYPE_CODE] [varchar](15) NULL,
	[MANAGEMENT_TYPE_DESC] [varchar](110) NULL,
	[DAYS_TO_MATURITY_NBR] [numeric](5, 0) NULL,
	[MANAGEMENT_DEPARTMENT_CODE] [varchar](7) NULL,
	[MANAGEMENT_DEPARTMENT_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_CHART_OF_ACCOUNTS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CHART_OF_ACCOUNTS_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_COLLATERAL]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_COLLATERAL](
	[COLLATERAL_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[GUARANTEE_SERIAL_NBR] [varchar](50) NULL,
	[COUNTRY_CODE] [varchar](7) NULL,
	[COUNTRY_DESC] [varchar](50) NULL,
	[COLLATERAL_TYPE_CODE] [varchar](7) NOT NULL,
	[COLLATERAL_TYPE_DESC] [varchar](50) NULL,
	[COLLATERAL_NATURE_CODE] [varchar](7) NULL,
	[COLLATERAL_NATURE_DESC] [varchar](50) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[USER_CODE] [varchar](30) NULL,
	[USER_DESC] [varchar](50) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[LIMIT_CURRENCY_CODE] [varchar](3) NULL,
	[LIMIT_CURRENCY_DESC] [varchar](25) NULL,
	[NOMINAL_CERTIFICATE_AMT] [numeric](15, 2) NULL,
	[LIMIT_AMT] [numeric](15, 2) NULL,
	[COLLATERAL_NAME_DESC] [varchar](50) NULL,
	[GUARANTEE_TYPE_CODE] [varchar](15) NULL,
	[GUARANTEE_TYPE_DESC] [varchar](200) NULL,
	[LIABILITY_TYPE_CODE] [varchar](15) NULL,
	[LIABILITY_TYPE_DESC] [varchar](250) NULL,
	[LIABILITY_CODE] [varchar](15) NULL,
	[LIABILITY_DESC] [varchar](15) NULL,
	[OTHER_INFO_DESC] [varchar](2000) NULL,
	[LATEST_REVIEWAL_DT] [date] NULL,
	[RANK_NBR] [numeric](2, 0) NULL,
	[GUARANTOR_INFORMED_IND] [numeric](1, 0) NULL,
	[MATURITY_DT] [date] NULL,
	[STATUS_CODE] [varchar](7) NULL,
	[STATUS_DESC] [varchar](250) NULL,
	[LEGAL_EFFECTIVE_DT] [date] NULL,
	[ENFORCE_ABILITY_IND] [numeric](1, 0) NULL,
	[CORRELATION_IND] [numeric](1, 0) NULL,
	[COLLATERAL_AGREEMENT_END_DT] [date] NULL,
	[LEGAL_CONDITION_IND] [numeric](1, 0) NULL,
	[SURETY_AMT] [varchar](15) NULL,
	[LIABILITY_PURPOSE_CODE] [varchar](15) NULL,
	[LIABILITY_PURPOSE_DESC] [varchar](200) NULL,
	[CERTIFICATE_IND] [numeric](1, 0) NULL,
	[VOTING_RIGHTS_IND] [numeric](1, 0) NULL,
	[ADDITIONAL_INFO_DESC] [varchar](250) NULL,
	[PLEDGE_DT] [date] NULL,
	[NOTIFICATION_DT] [date] NULL,
	[CONFIRMATION_DT] [date] NULL,
	[EXTERNAL_THIRDPARTY_DESC] [varchar](50) NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[TELEPHONE_ORDER_NBR] [numeric](10, 0) NULL,
 CONSTRAINT [DW_COLLATERAL_KEY] PRIMARY KEY CLUSTERED 
(
	[COLLATERAL_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_COLLATERAL_OBJECT]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_COLLATERAL_OBJECT](
	[COLLATERAL_ID] [numeric](10, 0) NOT NULL,
	[COLLATERAL_OBJECT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[INVESTMENT_ID] [numeric](10, 0) NULL,
	[INVESTMENT_ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[COMPONENT_ORDER_NBR] [numeric](10, 0) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[REALESTATE_ID] [numeric](10, 0) NULL,
	[START_DT] [date] NULL,
	[COLLATERAL_OBJECT_RANK_NBR] [numeric](2, 0) NULL,
	[LEGAL_EFFECTIVE_DT] [date] NULL,
	[ENFORCE_ABILITY_IND] [numeric](1, 0) NULL,
	[CORRELATION_IND] [numeric](1, 0) NULL,
	[END_DT] [date] NULL,
	[PRIORITY_RANK_NBR] [numeric](10, 0) NULL,
	[ALA_CALC_METHOD_CODE] [varchar](15) NULL,
	[ALA_CALC_METHOD_DESC] [varchar](110) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[COLLATERAL_OBJECT_TYPE_CODE] [varchar](15) NULL,
	[COLLATERAL_OBJECT_TYPE_DESC] [varchar](110) NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](32) NULL,
	[COVERABLE_IND] [numeric](1, 0) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[UNIT_CODE] [varchar](15) NULL,
	[UNIT_DESC] [varchar](110) NULL,
	[BUYING_PRICE_PER_UNIT] [numeric](15, 2) NULL,
	[SELLING_PRICE_PER_UNIT] [numeric](15, 2) NULL,
	[ASSET_COMPONENT_ORDER_NBR] [numeric](10, 0) NULL,
	[DEAL_VERSION_CODE] [varchar](7) NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[USED_AMT] [numeric](15, 2) NULL,
	[ASSET_APPRAISAL_IND] [numeric](1, 0) NULL,
	[ACCEPTANCE_RATIO_PCT] [numeric](11, 8) NULL,
	[ACCEPTED_VALUE_AMT] [numeric](15, 2) NULL,
	[ACTIVATION_FEE_AMT] [numeric](15, 2) NULL,
	[OWNERSHIP_SHARE_PCT] [numeric](11, 8) NULL,
	[VALID_VALUE_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_COLLATERAL_OBJECT_KEY] PRIMARY KEY CLUSTERED 
(
	[COLLATERAL_ID] ASC,
	[COLLATERAL_OBJECT_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_COLLATERAL_OBJECT_VALUES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_COLLATERAL_OBJECT_VALUES](
	[COLLATERAL_ID] [numeric](10, 0) NOT NULL,
	[COLLATERAL_OBJECT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[COLLATERAL_VALUE_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CONTRACT_CURRENCY_CODE] [varchar](3) NULL,
	[CONTRACT_CURRENCY_DESC] [varchar](25) NULL,
	[VALUE_TYPE_CODE] [varchar](15) NULL,
	[VALUE_TYPE_DESC] [varchar](110) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[VALUE_DESC] [varchar](100) NULL,
	[VALUE_DT] [date] NULL,
	[VALUE_AMT] [numeric](15, 2) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_COLLATERAL_OBJECT_VALUES_KEY] PRIMARY KEY CLUSTERED 
(
	[COLLATERAL_ID] ASC,
	[COLLATERAL_OBJECT_ORDER_NBR] ASC,
	[COLLATERAL_VALUE_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_COLLATERAL_PHASE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_COLLATERAL_PHASE](
	[COLLATERAL_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[START_DT] [date] NULL,
	[USER_CODE] [varchar](30) NULL,
	[USER_DESC] [varchar](50) NULL,
	[PHASE_CODE] [varchar](7) NULL,
	[PHASE_DESC] [varchar](25) NULL,
	[DESTINATION_CODE] [varchar](15) NULL,
	[DESTINATION_DESC] [varchar](110) NULL,
	[STEP_CODE] [varchar](7) NULL,
	[STEP_DESC] [varchar](100) NULL,
	[END_DT] [date] NULL,
	[UPDATE_DT] [date] NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_COLLATERAL_PHASE_KEY] PRIMARY KEY CLUSTERED 
(
	[COLLATERAL_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_COLLATERAL_REGISTRATIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_COLLATERAL_REGISTRATIONS](
	[COLLATERAL_ID] [numeric](10, 0) NOT NULL,
	[COLLATERAL_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[COLLATERAL_OBJECT_ORDER_NBR] [numeric](10, 0) NULL,
	[REGISTRATION_TYPE_CODE] [varchar](15) NULL,
	[REGISTRATION_TYPE_DESC] [varchar](110) NULL,
	[REFERENCE_DESC] [varchar](50) NULL,
	[REGISTRATION_AMT] [numeric](15, 2) NULL,
	[INSURANCE_AMT] [numeric](15, 2) NULL,
	[LIMIT_NBR] [numeric](10, 0) NULL,
	[REGISTRATION_REASON_CODE] [varchar](15) NULL,
	[REGISTRATION_REASON_DESC] [varchar](110) NULL,
	[REGISTERER_ACTOR_ID] [numeric](10, 0) NULL,
	[REGISTERER_ADDRESS_COUNT_NBR] [numeric](10, 0) NULL,
	[MORTGAGE_SETTING_DT] [date] NULL,
	[MORTGAGE_WRITE_OFF_DT] [date] NULL,
	[CONFIRM_DT] [date] NULL,
	[NOTARIZATION_ACTOR_ID] [numeric](10, 0) NULL,
	[NOTARIZATION_ADDRESS_COUNT_NBR] [numeric](10, 0) NULL,
	[REGISTRATION_DT] [date] NULL,
	[TERMINATION_DT] [date] NULL,
	[CLAIM_TICKET_NUMBER_CODE] [varchar](15) NULL,
	[CLAIM_TICKET_NUMBER_DESC] [varchar](110) NULL,
	[GOODS_ISSUE_NUMBER_CODE] [varchar](15) NULL,
	[GOODS_ISSUE_NUMBER_DESC] [varchar](110) NULL,
	[FIRST_QUANTITY_NBR] [numeric](10, 0) NULL,
	[REMAIN_QUANTITY_NBR] [numeric](10, 0) NULL,
	[USER_CODE] [varchar](30) NULL,
	[USER_DESC] [varchar](50) NULL,
	[EXTERNAL_REFERENCE_CODE] [varchar](15) NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](110) NULL,
	[ORDER_HOLDER_NBR] [numeric](10, 0) NULL,
	[ORDER_NOTORIZATION_NBR] [numeric](10, 0) NULL,
	[ORDER_OWNER_NBR] [numeric](10, 0) NULL,
 CONSTRAINT [DW_COLLATERAL_REGISTRATIONS_KEY] PRIMARY KEY CLUSTERED 
(
	[COLLATERAL_ID] ASC,
	[COLLATERAL_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_COMPANIES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_COMPANIES](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BANK_ISSUER_CODE] [varchar](7) NULL,
	[BANK_ISSUER_DESC] [varchar](110) NULL,
	[TRANSMITTER_CODE] [varchar](7) NULL,
	[TRANSMITTER_DESC] [varchar](110) NULL,
	[NORMAL_DRAWING_CODE] [varchar](7) NULL,
	[NORMAL_DRAWING_DESC] [varchar](110) NULL,
	[TRANSFER_DRAWING_CODE] [varchar](7) NULL,
	[TRANSFER_DRAWING_DESC] [varchar](110) NULL,
	[EFFECTIVE_DRAWING_CODE] [varchar](7) NULL,
	[EFFECTIVE_DRAWING_DESC] [varchar](110) NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[RATE_CODE] [varchar](7) NULL,
	[RATE_DESC] [varchar](50) NULL,
	[INTEREST_CALC_METHOD_CODE] [numeric](5, 0) NULL,
	[INTEREST_CALC_METHOD_DESC] [varchar](50) NULL,
	[COMPANY_LOGO_DESC] [varchar](8) NULL,
	[INTERBANK_CODE] [varchar](7) NULL,
	[INTERBANK_DESC] [varchar](110) NULL,
	[INVOICE_PMT_DELAY_NBR] [numeric](3, 0) NULL,
	[SERVERIC_CODE_DESC] [varchar](8) NULL,
	[DIRECT_DEBIT_CODE] [varchar](7) NULL,
	[DIRECT_DEBIT_DESC] [varchar](110) NULL,
	[PMT_VALID_DELAY_NBR] [numeric](3, 0) NULL,
	[LATE_CHARGE_INVOICING_IND] [numeric](1, 0) NULL,
	[LATE_CHARGES_CHECK_IND] [numeric](1, 0) NULL,
	[MINIMUM_INVOICE_AMT] [numeric](15, 2) NULL,
	[FICP_CODE] [varchar](7) NULL,
	[FICP_DESC] [varchar](110) NULL,
	[CALENDAR_CODE] [numeric](5, 0) NULL,
	[CALENDAR_DESC] [varchar](50) NULL,
	[TAX_REGIME_CODE] [varchar](15) NULL,
	[TAX_REGIME_DESC] [varchar](15) NULL,
	[LATE_PAYMENT_MARGIN_PCT] [numeric](11, 8) NULL,
	[SEPA_CREDITOR_ID_DESC] [varchar](15) NULL,
	[COUNTRY_CODE] [varchar](7) NULL,
	[COUNTRY_DESC] [varchar](50) NULL,
	[ACCOUNTING_ACTOR_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_COMPANIES_KEY] PRIMARY KEY NONCLUSTERED 
(
	[ACTOR_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_ACTORS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_ACTORS](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[FLOOR_RATE_FORMULA_CODE] [numeric](5, 0) NULL,
	[FLOOR_RATE_FORMULA_DESC] [varchar](100) NULL,
	[CEILING_RATE_FORMULA_CODE] [numeric](5, 0) NULL,
	[CEILING_RATE_FORMULA_DESC] [varchar](100) NULL,
	[DELEGATING_ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[ACTOR_ROLE_CODE] [varchar](7) NULL,
	[ACTOR_ROLE_DESC] [varchar](50) NULL,
	[ROLE_DELEGATION_CODE] [varchar](15) NULL,
	[ROLE_DELEGATION_DESC] [varchar](110) NULL,
	[RATE_CODE] [varchar](7) NULL,
	[RATE_DESC] [varchar](50) NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[INT_CALCULATION_METHOD_CODE] [numeric](5, 0) NULL,
	[INT_CALCULATION_METHOD_DESC] [varchar](50) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[REPLACING_ACTORS_ORDER_NBR] [numeric](10, 0) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[INVOICE_GROUPING_CODE] [varchar](7) NULL,
	[INVOICE_GROUPING_DESC] [varchar](110) NULL,
	[PRINT_CORRESPONDANT_IND] [numeric](1, 0) NULL,
	[PAYMENT_DELAY_IN_ADVANCE_NBR] [numeric](3, 0) NULL,
	[PAYMENT_DELAY_IN_ARREARS_NBR] [numeric](3, 0) NULL,
	[EARLY_INVOICING_NBR] [numeric](3, 0) NULL,
	[INVOICING_ROUNDING_CODE] [varchar](7) NULL,
	[INVOICING_ROUNDING_DESC] [varchar](110) NULL,
	[INVOICE_COMMENT_DESC] [varchar](250) NULL,
	[CUSTOMER_REFERENCE_DESC] [varchar](20) NULL,
	[SECURITY_DEPOSIT_FIX_RATE_PCT] [numeric](11, 8) NULL,
	[FINANCED_ASSET_DESC] [varchar](500) NULL,
	[INVOICE_CALCULATED_IND] [numeric](1, 0) NULL,
	[PAYMENT_BY_CHECK_IND] [numeric](1, 0) NULL,
	[LATE_PMT_MIN_INT_BASIS_AMT] [numeric](15, 2) NULL,
	[LATE_PMT_INT_LUMP_SUM_AMT] [numeric](15, 2) NULL,
	[LATE_PMT_RATE_FLOOR_PCT] [numeric](11, 8) NULL,
	[LATE_PMT_RATE_CEILING_PCT] [numeric](11, 8) NULL,
	[SECURITY_DEP_COVERAGE_MTHS_NBR] [numeric](5, 0) NULL,
	[SEC_DEP_COVERAGE_QUOTA_AMT] [numeric](15, 2) NULL,
	[FIXED_DEPOSIT_AMT] [numeric](15, 2) NULL,
	[SECURITY_DEPOSIT_REVISABLE_IND] [numeric](1, 0) NULL,
	[CURVE_BASED_SECURITY_DEP_IND] [numeric](1, 0) NULL,
	[LATE_PMT_INTEREST_MARGIN_PCT] [numeric](11, 8) NULL,
	[LATE_PMT_INTEREST_FIX_RATE_PCT] [numeric](11, 8) NULL,
	[UNPAID_AMOUNT_APPLIED_PCT] [numeric](11, 8) NULL,
	[REMINDER_NON_INCLUSION_CODE] [varchar](15) NULL,
	[REMINDER_NON_INCLUSION_DESC] [varchar](110) NULL,
	[PROJ_BRANCH_COMMISSION_PCT] [numeric](11, 8) NULL,
	[DAYS_DELAY_TYPE_CODE] [varchar](7) NULL,
	[DAYS_DELAY_TYPE_DESC] [varchar](110) NULL,
	[INVOICE_COPIES_NBR] [numeric](1, 0) NULL,
	[SEC_DEP_ANUL_RENT_INC_TAX_IND] [numeric](1, 0) NULL,
	[NON_SYNDICATED_LATE_PMT_IND] [numeric](1, 0) NULL,
	[NON_PROFESSIONAL_USAGE_IND] [numeric](1, 0) NULL,
	[SHORTFALL_OPTION_CODE] [varchar](15) NULL,
	[SHORTFALL_OPTION_DESC] [varchar](110) NULL,
	[CAPITALIZATION_CONTRACT_ID] [numeric](10, 0) NULL,
	[CAPITALIZATION_ELEMENT_NBR] [numeric](10, 0) NULL,
	[EXCESS_CASH_OPTION_CODE] [varchar](15) NULL,
	[EXCESS_CASH_OPTION_DESC] [varchar](110) NULL,
	[EXCESS_CASH_ELEMENT_NBR] [numeric](10, 0) NULL,
	[MEANS_OF_TRANSFER_CODE] [varchar](7) NULL,
	[MEANS_OF_TRANSFER_DESC] [varchar](110) NULL,
	[INVOICE_EMAIL_ADDRESS_DESC] [varchar](200) NULL,
	[PART_REMITTANCE_METHOD_CODE] [varchar](15) NULL,
	[PART_REMITTANCE_METHOD_DESC] [varchar](110) NULL,
	[MANDATE_ID] [numeric](10, 0) NULL,
	[DEFAULT_INTEREST_FLOOR_AMT] [numeric](15, 2) NULL,
	[DEFAULT_INTEREST_LUMP_SUM_AMT] [numeric](15, 2) NULL,
	[DEFAULT_INTEREST_LUMP_SUM_PCT] [numeric](11, 8) NULL,
	[DUE_DATE_FIXED_DAY_CODE] [varchar](7) NULL,
	[DUE_DATE_FIXED_DAY_DESC] [varchar](110) NULL,
	[LATE_PAYMENT_INT_TRIGGER_AMT] [numeric](3, 0) NULL,
	[LATE_PAYMENT_INT_TOLERANCE_AMT] [numeric](3, 0) NULL,
	[LATE_PAYMENT_INT_DELAY_NBR] [numeric](3, 0) NULL,
	[ALA_CALCULATION_METHOD_CODE] [varchar](15) NULL,
	[ALA_CALCULATION_METHOD_DESC] [varchar](15) NULL,
	[BILLING_STATEMENT_METHOD_CODE] [varchar](15) NULL,
	[BILLING_STATEMENT_METHOD_DESC] [varchar](110) NULL,
	[TAX_EXEMPT_CERT_REF_DESC] [varchar](200) NULL,
	[TAX_EXEMPT_AGREEMENT_DT] [date] NULL,
	[TAX_EXEMPTION_START_DT] [date] NULL,
	[TEMP_REMINDER_STOP_DT] [date] NULL,
	[REMAINDER_STOP_TYPE_CODE] [varchar](15) NULL,
	[REMAINDER_STOP_TYPE_DESC] [varchar](110) NULL,
	[LATE_PMT_FLOOR_TYPE_CODE] [varchar](15) NULL,
	[LATE_PMT_FLOOR_TYPE_DESC] [varchar](110) NULL,
	[LATE_PMT_CEILING_TYPE_CODE] [varchar](15) NULL,
	[LATE_PMT_CEILING_TYPE_DESC] [varchar](110) NULL,
	[INVOICING_OFFSET_CODE] [varchar](7) NULL,
	[INVOICING_OFFSET_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_CONTRACT_ACTORS_KEY] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_BALANCES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_BALANCES](
	[RECORD_ID] [numeric](22, 0) NOT NULL,
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[EFFECTIVE_DATE_KEY] [numeric](8, 0) NOT NULL,
	[CURRENT_IND] [numeric](1, 0) NULL,
	[BALANCE_TYPE_DESC] [varchar](20) NOT NULL,
	[ENTRY_DATE_AMT] [numeric](15, 2) NULL,
	[VALUE_DATE_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_CONTRACT_BALANCES_KEY] PRIMARY KEY CLUSTERED 
(
	[RECORD_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_CHARACTERISTICS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_CHARACTERISTICS](
	[CONTRACT_CHARACTERISTIC_ID] [numeric](10, 0) NOT NULL,
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[CHARACTERISTIC_CODE] [varchar](150) NULL,
	[CHARACTERISTIC_DESC] [varchar](150) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DATA_TYPE_DESC] [varchar](12) NOT NULL,
	[NUMERIC_VALUE_AMT] [numeric](22, 7) NULL,
	[STRING_VALUE_DESC] [varchar](2000) NULL,
	[DATE_VALUE_DT] [date] NULL,
	[BOOLEAN_VALUE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_CONTRACT_CHARACTERISTICS_KEY] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_CREDIT_INFO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_CREDIT_INFO](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CREDIT_TYPE_CODE] [varchar](7) NULL,
	[CREDIT_TYPE_DESC] [varchar](250) NULL,
	[CONTRACT_CLASS_CODE] [varchar](7) NULL,
	[CONTRACT_CLASS_DESC] [varchar](250) NULL,
	[FRANCE_BANK_ELIGIBILITY_IND] [numeric](1, 0) NULL,
	[IEOM_ELIGIBILITY_IND] [numeric](1, 0) NULL,
	[IEDOM_ELIGIBILITY_IND] [numeric](1, 0) NULL,
	[MTGE_MARKET_ELIGIBILITY_IND] [numeric](1, 0) NULL,
	[BAFI_RANKING_CODE] [varchar](7) NULL,
	[BAFI_RANKING_DESC] [varchar](110) NULL,
	[REVOCABILITY_IND] [numeric](1, 0) NULL,
	[REVOCABILITY_DELAY_MONTHS_NBR] [numeric](3, 0) NULL,
	[PLANNED_DRAW_RATE_PCT] [numeric](11, 8) NULL,
	[CONVERTABILITY_IND] [numeric](1, 0) NULL,
	[TACIT_RENEWAL_IND] [numeric](1, 0) NULL,
	[REVOLVING_CREDIT_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_CONTRACT_CREDIT_INFO_KEY] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_CURRENCIES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_CURRENCIES](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CURRENCY_CODE] [varchar](3) NOT NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[TARGET_USAGE_CODE] [varchar](15) NULL,
	[TARGET_USAGE_DESC] [varchar](110) NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[ROUNDING_METHOD_CODE] [varchar](15) NULL,
	[ROUNDING_METHOD_DESC] [varchar](110) NULL,
	[LATE_PMT_MIN_PEN_ROUND_AMT] [numeric](15, 2) NULL,
	[LATE_PMT_LUMP_SUM_ROUND_AMT] [numeric](15, 2) NULL,
	[FLOOR_INTEREST_ROUND_AMT] [numeric](15, 2) NULL,
	[LUMP_INTEREST_ROUND_AMT] [numeric](15, 2) NULL,
	[ROUNDING_SCALE_NBR] [numeric](10, 0) NULL,
	[EXCHANGE_RATE_FORMULA_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_CONTRACT_CURRENCIES_KEY] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_DOCUMENTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_DOCUMENTS](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[DOCUMENT_TRACKING_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NULL,
	[DOCUMENT_DT] [date] NULL,
	[DOCUMENT_ID] [numeric](10, 0) NULL,
	[DOCUMENT_TYPE_CODE] [varchar](15) NULL,
	[DOCUMENT_TYPE_DESC] [varchar](250) NULL,
	[ACTION_NEEDED_IND] [numeric](1, 0) NULL,
	[ACTION_SOLVED_IND] [numeric](1, 0) NULL,
	[ADDED_BY_CODE] [varchar](30) NULL,
	[ADDED_BY_DESC] [varchar](50) NULL,
	[COMMENT_DESC] [varchar](50) NULL,
	[TASK_ID] [numeric](10, 0) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NULL,
	[BUILDING_ID] [numeric](10, 0) NULL,
	[INVESTMENT_ID] [numeric](10, 0) NULL,
	[SITE_ID] [numeric](10, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[TENDER_ID] [numeric](10, 0) NULL,
	[CLAIM_ID] [numeric](10, 0) NULL,
	[MANDATE_ID] [numeric](10, 0) NULL,
	[INSURANCE_POLICY_ID] [numeric](10, 0) NULL,
	[GUARANTY_ORDER_NBR] [numeric](10, 0) NULL,
	[BATCH_ID] [numeric](10, 0) NULL,
	[ROLE_CODE] [varchar](7) NULL,
	[ROLE_DESC] [varchar](50) NULL,
	[BUDGET_ID] [numeric](10, 0) NULL,
	[SERVICING_AGREEMENT_ID] [numeric](10, 0) NULL,
	[WORK_ORDER_ID] [numeric](10, 0) NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NULL,
	[TRANSACTION_ID] [numeric](10, 0) NULL,
	[ANDROMEDE_CONTRACT_ID] [numeric](10, 0) NULL,
	[DOCUMENT_PATH_DESC] [varchar](264) NULL,
	[FILE_NAME_DESC] [varchar](50) NULL,
	[MEMO_TXT] [varchar](2000) NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](50) NULL,
	[DOCUMENT_STATUS_CODE] [varchar](15) NULL,
	[DOCUMENT_STATUS_DESC] [varchar](250) NULL,
	[MEMO2_TXT] [varchar](2000) NULL,
	[AUTHORISED_USER_CODE] [varchar](30) NULL,
	[AUTHORISED_USER_DESC] [varchar](50) NULL,
	[COVENANT_ID] [numeric](10, 0) NULL,
	[COVENANT_ORDER_NBR] [numeric](10, 0) NULL,
	[INSPECTION_ORDER_NBR] [numeric](10, 0) NULL,
	[RESENDING_REASON_CODE] [varchar](15) NULL,
	[RESENDING_REASON_DESC] [varchar](110) NULL,
	[SENDING_METHOD_CODE] [varchar](15) NULL,
	[SENDING_METHOD_DESC] [varchar](110) NULL,
	[DELIVERY_STATUS_CODE] [varchar](15) NULL,
	[DELIVERY_STATUS_DESC] [varchar](110) NULL,
	[DETAILED_STATUS_CODE] [varchar](15) NULL,
	[DETAILED_STATUS_DESC] [varchar](110) NULL,
	[NOT_SENDING_REASON_CODE] [varchar](15) NULL,
	[NOT_SENDING_REASON_DESC] [varchar](110) NULL,
	[RESENT_IND] [numeric](1, 0) NULL,
	[BAR_CODE_DESC] [varchar](50) NULL,
	[REGISTERED_MAIL_NO_DESC] [varchar](200) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[COLLATERAL_ID] [numeric](10, 0) NULL,
	[COLLECTION_CASE_ID] [numeric](10, 0) NULL,
	[MAIL_SENT_DT] [date] NULL,
	[MAIL_RETURNED_DT] [date] NULL,
	[NATIONAL_ID_CODE] [varchar](15) NULL,
	[NATIONAL_ID_DESC] [varchar](250) NULL,
	[POST_OFFICE_RETURN_CODE] [varchar](15) NULL,
	[POST_OFFICE_RETURN_DESC] [varchar](250) NULL,
	[INTERNAL_RETURN_CODE] [varchar](15) NULL,
	[INTERNAL_RETURN_DESC] [varchar](250) NULL,
	[NOTARIZATION_INPUT_DT] [date] NULL,
	[NOTARIZATION_REGISTER_DT] [date] NULL,
	[NOTARIZATION_REFERENCE_DESC] [varchar](50) NULL,
	[RECEIVED_LOCATION_CODE] [varchar](15) NULL,
	[RECEIVED_LOCATION_DESC] [varchar](110) NULL,
	[MATRIX_ID] [numeric](10, 0) NULL,
	[SCAN_DT] [date] NULL,
	[PREVIOUS_SCAN_DT] [date] NULL,
	[UPDATE_DT] [date] NULL,
	[DOCUMENT_CATEGORY_CODE] [varchar](15) NULL,
	[DOCUMENT_CATEGORY_DESC] [varchar](110) NULL,
	[ISSUE_NUMBER_DESC] [varchar](60) NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[PRODUCT_VERSION_NBR] [numeric](10, 0) NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[PRICING_ELEMENT_ID] [numeric](10, 0) NULL,
	[HISTORY_ORDER_NBR] [numeric](10, 0) NULL,
	[INTERNAL_TRANSACTION_ID] [numeric](10, 0) NULL,
	[CARD_ID] [numeric](10, 0) NULL,
	[BILLING_ACCOUNT_DESC] [varchar](50) NULL,
	[ACTOR_TELECOM_ORDER_NBR] [numeric](10, 0) NULL,
	[ADDRESS_ID] [numeric](10, 0) NULL,
	[DEPARTMENT_CODE] [varchar](7) NULL,
	[DEPARTMENT_DESC] [varchar](110) NULL,
 CONSTRAINT [PK_DW_CONTRACT_DOCUMENTS] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[DOCUMENT_TRACKING_ID] ASC,
	[DIM_DATE_KEY] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_EXCHANGE_RATES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_EXCHANGE_RATES](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[CURRENCY_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[RATE_CHANGE_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[VALUE_TYPE_CODE] [varchar](15) NULL,
	[VALUE_TYPE_DESC] [varchar](110) NULL,
	[VALUE_DT] [date] NULL,
	[CHANGE_VALUE_AMT] [numeric](15, 2) NULL,
	[UPDATED_IND] [numeric](1, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[MARGIN_AMT] [numeric](22, 5) NULL,
	[REFERENCE_DATE_DESC] [varchar](15) NULL,
	[PERIOD_CODE] [varchar](7) NULL,
	[PERIOD_DESC] [varchar](110) NULL,
	[MULTIPLE_NBR] [numeric](3, 0) NULL,
	[LOOK_BACK_TYPE_CODE] [varchar](15) NULL,
	[LOOK_BACK_TYPE_DESC] [varchar](110) NULL,
	[LOOK_BACK_NBR] [numeric](3, 0) NULL,
	[VALUE_END_DT] [date] NULL,
	[EXCHANGE_RATE_VALUE_NBR] [numeric](10, 0) NULL,
 CONSTRAINT [PK_DW_CONTRACT_EXCHANGE_RATES] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[CURRENCY_ORDER_NBR] ASC,
	[RATE_CHANGE_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_FINANCE_INFO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_FINANCE_INFO](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[FUNDING_DT] [date] NOT NULL,
	[REQUESTED_AMT] [numeric](15, 2) NULL,
	[TOTAL_FINANCED_AMT] [numeric](15, 2) NULL,
	[RESIDUAL_AMT] [numeric](15, 2) NULL,
	[FEE_AMT] [numeric](15, 2) NULL,
	[AMORTIZABLE_AMT] [numeric](15, 2) NULL,
	[NON_AMORTIZABLE_AMT] [numeric](15, 2) NULL,
	[VARIABLE_RATE_INDEX_IND] [numeric](1, 0) NULL,
	[VARIABLE_RATE_PCT] [numeric](5, 2) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[SYNDICATION_ID] [numeric](10, 0) NULL,
	[TAXES_ON_TOTAL_FINANCED_AMT] [numeric](15, 2) NULL,
	[TAXES_ON_FINANCING_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_CONTRACT_FINANCE_INFO_KEY] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_CONTRACT_GUARANTEE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_GUARANTEE](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[GUARANTEE_TYPE_CODE] [varchar](7) NULL,
	[GUARANTEE_TYPE_DESC] [varchar](50) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[BASIS_CODE] [varchar](15) NULL,
	[GUARANTEE_AMT] [numeric](15, 2) NULL,
	[FLAG_GUARANTOR] [numeric](1, 0) NULL,
	[MAX_AMT] [numeric](15, 2) NULL,
	[FRANCHISE_AMT] [numeric](15, 2) NULL,
	[MIN_AMT] [numeric](15, 2) NULL,
	[PHASE_CODE] [varchar](7) NULL,
	[PHASE_CODE_DESC] [varchar](50) NULL,
	[FLAG_OFF_BALANCE] [numeric](1, 0) NULL,
	[FLAG_BASIS_TAX] [numeric](1, 0) NULL,
	[SLIDING_MTHS_NBR] [numeric](3, 0) NULL,
	[ENTITY_DEST_CODE] [varchar](15) NULL,
	[ENTITY_DEST_CODE_DESC] [varchar](50) NULL,
	[GUARANTEE_STATUS] [varchar](50) NULL,
	[RCVD_DT_GUARANTEE] [date] NULL,
	[RCVD_FLAG_DOC] [numeric](1, 0) NULL,
	[GUARANTEE_USED_PCT] [numeric](11, 8) NULL,
	[GUARANTEE_MEMO_TXT] [varchar](2000) NULL,
	[ADDRESS_ID] [numeric](10, 0) NULL,
	[RECUPERATION_RANK] [varchar](15) NULL,
	[ANNUAL_RENT_PORTION] [numeric](10, 0) NULL,
	[RVW_FLAG_DEPOSIT] [numeric](1, 0) NULL,
	[FLAG_DEPOSIT_STEP] [numeric](1, 0) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[RENEW_TYPE_GUARANTEE] [varchar](15) NULL,
	[RENEWAL_FREQUENCY] [varchar](7) NULL,
	[MUTLIPLE_RENEWAL_FREQUENCY] [numeric](3, 0) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_CODE_DESC] [varchar](50) NULL,
	[COLLATERAL_ID] [numeric](10, 0) NULL,
	[COLLATERAL_ORDER_NBR] [numeric](10, 0) NULL,
	[COLLATERAL_NBR_DAYS_INACTIVE] [numeric](2, 0) NULL,
	[ROLLOVER_DT] [date] NULL,
	[CONTRACT_OCCURENCE_NBR] [numeric](10, 0) NULL,
	[REVISION_START_DT] [date] NULL,
	[REVISION_AMT] [numeric](15, 2) NULL,
PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ACTOR_ORDER_NBR] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_PHASES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_PHASES](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PHASE_CODE] [varchar](7) NOT NULL,
	[PHASE_DESC] [varchar](25) NULL,
	[PHASE_TYPE_CODE] [varchar](15) NOT NULL,
	[PHASE_TYPE_DESC] [varchar](110) NULL,
	[PHASE_RECORDED_BY_CODE] [varchar](30) NOT NULL,
	[PHASE_RECORDED_BY_DESC] [varchar](50) NOT NULL,
	[STEP_CODE] [varchar](7) NULL,
	[STEP_DESC] [varchar](100) NULL,
	[REASON_CODE] [varchar](15) NULL,
	[REASON_DESC] [varchar](250) NULL,
	[PHASE_EFFECTIVE_DT] [date] NOT NULL,
	[PHASE_END_DT] [date] NULL,
	[LAST_UPDATE_DT] [date] NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_CONTRACT_PHASES_KEY] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_CONTRACT_SYNDICATIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_CONTRACT_SYNDICATIONS](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[SYNDICATION_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
 CONSTRAINT [DW_CONTRACT_SYNDICATIONS_KEY] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[SYNDICATION_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_CONTRACTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_CONTRACTS](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NOT NULL,
	[USERNAME_CODE] [varchar](30) NULL,
	[USERNAME_DESC] [varchar](45) NULL,
	[BUSINESS_TYPE_CODE] [varchar](7) NOT NULL,
	[BUSINESS_TYPE_DESC] [varchar](50) NULL,
	[CONTRACT_NUMBER_DESC] [varchar](15) NOT NULL,
	[CONTRACT_NAME_DESC] [varchar](50) NOT NULL,
	[MANDATE_ID] [numeric](10, 0) NULL,
	[CONTRACT_AMENDMENT_NBR] [numeric](2, 0) NULL,
	[CONTRACT_STATUS_CODE] [varchar](7) NULL,
	[CONTRACT_STATUS_DESC] [varchar](110) NULL,
	[TERM_IN_DAYS_NBR] [numeric](5, 0) NULL,
	[TERM_IN_MONTHS_NBR] [numeric](5, 0) NULL,
	[TERM_IN_YEARS_NBR] [numeric](3, 0) NULL,
	[CONTRACT_START_DT] [date] NULL,
	[CONTRACT_END_DT] [date] NULL,
	[LAST_UPDATE_DT] [date] NULL,
	[SIGNATURE_DT] [date] NULL,
	[PUT_OPTION_DT] [date] NULL,
	[COMMITTEE_APPROVAL_DT] [date] NULL,
	[LEASE_START_DT] [date] NULL,
	[CONTRACT_1ST_ENTRY_DT] [date] NULL,
	[REG_PAYMENTS_START_DT] [date] NULL,
	[DOSPREAVIS_NBR] [numeric](5, 0) NULL,
	[EARLY_PAYOFF_PENALTY_TYPE_CODE] [varchar](7) NULL,
	[EARLY_PAYOFF_PENALTY_TYPE_DESC] [varchar](250) NULL,
	[PENALTY_AMT] [numeric](15, 2) NULL,
	[FISCAL_REGIME_CODE] [varchar](7) NULL,
	[FISCAL_REGIME_DESC] [varchar](110) NULL,
	[SYNDICATION_CODE] [varchar](7) NULL,
	[SYNDICATION_DESC] [varchar](110) NULL,
	[INITIAL_CONTRACT_RATE_PCT] [numeric](11, 8) NULL,
	[NEGOTIATED_RATE_PCT] [numeric](11, 8) NULL,
	[EXPECTED_MARGIN_RATE_PCT] [numeric](11, 8) NULL,
	[REVISABLE_IND] [numeric](1, 0) NULL,
	[FINANCING_TYPE_CODE] [varchar](7) NULL,
	[FINANCING_TYPE_DESC] [varchar](110) NULL,
	[REVISED_TERM_IN_YEARS_NBR] [numeric](3, 0) NULL,
	[REVISED_TERM_IN_MONTHS_NBR] [numeric](5, 0) NULL,
	[REVISED_TERM_IN_DAYS_NBR] [numeric](5, 0) NULL,
	[SIGNED_AMT] [numeric](15, 2) NULL,
	[COMMITTEE_AMT] [numeric](15, 2) NULL,
	[CREATION_AMT] [numeric](15, 2) NULL,
	[IN_SERVICE_AMT] [numeric](15, 2) NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[DEPARTMENT_CODE] [varchar](7) NULL,
	[DEPARTMENT_DESC] [varchar](250) NULL,
	[SCHEDULE_TYPE_CODE] [varchar](7) NULL,
	[SCHEDULE_TYPE_DESC] [varchar](250) NULL,
	[EXPECTED_MARGIN_AMT] [numeric](15, 2) NULL,
	[REFINANCING_CONTRACT_ID] [numeric](10, 0) NULL,
	[STRUCTURED_FINANCING_TYPE_CODE] [varchar](7) NULL,
	[STRUCTURED_FINANCING_TYPE_DESC] [varchar](110) NULL,
	[LUMP_SUM_ADDED_AMT] [numeric](15, 2) NULL,
	[EARLY_TERM_PENALTY_PCT] [numeric](11, 8) NULL,
	[US_GAAP_CODE] [varchar](15) NULL,
	[US_GAAP_DESC] [varchar](110) NULL,
	[CANCEL_PENALTY_CALC_TYPE_CODE] [varchar](7) NULL,
	[CANCEL_PENALTY_CALC_TYPE_DESC] [varchar](110) NULL,
	[LUMP_SUM_CANCELLATION_COMP_AMT] [numeric](15, 2) NULL,
	[EARLY_TERMINATION_RATE_PCT] [numeric](11, 8) NULL,
	[ASSET_CLASS_CODE] [varchar](7) NULL,
	[ASSET_CLASS_DESC] [varchar](65) NULL,
	[COUNTRY_CODE] [varchar](7) NULL,
	[COUNTRY_DESC] [varchar](50) NULL,
	[DOSFLAGRESTRUCT_IND] [numeric](1, 0) NULL,
	[DOSDTDEBRESTRUCT_DT] [date] NULL,
	[TRANSFERABILITY_CODE] [varchar](15) NULL,
	[TRANSFERABILITY_DESC] [varchar](15) NULL,
	[CONFIDENTIAL_IND] [numeric](1, 0) NULL,
	[EFFECTIVE_CALCULATED_RATE_PCT] [numeric](11, 8) NULL,
	[IAS_FISCAL_YEAR_NBR] [numeric](4, 0) NULL,
	[IAS_CONTRACT_CLASS_CODE] [varchar](15) NULL,
	[IAS_CONTRACT_CLASS_DESC] [varchar](110) NULL,
	[MICROCOVERED_IND] [numeric](1, 0) NULL,
	[SPECIFIC_ASSET_NATURE_IND] [numeric](1, 0) NULL,
	[RENT_AT_TERMINATION_IND] [numeric](1, 0) NULL,
	[OWNERSHIP_TRANSFER_AT_TERM_IND] [numeric](1, 0) NULL,
	[ASSET_LIFE_SPAN_IN_YEARS_NBR] [numeric](3, 0) NULL,
	[AUTO_INVOICE_RESIDUAL_IND] [numeric](1, 0) NULL,
	[RESIDUAL_LIFESPAN_MONTHS_NBR] [numeric](3, 0) NULL,
	[RESIDUAL_LIFESPAN_DAYS_NBR] [numeric](5, 0) NULL,
	[INITIAL_FAIR_VALUE_AMT] [numeric](15, 2) NULL,
	[RELATED_CONTRACT_ID] [numeric](10, 0) NULL,
	[ACTUARIAL_RATE_PCT] [numeric](11, 8) NULL,
	[IAS_CLASS_UPDATE_IND] [numeric](1, 0) NULL,
	[FORCED_CLASS_REASON_DESC] [varchar](2000) NULL,
	[BAD_DEBT_IND] [numeric](1, 0) NULL,
	[BAD_DEBT_LAST_XFER_DT] [date] NULL,
	[RATE_CODE] [varchar](7) NULL,
	[RATE_DESC] [varchar](50) NULL,
	[IAS_MARKET_CODE] [varchar](15) NULL,
	[IAS_MARKET_DESC] [varchar](110) NULL,
	[IAS_PRODUCT_CODE] [varchar](15) NULL,
	[IAS_PRODUCT_DESC] [varchar](110) NULL,
	[MARKET_RATE_VALUE_PCT] [numeric](11, 8) NULL,
	[MARKET_RATE_GAP_FOR_CLASS_PCT] [numeric](11, 8) NULL,
	[MARKET_RATE_GAP_FOR_IRREV_PCT] [numeric](11, 8) NULL,
	[INITIAL_DISCOUNT_AMT] [numeric](15, 2) NULL,
	[HEDGING_CATEGORY_CODE] [varchar](15) NULL,
	[HEDGING_CATEGORY_DESC] [varchar](110) NULL,
	[CALENDAR_CODE] [numeric](2, 0) NULL,
	[CALENDAR_DESC] [varchar](50) NULL,
	[COMMITMENT_END_DT] [date] NULL,
	[CONTRACT_COMMENT_DESC] [varchar](500) NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](15) NULL,
	[COMMERCIAL_NETWORK_CODE] [varchar](15) NULL,
	[COMMERCIAL_NETWORK_DESC] [varchar](110) NULL,
	[STATE_COUNTRY_CODE] [varchar](7) NULL,
	[STATE_COUNTRY_DESC] [varchar](50) NULL,
	[STATE_CODE] [varchar](7) NULL,
	[STATE_DESC] [varchar](50) NULL,
	[STATE_TYPE_CODE] [varchar](15) NULL,
	[STATE_TYPE_DESC] [varchar](110) NULL,
	[CONTRACT_VERSION_DESC] [varchar](250) NULL,
	[PRICING_CRITERIA_ID] [numeric](10, 0) NULL,
	[PRICING_CRITERIA_ORDER_NBR] [numeric](10, 0) NULL,
	[ANNUAL_USAGE_AMT] [numeric](15, 2) NULL,
	[UNIT_OF_MEASURE_CODE] [varchar](15) NULL,
	[UNIT_OF_MEASURE_DESC] [varchar](110) NULL,
	[PURCHASE_USAGE_AMT] [numeric](15, 2) NULL,
	[EXTERNAL_GRADE_CODE] [varchar](15) NULL,
	[EXTERNAL_GRADE_DESC] [varchar](110) NULL,
	[EXCESS_COST_USE_AMT] [numeric](15, 2) NULL,
	[SUBVENTION_TYPE_CODE] [varchar](15) NULL,
	[SUBVENTION_TYPE_DESC] [varchar](110) NULL,
	[MASTER_FACILITY_TYPE_CODE] [varchar](15) NULL,
	[MASTER_FACILITY_TYPE_DESC] [varchar](110) NULL,
	[DISCOUNT_INTEREST_RATE_PCT] [numeric](11, 8) NULL,
	[CONTRACT_TYPE_CODE] [varchar](15) NULL,
	[CONTRACT_TYPE_DESC] [varchar](110) NULL,
	[PROJECT_FINANCING_AMT] [numeric](15, 2) NULL,
	[PROJECT_FINANCING_DURATION_NBR] [numeric](10, 0) NULL,
	[PROJECT_FINANCING_CONTRACT_AMT] [numeric](15, 2) NULL,
	[CONSTRUCTION_DURATION_NBR] [numeric](10, 0) NULL,
	[GUARANTEE_AMT] [numeric](15, 2) NULL,
	[MATURITY_DT] [date] NULL,
	[COLLATERAL_CREDIT_LIMIT_AMT] [numeric](15, 2) NULL,
	[SALES_CREDIT_LIMIT_AMT] [numeric](15, 2) NULL,
	[STRAT_DLR_BLOCK_CRED_LIMIT_AMT] [numeric](15, 2) NULL,
	[IPD_DT] [date] NULL,
 CONSTRAINT [DW_CONTRACTS_KEY] PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_ACTORS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_ACTORS_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[ROLE_CODE] [varchar](7) NULL,
	[ROLE_DESC] [varchar](50) NULL,
	[DISBURSEMENT_BANK_ID] [numeric](10, 0) NULL,
	[DISBURSEMENT_PMT_METHOD_CODE] [varchar](7) NULL,
	[DISBURSEMENT_PMT_METHOD_DESC] [varchar](50) NULL,
	[COLLECTION_BANK_ID] [numeric](10, 0) NULL,
	[COLLECTION_PMT_METHOD_CODE] [varchar](7) NULL,
	[COLLECTION_PMT_METHOD_DESC] [varchar](50) NULL,
	[CONTACT_ORDER_NBR] [numeric](10, 0) NULL,
	[ATTACHMENT_UNIT_ORDER_NBR] [numeric](10, 0) NULL,
	[ACTOR_ADDRESS_ORDER_NBR] [numeric](10, 0) NULL,
	[SUPPLIER_TYPE_CODE] [varchar](15) NULL,
	[SUPPLIER_TYPE_DESC] [varchar](110) NULL,
	[DELIVERING_SUPPLIER_ACTOR_ID] [numeric](10, 0) NULL,
	[INVOICING_ADDRESS_ORDER_NBR] [numeric](10, 0) NULL,
	[INVOICING_ADDRESS_ID] [numeric](10, 0) NULL,
	[TAX_EXEMPTION_CERTIFICATE_DESC] [varchar](200) NULL,
	[BILLING_METHOD_CODE] [varchar](15) NULL,
	[BILLING_METHOD_DESC] [varchar](110) NULL,
	[CARIDENC_ID] [numeric](10, 0) NULL,
	[CARIDDEC_ID] [numeric](10, 0) NULL,
	[CAR_TYPE_CODE] [varchar](15) NULL,
	[CAR_TYPE_DESC] [varchar](110) NULL,
	[MARITAL_STATUS_CODE] [varchar](15) NULL,
	[MARITAL_STATUS_DESC] [varchar](110) NULL,
	[FAMILY_STATUS_CODE] [varchar](15) NULL,
	[FAMILY_STATUS_DESC] [varchar](110) NULL,
	[ASSET_FEE_AMT] [numeric](15, 2) NULL,
	[PROPERTY_LOCATION_DESC] [varchar](50) NULL,
	[BORROWER_OFFICE_DESC] [varchar](50) NULL,
	[BORROWER_OCCUPATION_CODE_DESC] [varchar](50) NULL,
	[BORROWER_POSITION_CODE_DESC] [varchar](50) NULL,
	[INCOMING_CERT_METHOD_CODE] [varchar](15) NULL,
	[INCOMING_CERT_METHOD_DESC] [varchar](110) NULL,
	[INCOMING_AMT] [numeric](15, 2) NULL,
	[BUSINESS_NUMBER_DESC] [varchar](50) NULL,
	[CORPORATION_NUMBER_DESC] [varchar](50) NULL,
	[PERSONAL_CORPORATION_IND] [numeric](1, 0) NULL,
	[LOAN_TYPE_CODE] [varchar](15) NULL,
	[LOAN_TYPE_DESC] [varchar](110) NULL,
	[COMPANY_JOIN_DT] [date] NULL,
	[YEARS_OF_COMPANY_SERVICE_NBR] [numeric](4, 0) NULL,
	[MONTHS_OF_COMPANY_SERVICE_NBR] [numeric](2, 0) NULL,
	[LIVING_START_DT] [date] NULL,
	[YEARS_OF_LIVING_NBR] [numeric](4, 0) NULL,
	[MONTHS_OF_LIVING_NBR] [numeric](2, 0) NULL,
	[RELATIONSHIP_WITH_BORR_DESC] [varchar](50) NULL,
	[NON_REGISTERED_COMPANY_DESC] [varchar](200) NULL,
	[MB_MEMBERSHIP_IND] [numeric](1, 0) NULL,
	[ALARM_SERVICE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_DEAL_ACTORS_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ACTOR_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_ATTRIBUTES_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_ATTRIBUTES_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ATTRIBUTE_CODE] [varchar](15) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[ATTRIBUTE_DESC] [varchar](110) NULL,
	[STRING_DATA_DESC] [varchar](250) NULL,
	[INTEGER_DATA_NBR] [numeric](7, 0) NULL,
	[DOUBLE_DATA_AMT] [numeric](15, 2) NULL,
	[BOOLEAN_DATA_IND] [numeric](1, 0) NULL,
	[DATE_DATA_DT] [date] NULL,
 CONSTRAINT [DW_DEAL_ATTRIBUTES_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ATTRIBUTE_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_CHARACTERISTICS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_CHARACTERISTICS](
	[DEAL_CHARACTERISTIC_ID] [numeric](10, 0) NOT NULL,
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[CHARACTERISTIC_CODE] [varchar](150) NULL,
	[CHARACTERISTIC_DESC] [varchar](150) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DATA_TYPE_DESC] [varchar](12) NOT NULL,
	[NUMERIC_VALUE_AMT] [numeric](22, 7) NULL,
	[STRING_VALUE_DESC] [varchar](2000) NULL,
	[DATE_VALUE_DT] [date] NULL,
	[BOOLEAN_VALUE_IND] [numeric](1, 0) NULL,
	[STRING_VALUE_CODE] [varchar](150) NULL,
	[DEAL_VERSION_CODE] [varchar](10) NULL,
	[DEAL_VERSION_DESC] [varchar](100) NULL,
 CONSTRAINT [DW_DEAL_CHARACTERISTICS_KEY] PRIMARY KEY CLUSTERED 
(
	[DEAL_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_CREDIT_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_CREDIT_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[CREDIT_TYPE_CODE] [varchar](7) NULL,
	[CREDIT_TYPE_DESC] [varchar](110) NULL,
	[CREDIT_CLASS_CODE] [varchar](7) NULL,
	[CREDIT_CLASS_DESC] [varchar](110) NULL,
	[BANK_OF_FRANCE_ELIGIBILITY_IND] [numeric](1, 0) NULL,
	[EOM_ELIGIBILITY_IND] [numeric](1, 0) NULL,
	[EDOM_ELIGIBILITY_IND] [numeric](1, 0) NULL,
	[MARCHE_MORTG_ELIGIBILITY_IND] [numeric](1, 0) NULL,
	[BAFI_CLASSIFICATION_CODE] [varchar](7) NULL,
	[BAFI_CLASSIFICATION_DESC] [varchar](110) NULL,
	[LOAN_REVOCABLE_IND] [numeric](1, 0) NULL,
	[REVOC_NOTICE_DELAY_MONTHS_NBR] [numeric](3, 0) NULL,
	[PLANNED_DRAW_RATE_PCT] [numeric](11, 8) NULL,
	[CONVERTIBLE_IND] [numeric](1, 0) NULL,
	[TACIT_RENEWAL_IND] [numeric](1, 0) NULL,
	[REVOLVING_CREDIT_IND] [numeric](1, 0) NULL,
	[NET_TAXABLE_AMT] [numeric](15, 2) NULL,
	[DCRSUPPLFAMILIAL_AMT] [numeric](15, 2) NULL,
	[NUMBER_OF_DEPENDENTS_NBR] [numeric](3, 0) NULL,
	[DCRDEDUCTION_AMT] [numeric](15, 2) NULL,
	[DRAW_PERIOD_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_DEAL_CREDIT_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_DECISION_HISTORY_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_DECISION_HISTORY_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[DECISION_TYPE_CODE] [varchar](15) NULL,
	[DECISION_TYPE_DESC] [varchar](110) NULL,
	[CONCLUSION_MADE_DT] [date] NULL,
	[CREATION_DT] [date] NULL,
	[VALID_DT] [date] NULL,
	[COMMENT_DESC] [varchar](2000) NULL,
	[FINANCING_OFFER_ORDER_NBR] [numeric](10, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_DEAL_DECISION_HIST_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_DECISIONS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_DECISIONS_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[DECISION_TYPE_CODE] [varchar](15) NULL,
	[DECISION_TYPE_DESC] [varchar](50) NULL,
	[DECISION_DT] [date] NULL,
	[COMMENT_TXT] [varchar](2000) NULL,
	[DISPATCH_AGENCY_DT] [date] NULL,
	[ATTACHEMENT_FILE_NAME_DESC] [varchar](264) NULL,
	[MODIFIED_BY_CODE] [varchar](30) NULL,
	[MODIFIED_BY_DESC] [varchar](50) NULL,
	[DECISION_MADE_BY_CODE] [varchar](30) NULL,
	[DECISION_MADE_BY_DESC] [varchar](50) NULL,
	[SECTOR_RISK_CODE] [varchar](15) NULL,
	[SECTOR_RISK_DESC] [varchar](110) NULL,
	[CREATION_DT] [date] NULL,
 CONSTRAINT [DW_DEAL_DECISIONS_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_DETAILS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_DETAILS_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[COMMITMENT_REVOCABLE_IND] [numeric](1, 0) NULL,
	[FINANCED_ASSET_ORIGIN_CODE] [varchar](7) NULL,
	[FINANCED_ASSET_ORIGIN_DESC] [varchar](110) NULL,
	[CLIENT_PAYMENT_OFFSET_NBR] [numeric](3, 0) NULL,
	[SUPPLIER_DISCOUNT_PCT] [numeric](11, 8) NULL,
	[LIMITING_CONTRACT_ID] [numeric](10, 0) NULL,
	[ORIGINAL_FO_REF_NUMBER_DESC] [varchar](15) NULL,
	[MASTER_FAC_CONTRACT_TYPE_CODE] [varchar](7) NULL,
	[MASTER_FAC_CONTRACT_TYPE_DESC] [varchar](110) NULL,
	[CLIENT_TYPE_CODE] [varchar](15) NULL,
	[CLIENT_TYPE_DESC] [varchar](110) NULL,
	[IAS_FISCAL_YR_CRITERIA_NBR] [numeric](4, 0) NULL,
	[IAS_FINAL_TRANSFER_IND] [numeric](1, 0) NULL,
	[CLIENT_WARNING_IND] [numeric](1, 0) NULL,
	[SPECIFIC_NATURE_IAS_IND] [numeric](1, 0) NULL,
	[IAS_FINAL_LOCATION_IND] [numeric](1, 0) NULL,
	[IAS_MICRO_HEDGEING_IND] [numeric](1, 0) NULL,
	[IAS_DURATION_IN_YEARS_NBR] [numeric](2, 0) NULL,
	[IAS_DURATION_IN_MONTHS_NBR] [numeric](3, 0) NULL,
	[IAS_DURATION_IN_DAYS_NBR] [numeric](3, 0) NULL,
	[IAS_INITIAL_VALUE_AMT] [numeric](15, 2) NULL,
	[IAS_CLASSIFICATION_CODE] [varchar](15) NULL,
	[IAS_CLASSIFICATION_DESC] [varchar](110) NULL,
	[CLASSIFICATION_UPDATED_IND] [numeric](1, 0) NULL,
	[IAS_CLASSIFICATION_MEMO_TXT] [varchar](2000) NULL,
	[IAS_CODE] [varchar](7) NULL,
	[IAS_DESC] [varchar](110) NULL,
	[CATEGORY_CODE] [varchar](7) NULL,
	[CATEGORY_DESC] [varchar](110) NULL,
	[DEAL_TYPE_CODE] [varchar](15) NULL,
	[DEAL_TYPE_DESC] [varchar](110) NULL,
	[COUNTRY_CODE] [varchar](7) NULL,
	[COUNTRY_DESC] [varchar](50) NULL,
	[COUNTRY_REGION_CODE] [varchar](15) NULL,
	[COUNTRY_REGION_DESC] [varchar](50) NULL,
	[COUNTRY_REGION_TYPE_CODE] [varchar](15) NULL,
	[COUNTRY_REGION_TYPE_DESC] [varchar](110) NULL,
	[VERSION_DESC] [varchar](250) NULL,
	[SERVICING_DEAL_ID] [numeric](10, 0) NULL,
	[DCOOTHERCAPCOMPREASON_DESC] [varchar](250) NULL,
	[SALES_CODE] [varchar](7) NULL,
	[SALES_DESC] [varchar](110) NULL,
	[DOCUMENT_TYPE_CODE] [varchar](15) NULL,
	[DOCUMENT_TYPE_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_DEAL_DETAILS_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_DISPENSATION_REQS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_DISPENSATION_REQS_FO](
	[REQUEST_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[PARAGRAPH_CODE] [varchar](7) NULL,
	[PARAGRAPH_DESC] [varchar](110) NULL,
	[DESTINATION_CODE] [varchar](7) NULL,
	[DESTINATION_DESC] [varchar](110) NULL,
	[ACTIVITY_CODE] [varchar](7) NULL,
	[ACTIVITY_DESC] [varchar](50) NULL,
	[CONTROL_CODE] [varchar](7) NULL,
	[CONTROL_DESC] [varchar](110) NULL,
	[PHASE_CODE] [varchar](7) NULL,
	[PHASE_DESC] [varchar](25) NULL,
	[PHASE_DESTINATION_CODE] [varchar](15) NULL,
	[PHASE_DESTINATION_DESC] [varchar](110) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[DEAL_VERSION_CODE] [varchar](7) NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[REQUEST_DT] [date] NULL,
	[REQUEST_STATUS_DT] [date] NULL,
	[REQUEST_PROCESS_DT] [date] NULL,
	[PROCESSED_BY_CODE] [varchar](30) NULL,
	[PROCESSED_BY_DESC] [varchar](50) NULL,
	[REQUEST_STATUS_CODE] [varchar](15) NULL,
	[REQUEST_STATUS_DESC] [varchar](110) NULL,
	[TASK_ID] [numeric](10, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[MINIMUM_ALLOWED_VALUE_CODE] [varchar](15) NULL,
	[MINIMUM_ALLOWED_VALUE_DESC] [varchar](110) NULL,
	[MAXIMUM_ALLOWED_VALUE_CODE] [varchar](15) NULL,
	[MAXIMUM_ALLOWED_VALUE_DESC] [varchar](110) NULL,
	[REQUESTED_VALUE_CODE] [varchar](15) NULL,
	[REQUESTED_VALUE_DESC] [varchar](15) NULL,
 CONSTRAINT [DW_DEAL_DISPENS_REQS_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[REQUEST_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_INVESTMENT_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_INVESTMENT_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[INVESTMENT_AMT] [numeric](15, 2) NULL,
	[SUBSIDIARY_AMT] [numeric](15, 2) NULL,
	[VAT_IND] [numeric](1, 0) NULL,
	[REFINANCING_MARGIN_RATE_PCT] [numeric](11, 8) NULL,
	[REFINANCING_MARGIN_AMT] [numeric](15, 2) NULL,
	[FUNDING_DURATION_DAYS_NBR] [numeric](3, 0) NULL,
	[FUNDING_DURATION_MONTHS_NBR] [numeric](3, 0) NULL,
	[FUNDING_DURATION_YEARS_NBR] [numeric](3, 0) NULL,
	[FUNDING_DT] [date] NULL,
	[FUNDING_AMT] [numeric](15, 2) NULL,
	[APPROVAL_DT] [date] NULL,
	[APPROVED_AMT] [numeric](15, 2) NULL,
	[AGREEMENT_DT] [date] NULL,
	[AGREEMENT_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_DEAL_INVESTMENT_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_INVOLVED_USERS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_INVOLVED_USERS_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[BUSINESS_CODE] [varchar](7) NULL,
	[BUSINESS_DESC] [varchar](250) NULL,
	[ASSIGNMENT_DT] [date] NULL,
	[KEYNOTE_SPEAKER_IND] [numeric](1, 0) NULL,
	[ASSIGNMENT_START_DT] [date] NULL,
	[ASSIGNMENT_END_DT] [date] NULL,
	[SALES_NETWORK_CODE] [varchar](15) NULL,
	[SALES_NETWORK_DESC] [varchar](110) NULL,
	[DINDPTCODE_CODE] [varchar](7) NULL,
	[DINDPTCODE_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_DEAL_INVOLVED_USERS_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_KEY_DATES_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_KEY_DATES_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[DATE_TYPE_CODE] [varchar](15) NULL,
	[DATE_TYPE_DESC] [varchar](110) NULL,
	[DATE_DT] [date] NULL,
 CONSTRAINT [DW_DEAL_KEY_DATES_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_PHASE_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_PHASE_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PHASE_CODE] [varchar](7) NULL,
	[PHASE_DESC] [varchar](25) NULL,
	[DESTINATION_CODE] [varchar](15) NULL,
	[DESTINATION_DESC] [varchar](110) NULL,
	[STEP_CODE] [varchar](7) NULL,
	[STEP_DESC] [varchar](100) NULL,
	[MOTIVATION_DESC] [varchar](2000) NULL,
	[EFFECTIVE_DT] [date] NULL,
	[UPDATE_DT] [date] NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[END_DT] [date] NULL,
 CONSTRAINT [DW_DEAL_PHASE_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_PREREQ_SUMMARY_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_PREREQ_SUMMARY_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[PREREQUISITE_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[GUARANTEE_ORDER_NBR] [numeric](10, 0) NULL,
	[GUARANTEE_CHAR_ORDER_NBR] [numeric](10, 0) NULL,
	[INVESTMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[GOOD_ORDER_NBR] [numeric](10, 0) NULL,
	[RESOURCE_ORDER_NBR] [numeric](10, 0) NULL,
	[INSURANCE_ORDER_NBR] [numeric](10, 0) NULL,
	[CHARACTERISTIC_ORDER_NBR] [numeric](10, 0) NULL,
	[OTHER_PREREQUISITE_ORDER_NBR] [numeric](10, 0) NULL,
	[COMMISSION_ORDER_NBR] [numeric](10, 0) NULL,
	[COMMITMENT_PREREQUISITE_IND] [numeric](1, 0) NULL,
	[SIGNATURE_PREREQUISITE_IND] [numeric](1, 0) NULL,
	[PREREQUISITE_TYPE_CODE] [varchar](15) NULL,
	[PREREQUISITE_TYPE_DESC] [varchar](110) NULL,
	[COMMENTS_DESC] [varchar](250) NULL,
	[REALIZATION_DT] [date] NULL,
	[REALIZATION_COMMENT_DESC] [varchar](2000) NULL,
	[PREREQUISITE_FINANCING_IND] [numeric](1, 0) NULL,
	[FORMATTED_ANSWER_DESC] [varchar](50) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[FINANCIAL_PROPOSAL_ID] [numeric](10, 0) NULL,
	[GUARANTEE_ORDER_NBR2] [numeric](10, 0) NULL,
	[COMMISSION_ORDER_NBR2] [numeric](10, 0) NULL,
	[PREREQUISITE_STATUS_CODE] [varchar](15) NULL,
	[PREREQUISITE_STATUS_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_DEAL_PREREQ_SUMMARY_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[PREREQUISITE_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_PREREQUISITES_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_PREREQUISITES_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[PREREQUISITE_CONDITION_CODE] [varchar](15) NULL,
	[PREREQUISITE_CONDITION_DESC] [varchar](250) NULL,
	[COMMITTING_PREREQUISITE_IND] [numeric](1, 0) NULL,
	[SIGNATURE_PREREQUISITE_IND] [numeric](1, 0) NULL,
	[DESCRIPTION_DESC] [varchar](2000) NULL,
	[FINANCING_PREREQUISITE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_DEAL_PREREQUISITES_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_SYNDICAT_PARTNERS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_SYNDICAT_PARTNERS_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[ROLE_CODE] [varchar](7) NULL,
	[ROLE_DESC] [varchar](50) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[PARTNER_SHARE_PCT] [numeric](3, 0) NULL,
	[PARTNER_SHARE_AMT] [numeric](15, 2) NULL,
	[LEAD_PARTNER_IND] [numeric](1, 0) NULL,
	[REBILLING_IND] [numeric](1, 0) NULL,
	[VAT_IND] [numeric](1, 0) NULL,
	[DIRECT_PRE_FINANCING_IND] [numeric](1, 0) NULL,
	[DIRECT_FUNDING_IND] [numeric](1, 0) NULL,
	[PRECIPUT_PCT] [numeric](11, 8) NULL,
 CONSTRAINT [DW_DEAL_SYNDICAT_PART_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_TANGIBLE_ASSETS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_TANGIBLE_ASSETS_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[ASSET_NATURE_CODE] [varchar](15) NULL,
	[ASSET_NATURE_DESC] [varchar](110) NULL,
	[ASSET_CLASS_CODE] [varchar](7) NULL,
	[ASSET_CLASS_DESC] [varchar](200) NULL,
	[FINANCIAL_ELEMENT_CODE] [varchar](7) NULL,
	[FINANCIAL_ELEMENT_DESC] [varchar](64) NULL,
	[NEW_IND] [numeric](1, 0) NULL,
	[CATEGORY_CODE] [varchar](15) NULL,
	[CATEGORY_DESC] [varchar](110) NULL,
	[TAX_CODE] [varchar](7) NULL,
	[TAX_DESC] [varchar](50) NULL,
	[REGISTRATION_NUMBER_DESC] [varchar](50) NULL,
	[SERIAL_NUMBER_DESC] [varchar](50) NULL,
	[INVESTED_AMT] [numeric](15, 2) NULL,
	[GAP_AMT] [numeric](15, 2) NULL,
	[VEHICLE_BODY_STYLE_CODE] [varchar](15) NULL,
	[VEHICLE_BODY_STYLE_DESC] [varchar](110) NULL,
	[FUEL_TYPE_CODE] [varchar](15) NULL,
	[FUEL_TYPE_DESC] [varchar](110) NULL,
	[VEHICLE_TYPE_CODE] [varchar](15) NULL,
	[VEHICLE_TYPE_DESC] [varchar](110) NULL,
	[FIRST_REGISTRATION_DT] [date] NULL,
	[REGISTRATION_SERIAL_NBR_DESC] [varchar](50) NULL,
	[FISCAL_POWER_AMT] [numeric](15, 2) NULL,
	[REGISTRATION_SHRT_COMMENT_DESC] [varchar](50) NULL,
	[MANUFACTURER_NAME_DESC] [varchar](15) NULL,
	[REG_BOOK_REGISTRATION_NBR_DESC] [varchar](50) NULL,
	[OPTION_NBR] [numeric](5, 0) NULL,
	[MILEAGE_NBR] [numeric](10, 0) NULL,
	[RESIDUAL_VALUE_AMT] [numeric](15, 2) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[ACTOR_ADDRESS_ORDER_NBR] [numeric](10, 0) NULL,
	[ACTOR_ADDRESS_ID] [numeric](10, 0) NULL,
	[MANUFACTURER_CODE] [varchar](15) NULL,
	[MANUFACTURER_DESC] [varchar](110) NULL,
	[MODEL_CODE] [varchar](15) NULL,
	[MODEL_DESC] [varchar](110) NULL,
	[DESCRIPTION_DESC] [varchar](250) NULL,
	[RATING_DESC] [varchar](25) NULL,
	[UNIT_OF_MEASURE_CODE] [varchar](15) NULL,
	[UNIT_OF_MEASURE_DESC] [varchar](250) NULL,
	[TAX_INC_PRICE_AMT] [numeric](15, 2) NULL,
	[TAX_INC_RESIDUAL_VALUE_AMT] [numeric](15, 2) NULL,
	[RESIDUAL_VALUE_PCT] [numeric](11, 8) NULL,
	[CO2_EMISSION_LEVEL_NBR] [numeric](3, 0) NULL,
	[REGISTRATION_TYPE_CODE] [varchar](15) NULL,
	[REGISTRATION_TYPE_DESC] [varchar](110) NULL,
	[YEAR_MODEL_CODE] [varchar](15) NULL,
	[YEAR_MODEL_DESC] [varchar](110) NULL,
	[RETURN_VEHICLE_REG_NBR_DESC] [varchar](50) NULL,
	[ODOMETER_READING_NBR] [numeric](10, 0) NULL,
	[ROAD_PRICE_AMT] [numeric](15, 2) NULL,
	[EXPECTED_DURATION_MONTHS_NBR] [numeric](3, 0) NULL,
	[SUPPLIER_ADDRESS_ORDER_NBR] [numeric](10, 0) NULL,
	[VARIANT_ID] [numeric](10, 0) NULL,
	[INTERNAL_ID_NBR] [numeric](10, 0) NULL,
	[DPPDWP_NBR] [numeric](10, 0) NULL,
	[MAKE_MODEL_CODE] [varchar](15) NULL,
	[MAKE_MODEL_DESC] [varchar](500) NULL,
	[VARIANT_RESIDUAL_VAL_ORDER_NBR] [numeric](10, 0) NULL,
	[TRIM_LEVEL_CODE] [varchar](15) NULL,
	[TRIM_LEVEL_DESC] [varchar](500) NULL,
	[REFURBISH_CODE] [varchar](15) NULL,
	[REFURBISH_DESC] [varchar](15) NULL,
	[REFURBISH_YEAR_NBR] [numeric](4, 0) NULL,
	[DISCOUNT_AMT] [numeric](15, 2) NULL,
	[DPMFLAGRETENUE_IND] [numeric](1, 0) NULL,
	[INVESTMENT_ID] [numeric](10, 0) NULL,
	[INVESTMENT_ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[BO_ASSET_REMARKETING_IND] [numeric](1, 0) NULL,
	[RELEASE_DT] [date] NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](50) NULL,
	[QUANTITY_NBR] [numeric](7, 0) NULL,
	[ANNUAL_MILEAGE_NBR] [numeric](10, 0) NULL,
	[UNITS_CODE] [varchar](15) NULL,
	[UNITS_DESC] [varchar](250) NULL,
	[ADDITIONAL_UNITS_PURCHASED_NBR] [numeric](10, 0) NULL,
	[EXCESS_UNIT_COST_AMT] [numeric](15, 2) NULL,
	[ESTIMATED_REGISTRATION_DT] [date] NULL,
	[COLLATERAL_CLASS_CODE] [varchar](15) NULL,
	[COLLATERAL_CLASS_DESC] [varchar](110) NULL,
	[USAGE_ADDRESS_ID] [numeric](10, 0) NULL,
	[VAT_AMT] [numeric](15, 2) NULL,
	[TAX_INVOICE_ISSUE_DT] [date] NULL,
	[REAL_VAT_AMT] [numeric](15, 2) NULL,
	[DELIVERY_METHOD_CODE] [varchar](15) NULL,
	[DELIVERY_METHOD_DESC] [varchar](110) NULL,
	[REGISTRATION_METHOD_CODE] [varchar](15) NULL,
	[REGISTRATION_METHOD_DESC] [varchar](250) NULL,
	[ROUNDING_ISSUE_FIX_AMT] [numeric](1, 0) NULL,
	[IMMATRICULATION_LOCATION_CODE] [varchar](15) NULL,
	[IMMATRICULATION_LOCATION_DESC] [varchar](110) NULL,
	[COUNTRY_OF_ORIGIN_CODE] [varchar](15) NULL,
	[COUNTRY_OF_ORIGIN_DESC] [varchar](50) NULL,
	[PRODUCTION_DT] [date] NULL,
	[CUSTOM_CLEARANCE_CODE] [varchar](15) NULL,
	[CUSTOM_CLEARANCE_DESC] [varchar](110) NULL,
	[EXTENDED_WARRANTY_CODE] [varchar](15) NULL,
	[EXTENDED_WARRANTY_DESC] [varchar](110) NULL,
	[CUSTOM_REGISTRATION_CHANGE_DT] [date] NULL,
	[CONVERSION_RATE_PCT] [numeric](11, 8) NULL,
	[CONVERSION_DT] [date] NULL,
	[CONVERSION_AMT] [numeric](15, 2) NULL,
	[CONVERTED_AMT] [numeric](15, 2) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
 CONSTRAINT [DW_DEAL_TANGIBLE_ASSETS_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEAL_WORKFLOW_STEP_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEAL_WORKFLOW_STEP_FO](
	[WORKFLOW_STEP_ID] [numeric](10, 0) NOT NULL,
	[WORKFLOW_CODE] [varchar](15) NULL,
	[ORDER_NBR] [numeric](10, 0) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[DEAL_VERSION_CODE] [varchar](7) NULL,
	[DEAL_STEP_ORDER_NBR] [numeric](10, 0) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[WORKFLOW_DESC] [varchar](110) NULL,
	[INITIALIZATION_USER_CODE] [varchar](30) NULL,
	[INITIALIZATION_USER_DESC] [varchar](50) NULL,
	[EXEC_USER_CODE] [varchar](30) NULL,
	[EXEC_USER_DESC] [varchar](50) NULL,
	[END_USER_CODE] [varchar](30) NULL,
	[END_USER_DESC] [varchar](50) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[END_DT] [date] NULL,
	[EXECUTION_DT] [date] NULL,
	[INITIALIZATION_DT] [date] NULL,
	[STATUS_CODE] [varchar](15) NULL,
	[STATUS_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_DEAL_WORKFLOW_STEP_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[WORKFLOW_STEP_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DEALS_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DEALS_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[DEAL_NUMBER_DESC] [varchar](25) NULL,
	[CONTRACT_NUMBER_DESC] [varchar](25) NULL,
	[CONTRACT_AMMENDMENT_NBR] [numeric](2, 0) NULL,
	[DEAL_NAME_DESC] [varchar](50) NULL,
	[COMMENT_TXT] [varchar](max) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[METHOD_CODE] [varchar](15) NULL,
	[METHOD_DESC] [varchar](110) NULL,
	[ORIGINAL_DEAL_ID] [numeric](10, 0) NULL,
	[ORIGINAL_DEAL_VERSION_CODE] [varchar](7) NULL,
	[ORIGINAL_DEAL_VERSION_DESC] [varchar](110) NULL,
	[CANCELLATION_DT] [date] NULL,
	[CANCELLATION_COMMENT_TXT] [varchar](2000) NULL,
	[ESTIMATED_DURATION_YEARS_DESC] [varchar](25) NULL,
	[FUNCTIONAL_VALIDATION_DT] [date] NULL,
	[BACK_OFFICE_TRANSFER_DT] [date] NULL,
	[RECOMMERCIALIZATION_IND] [numeric](1, 0) NULL,
	[EXER_OPTION_CALC_TYPE_CODE] [varchar](15) NULL,
	[EXER_OPTION_CALC_TYPE_DESC] [varchar](110) NULL,
	[DEAL_TYPE_CODE] [varchar](15) NULL,
	[DEAL_TYPE_DESC] [varchar](110) NULL,
	[OPERATION_INVESTOR_IND] [numeric](1, 0) NULL,
	[UNDER_TENANT_EXISTENCE_IND] [numeric](1, 0) NULL,
	[EXER_OPTION_MONTHS_NBR] [numeric](3, 0) NULL,
	[OPTION_EXERCISE_DT] [date] NULL,
	[INDCODE_CODE] [varchar](15) NULL,
	[INDCODE_DESC] [varchar](110) NULL,
	[CANCEL_FEE_WITH_CERT_PCT] [numeric](11, 8) NULL,
	[CANCEL_FEE_WITHOUT_CERT_PCT] [numeric](11, 8) NULL,
	[LATE_PMT_FLOOR_RATE_PCT] [numeric](11, 8) NULL,
	[LATE_PMT_CEILING_RATE_PCT] [numeric](11, 8) NULL,
	[MINIMUM_ASSET_IR_AMT] [numeric](15, 2) NULL,
	[LATE_PMT_MARGIN_PCT] [numeric](11, 8) NULL,
	[LATE_PMT_LUMP_SUM_AMT] [numeric](15, 2) NULL,
	[LATE_PMT_FACTURABLE_IND] [numeric](1, 0) NULL,
	[SYNDICATION_BASIS_AMT] [numeric](15, 2) NULL,
	[SYNDICATION_BASIS_PCT] [numeric](11, 8) NULL,
	[EXER_OPTION_COMMENT_CODE] [varchar](15) NULL,
	[EXER_OPTION_COMMENT_DESC] [varchar](110) NULL,
	[COMMITMENT_MEMO1_TXT] [varchar](max) NULL,
	[EXER_OPTION_COMMENT_TXT] [varchar](2000) NULL,
	[VAT_RENT_FOR_TRI_AMT] [numeric](15, 2) NULL,
	[ACTIVITY_CODE] [varchar](7) NULL,
	[ACTIVITY_DESC] [varchar](50) NULL,
	[CREATION_DT] [date] NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[TRANCHE_NUMBER_DESC] [varchar](15) NULL,
	[TAX_STATUS_CODE] [varchar](7) NULL,
	[TAX_STATUS_DESC] [varchar](50) NULL,
	[COMMITMENT_MEMO2_TXT] [varchar](max) NULL,
	[VALIDATION_DT] [date] NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[LAST_MODIFIED_BY_CODE] [varchar](30) NULL,
	[LAST_MODIFIED_BY_DESC] [varchar](50) NULL,
	[LAST_MODIFIED_DT] [date] NULL,
	[SALES_NETWORK_CODE] [varchar](15) NULL,
	[SALES_NETWORK_DESC] [varchar](250) NULL,
	[PREREQ_CONDITION_MEMO1_TXT] [varchar](max) NULL,
	[PREREQ_CONDITION_MEMO2_TXT] [varchar](max) NULL,
	[FINANCING_REQUEST_DT] [date] NULL,
	[DELEGATION_IND] [numeric](1, 0) NULL,
	[DEPARTMENT_CODE] [varchar](15) NULL,
	[DEPARTMENT_DESC] [varchar](250) NULL,
	[AGGREGATE_ID] [numeric](10, 0) NULL,
	[AMMENDMENT_NBR] [numeric](3, 0) NULL,
	[DPRSALESREDUCEDINT_AMT] [numeric](15, 2) NULL,
	[SALES_METHOD_CODE] [varchar](15) NULL,
	[SALES_METHOD_DESC] [varchar](110) NULL,
	[SALES_COMPANY_CODE] [varchar](15) NULL,
	[SALES_COMPANY_DESC] [varchar](110) NULL,
	[SALES_REASON_CODE] [varchar](15) NULL,
	[SALES_REASON_DESC] [varchar](110) NULL,
	[BID_REFERENCE_DESC] [varchar](50) NULL,
	[BID_METHOD_CODE] [varchar](15) NULL,
	[BID_METHOD_DESC] [varchar](110) NULL,
	[BID_RENDER_METHOD_CODE] [varchar](15) NULL,
	[BID_RENDER_METHOD_DESC] [varchar](110) NULL,
	[DEAL_CONFIRMATION_NUMBER_DESC] [varchar](25) NULL,
	[PAD_DELIVERY_METHOD_CODE] [varchar](15) NULL,
	[PAD_DELIVERY_METHOD_DESC] [varchar](110) NULL,
	[PAD_REDELIVERY_METHOD_CODE] [varchar](15) NULL,
	[PAD_REDELIVERY_METHOD_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_DEALS_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_DIM_DATE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_DIM_DATE](
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[DATE_VALUE] [date] NOT NULL,
	[DATE_SHORT] [varchar](12) NULL,
	[DATE_MEDIUM] [varchar](16) NULL,
	[DATE_LONG] [varchar](24) NULL,
	[DATE_FULL] [varchar](32) NULL,
	[DAY_IN_YEAR] [numeric](22, 0) NULL,
	[DAY_IN_MONTH] [numeric](22, 0) NULL,
	[IS_FIRST_DAY_IN_MONTH] [varchar](10) NULL,
	[IS_LAST_DAY_IN_MONTH] [varchar](10) NULL,
	[DAY_ABBREVIATION] [varchar](4) NULL,
	[DAY_NAME] [varchar](12) NULL,
	[WEEK_IN_YEAR] [numeric](22, 0) NULL,
	[WEEK_IN_MONTH] [numeric](22, 0) NULL,
	[IS_FIRST_DAY_IN_WEEK] [varchar](10) NULL,
	[IS_LAST_DAY_IN_WEEK] [varchar](10) NULL,
	[MONTH_NUMBER] [numeric](22, 0) NULL,
	[MONTH_ABBREVIATION] [varchar](6) NULL,
	[MONTH_NAME] [varchar](12) NULL,
	[YEAR2] [varchar](2) NULL,
	[YEAR4] [numeric](22, 0) NULL,
	[QUARTER_NAME] [varchar](2) NULL,
	[QUARTER_NUMBER] [numeric](22, 0) NULL,
	[YEAR_QUARTER] [varchar](7) NULL,
	[YEAR_MONTH_NUMBER] [varchar](7) NULL,
	[YEAR_MONTH_ABBREVIATION] [varchar](15) NULL,
PRIMARY KEY CLUSTERED 
(
	[DIM_DATE_KEY] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_BALANCES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_BALANCES](
	[RECORD_ID] [numeric](22, 0) NOT NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[EFFECTIVE_DATE_KEY] [numeric](8, 0) NULL,
	[CURRENT_IND] [numeric](1, 0) NULL,
	[BALANCE_TYPE_DESC] [varchar](20) NULL,
	[ENTRY_DATE_AMT] [numeric](15, 2) NULL,
	[VALUE_DATE_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_ELEMENT_BAL_KEY] PRIMARY KEY NONCLUSTERED 
(
	[RECORD_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_BASIS_FINANCIAL]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_BASIS_FINANCIAL](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[GUARANTEE_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[NUMERATOR_AMT] [numeric](15, 2) NULL,
	[DENOMINATOR_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_ELEMENT_BASIS_FINANCIAL_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[GUARANTEE_ORDER_NBR] ASC,
	[ACTOR_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_ELEMENT_BASIS_INCIDENTAL]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_BASIS_INCIDENTAL](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[NUMERATOR_NBR] [numeric](15, 2) NULL,
	[DENOMINATOR_NBR] [numeric](15, 2) NULL,
 CONSTRAINT [DW_ELEMENT_BASIS_INCIDENT_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_ELEMENT_CHARACTERISTICS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_CHARACTERISTICS](
	[ELEMENT_CHARACTERISTIC_ID] [numeric](10, 0) NOT NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[CHARACTERISTIC_CODE] [varchar](150) NULL,
	[CHARACTERISTIC_DESC] [varchar](150) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DATA_TYPE_DESC] [varchar](12) NULL,
	[NUMERIC_VALUE_AMT] [numeric](22, 7) NULL,
	[STRING_VALUE_DESC] [varchar](2000) NULL,
	[DATE_VALUE_DT] [date] NULL,
	[BOOLEAN_VALUE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_ELEMENT_CHAR_KEY] PRIMARY KEY NONCLUSTERED 
(
	[ELEMENT_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_FLOWS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_FLOWS](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[FLOW_PMT_TERM_CODE] [varchar](1) NULL,
	[FLOW_PMT_TERM_DESC] [varchar](110) NULL,
	[FLOW_START_DT] [date] NULL,
	[PERIODS_NBR] [numeric](4, 0) NULL,
	[FLOW_PERIOD_MULTIPLE_NBR] [numeric](4, 0) NULL,
	[PERIOD_TYPE_CODE] [varchar](7) NULL,
	[PERIOD_TYPE_DESC] [varchar](110) NULL,
	[FLOW_AMT] [numeric](15, 2) NULL,
	[FLOW_END_DT] [date] NULL,
	[LAST_DAY_IN_MONTH_IND] [numeric](1, 0) NULL,
	[PROGRESSION_RULE_CODE] [varchar](7) NULL,
	[PROGRESSION_RULE_DESC] [varchar](110) NULL,
	[PROGRESS_RATE_PCT] [numeric](11, 8) NULL,
	[INTEREST_CALC_FREQ_NBR] [numeric](3, 0) NULL,
	[REG_PMTS_PER_PERIOD_NBR] [numeric](3, 0) NULL,
	[FIXED_DAY_IND] [numeric](1, 0) NULL,
	[OFFSET_IN_DAYS_NBR] [numeric](4, 0) NULL,
	[SEASONS_NBR] [numeric](3, 0) NULL,
	[BASIS_PCT] [numeric](11, 8) NULL,
	[INTEREST_TERM_CODE] [varchar](1) NULL,
	[INTEREST_TERM_DESC] [varchar](110) NULL,
	[INTEREST_PERIODS_NBR] [numeric](4, 0) NULL,
	[INTEREST_PERIODICITY_CODE] [varchar](7) NULL,
	[INTEREST_PERIODICITY_DESC] [varchar](110) NULL,
	[INTEREST_MULTIPLE_NBR] [numeric](4, 0) NULL,
	[EXEMPTION_NBR] [numeric](3, 0) NULL,
	[DIFFERRED_INTERESTS_DT] [date] NULL,
	[INTEREST_OFFEST_DAYS_NBR] [numeric](4, 0) NULL,
	[INTEREST_FIXED_DAY_IND] [numeric](1, 0) NULL,
	[INTEREST_MONTH_END_IND] [numeric](1, 0) NULL,
	[SUB_PERIOD_DEPR_TYPE_CODE] [varchar](7) NULL,
	[SUB_PERIOD_DEPR_TYPE_DESC] [varchar](110) NULL,
	[BUDGET_PORTION_ID] [numeric](10, 0) NULL,
	[PMT_ONE_DAY_AFTER_DUE_IND] [numeric](1, 0) NULL,
	[PERMIT_MONTH_CHG_DUE_DATE_IND] [numeric](1, 0) NULL,
	[DEF_INT_GRACE_PER_TYPE_CODE] [varchar](15) NULL,
	[DEF_INT_GRACE_PER_TYPE_DESC] [varchar](110) NULL,
	[DEF_INT_GRACE_PER_DAYS_NBR] [numeric](4, 0) NULL,
	[DUE_DAY_AFTER_IND] [numeric](1, 0) NULL,
	[ASYNC_INT_START_DT] [date] NULL,
	[ASYNC_INT_END_DT] [date] NULL,
	[FIXED_DUE_DATE_CODE] [varchar](7) NULL,
	[FIXED_DUE_DATE_DESC] [varchar](110) NULL,
	[DUE_DATE_SHIFT_TYPE_CODE] [varchar](7) NULL,
	[DUE_DATE_SHIFT_TYPE_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_ELEMENT_FLOWS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_OUTLAYS_BASIS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_OUTLAYS_BASIS](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[BASIS_DT] [date] NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BASIS_AMT] [numeric](15, 2) NULL,
	[FUND_TRANSFER_TYPE_CODE] [varchar](15) NULL,
	[FUND_TRANSFER_TYPE_DESC] [varchar](110) NULL,
	[CLIENT_DAYS_NBR] [numeric](4, 0) NULL,
	[SUPPLIER_DAYS_NBR] [numeric](4, 0) NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
 CONSTRAINT [DW_ELEMENT_OUTLAYS_BASIS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[BASIS_DT] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_PARTICIPATION]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_PARTICIPATION](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[SYNDICATION_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PARTICIPANT_SHARE_AMT] [numeric](15, 2) NULL,
	[FINAL_MARGIN_PCT] [numeric](11, 8) NULL,
	[VARIABLE_RATE_OCCURRENCE_NBR] [numeric](10, 0) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[PARTICIPANT_FIXED_RATE_PCT] [numeric](11, 8) NULL,
	[VAR_RATE_FLOOR_OCCUR_NBR] [numeric](10, 0) NULL,
	[VAR_RATE_REG_OCCUR_NBR] [numeric](10, 0) NULL,
	[VAR_RATE_CRYST_OCCUR_NBR] [numeric](10, 0) NULL,
	[VAR_RATE_CEILING_OCCUR_NBR] [numeric](10, 0) NULL,
	[PART_FIXED_FLOOR_RATE_PCT] [numeric](11, 8) NULL,
	[PART_FIXED_CEILING_RATE_PCT] [numeric](11, 8) NULL,
	[FLOOR_TYPE_CODE] [varchar](15) NULL,
	[FLOOR_TYPE_DESC] [varchar](110) NULL,
	[CEILING_TYPE_CODE] [varchar](15) NULL,
	[CEILING_TYPE_DESC] [varchar](110) NULL,
	[FLOOR_START_DT] [date] NULL,
	[FLOOR_END_DT] [date] NULL,
	[CEILING_START_DT] [date] NULL,
	[CEILING_END_DT] [date] NULL,
	[PART_CALC_RULE_CODE] [varchar](7) NULL,
	[PART_CALC_RULE_DESC] [varchar](110) NULL,
	[PART_NUMERATOR_CODE] [varchar](7) NULL,
	[PART_NUMERATOR_DESC] [varchar](110) NULL,
	[PART_DENOMINATOR_CODE] [varchar](7) NULL,
	[PART_DENOMINATOR_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_ELEMENT_PARTICIPATION_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[SYNDICATION_ID] ASC,
	[ACTOR_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_RATES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_RATES](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BASIS_FORMULA_CODE] [numeric](5, 0) NULL,
	[BASIS_FORMULA_DESC] [varchar](100) NULL,
	[FIRST_TERM_DT] [date] NULL,
	[RATE_PERIOD_UNIT_CODE] [varchar](7) NULL,
	[RATE_PERIOD_UNIT_DESC] [varchar](110) NULL,
	[UNIT_MULTIPLE_NBR] [numeric](3, 0) NULL,
	[FLOOR_TYPE_CODE] [numeric](5, 0) NULL,
	[FLOOR_TYPE_DESC] [varchar](110) NULL,
	[FLOOR_RATE_PCT] [numeric](11, 8) NULL,
	[FLOOR_RATE_FORMULA_CODE] [numeric](5, 0) NULL,
	[FLOOR_RATE_FORMULA_DESC] [varchar](100) NULL,
	[CEILING_TYPE_CODE] [varchar](7) NULL,
	[CEILING_TYPE_DESC] [varchar](110) NULL,
	[CEILING_RATE_PCT] [numeric](11, 8) NULL,
	[CEILING_RATE_FORMULA_CODE] [numeric](5, 0) NULL,
	[CEILING_RATE_FORMULA_DESC] [varchar](100) NULL,
	[CONTRACT_LEVEL_CORP_IND] [numeric](1, 0) NULL,
	[EXERCISE_RIGHT_DELAY_NBR] [numeric](15, 2) NULL,
	[CONSOLIDATION_FORMULA_CODE] [numeric](5, 0) NULL,
	[CONSOLIDATION_FORMULA_DESC] [varchar](100) NULL,
	[ADJUSTMENT_TYPE_CODE] [varchar](7) NULL,
	[ADJUSTMENT_TYPE_DESC] [varchar](110) NULL,
	[ADJUSTMENT_FORMULA_CODE] [numeric](5, 0) NULL,
	[ADJUSTMENT_FORMULA_DESC] [varchar](100) NULL,
	[CEILING_START_DT] [date] NULL,
	[CEILING_END_DT] [date] NULL,
	[FLOOR_START_DT] [date] NULL,
	[FLOOR_END_DT] [date] NULL,
	[RENEW_CALC_SCHED_PERIOD_CODE] [varchar](7) NULL,
	[RENEW_CALC_SCHED_PERIOD_DESC] [varchar](110) NULL,
	[RENEW_SCHED_CALC_PER_MULT_NBR] [numeric](3, 0) NULL,
	[FIRST_PAYMENT_REVISION_DT] [date] NULL,
	[PAYMENT_CAP_TYPE_CODE] [varchar](15) NULL,
	[PAYMENT_CAP_TYPE_DESC] [varchar](110) NULL,
	[CAP_VALUE_AMT] [numeric](15, 2) NULL,
	[CAP_DELTA_APPLIED_AMT] [numeric](15, 2) NULL,
	[MAX_PER_RATE_DECREASE_PCT] [numeric](11, 8) NULL,
	[FLOOR_APP_START_DT] [date] NULL,
	[FLOOR_APP_END_DT] [date] NULL,
	[MAX_PERIODIC_RATE_INC_PCT] [numeric](11, 8) NULL,
	[CEILING_APP_START_DT] [date] NULL,
	[CEILING_APP_END_DT] [date] NULL,
	[MAX_RATE_DELTA_PCT] [numeric](11, 8) NULL,
	[MIN_RATE_DELTA_PCT] [numeric](11, 8) NULL,
 CONSTRAINT [DW_ELEMENT_RATES_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_SCHEDULE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_SCHEDULE](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PAYMENT_DUE_DT] [date] NULL,
	[PAYMENT_TYPE_CODE] [varchar](7) NULL,
	[PAYMENT_TYPE_DESC] [varchar](110) NULL,
	[ELEMENT_FLOW_ORDER_NBR] [numeric](10, 0) NULL,
	[PERIOD_RATE_PCT] [numeric](11, 8) NULL,
	[PRINCIPAL_AMT] [numeric](15, 2) NULL,
	[REVISION_AMT] [numeric](15, 2) NULL,
	[POST_PRINCIPAL_BALANCE_AMT] [numeric](15, 2) NULL,
	[TAX_AMT] [numeric](15, 2) NULL,
	[TOTAL_AMT] [numeric](15, 2) NULL,
	[ACCRUAL_PERIOD_START_DT] [date] NULL,
	[ACCRUAL_PERIOD_END_DT] [date] NULL,
	[CALCULATION_BASIS_AMT] [numeric](15, 2) NULL,
	[DISCOUNTED_RESIDUAL_AMT] [numeric](15, 2) NULL,
	[ACTUALIZED_PAYMENT_AMT] [numeric](15, 2) NULL,
	[EXTERNAL_TERM_NBR] [numeric](10, 0) NULL,
	[PRESET_INT_COMP_BALANCE_AMT] [numeric](15, 2) NULL,
	[CTRV_INT_PRESET_INT_AMT] [numeric](15, 2) NULL,
	[INTEREST_AMT] [numeric](15, 2) NULL,
	[UNPAID_INTEREST_AMT] [numeric](15, 2) NULL,
	[POSTPONED_INTEREST_AMT] [numeric](15, 2) NULL,
	[TRANSFER_AMT] [numeric](15, 2) NULL,
	[PRESET_ACTUARIAL_RATE_PCT] [numeric](11, 8) NULL,
	[EXTERNAL_STEP_CODE_NBR] [numeric](3, 0) NULL,
	[EXTERNAL_SEASON_CODE_NBR] [numeric](3, 0) NULL,
	[CUM_CURR_ACT_CALLS_AMT] [numeric](15, 2) NULL,
	[PRE_TAX_CURR_ACCT_INT_AMT] [numeric](15, 2) NULL,
	[PRE_TAX_CURR_ACCT_BAL_AMT] [numeric](15, 2) NULL,
	[CURR_ACCT_TAX_BAL_AMT] [numeric](15, 2) NULL,
	[TERM_ACTUALIZATION_AMT] [numeric](15, 2) NULL,
	[CURR_ACCT_REV_BAL_AMT] [numeric](15, 2) NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
	[PAYABLE_ORDER_NBR] [numeric](10, 0) NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_LINE_ITEM_NBR] [numeric](10, 0) NULL,
	[MEMO_ID] [numeric](10, 0) NULL,
	[CAP_INT_CASH_SEU_ANNIV_AMT] [numeric](15, 2) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[ANNUAL_PERCENTAGE_RATE_PCT] [numeric](11, 8) NULL,
	[RESIDUAL_INCOME_AMT] [numeric](15, 2) NULL,
	[UNEARNED_RESIDUAL_INC_AMT] [numeric](15, 2) NULL,
	[FINANCE_INCOME_AMT] [numeric](15, 2) NULL,
	[UNEARNED_FINANCE_INC_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_ELEMENT_SCHEDULE12] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_VAR_RATE_DETAILS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_VAR_RATE_DETAILS](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[RATE_OCCURRENCE_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[RATE_TYPE_CODE] [varchar](7) NULL,
	[RATE_TYPE_DESC] [varchar](50) NULL,
	[QUOTUM_NBR] [numeric](10, 0) NULL,
	[CEILING_RATE_PCT] [numeric](11, 8) NULL,
	[FLOOR_RATE_PCT] [numeric](11, 8) NULL,
	[REFERENCE_DATE_TYPE_CODE] [varchar](7) NULL,
	[REFERENCE_DATE_TYPE_DESC] [varchar](110) NULL,
	[UNIT_MULTIPLE_NBR] [numeric](4, 0) NULL,
	[NUMBER_OF_REFERENCES_NBR] [numeric](4, 0) NULL,
	[RATE_PERIOD_COVERAGE_CODE] [varchar](7) NULL,
	[RATE_PERIOD_COVERAGE_DESC] [varchar](110) NULL,
	[NUMERATOR_IN_PER_COUNT_CODE] [varchar](7) NULL,
	[NUMERATOR_IN_PER_COUNT_DESC] [varchar](110) NULL,
	[DENOMINATOR_IN_YR_COUNT_CODE] [varchar](7) NULL,
	[DENOMINATOR_IN_YR_COUNT_DESC] [varchar](110) NULL,
	[DENOMINATOR_OUT_YR_COUNT_CODE] [varchar](7) NULL,
	[DENOMINATOR_OUT_YR_COUNT_DESC] [varchar](110) NULL,
	[NUMERATOR_OUT_PER_COUNT_CODE] [varchar](7) NULL,
	[NUMERATOR_OUT_PER_COUNT_DESC] [varchar](110) NULL,
	[COMPOSITION_CODE] [varchar](7) NULL,
	[COMPOSITION_DESC] [varchar](110) NULL,
	[START_RATE_TYPE_CODE] [varchar](7) NULL,
	[START_RATE_TYPE_DESC] [varchar](110) NULL,
	[FINAL_RATE_TYPE_CODE] [varchar](7) NULL,
	[FINAL_RATE_TYPE_DESC] [varchar](110) NULL,
	[MEAN_MARGIN_FORMULA_CODE] [varchar](7) NULL,
	[MEAN_MARGIN_FORMULA_DESC] [varchar](110) NULL,
	[MEAN_MARGIN_PCT] [numeric](11, 8) NULL,
	[FINAL_MARGIN_FORMULA_CODE] [varchar](110) NULL,
	[FINAL_MARGIN_FORMULA_DESC] [varchar](110) NULL,
	[FINAL_MARGIN_PCT] [numeric](11, 8) NULL,
	[SEARCH_OFFSET_DAYS_NBR] [numeric](3, 0) NULL,
	[SEARCH_OFFSET_DAYS_CODE] [varchar](7) NULL,
	[SEARCH_OFFSET_DAYS_DESC] [varchar](110) NULL,
	[RATE_REF_EXTRACT_CODE] [varchar](7) NULL,
	[RATE_REF_EXTRACT_DESC] [varchar](110) NULL,
	[SEARCH_SPAN_ADDL_DAYS_NBR] [numeric](3, 0) NULL,
	[SEARCH_SPAN_ADDL_DAYS_CODE] [varchar](7) NULL,
	[SEARCH_SPAN_ADDL_DAYS_DESC] [varchar](110) NULL,
	[CLIQUET_FLOOR_VALUE_PCT] [numeric](11, 8) NULL,
	[CLIQUET_CEILING_VALUE_PCT] [numeric](11, 8) NULL,
	[CALENDAR_CODE] [numeric](5, 0) NULL,
	[CALENDAR_DESC] [varchar](50) NULL,
 CONSTRAINT [DW_ELEMENT_VAR_RATE_DET_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[ORDER_NBR] ASC,
	[RATE_OCCURRENCE_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENT_VARIABLE_RATES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENT_VARIABLE_RATES](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[FORMULA_TYPE_CODE] [varchar](7) NULL,
	[FORMULA_TYPE_DESC] [varchar](110) NULL,
	[COMPONENT_FINAL_RATE_TYPE_CODE] [varchar](7) NULL,
	[COMPONENT_FINAL_RATE_TYPE_DESC] [varchar](110) NULL,
	[FORMULA_FINAL_RATE_TYPE_CODE] [varchar](7) NULL,
	[FORMULA_FINAL_RATE_TYPE_DESC] [varchar](110) NULL,
	[MARGIN_PCT] [numeric](11, 8) NULL,
	[MARGIN_TYPE_CODE] [varchar](7) NULL,
	[MARGIN_TYPE_DESC] [varchar](110) NULL,
	[DAY_COUNT_CODE] [varchar](7) NULL,
	[DAY_COUNT_DESC] [varchar](110) NULL,
	[FIRST_RU_SCALE_NBR] [numeric](5, 0) NULL,
	[ROUNDING_UP_CODE] [varchar](7) NULL,
	[ROUNDING_UP_DESC] [varchar](110) NULL,
	[TEMP_CALC_METHOD_CODE] [varchar](7) NULL,
	[TEMP_CALC_METHOD_DESC] [varchar](110) NULL,
	[PROVISORY_RATE_PCT] [numeric](11, 8) NULL,
	[NUMERATOR_CORRECTION_CODE] [varchar](7) NULL,
	[NUMERATOR_CORRECTION_DESC] [varchar](110) NULL,
	[DENOMINATOR_CORRECTION_CODE] [varchar](7) NULL,
	[DENOMINATOR_CORRECTION_DESC] [varchar](110) NULL,
	[WEIGHTING_TYPE_CODE] [varchar](7) NULL,
	[WEIGHTING_TYPE_DESC] [varchar](110) NULL,
	[NON_CONVERT_ON_OUTPUT_IND] [numeric](1, 0) NULL,
	[TRIGGERING_THRESHOLD_PCT] [numeric](11, 8) NULL,
	[SECOND_ROUNDING_UP_CODE] [varchar](7) NULL,
	[SECOND_ROUNDING_UP_DESC] [varchar](110) NULL,
	[SECOND_RU_SCALE_NBR] [numeric](5, 0) NULL,
	[REPLACING_ORDER_NBR] [numeric](10, 0) NULL,
	[END_DT] [date] NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[VARIABLE_RATE_FORMULA_CODE] [numeric](5, 0) NULL,
	[VARIABLE_RATE_FORMULA_DESC] [varchar](100) NULL,
	[START_DT] [date] NULL,
 CONSTRAINT [DW_ELEMENT_VARIABLE_RATES_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ELEMENTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ELEMENTS](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[ENTERED_BY_CODE] [varchar](30) NULL,
	[ENTERED_BY_DESC] [varchar](50) NULL,
	[FINANCIAL_ELEMENT_SIGN_DESC] [varchar](1) NULL,
	[ELEMENT_CLASS_CODE] [varchar](1) NULL,
	[ELEMENT_CLASS_DESC] [varchar](110) NULL,
	[START_DT] [date] NULL,
	[CONTRACT_REVISION_NBR] [numeric](10, 0) NULL,
	[PREVIOUS_ORDER_NBR] [numeric](10, 0) NULL,
	[INVOICE_ORDER_NBR] [numeric](10, 0) NULL,
	[PARENT_ORDER_NBR] [numeric](10, 0) NULL,
	[GROUP_ORDER_NBR] [numeric](10, 0) NULL,
	[SYNDICATION_ID] [numeric](10, 0) NULL,
	[TAX_RATE_CODE] [varchar](7) NULL,
	[TAX_RATE_DESC] [varchar](50) NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[END_DT] [date] NULL,
	[USED_FIXED_RATE_PCT] [numeric](11, 8) NULL,
	[ACTUARIAL_RATE_PCT] [numeric](11, 8) NULL,
	[INITIAL_BASIS_AMT] [numeric](15, 2) NULL,
	[RESIDUAL_AMT] [numeric](15, 2) NULL,
	[FINANCIAL_PMT_SCHED_TYPE_CODE] [varchar](7) NULL,
	[FINANCIAL_PMT_SCHED_TYPE_DESC] [varchar](110) NULL,
	[INTEREST_CALC_METHOD_CODE] [varchar](7) NULL,
	[INTEREST_CALC_METHOD_DESC] [varchar](110) NULL,
	[INT_NUMERATOR_COUNT_CODE] [varchar](7) NULL,
	[INT_NUMERATOR_COUNT_DESC] [varchar](110) NULL,
	[INT_DENOMINATOR_COUNT_CODE] [varchar](7) NULL,
	[INT_DENOMINATOR_COUNT_DESC] [varchar](110) NULL,
	[REG_PAYMENT_UPDATE_DT] [date] NULL,
	[ELEMENT_UPDATE_DT] [date] NULL,
	[INCIDENTAL_CALC_BASIS_CODE] [varchar](15) NULL,
	[INCIDENTAL_CALC_BASIS_DESC] [varchar](110) NULL,
	[DISCOUNTING_BASIS_CODE] [varchar](7) NULL,
	[DISCOUNTING_BASIS_DESC] [varchar](110) NULL,
	[DISCOUNTING_START_DT] [date] NULL,
	[CURRENT_ACCOUNT_IND] [numeric](1, 0) NULL,
	[INVOICE_GROUPING_IND] [numeric](1, 0) NULL,
	[CONSTANT_REP_PMT_DEPR_CODE] [varchar](1) NULL,
	[CONSTANT_REP_PMT_DEPR_DESC] [varchar](110) NULL,
	[INCIDENTAL_MIN_BASIS_AMT] [numeric](15, 2) NULL,
	[INCIDENTAL_MAX_BASIS_AMT] [numeric](15, 2) NULL,
	[INCIDENTAL_EXEMPTIONS_AMT] [numeric](15, 2) NULL,
	[RATE_TYPE_CODE] [varchar](7) NULL,
	[RATE_TYPE_DESC] [varchar](110) NULL,
	[MANUALLY_DEFINED_IND] [numeric](1, 0) NULL,
	[APR_CALCULATION_IND] [numeric](1, 0) NULL,
	[AUTOMATIC_RENEWAL_IND] [numeric](1, 0) NULL,
	[CONSTANT_REG_PMT_IND] [numeric](1, 0) NULL,
	[REFRAMED_INT_NUMER_COUNT_CODE] [varchar](7) NULL,
	[REFRAMED_INT_NUMER_COUNT_DESC] [varchar](110) NULL,
	[REFRAMED_INT_DENOM_COUNT_CODE] [varchar](7) NULL,
	[REFRAMED_INT_DENOM_COUNT_DESC] [varchar](110) NULL,
	[RATE_CONVERSION_METHOD_CODE] [varchar](7) NULL,
	[RATE_CONVERSION_METHOD_DESC] [varchar](110) NULL,
	[REFRAMING_DT] [date] NULL,
	[RECENTERING_PMT_TERM_CODE] [varchar](1) NULL,
	[RECENTERING_PMT_TERM_DESC] [varchar](10) NULL,
	[INCOMPLETE_PERIOD_OFFSET_NBR] [numeric](4, 0) NULL,
	[RECENTERING_METHOD_CODE] [varchar](15) NULL,
	[RECENTERING_METHOD_DESC] [varchar](110) NULL,
	[CUST_CURRENT_ACCT_PART_AMT] [numeric](15, 2) NULL,
	[ADV_TRANS_METH_CURR_ACT_CODE] [varchar](7) NULL,
	[ADV_TRANS_METH_CURR_ACT_DESC] [varchar](110) NULL,
	[SPREAD_ON_CURRENT_ACCOUNT_PCT] [numeric](11, 8) NULL,
	[DEPOSIT_ACCT_INT_DISPLAY_IND] [numeric](1, 0) NULL,
	[FINANCING_PMT_SCHED_TYPE_CODE] [varchar](7) NULL,
	[FINANCING_PMT_SCHED_TYPE_DESC] [varchar](110) NULL,
	[SEASONAL_PERIOD_EXP_CODE] [varchar](7) NULL,
	[SEASONAL_PERIOD_EXP_DESC] [varchar](110) NULL,
	[SEASONAL_PERIOD_MULTIPLE_NBR] [numeric](3, 0) NULL,
	[ELEMENT_TYPE_CODE] [varchar](1) NULL,
	[ELEMENT_TYPE_DESC] [varchar](110) NULL,
	[SIMPLE_INT_PERIODICITY_CODE] [varchar](7) NULL,
	[SIMPLE_INT_PERIODICITY_DESC] [varchar](110) NULL,
	[SIMPLE_INT_PERIOD_MULT_NBR] [numeric](3, 0) NULL,
	[INTEREST_RATE_NATURE_CODE] [varchar](7) NULL,
	[INTEREST_RATE_NATURE_DESC] [varchar](110) NULL,
	[INTERNAL_FLOW_VALIDATION_CODE] [varchar](7) NULL,
	[INTERNAL_FLOW_VALIDATION_DESC] [varchar](110) NULL,
	[RATE_REF_PERIODICITY_CODE] [varchar](7) NULL,
	[RATE_REF_PERIODICITY_DESC] [varchar](110) NULL,
	[RATE_REF_PERIOD_UNIT_NBR] [numeric](3, 0) NULL,
	[CUR_ACCT_TAX_MGMT_METH_CODE] [varchar](7) NULL,
	[CUR_ACCT_TAX_MGMT_METH_DESC] [varchar](110) NULL,
	[CASH_ACCT_REVISION_MODE_CODE] [varchar](7) NULL,
	[CASH_ACCT_REVISION_MODE_DESC] [varchar](110) NULL,
	[CUR_ACCT_INT_RATE_ORIGIN_CODE] [varchar](7) NULL,
	[CUR_ACCT_INT_RATE_ORIGIN_DESC] [varchar](110) NULL,
	[CUR_ACCT_MANUAL_RATE_PCT] [numeric](11, 8) NULL,
	[ACCRUED_INT_CAPITALIZE_IND] [numeric](1, 0) NULL,
	[CAP_INT_PREPAY_CEILING_AMT] [numeric](15, 2) NULL,
	[VAT_FIXED_TERM_MOS_NBR] [numeric](3, 0) NULL,
	[IMMEDIATE_LUMP_SUM_IND] [numeric](1, 0) NULL,
	[ADDITIONAL_TAX_CODE] [varchar](7) NULL,
	[ADDITIONAL_TAX_DESC] [varchar](110) NULL,
	[ADDITIONAL_TAX_START_DT] [date] NULL,
	[SECURITY_DEPOSIT_BASIS_IND] [numeric](1, 0) NULL,
	[AMOUNT_PERIODICITY_CODE] [varchar](7) NULL,
	[AMOUNT_PERIODICITY_DESC] [varchar](110) NULL,
	[PROVISION_TYPE_CODE] [varchar](7) NULL,
	[PROVISION_TYPE_DESC] [varchar](110) NULL,
	[GUARANTOR_CAN_CALL_IND] [numeric](1, 0) NULL,
	[CUR_ACCT_TAX_METHOD_CODE] [varchar](7) NULL,
	[CUR_ACCT_TAX_METHOD_DESC] [varchar](110) NULL,
	[LOAN_NBR] [varchar](15) NULL,
	[ELEMENT_NOMINAL_RATE_PCT] [numeric](11, 8) NULL,
	[INVOICING_SUSPENDED_IND] [numeric](1, 0) NULL,
	[ELEMENT_DESC] [varchar](250) NULL,
	[TRANSFER_ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[TRANSFER_TAX_CODE] [varchar](7) NULL,
	[TRANSFER_TAX_DESC] [varchar](110) NULL,
	[RATE_APPL_PERIOD_MGMT_CODE] [varchar](7) NULL,
	[RATE_APPL_PERIOD_MGMT_DESC] [varchar](110) NULL,
	[RESTRUCTURED_ELEMENT_IND] [numeric](1, 0) NULL,
	[RESTRUCTURED_START_DT] [date] NULL,
	[SCHEDULE_ID] [numeric](10, 0) NULL,
	[EVOLUTION_ORDER_NBR] [numeric](10, 0) NULL,
	[AMOUNT_ORDER_NBR] [numeric](10, 0) NULL,
	[TIME_SPAN_ORDER_NBR] [numeric](10, 0) NULL,
	[LUMP_SUM_PERIOD_CODE] [varchar](7) NULL,
	[LUMP_SUM_PERIOD_DESC] [varchar](110) NULL,
	[RENEWAL_METHOD_CODE] [varchar](7) NULL,
	[RENEWAL_METHOD_DESC] [varchar](110) NULL,
	[RENEWAL_ELEMENT_ID] [numeric](10, 0) NULL,
	[LEASE_RENEWAL_PERIOD_IND] [numeric](1, 0) NULL,
	[POST_RENEWAL_PERIODICITY_CODE] [varchar](7) NULL,
	[POST_RENEWAL_PERIODICITY_DESC] [varchar](110) NULL,
	[POST_RENEWAL_PERIOD_MULT_NBR] [numeric](3, 0) NULL,
	[POST_RENEWAL_ELEMENT_NBR] [numeric](3, 0) NULL,
	[LAST_COMPLETE_TERM_RENEWAL_IND] [numeric](1, 0) NULL,
	[RENEWAL_AMT] [numeric](15, 2) NULL,
	[RESIDUAL_VALUE_PCT] [numeric](11, 8) NULL,
	[INSURANCE_POLICY_ID] [numeric](10, 0) NULL,
	[INSURED_ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[TRANSFER_PCT] [numeric](11, 8) NULL,
	[FACIAL_RATE_PCT] [numeric](11, 8) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[ACCRUAL_CONTRACT_ID] [numeric](10, 0) NULL,
	[ACCRUAL_ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[FIX_PARITY_RATE_PCT] [numeric](11, 8) NULL,
	[PARITY_SEARCH_METHOD_CODE] [varchar](7) NULL,
	[PARITY_SEARCH_METHOD_DESC] [varchar](110) NULL,
	[FIXING_DT] [date] NULL,
	[PARITY_SEARCH_GAP_CODE] [varchar](7) NULL,
	[PARITY_SEARCH_GAP_DESC] [varchar](110) NULL,
	[CALENDAR_CODE] [numeric](5, 0) NULL,
	[CALENDAR_DESC] [varchar](50) NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NULL,
	[FIX_RATE_SPREAD_PCT] [numeric](11, 8) NULL,
	[ROUNDING_METHOD_ON_UPB_CODE] [varchar](7) NULL,
	[ROUNDING_METHOD_ON_UPB_DESC] [varchar](110) NULL,
	[SUPPLIER_SHIFT_RATE_PCT] [numeric](11, 8) NULL,
	[MARKET_RATE_DATE_TIME_DT] [date] NULL,
	[DEPOSIT_PCT] [numeric](11, 8) NULL,
	[OPB_ROUNDING_UNIT_NBR] [numeric](10, 0) NULL,
	[ROUNDING_METHOD_CODE] [varchar](7) NULL,
	[ROUNDING_METHOD_DESC] [varchar](110) NULL,
	[ROUNDING_UNIT_NBR] [numeric](10, 0) NULL,
	[MONEY_FACTOR_NBR] [numeric](10, 0) NULL,
	[LATE_PYMTS_NBR] [numeric](10, 0) NULL,
	[MIN_RV_AMT] [numeric](15, 2) NULL,
	[MAX_RV_AMT] [numeric](15, 2) NULL,
	[PRICING_CRITERIA_ID] [numeric](10, 0) NULL,
	[PRICING_CRITERIA_ORDER_NBR] [numeric](10, 0) NULL,
	[PRICING_ELEMENT_ID] [numeric](10, 0) NULL,
	[EXTENSION_RATE_PCT] [numeric](11, 8) NULL,
	[CARD_INTEREST_RATE_GRADE_CODE] [varchar](15) NULL,
	[CARD_INTEREST_RATE_GRADE_DESC] [varchar](15) NULL,
	[CARD_SERVICE_RATE_GRADE_CODE] [varchar](15) NULL,
	[CARD_SERVICE_RATE_GRADE_DESC] [varchar](15) NULL,
	[CUSTOMER_TYPE_CODE] [varchar](15) NULL,
	[CUSTOMER_TYPE_DESC] [varchar](110) NULL,
	[CARD_BASIC_LIMIT_AMT] [numeric](15, 2) NULL,
	[CARD_SERVICE_LIMIT_AMT] [numeric](15, 2) NULL,
	[HOLD_CARD_LIMIT_IND] [numeric](1, 0) NULL,
	[LOAN_CARD_ONLY_IND] [numeric](1, 0) NULL,
	[PRIME_LOAN_CRD_TRANS_LIMIT_IND] [numeric](1, 0) NULL,
	[FORCED_END_DATE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_ELEMENTS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ETL_PARTIAL_LOAD]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ETL_PARTIAL_LOAD](
	[START_TIME] [date] NOT NULL,
	[TABLE_NAME] [varchar](30) NOT NULL,
	[RECORD_ID] [numeric](10, 0) NOT NULL,
	[END_TIME] [date] NULL,
 CONSTRAINT [DW_ETL_PARTIAL_LOAD_KEY] PRIMARY KEY NONCLUSTERED 
(
	[START_TIME] ASC,
	[TABLE_NAME] ASC,
	[RECORD_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_EVENT_DETAILS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_EVENT_DETAILS](
	[EVENT_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PRODUCT_CODE] [varchar](15) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[TABLE_DESC] [varchar](32) NULL,
	[COLUMN_DESC] [varchar](32) NULL,
	[DATE_DATA_DT] [date] NULL,
	[STRING_DATA_DESC] [varchar](250) NULL,
	[NUMERIC_DATA_AMT] [numeric](22, 8) NULL,
	[BOOLEAN_DATA_IND] [numeric](1, 0) NULL,
	[COVENANT_ID] [numeric](10, 0) NULL,
	[COVENANT_RESULT_STATUS_DESC] [varchar](15) NULL,
	[CONTRACT_ELEMENT_NUMBER_NBR] [numeric](10, 0) NULL,
	[MEMO_TXT] [varchar](2000) NULL,
	[ASSET_ELEMENT_NUMBER_NBR] [numeric](10, 0) NULL,
	[PRE_CHANGE_VALUE_DESC] [varchar](2000) NULL,
	[POST_CHANGE_VALUE_DESC] [varchar](2000) NULL,
	[COVENANT_ORDER_NBR] [numeric](10, 0) NULL,
	[RULE_ID] [numeric](10, 0) NULL,
	[CRITERIA_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_EVENT_DETAILS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[EVENT_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_EVENTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_EVENTS](
	[EVENT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BUSINESS_TYPE_CODE] [varchar](7) NULL,
	[BUSINESS_TYPE_DESC] [varchar](50) NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[EFFECTIVE_DT] [date] NULL,
	[CREATED_DT] [date] NULL,
	[MODULE_CODE] [varchar](15) NULL,
	[MODULE_DESC] [varchar](50) NULL,
	[FUNCTION_CODE] [varchar](15) NULL,
	[FUNCTION_DESC] [varchar](100) NULL,
	[DESTINATION_CODE] [varchar](15) NULL,
	[DESTINATION_DESC] [varchar](110) NULL,
	[VALIDATED_BY_CODE] [varchar](30) NULL,
	[VALIDATED_BY_DESC] [varchar](50) NULL,
	[DELETED_BY_CODE] [varchar](30) NULL,
	[DELETED_BY_DESC] [varchar](50) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[INVESTMENT_ID] [numeric](10, 0) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
	[VALIDATION_DT] [date] NULL,
	[DELETE_DT] [date] NULL,
	[EVENT_AMT] [numeric](15, 2) NULL,
	[PRE_EVENT_CODE] [varchar](15) NULL,
	[PRE_EVENT_DESC] [varchar](110) NULL,
	[POST_EVENT_CODE] [varchar](15) NULL,
	[POST_EVENT_DESC] [varchar](110) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[BUILDING_SITE_ID] [numeric](10, 0) NULL,
	[WORK_ORDER_ID] [numeric](10, 0) NULL,
	[TRANSACTION_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NULL,
	[BUDGET_ID] [numeric](10, 0) NULL,
	[CLAIM_ID] [numeric](10, 0) NULL,
	[INTERNAL_CODE_CODE] [varchar](15) NULL,
	[INTERNAL_CODE_DESC] [varchar](110) NULL,
	[INSURANCY_POLICY_ID] [numeric](10, 0) NULL,
	[PROPERTY_ID] [numeric](10, 0) NULL,
	[SERVICING_AGREEMENT_ID] [numeric](10, 0) NULL,
	[MANDATE_ID] [numeric](10, 0) NULL,
	[TENDER_ID] [numeric](10, 0) NULL,
	[BATCH_RUN_ID] [numeric](10, 0) NULL,
	[IMAGE_ID] [numeric](10, 0) NULL,
	[GROSS_VALUE_AMT] [numeric](15, 2) NULL,
	[GROSS_BOOK_VALUE_AMT] [numeric](15, 2) NULL,
	[PRE_EVENT_ACTOR_TRADE_1_DESC] [varchar](32) NULL,
	[PRE_EVENT_ACTOR_TRADE_2_DESC] [varchar](32) NULL,
	[AGGREGATE_ID] [numeric](10, 0) NULL,
	[COLLATERAL_ID] [numeric](10, 0) NULL,
	[ROLLBACK_REASON_CODE] [varchar](15) NULL,
	[ROLLBACK_REASON_DESC] [varchar](110) NULL,
	[ROLLBACK_DESCRIPTION_DESC] [varchar](2000) NULL,
	[RESTORE_REQUESTED_BY_CODE] [varchar](30) NULL,
	[RESTORE_REQUESTED_BY_DESC] [varchar](50) NULL,
	[RESTORE_REQUEST_DT] [date] NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[CHART_OF_ACCOUNTS_ID] [numeric](10, 0) NULL,
	[AFTER_IMAGE_ID] [numeric](10, 0) NULL,
	[COLLECTION_CASE_ID] [numeric](10, 0) NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[INTERNAL_TRANSACTION_ID] [numeric](10, 0) NULL,
	[CARD_ID] [numeric](10, 0) NULL,
	[CREATING_USER_DEPT_CODE] [varchar](7) NULL,
	[CREATING_USER_DEPT_DESC] [varchar](110) NULL,
	[VALIDATING_USER_DEPT_CODE] [varchar](7) NULL,
	[VALIDATING_USER_DEPT_DESC] [varchar](110) NULL,
	[DELETING_USER_DEPT_CODE] [varchar](7) NULL,
	[DELETING_USER_DEPT_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_EVENTS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[EVENT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_FINANCIAL_PROPOSAL_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_FINANCIAL_PROPOSAL_FO](
	[FINANCIAL_PROPOSAL_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[CREATION_DT] [date] NULL,
	[DESCRIPTION_DESC] [varchar](250) NULL,
	[COMMENT_TXT] [varchar](2000) NULL,
	[INVESTMENT_AMT] [numeric](15, 2) NULL,
	[PERIODICITY_DESC] [varchar](110) NULL,
	[NUMBER_OF_PERIODS_NBR] [numeric](4, 0) NULL,
	[FISCAL_REGIME_CODE] [varchar](7) NULL,
	[FISCAL_REGIME_DESC] [varchar](110) NULL,
	[APPROACH_FLOW_CODE] [varchar](7) NULL,
	[APPROACH_FLOW_DESC] [varchar](110) NULL,
	[TERM_CODE] [varchar](7) NULL,
	[TERM_DESC] [varchar](110) NULL,
	[TRANCHE_CODE] [varchar](7) NULL,
	[TRANCHE_DESC] [varchar](110) NULL,
	[CONSOLIDATION_PERIODICITY_CODE] [varchar](7) NULL,
	[CONSOLIDATION_PERIODICITY_DESC] [varchar](110) NULL,
	[CONSOLIDATIAON_DELAY_NBR] [numeric](3, 0) NULL,
	[PRE_CONSOLIDATION_RATE_CODE] [varchar](7) NULL,
	[PRE_CONSOLIDATION_RATE_DESC] [varchar](110) NULL,
	[CONS_FORMULA_MARGIN_PCT] [numeric](11, 8) NULL,
	[INDEX_RATE_PCT] [numeric](11, 8) NULL,
	[ORFI_EXPERT_FILE_PATH_DESC] [varchar](250) NULL,
	[RATE_FORMULA_CODE] [varchar](7) NULL,
	[RATE_FORMULA_DESC] [varchar](100) NULL,
	[TRANSFER_TAX_AMT] [numeric](15, 2) NULL,
	[APPLICATION_FEE_AMT] [numeric](15, 2) NULL,
	[CONST_AMORT_DURATION_NBR] [numeric](3, 0) NULL,
	[DEPRECIATION_ADJ_DURATION_NBR] [numeric](3, 0) NULL,
	[EXPENSE_AMORT_DURATION_NBR] [numeric](3, 0) NULL,
	[TRANSLATE_IND] [numeric](1, 0) NULL,
	[SHORT_TERM_CONT_COST_AMT] [numeric](15, 2) NULL,
	[LONG_TERM_CONT_COST_AMT] [numeric](15, 2) NULL,
	[PUBLICATION_COST_AMT] [numeric](15, 2) NULL,
	[COMPARATIVE_CASH_COST_AMT] [numeric](15, 2) NULL,
	[COMPARATIVE_TAX_RATE_PCT] [numeric](11, 8) NULL,
	[COMPARATIVE_DISCOUNT_RATE_PCT] [numeric](11, 8) NULL,
	[COMPARATIVE_MORTGAGE_COST_AMT] [numeric](15, 2) NULL,
	[COMPARATIVE_LOAN_PCT] [numeric](11, 8) NULL,
	[COMPARATIVE_NOMINAL_RATE_PCT] [numeric](11, 8) NULL,
	[FIRST_RENT_AMT] [numeric](15, 2) NULL,
	[MILEAGE_AMT] [numeric](15, 2) NULL,
	[UNIT_OF_MEASURE_CODE] [varchar](7) NULL,
	[UNIT_OF_MEASURE_DESC] [varchar](110) NULL,
	[MULTI_PAYMENT_IMPACT_CODE] [varchar](7) NULL,
	[MULTI_PAYMENT_IMPACT_DESC] [varchar](110) NULL,
	[CONSOLIDATION_METHOD_CODE] [varchar](7) NULL,
	[CONSOLIDATION_METHOD_DESC] [varchar](110) NULL,
	[APR_SERVICES_INCLUSIVE_AMT] [numeric](15, 2) NULL,
	[APR_SERVICES_EXCLUDED_AMT] [numeric](15, 2) NULL,
	[MFG_ADDITIONAL_SUPPORT_AMT] [numeric](15, 2) NULL,
	[DEALER_ADDITIONAL_SUPPORT_AMT] [numeric](15, 2) NULL,
	[OTHER_ADDITIONAL_SUPPORTS_AMT] [numeric](15, 2) NULL,
	[MFG_SUPPORT_NOTES_DESC] [varchar](50) NULL,
	[DEALER_SUPPORT_NOTES_DESC] [varchar](50) NULL,
	[OTHER_SUPPORT_NOTES_DESC] [varchar](50) NULL,
	[OVERRIDE_REGISTRATION_AMT] [numeric](15, 2) NULL,
	[OVERRIDE_DELIVERY_AMT] [numeric](15, 2) NULL,
	[OVERRIDE_BROKER_FEES_AMT] [numeric](15, 2) NULL,
	[REGISTRATION_NOTES_DESC] [varchar](50) NULL,
	[DELIVERY_NOTES_DESC] [varchar](50) NULL,
	[BROKER_FEES_NOTES_DESC] [varchar](50) NULL,
	[PAYMENT_PATTERN_ID] [numeric](10, 0) NULL,
	[AGENT_ACTOR_ID] [numeric](10, 0) NULL,
	[SALES_NETWORK_CODE] [varchar](7) NULL,
	[SALES_NETWORK_DESC] [varchar](110) NULL,
	[RESIDUAL_VALUE_AMT] [numeric](15, 2) NULL,
	[FIRST_PAYMENT_RAISED_IND] [numeric](1, 0) NULL,
	[AGENT_COMMISSION_RATE_PCT] [numeric](11, 8) NULL,
	[RISK_FEE_RATE_PCT] [numeric](11, 8) NULL,
	[SECURITY_DEPOSIT_AMT] [numeric](15, 2) NULL,
	[CONTRIBUTION_AMT] [numeric](15, 2) NULL,
	[NET_RISK_PCT] [numeric](11, 8) NULL,
	[OTHER_GUARANTEE_IND] [numeric](1, 0) NULL,
	[OTHER_GUARANTEE_NAME_DESC] [varchar](32) NULL,
	[OTHER_GUAR_COVERAGE_RATE_PCT] [numeric](11, 8) NULL,
	[DEPOSIT_PCT] [numeric](11, 8) NULL,
	[DEPOSIT_AMT] [numeric](15, 2) NULL,
	[DEPOSIT_REMUNERATION_RATE_PCT] [numeric](11, 8) NULL,
	[DOWN_PAYMENT_AMT] [numeric](15, 2) NULL,
	[DOWN_PAYMENT_PCT] [numeric](11, 8) NULL,
	[REMUNERATION_FORMULA_CODE] [varchar](7) NULL,
	[REMUNERATION_FORMULA_DESC] [varchar](110) NULL,
	[FOREBEARANCE_RATE_TYPE_CODE] [varchar](15) NULL,
	[FOREBEARANCE_RATE_TYPE_DESC] [varchar](110) NULL,
	[FOREBEARANCE_NBR] [numeric](3, 0) NULL,
	[FOREBEARANCE_CALC_METHOD_CODE] [varchar](15) NULL,
	[FOREBEARANCE_CALC_METHOD_DESC] [varchar](110) NULL,
	[FOREBEARANCE_RATE_PCT] [numeric](11, 8) NULL,
	[PRICING_CRITERIA_ID] [numeric](10, 0) NULL,
	[PRICING_CRITERIA_ORDER_NBR] [numeric](10, 0) NULL,
	[DURATION_NBR] [numeric](8, 0) NULL,
	[INTEREST_FRQUENCY_MULTIPLE_NBR] [numeric](4, 0) NULL,
	[DOWN_PMT_PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[MULTIPLE_NBR] [numeric](4, 0) NULL,
	[INTEREST_START_DT] [date] NULL,
	[INTEREST_END_DT] [date] NULL,
	[INTEREST_TERM_CODE] [varchar](7) NULL,
	[INTEREST_TERM_DESC] [varchar](110) NULL,
	[INTEREST_PERIODS_NBR] [numeric](4, 0) NULL,
	[INTEREST_FREQUENCY_CODE] [varchar](7) NULL,
	[INTEREST_FREQUENCY_DESC] [varchar](110) NULL,
	[UPFRONT_DOWN_PAYMENT_RATE_PCT] [numeric](11, 8) NULL,
	[DEPOSIT_RATE_PCT] [numeric](11, 8) NULL,
	[SECURITY_SETTING_RATE_PCT] [numeric](11, 8) NULL,
	[GRACE_PERIOD_FREQUENCY_CODE] [varchar](15) NULL,
	[GRACE_PERIOD_FREQUENCY_DESC] [varchar](110) NULL,
	[GRACE_PERIOD_FREQ_MULTIPLE_NBR] [numeric](4, 0) NULL,
	[GRACE_PERIOD_TERM_CODE] [varchar](15) NULL,
	[GRACE_PERIOD_TERM_DESC] [varchar](110) NULL,
	[QUOTE_TYPE_CODE] [varchar](15) NULL,
	[QUOTE_TYPE_DESC] [varchar](110) NULL,
	[DOWN_PAYMENT_BASIS_TYPE_CODE] [varchar](15) NULL,
	[DOWN_PAYMENT_BASIS_TYPE_DESC] [varchar](110) NULL,
	[DOWN_PAYMENT_EVAL_MODE_CODE] [varchar](15) NULL,
	[DOWN_PAYMENT_EVAL_MODE_DESC] [varchar](110) NULL,
	[DOWN_PAYMENT_EVALUATION_DT] [date] NULL,
	[INTEREST_REPAYMENT_METHOD_CODE] [varchar](15) NULL,
	[INTEREST_REPAYMENT_METHOD_DESC] [varchar](110) NULL,
	[GRACE_PERIOD_REPAY_METHOD_CODE] [varchar](15) NULL,
	[GRACE_PERIOD_REPAY_METHOD_DESC] [varchar](110) NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](50) NULL,
	[VARIABLE_RATE_FORMULA_CODE] [numeric](10, 0) NULL,
	[VARIABLE_RATE_FORMULA_DESC] [varchar](100) NULL,
	[INITIAL_PAYMENT_TYPE_CODE] [varchar](15) NULL,
	[INITIAL_PAYMENT_TYPE_DESC] [varchar](110) NULL,
	[ACCEPTED_PAYMENT_TYPE_CODE] [varchar](15) NULL,
	[ACCEPTED_PAYMENT_TYPE_DESC] [varchar](110) NULL,
	[ACCEPTED_DURATION_NBR] [numeric](3, 0) NULL,
	[INITIAL_DURATION_NBR] [numeric](3, 0) NULL,
	[GRACE_PERIOD_PRICE_CODE] [numeric](10, 0) NULL,
	[GRACE_PERIOD_PRICE_DESC] [varchar](100) NULL,
	[GRACE_PERIOD_ADJUSTMENT_PCT] [numeric](11, 8) NULL,
	[CONVERSION_AMT] [numeric](15, 2) NULL,
	[CONVERTED_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_FINANCIAL_PROPOSAL_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[FINANCIAL_PROPOSAL_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_FINANCIAL_PROPOSAL_TOPIC_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_FINANCIAL_PROPOSAL_TOPIC_FO](
	[FINANCIAL_PROPOSAL_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ORIGIN_FUNDS_CODE] [varchar](15) NULL,
	[ORIGIN_FUNDS_DESC] [varchar](110) NULL,
	[FORMULA_CODE] [varchar](7) NULL,
	[FORMULA_DESC] [varchar](100) NULL,
	[RESIDUAL_VALUE_AMT] [numeric](15, 2) NULL,
	[NOMINAL_RATE_PCT] [numeric](11, 8) NULL,
	[NOMINAL_MARGIN_NBR] [numeric](10, 0) NULL,
	[ACTUARIAL_REFINANCING_RATE_PCT] [numeric](11, 8) NULL,
	[SEASONAL_PERIODICITY_CODE] [varchar](7) NULL,
	[SEASONAL_PERIODICITY_DESC] [varchar](7) NULL,
	[SEASONAL_PERIOD_MULTIPLE_NBR] [numeric](3, 0) NULL,
	[VALUE_DT] [date] NULL,
	[EXPRESSION_RATE_TYPE_CODE] [varchar](15) NULL,
	[EXPRESSION_RATE_TYPE_DESC] [varchar](110) NULL,
	[ACTUARIAL_MARGIN_NBR] [numeric](10, 0) NULL,
	[TOTAL_CLIENT_ACTUARIAL_AMT] [numeric](15, 2) NULL,
	[NOMINAL_TOTAL_AMT] [numeric](15, 2) NULL,
	[ACTUARIAL_TOTAL_AMT] [numeric](15, 2) NULL,
	[TOPIC_CODE] [varchar](7) NULL,
	[TOPIC_DESC] [varchar](64) NULL,
	[COUNT_DOWN_DAYS_CODE] [varchar](15) NULL,
	[COUNT_DOWN_DAYS_DESC] [varchar](110) NULL,
	[ANNUAL_BASIS_COUNT_CODE] [varchar](15) NULL,
	[ANNUAL_BASIS_COUNT_DESC] [varchar](110) NULL,
	[PRESALE_RATE_CODE] [varchar](15) NULL,
	[PRESALE_RATE_DESC] [varchar](110) NULL,
	[AMOUNT_AMT] [numeric](15, 2) NULL,
	[INDEXING_IND] [numeric](1, 0) NULL,
	[RENT_AMOUNT_AMT] [numeric](15, 2) NULL,
	[REFINANCING_COST_AMT] [numeric](15, 2) NULL,
	[MANAGEMENT_COST_AMT] [numeric](15, 2) NULL,
	[AGENCY_COMMISSION_AMT] [numeric](15, 2) NULL,
	[SUBSIDIARY_MARGIN_AMT] [numeric](15, 2) NULL,
	[LEVER_EFFECT_NBR] [numeric](10, 0) NULL,
	[CODEVI_ENVELOPE_NBR] [numeric](10, 0) NULL,
	[CODEVI_AGREEMENT_DT] [date] NULL,
	[PROPOSAL_RESERVED_IND] [numeric](1, 0) NULL,
	[VARIABLE_RATE_PCT] [numeric](11, 8) NULL,
	[RATE_PERIODICITY_CODE] [varchar](7) NULL,
	[RATE_PERIODICITY_DESC] [varchar](110) NULL,
	[RATE_TYPE_CODE] [varchar](7) NULL,
	[RATE_TYPE_DESC] [varchar](110) NULL,
	[INT_CALC_METHOD_CODE] [varchar](7) NULL,
	[INT_CALC_METHOD_DESC] [varchar](110) NULL,
	[PRICING_ELEMENT_ID] [numeric](10, 0) NULL,
	[TAUCODEREFI_CODE] [varchar](7) NULL,
	[TAUCODEREFI_DESC] [varchar](50) NULL,
	[FTVIDREFI_NBR] [numeric](10, 0) NULL,
	[FTVIDREFI_DESC] [varchar](100) NULL,
	[PFRTXSPREADREFI_PCT] [numeric](11, 8) NULL,
	[PFRTXREFI_PCT] [numeric](11, 8) NULL,
	[PFRTOTALREFI_PCT] [numeric](11, 8) NULL,
	[PFRTXTYPEREFI_CODE] [varchar](15) NULL,
	[PFRTXTYPEREFI_DESC] [varchar](110) NULL,
	[PFRTYPEMONTAGE_CODE] [varchar](7) NULL,
	[PFRTYPEMONTAGE_DESC] [varchar](110) NULL,
	[MIN_AUTH_RATE_VARIATION_PCT] [numeric](11, 8) NULL,
	[MAX_AUTH_RATE_VARIATION_PCT] [numeric](11, 8) NULL,
	[MONEY_FACTOR_PCT] [numeric](11, 8) NULL,
	[PAYMENT_VALUE_RATIO_PCT] [numeric](11, 8) NULL,
	[LATE_PAYMENT_NBR] [numeric](4, 0) NULL,
	[CONSTANT_REGULAR_PYMT_IND] [numeric](1, 0) NULL,
	[INT_RATE_EVAL_MODE_CODE] [varchar](15) NULL,
	[INT_RATE_EVAL_MODE_DESC] [varchar](110) NULL,
	[LAST_RATE_EVAL_DT] [date] NULL,
	[OPB_ROUNDING_METHOD_CODE] [varchar](15) NULL,
	[OPB_ROUNDING_METHOD_DESC] [varchar](110) NULL,
	[OPB_ROUNDING_UNIT_NBR] [numeric](10, 0) NULL,
	[FLOW_ROUNDING_METHOD_CODE] [varchar](15) NULL,
	[FLOW_ROUNDING_METHOD_DESC] [varchar](110) NULL,
	[FLOW_ROUNDING_UNIT_NBR] [numeric](10, 0) NULL,
	[PARTICIPATION_RATE_PCT] [numeric](11, 8) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[DEAL_VERSION_CODE] [varchar](7) NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[ACTOR_ORDER_NBR] [numeric](10, 0) NULL,
	[SEASONAL_METHOD_BASIS_CODE] [varchar](15) NULL,
	[SEASONAL_METHOD_BASIS_DESC] [varchar](110) NULL,
	[SPREAD_EVAL_MODE_CODE] [varchar](15) NULL,
	[SPREAD_EVAL_MODE_DESC] [varchar](110) NULL,
	[VARIABLE_RATE_FORMULA_NBR] [numeric](10, 0) NULL,
	[VARIABLE_RATE_FORMULA_DESC] [varchar](100) NULL,
	[SPREAD_EVAL_DT] [date] NULL,
	[SPREAD_RATE_PCT] [numeric](11, 8) NULL,
	[RECENTERING_METHOD_CODE] [varchar](15) NULL,
	[RECENTERING_METHOD_DESC] [varchar](110) NULL,
	[DISCOUNT_RATE_PCT] [numeric](11, 8) NULL,
	[PRICING_DT] [date] NULL,
	[ADJUSTMENT_DT] [date] NULL,
	[FIXED_DISC_PRICE_DATE_IND] [numeric](1, 0) NULL,
	[VAR_BASE_RATE_FORMULA_CODE] [varchar](7) NULL,
	[VAR_BASE_RATE_FORMULA_DESC] [varchar](100) NULL,
	[VAR_INT_RATE_MONTHS_NBR] [numeric](10, 0) NULL,
	[FIXED_INT_RATE_MONTHS_NBR] [numeric](10, 0) NULL,
	[INI_LOW_INT_RATE_MONTHS_NBR] [numeric](10, 0) NULL,
	[SPREAD_AFTER_INI_LOW_RATE_PCT] [numeric](11, 8) NULL,
	[LOAN_INT_RATE_USED_PREV_IND] [numeric](1, 0) NULL,
	[LOAN_SPREAD_PREV_PCT] [numeric](11, 8) NULL,
	[LOAN_SPREAD_ALTERNATIVE_PCT] [numeric](11, 8) NULL,
	[CARD_INT_RATE_GRADE_CODE] [varchar](15) NULL,
	[CARD_INT_RATE_GRADE_DESC] [varchar](110) NULL,
	[CARD_SERVICE_RATE_GRADE_CODE] [varchar](15) NULL,
	[CARD_SERVICE_RATE_GRADE_DESC] [varchar](110) NULL,
	[CUST_TYPE_CODE] [varchar](15) NULL,
	[CUST_TYPE_DESC] [varchar](110) NULL,
	[CARD_BASIC_LIMIT_AMT] [numeric](15, 2) NULL,
	[CARD_SERVICE_LIMIT_AMT] [numeric](15, 2) NULL,
	[LOAN_CARD_ONLY_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_FIN_PROPOSAL_TOPIC_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[FINANCIAL_PROPOSAL_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_GL_ENTRIES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_GL_ENTRIES](
	[ENTRY_ID] [numeric](22, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[TRAIL_ID] [numeric](10, 0) NULL,
	[GLREG_ID] [numeric](10, 0) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[ACCOUNTING_CURRENCY_CODE] [varchar](3) NULL,
	[ACCOUNTING_CURRENCY_DESC] [varchar](25) NULL,
	[ORIGIN_GLREG_ID] [numeric](10, 0) NULL,
	[DISK_FILE_NAME_DESC] [varchar](264) NULL,
	[DISK_FILE_TRANSFER_DT] [date] NULL,
	[GL_ACCOUNT_NBR_DESC] [varchar](20) NULL,
	[DEBIT_CREDIT_DESC] [varchar](7) NULL,
	[INTERNAL_CURRENCY_AMT] [numeric](15, 2) NULL,
	[ACCOUNTING_CURRENCY_AMT] [numeric](15, 2) NULL,
	[PROCESSING_DT] [date] NULL,
	[ACCOUNTING_DT] [date] NULL,
	[DUE_DT] [date] NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[CONTRACT_AMMENDMENT_NBR] [numeric](2, 0) NULL,
	[ACTOR_CODE] [varchar](15) NULL,
	[LEDGER_CODE] [varchar](15) NULL,
	[LEDGER_DESC] [varchar](110) NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](15) NULL,
	[ENTRY_DESIGNATION_DESC] [varchar](25) NULL,
	[ACTOR_STATISTICS_CODE] [varchar](15) NULL,
	[ACTOR_STATISTICS_DESC] [varchar](110) NULL,
	[CONTRACT_STATISTICS_CODE] [varchar](15) NULL,
	[CONTRACT_STATISTICS_DESC] [varchar](110) NULL,
	[INVESTMENT_STATISTICS_CODE] [varchar](15) NULL,
	[INVESTMENT_STATISTICS_DESC] [varchar](110) NULL,
	[VOUCHER_REFERENCE_DESC] [varchar](15) NULL,
	[ORIGINATING_JOURNAL_CODE] [varchar](7) NULL,
	[ORIGINATING_JOURNAL_DESC] [varchar](110) NULL,
	[USERNAME_CODE] [varchar](30) NULL,
	[USERNAME_DESC] [varchar](50) NULL,
	[ACTOR_ROLE_CODE] [varchar](7) NULL,
	[ACTOR_ROLE_DESC] [varchar](50) NULL,
	[FINANCIAL_ATTRIBUTE_IND] [numeric](1, 0) NULL,
	[GROUP_ATTRIBUTE_IND] [numeric](1, 0) NULL,
	[RESIDENT_ATTRIBUTE_IND] [numeric](1, 0) NULL,
	[ANALYTICAL_PRODUCT_CODE] [varchar](7) NULL,
	[ANALYTICAL_PRODUCT_DESC] [varchar](110) NULL,
	[PERIOD_START_DT] [date] NULL,
	[PERIOD_END_DT] [date] NULL,
	[EXPENSE_SUB_TYPE_CODE] [varchar](7) NULL,
	[EXPENSE_SUB_TYPE_DESC] [varchar](110) NULL,
	[ALLOCATION_CODE] [varchar](15) NULL,
	[ALLOCATION_DESC] [varchar](110) NULL,
	[PHASE_CODE] [varchar](7) NULL,
	[PHASE_DESC] [varchar](25) NULL,
	[EXP_INV_ENTRY_TYPE_CODE] [varchar](15) NULL,
	[EXP_INV_ENTRY_TYPE_DESC] [varchar](110) NULL,
	[BUSINESS_TYPE_CODE] [varchar](7) NULL,
	[BUSINESS_TYPE_DESC] [varchar](110) NULL,
	[FISCAL_REGIME_CODE] [varchar](7) NULL,
	[FISCAL_REGIME_DESC] [varchar](110) NULL,
	[ELEMENT_CODE] [varchar](7) NULL,
	[ELEMENT_DESC] [varchar](64) NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[RATE_CODE] [varchar](7) NULL,
	[RATE_DESC] [varchar](110) NULL,
	[VAT_RATE_PCT] [numeric](5, 2) NULL,
	[PAYMENT_TYPE_CODE] [varchar](7) NULL,
	[PAYMENT_TYPE_DESC] [varchar](50) NULL,
	[BUILDING_NUMBER_DESC] [varchar](15) NULL,
	[SITE_REFERENCE_DESC] [varchar](15) NULL,
	[SITE_AMMENDMENT_NBR] [numeric](2, 0) NULL,
	[SYNDICATION_TYPE_CODE] [varchar](1) NULL,
	[SYNDICATION_TYPE_DESC] [varchar](110) NULL,
	[TAX_MANAGEMENT_CODE] [varchar](1) NULL,
	[TAX_MANAGEMENT_DESC] [varchar](110) NULL,
	[BAD_DEBT_IND] [numeric](1, 0) NULL,
	[CONVERSION_RATE_PCT] [numeric](11, 8) NULL,
	[ORIGINAL_VOUCHER_DESC] [varchar](15) NULL,
	[RECONCILIATION_CODE_DESC] [varchar](15) NULL,
	[ENTRY_TYPE_CODE] [varchar](7) NULL,
	[ENTRY_TYPE_DESC] [varchar](110) NULL,
	[COMPANY_REFERENCE_DESC] [varchar](50) NULL,
	[VOUCHER_DT] [date] NULL,
	[DEPARTMENT_CODE] [varchar](7) NULL,
	[DEPARTMENT_DESC] [varchar](110) NULL,
	[OPERATIONAL_CURRENCY_BASIS_AMT] [numeric](15, 2) NULL,
	[ACCOUNTING_CURRENCY_BASIS_AMT] [numeric](15, 2) NULL,
	[SLIP_NBR] [numeric](10, 0) NULL,
	[ACTOR_STATS_1_DESC] [varchar](15) NULL,
	[ACTOR_STATS_2_DESC] [varchar](15) NULL,
	[ELEMENT_ORDER_NBR] [varchar](15) NULL,
	[CONTRACT_STATS_2_DESC] [varchar](15) NULL,
	[BUILDING_STATS_1_DESC] [varchar](15) NULL,
	[BUILDING_STATS_2_DESC] [varchar](15) NULL,
	[OUTPUT_LINE_DESC] [varchar](2000) NULL,
	[ACCOUNTING_ID_CODE] [varchar](15) NULL,
	[ACCOUNTING_ID_DESC] [varchar](110) NULL,
	[ANALYTICAL_AXIS_1_DESC] [varchar](200) NULL,
	[ANALYTICAL_AXIS_2_DESC] [varchar](200) NULL,
	[ANALYTICAL_AXIS_3_DESC] [varchar](200) NULL,
	[ANALYTICAL_AXIS_4_DESC] [varchar](200) NULL,
	[ANALYTICAL_AXIS_5_DESC] [varchar](200) NULL,
	[MOV2_EXTERNAL_REFERENCE_DESC] [varchar](15) NULL,
	[AUDIT_TRAIL_ORDER_NBR] [numeric](10, 0) NULL,
	[AGGREGATE_ID] [numeric](10, 0) NULL,
	[BANK_REC_VOUCHER_DESC] [varchar](15) NULL,
	[READJUSTMENT_IND] [numeric](1, 0) NULL,
	[HOST_ACCOUNTING_DT] [date] NULL,
	[USE_CONTRACT_REFERENCE_DESC] [varchar](15) NULL,
	[USE_CONTRACT_AMMENDMENT_NBR] [numeric](2, 0) NULL,
	[USE_CONTRACT_COMPANY_REF_CODE] [varchar](15) NULL,
	[USE_CONTRACT_COMPANY_REF_DESC] [varchar](110) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NULL,
	[BATCH_RUN_ID] [numeric](10, 0) NULL,
	[PAYER_ACTOR_ID] [numeric](10, 0) NULL,
	[CONSOLIDATED_CURRENCY_CODE] [varchar](7) NULL,
	[CONSOLIDATED_CURRENCY_DESC] [varchar](25) NULL,
	[POST_TAX_CONS_CURRENCY_AMT] [numeric](15, 2) NULL,
	[CONSOL_EXCHANGE_RATE_PCT] [numeric](11, 8) NULL,
	[GLREG_LINE_NBR] [numeric](10, 0) NULL,
	[GLREG_SUBLINE_NBR] [numeric](10, 0) NULL,
	[BORROWER_DESC] [varchar](15) NULL,
	[CONTRACT_PRODUCT_CODE] [varchar](7) NULL,
	[CONTRACT_PRODUCT_DESC] [varchar](50) NULL,
	[LOAN_NBR] [varchar](50) NULL,
 CONSTRAINT [DW_GL_ENTRIES_KEY] PRIMARY KEY NONCLUSTERED 
(
	[ENTRY_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_GL_REGISTER]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_GL_REGISTER](
	[GLREG_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NULL,
	[TRANSACTION_ID] [numeric](10, 0) NULL,
	[REGISTER_CODE] [varchar](7) NULL,
	[REGISTER_DESC] [varchar](110) NULL,
	[CREATION_DT] [date] NULL,
	[ACCOUNTING_DT] [date] NULL,
	[PROCESSING_DT] [date] NULL,
	[NON_PROCESSED_IND] [numeric](1, 0) NULL,
	[ZERO_AMOUNT_ENABLED_IND] [numeric](1, 0) NULL,
	[CANCELLATION_ID] [numeric](10, 0) NULL,
	[BLOCKED_IND] [numeric](1, 0) NULL,
	[BLOCKED_COMMENT_DESC] [varchar](250) NULL,
 CONSTRAINT [DW_GL_REGISTER_KEY] PRIMARY KEY NONCLUSTERED 
(
	[GLREG_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_GL_REJECTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_GL_REJECTS](
	[REJECT_TRAIL_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[REGISTER_CODE] [varchar](10) NOT NULL,
	[REGISTER_DESC] [varchar](100) NULL,
	[REJECT_ID] [numeric](10, 0) NOT NULL,
	[REFERENCE_NBR] [varchar](20) NULL,
	[DEBIT_AMT] [numeric](15, 2) NULL,
	[CREDIT_AMT] [numeric](15, 2) NULL,
	[GLREG_ID] [numeric](10, 0) NULL,
	[DEBIT_AMT_COMPTA] [numeric](15, 2) NULL,
	[CREDIT_AMT_COMPTA] [numeric](15, 2) NULL,
	[DEBIT_AMT_CONSO] [numeric](15, 2) NULL,
	[CREDIT_AMT_CONSO] [numeric](15, 2) NULL,
	[REJECT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[REJECT_OR_LINE_NBR] [numeric](10, 0) NULL,
	[REJECT_OR_SUBLINE_NBR] [numeric](10, 0) NULL,
	[ACCOUNTING_DT] [date] NULL,
	[GL_ACCOUNT_NUMBER_DESC] [varchar](100) NULL,
	[DEBIT_CREDIT_DESC] [varchar](5) NULL,
	[REJECT_AMT] [numeric](15, 2) NULL,
	[CURRENCY_CODE] [varchar](10) NULL,
	[CURRENCY_DESC] [varchar](50) NULL,
	[CONTRACT_NUMBER_DESC] [varchar](50) NULL,
	[CONTRACT_AMENDMENT_NBR] [numeric](2, 0) NULL,
	[INVOICE_NUMBER_DESC] [varchar](50) NULL,
	[PAYABLE_NUMBER_DESC] [varchar](50) NULL,
	[REFERENCE_DESC] [varchar](50) NULL,
	[CONTRACT_BUSINESS_TYPE_CODE] [varchar](20) NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[PROCESS_ALLOCATION_DESC] [varchar](100) NULL,
	[ACTOR_ROLE_CODE] [varchar](20) NULL,
	[ACTOR_ROLE_DESC] [varchar](20) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_GRID_CHARACTERISTICS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_GRID_CHARACTERISTICS](
	[GRID_CHARACTERISTIC_ID] [numeric](10, 0) NOT NULL,
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CHARACT_CD] [varchar](10) NOT NULL,
	[CHARACT_CD_DESC] [varchar](50) NULL,
	[CVG_CD] [varchar](10) NOT NULL,
	[NUMERIC_VALUE_AMT] [numeric](10, 0) NULL,
	[STRING_VALUE_CODE] [varchar](150) NULL,
	[STRING_VALUE_DESC] [varchar](2000) NULL,
	[DATE_VALUE_DT] [date] NULL,
	[BOOLEAN_VALUE_IND] [numeric](2, 0) NULL,
	[CHARACTERISTIC_CODE] [varchar](150) NULL,
	[LINE_NUM] [numeric](10, 0) NULL,
 CONSTRAINT [DW_GRID_CHARACTERISTIC_KEY] PRIMARY KEY CLUSTERED 
(
	[GRID_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_GROUP_EVENTS_RIGHTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_GROUP_EVENTS_RIGHTS](
	[MODULE_CODE] [varchar](15) NOT NULL,
	[MODULE_DESC] [varchar](255) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[FUNCTION_CODE] [varchar](15) NOT NULL,
	[FUNCTION_DESC] [varchar](255) NULL,
	[GROUP_CODE] [varchar](7) NOT NULL,
	[GROUP_DESC] [varchar](255) NULL,
	[CREATION_IND] [numeric](1, 0) NULL,
	[MODIFICATION_IND] [numeric](1, 0) NULL,
	[DELETE_IND] [numeric](1, 0) NULL,
	[VIEW_IND] [numeric](1, 0) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CAP_AMT] [numeric](10, 2) NULL,
	[LIMITE_DT] [date] NULL,
	[ACTIVE_IND] [numeric](1, 0) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_INVOLVED_USER]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_INVOLVED_USER](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEPARTMENT_CODE] [varchar](7) NOT NULL,
	[DEPARTMENT_DESC] [varchar](30) NOT NULL,
	[BUSINESS_CODE] [varchar](7) NOT NULL,
	[BUSINESS_DESC] [varchar](50) NOT NULL,
	[USER_BY_CODE] [varchar](30) NOT NULL,
	[USER_BY_DESC] [varchar](100) NOT NULL,
	[MEMO_TXT] [varchar](2000) NULL,
	[PRINC_IND] [numeric](1, 0) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
PRIMARY KEY CLUSTERED 
(
	[CONTRACT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC,
	[DEPARTMENT_CODE] ASC,
	[BUSINESS_CODE] ASC,
	[USER_BY_CODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_LK_ACT_COR_ADR]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_LK_ACT_COR_ADR](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[CORRESPONDANT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[ADDRESS_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ADDRESS_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_LK_ACT_COR_ADR_KEY] PRIMARY KEY NONCLUSTERED 
(
	[ACTOR_ID] ASC,
	[CORRESPONDANT_ORDER_NBR] ASC,
	[ADDRESS_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_LK_ACT_COR_TEL]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_LK_ACT_COR_TEL](
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[TELECOM_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[CORRESPONDANT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PREFERRED_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_LK_ACT_COR_TEL_KEY] PRIMARY KEY NONCLUSTERED 
(
	[ACTOR_ID] ASC,
	[TELECOM_ORDER_NBR] ASC,
	[CORRESPONDANT_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_LK_COLLATERAL_PRODUCT]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_LK_COLLATERAL_PRODUCT](
	[COLLATERAL_ID] [numeric](10, 0) NOT NULL,
	[PRODUCT_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
 CONSTRAINT [DW_LK_COLLATERAL_PRODUCT_KEY] PRIMARY KEY NONCLUSTERED 
(
	[COLLATERAL_ID] ASC,
	[PRODUCT_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_LK_DEAL_FIN_PROPOSAL_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_LK_DEAL_FIN_PROPOSAL_FO](
	[DEAL_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_CODE] [varchar](7) NOT NULL,
	[FINANCING_OFFER_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DEAL_VERSION_DESC] [varchar](110) NULL,
	[FINANCIAL_PROPOSAL_ID] [numeric](10, 0) NULL,
	[DEADLINE_DT] [date] NULL,
	[PROPOSAL_RESTRAINT_IND] [numeric](1, 0) NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[UNDERWRITER_VALID_DT] [date] NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[CUSTOMER_VALID_DT] [date] NULL,
	[EXTERNAL_QUOTE_IND] [numeric](1, 0) NULL,
	[SECONDARY_QUOTE_IND] [numeric](1, 0) NULL,
	[ACTIVATION_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_LK_DEAL_FIN_PROPOSAL_FO_KEY] PRIMARY KEY NONCLUSTERED 
(
	[DEAL_ID] ASC,
	[DEAL_VERSION_CODE] ASC,
	[FINANCING_OFFER_ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_LK_ELEMENT_EVENT]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_LK_ELEMENT_EVENT](
	[CONTRACT_ID] [numeric](10, 0) NOT NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[EVENT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
 CONSTRAINT [DW_LK_ELEMENT_EVENT_KEY] PRIMARY KEY NONCLUSTERED 
(
	[CONTRACT_ID] ASC,
	[ELEMENT_ORDER_NBR] ASC,
	[EVENT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_LK_PART_RECEIVABLES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_LK_PART_RECEIVABLES](
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[RECEIVABLE_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PRINCIPAL_AMT] [numeric](15, 2) NULL,
	[ACTUALIZED_AMT] [numeric](15, 2) NULL,
	[TAX_EXCLUDED_AMT] [numeric](15, 2) NULL,
	[REVISED_AMT] [numeric](15, 2) NULL,
	[PARTICIPANT_SHARE_AMT] [numeric](15, 2) NULL,
	[ANNUAL_RATE_PCT] [numeric](8, 5) NULL,
 CONSTRAINT [DW_LK_PART_RECEIVABLES_KEY] PRIMARY KEY NONCLUSTERED 
(
	[RECEIVABLE_ID] ASC,
	[RECEIVABLE_LINE_ITEM_NBR] ASC,
	[ACTOR_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_LK_TRANS_BANKS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_LK_TRANS_BANKS](
	[TRANSACTION_ID] [numeric](10, 0) NOT NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PAYMENT_AMT] [numeric](15, 2) NULL,
	[TRANSACTION_TYPE_CODE] [varchar](15) NULL,
	[TRANSACTION_TYPE_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_LK_TRANS_BANKS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[TRANSACTION_ID] ASC,
	[BANK_ACCOUNT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_LK_TRANS_PAYABLES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_LK_TRANS_PAYABLES](
	[TRANSACTION_ID] [numeric](10, 0) NOT NULL,
	[TRANSACTION_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[PAYABLE_ID] [numeric](10, 0) NOT NULL,
	[PAYABLE_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[TOTAL_AMT] [numeric](15, 2) NULL,
	[PRINCIPAL_AMT] [numeric](15, 2) NULL,
	[REVIEWED_AMT] [numeric](15, 2) NULL,
	[INDEXED_AMT] [numeric](15, 2) NULL,
	[NON_RECHARGEABLE_AMT] [numeric](15, 2) NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NULL,
	[TRANSFER_TRANSACTION_ID] [numeric](10, 0) NULL,
	[CANCELING_TRANSACTION_ID] [numeric](10, 0) NULL,
	[DISPLAY_ORDER_NBR] [numeric](10, 0) NULL,
 CONSTRAINT [DW_LK_TRANS_PAY_KEY] PRIMARY KEY NONCLUSTERED 
(
	[PAYABLE_ID] ASC,
	[PAYABLE_LINE_ITEM_NBR] ASC,
	[TRANSACTION_ID] ASC,
	[TRANSACTION_LINE_ITEM_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_LK_TRANS_RECEIVABLES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_LK_TRANS_RECEIVABLES](
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[RECEIVABLE_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[TRANSACTION_ID] [numeric](10, 0) NOT NULL,
	[TRANSACTION_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[TAX_EXCLUDED_AMT] [numeric](15, 2) NULL,
	[ACTUALIZED_BASE_AMT] [numeric](15, 2) NULL,
	[REVISED_BASE_AMT] [numeric](15, 2) NULL,
	[PRINCIPAL_AMT] [numeric](15, 2) NULL,
	[TARGET_BANK_ACCOUNT_ID] [numeric](10, 0) NULL,
	[TRANSFER_TRANSACTION_ID] [numeric](10, 0) NULL,
	[CANCELING_TRANSACTION_ID] [numeric](10, 0) NULL,
	[DISPLAY_ORDER_NBR] [numeric](10, 0) NULL,
 CONSTRAINT [DW_LK_TRANS_REC_KEY] PRIMARY KEY NONCLUSTERED 
(
	[RECEIVABLE_ID] ASC,
	[RECEIVABLE_LINE_ITEM_NBR] ASC,
	[TRANSACTION_ID] ASC,
	[TRANSACTION_LINE_ITEM_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_PAYABLE_CHARACTERISTICS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_PAYABLE_CHARACTERISTICS](
	[PAYABLE_CHARACTERISTIC_ID] [numeric](10, 0) NOT NULL,
	[PAYABLE_ID] [numeric](10, 0) NOT NULL,
	[CHARACTERISTIC_CODE] [varchar](150) NULL,
	[CHARACTERISTIC_DESC] [varchar](150) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[DATA_TYPE_DESC] [varchar](12) NOT NULL,
	[NUMERIC_VALUE_AMT] [numeric](22, 7) NULL,
	[STRING_VALUE_DESC] [varchar](2000) NULL,
	[DATE_VALUE_DT] [date] NULL,
	[BOOLEAN_VALUE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_PAYABLE_CHARACTERISTICS_KEY] PRIMARY KEY CLUSTERED 
(
	[PAYABLE_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_PAYABLE_LINE_ITEMS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_PAYABLE_LINE_ITEMS](
	[PAYABLE_ID] [numeric](10, 0) NOT NULL,
	[PAYABLE_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[INVESTMENT_ID] [numeric](10, 0) NULL,
	[INVESTMENT_ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[BUILDING_ID] [numeric](10, 0) NULL,
	[RATE_CODE_CODE] [varchar](7) NULL,
	[RATE_CODE_DESC] [varchar](110) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[WORK_ORDER_1_ID] [numeric](10, 0) NULL,
	[PRE_TAX_AMT] [numeric](15, 2) NULL,
	[TAX_RATE_PCT] [numeric](5, 2) NULL,
	[DESCRIPTION_DESC] [varchar](50) NULL,
	[NON_HOUSE_EXP_REBILL_PCT] [numeric](5, 2) NULL,
	[HOUSE_EXP_REBILL_PCT] [numeric](5, 2) NULL,
	[ELEMENT_EFFECTIVE_DT] [date] NULL,
	[PERIOD_START_DT] [date] NULL,
	[PERIOD_END_DT] [date] NULL,
	[PRE_TAX_UNIT_PRICE_AMT] [numeric](15, 2) NULL,
	[TAX_ON_UNIT_PRICE_AMT] [numeric](15, 2) NULL,
	[UNIT_QUANTITY_AMT] [numeric](10, 3) NULL,
	[MEASUREMENT_UNIT_CODE] [varchar](7) NULL,
	[MEASUREMENT_UNIT_DESC] [varchar](110) NULL,
	[RECHARGE_DELAY_CODE] [varchar](110) NULL,
	[RECHARGE_DELAY_DESC] [varchar](110) NULL,
	[PRO_RATED_TAX_RATE_PCT] [numeric](5, 2) NULL,
	[CREDIT_NOTE_ID] [numeric](10, 0) NULL,
	[PAYABLE_NOMENCLATURE_CODE] [numeric](10, 0) NULL,
	[PAYABLE_NOMENCLATURE_DESC] [varchar](60) NULL,
	[BUDGET_NOMENCLATURE_CODE] [numeric](10, 0) NULL,
	[BUDGET_NOMENCLATURE_DESC] [varchar](60) NULL,
	[CHARGE_SPLIT_UP_ORDER_NBR] [numeric](10, 0) NULL,
	[PAYABLE_PERIOD_ORDER_NBR] [numeric](10, 0) NULL,
	[ACTUALIZED_AMT] [numeric](15, 2) NULL,
	[REVISED_AMT] [numeric](15, 2) NULL,
	[PRINCIPAL_AMT] [numeric](15, 2) NULL,
	[PAID_TO_BE_RECLAIMED_IND] [numeric](1, 0) NULL,
	[REBILLING_IND] [numeric](1, 0) NULL,
	[TAX_EXCLUDED_AMT] [numeric](15, 2) NULL,
	[INSURANCE_POLICY_ID] [numeric](10, 0) NULL,
	[TAX_AMT] [numeric](15, 2) NULL,
	[DEDUCTABLE_TAX_AMT] [numeric](15, 2) NULL,
	[REVISION_ID] [numeric](10, 0) NULL,
	[CALCULATION_BASIS_AMT] [numeric](15, 2) NULL,
	[INCIDENTAL_RATE_PCT] [numeric](11, 8) NULL,
	[REVISION_DT] [date] NULL,
	[CONCILIATION_CODE] [varchar](15) NULL,
	[CONCILIATION_DESC] [varchar](110) NULL,
	[PAYMENT_TERM_CODE] [varchar](7) NULL,
	[PAYMENT_TERM_DESC] [varchar](110) NULL,
	[TERM_DT] [date] NULL,
	[ELEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[COMPONENT_ORDER_NBR] [numeric](10, 0) NULL,
	[TRANSACTION_ID] [numeric](10, 0) NULL,
	[TRANSACTION_LINE_ITEM_NBR] [numeric](10, 0) NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_LINE_ITEM_NBR] [numeric](10, 0) NULL,
	[TARGET_BANK_ID] [numeric](10, 0) NULL,
	[ANNUAL_RATE_PCT] [numeric](11, 8) NULL,
	[LAND_REG_ORDER_NBR] [numeric](10, 0) NULL,
	[CONTRACT_CURRENCY_CODE] [varchar](3) NULL,
	[CONTRACT_CURRENCY_DESC] [varchar](25) NULL,
	[CONTRACT_CURRENCY_AMT] [numeric](15, 2) NULL,
	[WORK_ORDER_2_ID] [numeric](10, 0) NULL,
	[ORGANIZATION_CODE] [varchar](7) NULL,
	[ORGANIZATION_DESC] [varchar](110) NULL,
	[BUILDING2_ID] [numeric](10, 0) NULL,
	[EQUIPMENT_OCCURRENCE_NBR] [numeric](10, 0) NULL,
	[INDEX_OCCURRENCE_NBR] [numeric](10, 0) NULL,
	[BUDGET_ID] [numeric](10, 0) NULL,
	[ORDER_LINE_ORDER_NBR] [numeric](10, 0) NULL,
	[DEAL_ID] [numeric](10, 0) NULL,
	[ADDL_INCENTIVE_REASON_CODE] [varchar](15) NULL,
	[ADDL_INCENTIVE_REASON_DESC] [varchar](110) NULL,
	[COMPETITOR_ACTOR_ID] [numeric](10, 0) NULL,
	[ADDL_INCENTIVE_PROMO_TYP_CODE] [varchar](15) NULL,
	[ADDL_INCENTIVE_PROMO_TYP_DESC] [varchar](110) NULL,
	[COMPETITOR_DIFF_ADDL_INT_PCT] [numeric](11, 8) NULL,
	[ADDITIONAL_INCENTIVE_PCT] [numeric](11, 8) NULL,
	[MILEAGE_NBR] [numeric](10, 0) NULL,
	[USAGE_ORDER_NBR] [numeric](10, 0) NULL,
	[SYNDICATION_ID] [numeric](10, 0) NULL,
	[PART_PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[PART_PRE_TAX_AMT] [numeric](15, 2) NULL,
	[PART_TAX_AMT] [numeric](15, 2) NULL,
	[PART_DUE_DT] [date] NULL,
 CONSTRAINT [DW_PAYABLE_LINE_ITEMS_KEY] PRIMARY KEY CLUSTERED 
(
	[PAYABLE_ID] ASC,
	[PAYABLE_LINE_ITEM_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_PAYABLE_PAYMENT_INFO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_PAYABLE_PAYMENT_INFO](
	[PAYABLE_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ADDRESS_ORDER_NBR] [numeric](10, 0) NULL,
	[BENEFICIARY_ACTOR_ID] [numeric](10, 0) NOT NULL,
	[PAYMENT_METHOD_CODE] [varchar](7) NULL,
	[PAYMENT_METHOD_DESC] [varchar](50) NULL,
	[BANK_ACCOUNT_OUT_ID] [numeric](10, 0) NULL,
	[BANK_ACCOUNT_OUT_ACTOR_ID] [numeric](10, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[CASH_IN_PAYMENT_METHOD_CODE] [varchar](7) NULL,
	[CASH_IN_PAYMENT_METHOD_DESC] [varchar](50) NULL,
	[BANK_ACCOUNT_IN_ID] [numeric](10, 0) NULL,
	[BANK_ACCOUNT_IN_ACTOR_ID] [numeric](10, 0) NULL,
	[PAYMENT_DELAY_CODE] [varchar](7) NULL,
	[PAYMENT_DELAY_DESC] [varchar](110) NULL,
	[TERM_DT] [date] NULL,
	[PAYMENT_DT] [date] NULL,
	[PAYMENT_BLOCKED_IND] [numeric](1, 0) NULL,
	[DISCOUNT_PCT] [numeric](5, 2) NULL,
	[DAY_NBR] [numeric](3, 0) NULL,
	[START_BASIS_CODE] [varchar](7) NULL,
	[START_BASIS_DESC] [varchar](110) NULL,
	[TOTAL_AMT] [numeric](15, 2) NULL,
	[MODIFIED_DUE_DATE_IND] [numeric](1, 0) NULL,
	[PAYMENT_BLOCKED_REASON_CODE] [varchar](15) NULL,
	[PAYMENT_BLOCKED_REASON_DESC] [varchar](250) NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NULL,
	[TARGET_BANK_ACCT_OUT_ID] [numeric](10, 0) NULL,
	[TERM_PROCESS_IND] [numeric](1, 0) NULL,
	[CONTRACT_CURRENCY_CODE] [varchar](3) NULL,
	[CONTRACT_CURRENCY_DESC] [varchar](25) NULL,
	[EXPECTED_CURRENCY_AMT] [numeric](15, 2) NULL,
	[EXCHANGE_RATE_PCT] [numeric](15, 5) NULL,
	[EXCHANGE_TYPE_CODE] [varchar](15) NULL,
	[EXCHANGE_TYPE_DESC] [varchar](110) NULL,
	[PAYMENT_IN_CONTRACT_CURR_AMT] [numeric](15, 2) NULL,
	[DEVCODECONTRACTCURRENCY_CODE] [varchar](3) NULL,
	[DEVCODECONTRACTCURRENCY_DESC] [varchar](25) NULL,
	[CARD_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_PAYABLE_PAYMENT_INFO_KEY] PRIMARY KEY CLUSTERED 
(
	[PAYABLE_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_PAYABLE_PHASE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_PAYABLE_PHASE](
	[PAYABLE_ID] [numeric](10, 0) NOT NULL,
	[PHASE_CODE] [varchar](7) NOT NULL,
	[AREA_CODE] [varchar](15) NOT NULL,
	[STEP_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PHASE_DESC] [varchar](25) NULL,
	[AREA_DESC] [varchar](110) NULL,
	[STEP_DESC] [varchar](100) NULL,
	[USERNAME_CODE] [varchar](30) NOT NULL,
	[USERNAME_DESC] [varchar](50) NOT NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[EFFECTIVE_DT] [date] NULL,
	[END_DT] [date] NULL,
 CONSTRAINT [DW_PAYABLE_PHASE_KEY] PRIMARY KEY CLUSTERED 
(
	[PAYABLE_ID] ASC,
	[PHASE_CODE] ASC,
	[AREA_CODE] ASC,
	[STEP_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_PAYABLE_SYNDICATIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DW_PAYABLE_SYNDICATIONS](
	[PAYABLE_ID] [numeric](10, 0) NOT NULL,
	[PAYABLE_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[SYNDICATION_ID] [numeric](10, 0) NOT NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NULL,
	[TAX_EXCLUDED_AMT] [numeric](15, 2) NULL,
	[TAX_AMT] [numeric](15, 2) NULL,
	[CALL_DUE_DT] [date] NULL,
 CONSTRAINT [DW_PAYABLE_SYNDICATIONS_KEY] PRIMARY KEY CLUSTERED 
(
	[PAYABLE_ID] ASC,
	[PAYABLE_LINE_ITEM_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[DW_PAYABLES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_PAYABLES](
	[PAYABLE_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CONTRACT_CURRENCY_CODE] [varchar](3) NOT NULL,
	[CONTRACT_CURRENCY_DESC] [varchar](25) NULL,
	[ACCOUNTING_CURRENCY_CODE] [varchar](3) NOT NULL,
	[ACCOUNTING_CURRENCY_DESC] [varchar](25) NULL,
	[PRODUCT_CODE] [varchar](7) NOT NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[CONTRACT_BUSINESS_TYPE_CODE] [varchar](7) NOT NULL,
	[CONTRACT_BUSINESS_TYPE_DESC] [varchar](50) NULL,
	[PAYABLE_ORIGIN_CODE] [varchar](7) NOT NULL,
	[PAYABLE_ORIGIN_DESC] [varchar](110) NULL,
	[VOUCHER_TYPE_CODE] [varchar](7) NOT NULL,
	[VOUCHER_TYPE_DESC] [varchar](110) NULL,
	[PAYABLE_NUMBER_DESC] [varchar](15) NOT NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NOT NULL,
	[PAYEE_ACTOR_ID] [numeric](10, 0) NOT NULL,
	[PAYEE_ROLE_CODE] [varchar](7) NOT NULL,
	[PAYEE_ROLE_DESC] [varchar](50) NULL,
	[PAYABLE_SUBTYPE_CODE] [varchar](7) NULL,
	[PAYABLE_SUBTYPE_DESC] [varchar](110) NULL,
	[BUILDING_SITE_ID] [numeric](10, 0) NULL,
	[VOUCHER_DT] [date] NULL,
	[EXTERNAL_REFERENCE_DESC] [varchar](50) NULL,
	[RECEIPT_DT] [date] NULL,
	[PAYABLE_LABEL_DESC] [varchar](50) NULL,
	[PRE_TAX_AMT] [numeric](15, 2) NULL,
	[ACCOUNTING_DT] [date] NULL,
	[RETENSION_AMT] [numeric](15, 2) NULL,
	[SUBJECTED_TO_VAT_CODE] [varchar](1) NULL,
	[SUBJECTED_TO_VAT_DESC] [varchar](110) NULL,
	[WORK_ORDER_ID] [numeric](10, 0) NULL,
	[PAYABLE_INFORMATION_DESC] [varchar](15) NULL,
	[PARTIAL_PAYMENT_ID] [numeric](10, 0) NULL,
	[ORIGINAL_CREDIT_NOTE_ID] [numeric](10, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NULL,
	[BUDGET_ORDER_NBR] [numeric](10, 0) NULL,
	[TOTAL_CONVERTED_AMT] [numeric](15, 2) NULL,
	[CONVERSION_RATE_PCT] [numeric](15, 5) NULL,
	[BATCH_PROCESS_ID] [numeric](10, 0) NULL,
	[PATIAL_PAYMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[GUARANTY_RETAINER_PCT] [numeric](5, 2) NULL,
	[WITHHOLDING_PERIOD_NBR] [numeric](3, 0) NULL,
	[GUAR_WITHHOLDING_PAYMENT_DT] [date] NULL,
	[CLAIM_ID] [numeric](10, 0) NULL,
	[GIVEN_MANDATE_ID] [numeric](10, 0) NULL,
	[RECEIVED_MANDATE_ID] [numeric](10, 0) NULL,
	[PAYEE_TRADE_CODE] [varchar](15) NULL,
	[PAYEE_TRADE_DESC] [varchar](110) NULL,
	[SERVICING_AGREEMENT_ID] [numeric](10, 0) NULL,
	[BATCH_RUN_ID] [numeric](10, 0) NULL,
	[PROCEEDING_ACTOR_ID] [numeric](10, 0) NULL,
	[LEGAL_PROCEEDING_ORDER_NBR] [numeric](10, 0) NULL,
	[EU_VAT_APPLIES_IND] [numeric](1, 0) NULL,
	[INITIAL_TOTAL_AMT] [numeric](15, 2) NULL,
	[INITIAL_EXPENDITURE_ID] [numeric](10, 0) NULL,
	[INVOICE_CENTER_ORDER_NBR] [numeric](10, 0) NULL,
	[PAYMENT_CURRENCY_CODE] [varchar](3) NULL,
	[PAYMENT_CURRENCY_DESC] [varchar](25) NULL,
	[EXCHANGE_RATE_PCT] [numeric](15, 5) NULL,
	[CONSOLIDATED_CURRENCY_CODE] [varchar](3) NULL,
	[CONSOLIDATED_CURRENCY_DESC] [varchar](25) NULL,
	[TOTAL_CONS_CONVERTED_AMT] [numeric](15, 2) NULL,
	[CONSOLIDATED_EXCHANGE_RATE_PCT] [numeric](15, 5) NULL,
	[EXPENSE_ASYNC_MODE_CODE] [varchar](7) NULL,
	[EXPENSE_ASYNC_MODE_DESC] [varchar](110) NULL,
	[ORDER_LINE_ORDER_NBR] [numeric](10, 0) NULL,
	[VAT_AMT] [numeric](15, 2) NULL,
	[REVIEWED_PAYABLE_ID] [numeric](10, 0) NULL,
	[BUSINESS_UNIT_CODE] [varchar](15) NULL,
	[BUSINESS_UNIT_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_PAYABLES_KEY] PRIMARY KEY CLUSTERED 
(
	[PAYABLE_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_PRICING_CRITERIA]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_PRICING_CRITERIA](
	[PRICING_CRITERIA_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PRICING_CRITERIA_DESC] [varchar](250) NULL,
	[BUSINESS_TYPE_CODE] [varchar](7) NULL,
	[BUSINESS_TYPE_DESC] [varchar](50) NULL,
	[PRODUCT_CODE] [varchar](7) NULL,
	[PRODUCT_DESC] [varchar](50) NULL,
	[SALES_NETWORK_CODE] [varchar](15) NULL,
	[SALES_NETWORK_DESC] [varchar](110) NULL,
	[CURRENCY_CODE] [varchar](3) NOT NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[ACTOR_TYPE_CODE] [varchar](7) NULL,
	[ACTOR_TYPE_DESC] [varchar](110) NULL,
	[MAXIMUM_AMT] [numeric](15, 2) NULL,
	[MINIMUM_AMT] [numeric](15, 2) NULL,
	[MAXIMUM_DURATION_NBR] [numeric](3, 0) NULL,
	[MINIMUM_DURATION_NBR] [numeric](3, 0) NULL,
	[ENTRY_DT] [date] NULL,
	[START_DT] [date] NOT NULL,
	[END_DT] [date] NULL,
	[MIN_RESIDUAL_VALUE_PCT] [numeric](11, 8) NULL,
	[MAX_RESIDUAL_VALUE_PCT] [numeric](11, 8) NULL,
	[USAGE_CONTEXT_CODE] [varchar](15) NULL,
	[USAGE_CONTEXT_DESC] [varchar](110) NULL,
	[METHOD_CODE] [varchar](15) NULL,
	[METHOD_DESC] [varchar](110) NULL,
	[INVOICING_METHOD_CODE] [varchar](15) NULL,
	[INVOICING_METHOD_DESC] [varchar](110) NULL,
	[INVOICING_REASON_CODE] [varchar](15) NULL,
	[INVOICING_REASON_DESC] [varchar](250) NULL,
	[TARGET_CODE] [varchar](15) NULL,
	[TARGET_DESC] [varchar](110) NULL,
	[CONTRACT_VERSION_DESC] [varchar](250) NULL,
	[PRICING_CODE] [varchar](15) NULL,
	[PRICING_DESC] [varchar](15) NULL,
	[SCALE_TYPE_CODE] [varchar](15) NULL,
	[SCALE_TYPE_DESC] [varchar](110) NULL,
	[EVENT_TYPE_CODE] [varchar](15) NULL,
	[EVENT_TYPE_DESC] [varchar](110) NULL,
	[PRODUCT_VERSION_NBR] [numeric](10, 0) NULL,
 CONSTRAINT [DW_PRICING_CRITERIA_KEY] PRIMARY KEY CLUSTERED 
(
	[PRICING_CRITERIA_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_PROCESS_ALLOCATIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_PROCESS_ALLOCATIONS](
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PROCESS_ALLOCATION_CODE] [varchar](7) NULL,
	[PROCESS_ALLOCATION_DESC] [varchar](64) NULL,
	[INTEREST_IND] [numeric](1, 0) NULL,
	[TAX_ESCROW_IND] [numeric](1, 0) NULL,
	[INSURANCE_ESCROW_IND] [numeric](1, 0) NULL,
	[RESERVE_ESCROW_IND] [numeric](1, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[PROCESS_ALLOCATION_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_RATE_VALUE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_RATE_VALUE](
	[RATE_CODE] [varchar](7) NOT NULL,
	[RATE_DESC] [varchar](255) NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PERIOD_START_DT] [date] NOT NULL,
	[RATE_VALUE_PCT] [numeric](10, 2) NOT NULL,
	[ENTRY_DT] [date] NULL,
	[PERIOD_END_DT] [date] NULL,
	[RATE_DISCOUNT_AMT] [numeric](10, 2) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_RECEIVABLE_BALANCES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_RECEIVABLE_BALANCES](
	[RECORD_ID] [numeric](22, 0) NOT NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[EFFECTIVE_DATE_KEY] [numeric](8, 0) NOT NULL,
	[CURRENT_IND] [numeric](1, 0) NULL,
	[BALANCE_TYPE_DESC] [varchar](20) NOT NULL,
	[ENTRY_DATE_AMT] [numeric](15, 2) NULL,
	[VALUE_DATE_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_RECEIVABLE_BALANCES_KEY] PRIMARY KEY CLUSTERED 
(
	[RECORD_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_RECEIVABLE_CHARACTERISTICS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_RECEIVABLE_CHARACTERISTICS](
	[RECEIVABLE_CHARACTERISTIC_ID] [numeric](10, 0) NOT NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CHARACTERISTIC_CODE] [varchar](150) NULL,
	[CHARACTERISTIC_DESC] [varchar](150) NULL,
	[DATA_TYPE_DESC] [varchar](12) NULL,
	[NUMERIC_VALUE_AMT] [numeric](22, 7) NULL,
	[STRING_VALUE_DESC] [varchar](2000) NULL,
	[DATE_VALUE_DT] [date] NULL,
	[BOOLEAN_VALUE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_RECEIVABLE_CHARACTERISTICS_KEY] PRIMARY KEY CLUSTERED 
(
	[RECEIVABLE_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_RECEIVABLE_DETAILS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_RECEIVABLE_DETAILS](
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[CONTRACT_NUMBER_DESC] [varchar](15) NULL,
	[DESCRIPTION_DESC] [varchar](2000) NULL,
	[CUSTOMER_COMMENT_DESC] [varchar](50) NULL,
	[CUSTOMER_REFERENCE_DESC] [varchar](20) NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
	[PAYABLE_NUMBER_DESC] [varchar](15) NULL,
	[CONTRACT_AMENDMENT_NBR] [numeric](2, 0) NULL,
	[SYNDICATION_ID] [numeric](10, 0) NULL,
	[NOMENCLATURE_CODE] [numeric](5, 0) NULL,
	[NOMENCLATURE_DESC] [varchar](60) NULL,
	[ELEMENT_NBR] [numeric](10, 0) NULL,
	[PROPERTY_ID] [numeric](10, 0) NULL,
	[INVESTMENT_ID] [numeric](10, 0) NULL,
	[SORT_ORDER_CODE] [varchar](15) NULL,
	[SORT_ORDER_DESC] [varchar](110) NULL,
	[DRAW_ID] [numeric](10, 0) NULL,
	[DELIVERY_TYPE_CODE] [varchar](15) NULL,
	[DELIVERY_TYPE_DESC] [varchar](110) NULL,
	[CURRENT_TURN_AMT] [numeric](15, 2) NULL,
	[REMAINING_TURNS_AMT] [numeric](15, 2) NULL,
	[LOAN_BALANCE_AMT] [numeric](15, 2) NULL,
	[PRINCIPAL_PAID_AMT] [numeric](15, 2) NULL,
	[PREVIOUS_MONTHLY_UNPAID_AMT] [numeric](15, 2) NULL,
	[PREVIOUS_OVERPAID_AMT] [numeric](15, 2) NULL,
	[PREV_MNT_DELINQUENT_PRINC_AMT] [numeric](15, 2) NULL,
	[LATE_CHARGE_AMT] [numeric](15, 2) NULL,
	[PREV_MNT_DELINQUENT_TOTAL_AMT] [numeric](15, 2) NULL,
	[CURR_MNT_BILLING_TOTAL_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_RECEIVABLE_DETAILS_KEY] PRIMARY KEY CLUSTERED 
(
	[RECEIVABLE_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_RECEIVABLE_LINE_BALANCE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_RECEIVABLE_LINE_BALANCE](
	[RECORD_ID] [numeric](22, 0) NOT NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[RECEIVABLE_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[EFFECTIVE_DATE_KEY] [numeric](8, 0) NOT NULL,
	[CURRENT_IND] [numeric](1, 0) NULL,
	[BALANCE_TYPE_DESC] [varchar](20) NOT NULL,
	[ENTRY_DATE_AMT] [numeric](15, 2) NULL,
	[VALUE_DATE_AMT] [numeric](15, 2) NULL,
 CONSTRAINT [DW_REC_LINE_ITEM_BALANCES_KEY] PRIMARY KEY CLUSTERED 
(
	[RECORD_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_RECEIVABLE_LINE_ITEMS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_RECEIVABLE_LINE_ITEMS](
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[RECEIVABLE_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[RECEIVABLE_DETAILS_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NOT NULL,
	[PRE_TAX_AMT] [numeric](15, 2) NOT NULL,
	[TAX_CODE] [varchar](7) NULL,
	[TAX_DESC] [varchar](50) NULL,
	[REVISION_ID] [numeric](10, 0) NULL,
	[ACTUALIZATION_ID] [numeric](10, 0) NULL,
	[CREDIT_NOTE_RECEIVABLE_ID] [numeric](10, 0) NULL,
	[UNPAID_RECEIVABLE_ID] [numeric](10, 0) NULL,
	[TERM_OCCURRENCE_NBR] [numeric](10, 0) NULL,
	[TOTAL_AMT] [numeric](15, 2) NULL,
	[REVISED_AMT] [numeric](15, 2) NULL,
	[PRINCIPAL_AMT] [numeric](15, 2) NULL,
	[TAX_RATE_PCT] [numeric](5, 2) NULL,
	[PERIOD_START_DT] [date] NULL,
	[PERIOD_END_DT] [date] NULL,
	[LINE_REGROUPING_NBR] [numeric](10, 0) NULL,
	[VARIABLE_RATE_VALUE_PCT] [numeric](11, 8) NULL,
	[CASHFLOW_AGGREEMENT_ORDER_NBR] [numeric](10, 0) NULL,
	[CURACCT_BAL_IDX_PREV_AMT] [numeric](15, 2) NULL,
	[CURACCT_BAL_IDX_EOP_AMT] [numeric](15, 2) NULL,
	[CURACCT_BAL_IDX_PRETX_PRV_AMT] [numeric](15, 2) NULL,
	[CURACCT_BAL_IDX_PRETX_EOP_AMT] [numeric](15, 2) NULL,
	[LOAN_DESC] [varchar](15) NULL,
	[CURACCT_VAT_PRV_AMT] [numeric](15, 2) NULL,
	[CURACCT_VAT_EOP_AMT] [numeric](15, 2) NULL,
	[PREVIOUS_REVISION_ID] [numeric](10, 0) NULL,
	[ELEMENT_CLASS_CODE] [varchar](7) NULL,
	[ELEMENT_CLASS_DESC] [varchar](110) NULL,
	[FINANCIAL_ELEMENT_TYPE_CODE] [varchar](7) NULL,
	[FINANCIAL_ELEMENT_TYPE_DESC] [varchar](110) NULL,
	[CURR_ACCT_INT_RATE_ORIG_CODE] [varchar](7) NULL,
	[CURR_ACCT_INT_RATE_ORIG_DESC] [varchar](110) NULL,
	[CALCULATION_BASIS_AMT] [numeric](15, 2) NULL,
	[INCIDENTAL_RATE_PCT] [numeric](11, 8) NULL,
	[REVISION_DT] [date] NULL,
	[TERM_DT] [date] NULL,
	[END_OF_PREVIOUS_PERIOD_DT] [date] NULL,
	[ACTOR_OCCURRENCE_NBR] [numeric](10, 0) NULL,
	[INTEREST_CALC_METHOD_CODE] [varchar](7) NULL,
	[INTEREST_CALC_METHOD_DESC] [varchar](110) NULL,
	[INTERST_RATE_TYPE_CODE] [varchar](7) NULL,
	[INTERST_RATE_TYPE_DESC] [varchar](110) NULL,
	[TAX_MGMT_METHOD_CODE] [varchar](7) NULL,
	[TAX_MGMT_METHOD_DESC] [varchar](110) NULL,
	[FLIDRUCVTMODEINDEX_CODE] [varchar](7) NULL,
	[FLIDRUCVTMODEINDEX_DESC] [varchar](110) NULL,
	[FLIDRUCCFLAGAFFICHINT_IND] [numeric](1, 0) NULL,
	[CURACCT_INTEREST_IND] [numeric](1, 0) NULL,
	[PERCEPTION_CODE] [varchar](7) NULL,
	[PERCEPTION_DESC] [varchar](110) NULL,
	[REVISION_MODE_CODE] [varchar](15) NULL,
	[REVISION_MODE_DESC] [varchar](110) NULL,
	[INTEREST_CALC_BASIS_AMT] [numeric](15, 2) NULL,
	[MEMO_ID] [numeric](10, 0) NULL,
	[TRANSFER_ACTOR_NBR] [numeric](10, 0) NULL,
	[PAYMENT_TAX_CODE_CODE] [varchar](7) NULL,
	[PAYMENT_TAX_CODE_DESC] [varchar](50) NULL,
	[PAYMENT_SCHED_TYPE_CODE] [varchar](7) NULL,
	[PAYMENT_SCHED_TYPE_DESC] [varchar](110) NULL,
	[ELEMENT_DESC] [varchar](250) NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
	[PAYABLE_LINE_ITEM_NBR] [numeric](10, 0) NULL,
	[ORIGINAL_CREDIT_NOTE_ID] [numeric](10, 0) NULL,
	[ORIGINAL_CREDIT_NOTE_LINE_NBR] [numeric](10, 0) NULL,
	[PAYMENT_CODE_CODE] [varchar](7) NULL,
	[PAYMENT_CODE_DESC] [varchar](110) NULL,
	[WORK_ID] [numeric](10, 0) NULL,
	[BUDGET_ORDER_NBR] [numeric](10, 0) NULL,
	[ANNUAL_RATE_PCT] [numeric](11, 8) NULL,
	[ELEMENT_NBR] [numeric](10, 0) NULL,
	[PAYMENT_NBR] [numeric](10, 0) NULL,
	[CONSTRUCTION_STEP_NBR] [numeric](10, 0) NULL,
	[PRETAX_PASSIVE_ELEMENT_AMT] [numeric](15, 2) NULL,
	[PASSIVE_ELEMENT_PRINCIPAL_AMT] [numeric](15, 2) NULL,
	[FOREIGN_EXCHANGE_RATE_PCT] [numeric](15, 5) NULL,
	[ORIGINAL_CURRENCY_CODE] [varchar](3) NULL,
	[ORIGINAL_CURRENCY_DESC] [varchar](25) NULL,
	[INTEREST_IND] [numeric](1, 0) NULL,
	[TAX_ESCROW_IND] [numeric](1, 0) NULL,
	[INS_ESCROW_IND] [numeric](1, 0) NULL,
	[RES_ESCROW_IND] [numeric](1, 0) NULL,
	[LATE_CHARGE_IND] [numeric](1, 0) NULL,
	[FEES_IND] [numeric](1, 0) NULL,
	[SERVICE_FEES_IND] [numeric](1, 0) NULL,
	[OTHER_IND] [numeric](1, 0) NULL,
	[ADDRESS_ID] [numeric](10, 0) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[CONTRACT_NUMBER_DESC] [varchar](200) NULL,
 CONSTRAINT [DW_RECEIVABLE_LINE_ITEMS_KEY] PRIMARY KEY CLUSTERED 
(
	[RECEIVABLE_ID] ASC,
	[RECEIVABLE_LINE_ITEM_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_RECEIVABLE_PAYMENT_INFO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_RECEIVABLE_PAYMENT_INFO](
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[LATE_PMT_INT_REASON_CODE] [varchar](15) NULL,
	[LATE_PMT_INT_REASON_DESC] [varchar](110) NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[PAYMENT_METHOD_IN_CODE] [varchar](7) NULL,
	[PAYMENT_METHOD_IN_DESC] [varchar](50) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[BANK_ACCOUNT_OUT_ID] [numeric](10, 0) NULL,
	[BANK_OUT_ACTOR_ID] [numeric](10, 0) NULL,
	[PAYMENT_METHOD_OUT_CODE] [varchar](7) NULL,
	[PAYMENT_METHOD_OUT_DESC] [varchar](50) NULL,
	[PAYEE_ACTOR_ID] [numeric](10, 0) NULL,
	[TERM_DT] [date] NULL,
	[DUE_DT] [date] NULL,
	[DIRECT_DEBIT_BLOCKED_IND] [numeric](1, 0) NULL,
	[DIRECT_DEBIT_TRANS_IND] [numeric](1, 0) NULL,
	[TOTAL_AMT] [numeric](15, 2) NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NULL,
	[BANK_ACCT_IN_ID] [numeric](10, 0) NULL,
	[PROCESSING_TERM_IND] [numeric](1, 0) NULL,
	[NON_REMINDER_REASON_CODE] [varchar](15) NULL,
	[NON_REMINDER_REASON_DESC] [varchar](110) NULL,
	[PAYMENT_MADE_IND] [numeric](1, 0) NULL,
	[EXPECTED_CURRENCY_CODE] [varchar](3) NULL,
	[EXPECTED_CURRENCY_DESC] [varchar](25) NULL,
	[EXP_CURRENCY_PMT_AMT] [numeric](15, 2) NULL,
	[EXCHANGE_RATE_PCT] [numeric](15, 5) NULL,
	[EXCHANGE_RATE_TYPE_CODE] [varchar](15) NULL,
	[EXCHANGE_RATE_TYPE_DESC] [varchar](15) NULL,
	[PAYMENT_DT] [date] NULL,
	[PAYMENT_VALUE_DT] [date] NULL,
	[CARD_ID] [numeric](10, 0) NULL,
	[COLLECTION_CASE_ID] [numeric](10, 0) NULL,
	[SUBROGRATION_ORDER_NBR] [numeric](10, 0) NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_RECEIVABLE_PAYMENT_INFO_KEY] PRIMARY KEY CLUSTERED 
(
	[RECEIVABLE_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_RECEIVABLES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_RECEIVABLES](
	[RECEIVABLE_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NOT NULL,
	[CONTRACT_TYPE_CODE] [varchar](7) NOT NULL,
	[CONTRACT_TYPE_DESC] [varchar](50) NULL,
	[CURRENCY_CODE] [varchar](3) NOT NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[PAYEE_ACTOR_ID] [numeric](10, 0) NOT NULL,
	[ORIGINAL_RECEIVABLE_ID] [numeric](10, 0) NULL,
	[PAYEE_ADRESS_ORDER_NBR] [numeric](10, 0) NOT NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[ACTOR_ROLE_CODE] [varchar](7) NOT NULL,
	[ACTOR_ROLE_DESC] [varchar](50) NULL,
	[ACCOUNTING_CURRENCY_CODE] [varchar](3) NULL,
	[ACCOUNTING_CURRENCY_DESC] [varchar](25) NULL,
	[INVOICE_NUMBER_DESC] [varchar](15) NOT NULL,
	[RECEIVABLE_TYPE_CODE] [varchar](7) NOT NULL,
	[RECEIVABLE_TYPE_DESC] [varchar](110) NULL,
	[TOTAL_INVOICE_AMT] [numeric](15, 2) NULL,
	[INVOICE_DT] [date] NOT NULL,
	[PROCESSING_DT] [date] NULL,
	[GRACE_PERIOD_NBR] [numeric](5, 0) NULL,
	[CO_VAT_TYPE_CODE] [varchar](1) NULL,
	[CO_VAT_TYPE_DESC] [varchar](110) NULL,
	[CUSTOMER_COPY_IND] [numeric](1, 0) NULL,
	[CREDIT_NOTE_IND] [numeric](1, 0) NULL,
	[TEMPORARY_IND] [numeric](1, 0) NULL,
	[BATCH_JOB_ID] [numeric](10, 0) NULL,
	[CUSTOMER_CONTACT_DESC] [varchar](50) NULL,
	[TOTAL_CONVERTED_AMT] [numeric](15, 2) NULL,
	[CONVERSION_RATE_PCT] [numeric](15, 5) NULL,
	[CONSTRUCTION_BUDGET_ID] [numeric](10, 0) NULL,
	[BUDGET_OCCURRENCE_NBR] [numeric](10, 0) NULL,
	[USERNAME_CODE] [varchar](30) NULL,
	[USERNAME_DESC] [varchar](45) NULL,
	[CLAIM_ID] [numeric](10, 0) NULL,
	[MANDATE_ID] [numeric](10, 0) NULL,
	[INVOICE_RECAP_CODE] [varchar](7) NULL,
	[INVOICE_RECAP_DESC] [varchar](110) NULL,
	[BATCH_RUN_ID] [numeric](10, 0) NULL,
	[INVOICE_CENTER_ORDER_NBR] [numeric](10, 0) NULL,
	[TRANSFER_STATUS_CODE] [varchar](7) NULL,
	[TRANSFER_STATUS_DESC] [varchar](110) NULL,
	[INITIAL_DUE_DT] [date] NOT NULL,
	[RELATED_INVOICE_ID] [numeric](10, 0) NULL,
	[CREDIT_NOTE_REASON_CODE] [varchar](15) NULL,
	[CREDIT_NOTE_REASON_DESC] [varchar](110) NULL,
	[PAYMENT_CURRENCY_CODE] [varchar](3) NULL,
	[PAYMENT_CURRENCY_DESC] [varchar](25) NULL,
	[CURRENCY_EXCHANGE_RATE_PCT] [numeric](15, 5) NULL,
	[CONSOLIDATION_CURRENCY_CODE] [varchar](3) NULL,
	[CONSOLIDATION_CURRENCY_DESC] [varchar](25) NULL,
	[TOTAL_CONSOLIDATED_AMT] [numeric](15, 2) NULL,
	[EXCHANGE_RATE_PCT] [numeric](15, 5) NULL,
	[INVOICE_STATUS_CODE] [varchar](7) NULL,
	[INVOICE_STATUS_DESC] [varchar](110) NULL,
	[DIRECT_DEBIT_REFERENCE_DESC] [varchar](50) NULL,
	[E_PAYMENTS_REFERENCE_DESC] [varchar](50) NULL,
	[REVIEWED_RECEIVABLE_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_ID2] [numeric](10, 0) NULL,
	[NORECOVERY_REASON_CODE] [varchar](15) NULL,
	[NORECOVERY_REASON_DESC] [varchar](110) NULL,
	[INVOICE_CENTER_NBR_DESC] [varchar](50) NULL,
 CONSTRAINT [DW_RECEIVABLES_KEY] PRIMARY KEY CLUSTERED 
(
	[RECEIVABLE_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_ROLES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_ROLES](
	[ROLE_CODE] [varchar](7) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[ROLE_DESC] [varchar](50) NULL,
	[EXTERNAL_ROLE_CODE] [varchar](7) NULL,
	[EXTERNAL_ROLE_DESC] [varchar](50) NULL,
	[ORFI_ENFORCED_IND] [numeric](1, 0) NULL,
	[ATTRIBUTE_PRESENCE_IND] [numeric](1, 0) NULL,
	[ENTRANCE_ACCOUNTANCY_POS_IND] [numeric](1, 0) NULL,
	[EXIT_ACCOUNTANCY_POS_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_ROLES_KEY] PRIMARY KEY CLUSTERED 
(
	[ROLE_CODE] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_SYNDICATION_ACTORS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_SYNDICATION_ACTORS](
	[SYNDICATION_ID] [numeric](10, 0) NOT NULL,
	[ACTOR_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[LEAD_PARTICIPANT_IND] [numeric](1, 0) NULL,
	[SYNDICATION_SHARE_AMT] [numeric](15, 2) NULL,
	[SYNDICATION_SHARE_PCT] [numeric](11, 8) NULL,
	[PART_OPERATIONAL_VISIBLTY_IND] [numeric](1, 0) NULL,
	[PREFINANCING_RULE_CODE] [varchar](7) NULL,
	[PREFINANCING_RULE_DESC] [varchar](110) NULL,
	[TAX_MANAGED_BY_LEADER_IND] [numeric](1, 0) NULL,
	[FUNDS_CALL_POSSIBILITY_IND] [numeric](1, 0) NULL,
	[PART_CONSTRUCTION_VISIBLTY_IND] [numeric](1, 0) NULL,
	[FINAL_MARGIN_PCT] [numeric](11, 8) NULL,
	[AGREEMENT_START_DT] [date] NULL,
	[AGREEMENT_END_DT] [date] NULL,
	[AGREEMENT_SIGNATURE_DT] [date] NULL,
	[CONVENTION_AGREEMENT_TYPE_CODE] [varchar](7) NULL,
	[CONVENTION_AGREEMENT_TYPE_DESC] [varchar](110) NULL,
	[INTERVENTION_LEVEL_CODE] [varchar](7) NULL,
	[INTERVENTION_LEVEL_DESC] [varchar](110) NULL,
	[CONVENTION_SHARE_AMT] [numeric](15, 2) NULL,
	[SHARE_AGREEMENT_BASIS_AMT] [numeric](15, 2) NULL,
	[GUARANTEE_BASIS_CODE] [varchar](7) NULL,
	[GUARANTEE_BASIS_DESC] [varchar](110) NULL,
	[RISK_COVERAGE_START_CODE] [varchar](7) NULL,
	[RISK_COVERAGE_START_DESC] [varchar](110) NULL,
	[FINAL_LOSS_DEF_FUND_CALL_IND] [numeric](1, 0) NULL,
	[GUARANTEE_TO_PLAY_CODE] [varchar](7) NULL,
	[GUARANTEE_TO_PLAY_DESC] [varchar](110) NULL,
	[MIN_PERIODS_FOR_GUAR_CALL_NBR] [numeric](2, 0) NULL,
	[GUARANTEE_CALL_PERIOD_CODE] [varchar](7) NULL,
	[GUARANTEE_CALL_PERIOD_DESC] [varchar](110) NULL,
	[RISK_CAPPING_CODE] [varchar](7) NULL,
	[RISK_CAPPING_DESC] [varchar](110) NULL,
	[DEFINITE_UNPAID_PERIODS_NBR] [numeric](2, 0) NULL,
	[BAD_DEBT_PERIOD_CODE] [varchar](7) NULL,
	[BAD_DEBT_PERIOD_DESC] [varchar](110) NULL,
	[UNPAID_INCLUDES_TAX_IND] [numeric](1, 0) NULL,
	[SUBSYNDICATION_SYNDICATION_ID] [numeric](10, 0) NULL,
	[EXCESS_COLLECTION_CODE] [varchar](15) NULL,
	[EXCESS_COLLECTION_DESC] [varchar](110) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[DEBT_STACK_ORDER_NBR] [numeric](10, 0) NULL,
	[MAXIMUM_COMMITMENT_AMT] [numeric](15, 2) NULL,
	[UNPAID_PRINCIPAL_BALANCE_AMT] [numeric](15, 2) NULL,
	[ANNUAL_DEBT_SERVICE_AMT] [numeric](15, 2) NULL,
	[ANNUAL_PRINCIPAL_AMT] [numeric](15, 2) NULL,
	[ANNUAL_INTEREST_AMT] [numeric](15, 2) NULL,
	[LOAN_TO_VALUE_PCT] [numeric](11, 8) NULL,
	[DEBT_SERVICE_COVERAGE_PCT] [numeric](11, 8) NULL,
	[STATUS_CODE] [varchar](15) NULL,
	[STATUS_DESC] [varchar](110) NULL,
	[ROLE_CODE] [varchar](7) NULL,
	[ROLE_DESC] [varchar](50) NULL,
	[SHIFT_NUMBER_DAYS_NBR] [numeric](3, 0) NULL,
 CONSTRAINT [DW_SYNDICATION_ACTORS_KEY] PRIMARY KEY CLUSTERED 
(
	[SYNDICATION_ID] ASC,
	[ACTOR_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_SYNDICATIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_SYNDICATIONS](
	[SYNDICATION_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[SYNDICATION_NAME] [varchar](50) NOT NULL,
	[TOTAL_SYNDICATION_BASE_AMT] [numeric](15, 2) NOT NULL,
	[SYNDICATION_TYPE_CODE] [varchar](7) NOT NULL,
	[SYNDICATION_TYPE_DESC] [varchar](110) NULL,
	[TRANCHE_ID] [numeric](10, 0) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[START_DT] [date] NULL,
	[END_DT] [date] NULL,
	[COLLATERAL_ID] [numeric](10, 0) NULL,
 CONSTRAINT [DW_SYNDICATIONS_KEY] PRIMARY KEY CLUSTERED 
(
	[SYNDICATION_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_TASK_STATUS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_TASK_STATUS](
	[ADMINISTRATIVE_TASK_ID] [numeric](10, 0) NOT NULL,
	[ORDER_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[STATUS_CODE] [varchar](15) NOT NULL,
	[STATUS_DESC] [varchar](110) NULL,
	[START_DT] [date] NOT NULL,
	[END_DT] [date] NULL,
	[UPDATE_DT] [date] NULL,
	[DEPARTMENT_CODE] [varchar](7) NULL,
	[DEPARTMENT_DESC] [varchar](110) NULL,
	[BUSINESS_CODE] [varchar](7) NULL,
	[BUSINESS_DESC] [varchar](250) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[SENDER_CODE] [varchar](30) NULL,
	[SENDER_DESC] [varchar](50) NULL,
	[HOLDER_CODE] [varchar](30) NULL,
	[HOLDER_DESC] [varchar](50) NULL,
	[STATUS_MEMO_TXT] [varchar](2000) NULL,
	[NOTIFY_VIA_MAIL_IND] [numeric](1, 0) NULL,
	[MAIL_SENT_DT] [date] NULL,
	[STEP_CODE] [varchar](7) NULL,
	[STEP_DESC] [varchar](100) NULL,
	[STATUS_WEIGHT_NBR] [numeric](10, 0) NULL,
	[PERMITTED_USER_CODES] [varchar](2000) NULL,
 CONSTRAINT [DW_TASK_STATUS_KEY] PRIMARY KEY CLUSTERED 
(
	[ADMINISTRATIVE_TASK_ID] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_TASKS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_TASKS](
	[TASK_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[FORMALITY_CODE] [varchar](7) NOT NULL,
	[FORMALITY_DESC] [varchar](250) NULL,
	[DESTINATION_CODE] [varchar](15) NOT NULL,
	[DESTINATION_DESC] [varchar](110) NULL,
	[BUSINESS_TYPE_CODE] [varchar](7) NOT NULL,
	[BUSINESS_TYPE_DESC] [varchar](50) NULL,
	[MANAGEMENT_UNIT_CODE] [varchar](7) NOT NULL,
	[MANAGEMENT_UNIT_DESC] [varchar](110) NULL,
	[ISSUED_DOCUMENT_ID] [numeric](10, 0) NULL,
	[RECALL_TASK_ID] [numeric](10, 0) NULL,
	[POSTING_DELAY_NBR] [numeric](3, 0) NULL,
	[DOCUMENT_ISSUED_IND] [numeric](1, 0) NULL,
	[ANSWER_EXPECTED_IND] [numeric](1, 0) NULL,
	[RESPONSE_DELAY_NBR] [numeric](3, 0) NULL,
	[REMINDER_IND] [numeric](1, 0) NULL,
	[MANDATORY_IND] [numeric](1, 0) NULL,
	[TRIGGER_DATE_TYPE_CODE] [varchar](15) NULL,
	[TRIGGER_DATE_TYPE_DESC] [varchar](110) NULL,
	[TRIGGER_METHOD_CODE] [varchar](7) NULL,
	[TRIGGER_METHOD_DESC] [varchar](110) NULL,
	[RECURRING_IND] [numeric](1, 0) NULL,
	[OCCURRENCE_PERIOD_UNIT_CODE] [varchar](7) NULL,
	[OCCURRENCE_PERIOD_UNIT_DESC] [varchar](110) NULL,
	[RECURRENCE_MULTIPLE_NBR] [numeric](3, 0) NULL,
	[DAY_OF_WEEK_OR_MONTH_NBR] [numeric](3, 0) NULL,
	[MONTH_IN_YEAR_NBR] [numeric](2, 0) NULL,
	[NXT_TASK_REACTIVATE_DELAY_NBR] [numeric](3, 0) NULL,
	[RESPONSE_DELAY_HOURS_NBR] [numeric](4, 0) NULL,
	[OCCURRENCES_NBR] [numeric](4, 0) NULL,
	[NEXT_DAY_TYPE_CODE] [varchar](7) NULL,
	[NEXT_DAY_TYPE_DESC] [varchar](110) NULL,
	[RECURRENCE_TYPE_CODE] [varchar](7) NULL,
	[RECURRENCE_TYPE_DESC] [varchar](110) NULL,
	[PRIORITY_CODE] [varchar](15) NULL,
	[PRIORITY_DESC] [varchar](110) NULL,
	[TASK_TYPE_CODE] [varchar](15) NULL,
	[TASK_TYPE_DESC] [varchar](110) NULL,
	[POSTING_DELAY_TIME_UNIT_CODE] [varchar](7) NULL,
	[POSTING_DELAY_TIME_UNIT_DESC] [varchar](110) NULL,
	[NXT_TSK_RE_DEL_TIME_UNIT_CODE] [varchar](7) NULL,
	[NXT_TSK_RE_DEL_TIME_UNIT_DESC] [varchar](110) NULL,
	[RESPONSE_DELAY_TIME_UNIT_CODE] [varchar](7) NULL,
	[RESPONSE_DELAY_TIME_UNIT_DESC] [varchar](110) NULL,
	[RESP_DELAY_HRS_TIME_UNIT_CODE] [varchar](7) NULL,
	[RESP_DELAY_HRS_TIME_UNIT_DESC] [varchar](110) NULL,
	[MESSAGE_TYPE_CODE] [varchar](7) NULL,
	[MESSAGE_TYPE_DESC] [varchar](110) NULL,
	[ANALYSIS_MATRIX_ID] [numeric](10, 0) NULL,
	[MESSAGE_TELECOM_TYPE_CODE] [varchar](7) NULL,
	[MESSAGE_TELECOM_TYPE_DESC] [varchar](250) NULL,
	[PROCEDURE_NAME_DESC] [varchar](200) NULL,
	[TASK_GROUP_CODE] [varchar](15) NULL,
	[TASK_GROUP_DESC] [varchar](110) NULL,
	[CALENDAR_ID] [numeric](10, 0) NULL,
	[CALENDAR_DESC] [varchar](50) NULL,
	[GAP_TYPE_CODE] [varchar](15) NULL,
	[GAP_TYPE_DESC] [varchar](110) NULL,
	[TASK_GROUP_ID] [numeric](10, 0) NULL,
	[CLOSING_TYPE_CODE] [varchar](15) NULL,
	[CLOSING_TYPE_DESC] [varchar](110) NULL,
	[SOURCE_STEP_CODE] [varchar](7) NULL,
	[SOURCE_STEP_DESC] [varchar](110) NULL,
	[TARGET_STEP_CODE] [varchar](7) NULL,
	[TARGET_STEP_DESC] [varchar](110) NULL,
	[REMINDER_TASK_IND] [numeric](1, 0) NULL,
	[REMINDER_METHOD_CODE] [varchar](15) NULL,
	[REMINDER_METHOD_DESC] [varchar](110) NULL,
	[PRE_REMINDER_UNIT_CODE] [varchar](7) NULL,
	[PRE_REMINDER_UNIT_DESC] [varchar](7) NULL,
	[PRE_REMIND_RECUR_MULT_NBR] [numeric](3, 0) NULL,
	[POST_REMINDER_UNIT_CODE] [varchar](7) NULL,
	[POST_REMIND_RECUR_MULT_NBR] [numeric](3, 0) NULL,
	[FORPROCRUN] [varchar](200) NULL,
	[FORDTFREQUENCYTIME] [date] NULL,
	[TASK_WEIGHT_NBR] [numeric](5, 0) NULL,
	[RULE_MATRIX_ID] [numeric](10, 0) NULL,
	[SLA_ID] [numeric](10, 0) NULL,
	[ALERT_MESSAGE_DESC] [varchar](250) NULL,
	[TARGET_TYPE_CODE] [varchar](15) NULL,
	[TARGET_TYPE_DESC] [varchar](110) NULL,
 CONSTRAINT [DW_TASKS_KEY] PRIMARY KEY CLUSTERED 
(
	[TASK_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_TEST]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_TEST](
	[Run_ID] [numeric](10, 0) NOT NULL,
	[UnderlyingFacilityID] [varchar](15) NOT NULL,
	[LoanID] [varchar](15) NOT NULL,
	[FeeType] [varchar](64) NULL,
	[Fee_Assessed_Date] [date] NULL,
	[FeeAmount] [numeric](15, 2) NULL,
	[FeeWaivedAmount] [numeric](16, 2) NULL,
	[FeeDueAmount] [numeric](17, 2) NULL,
	[RequestedBy] [varchar](50) NULL,
	[ApprovedBy] [varchar](50) NULL,
	[Fee_waived_reason] [varchar](500) NULL,
	[FeeApprovalDate] [date] NULL,
	[FeeWaivedDate] [date] NULL,
	[Associate_Vice_President] [varchar](100) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_TRANSACTION_LINE_ITEMS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_TRANSACTION_LINE_ITEMS](
	[TRANSACTION_ID] [numeric](10, 0) NOT NULL,
	[TRANSACTION_LINE_ITEM_NBR] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[PAYABLE_ID] [numeric](10, 0) NULL,
	[RECEIVABLE_ID] [numeric](10, 0) NULL,
	[PAID_AMT] [numeric](15, 2) NOT NULL,
	[PROCESS_ALLOCATION_ID] [numeric](10, 0) NOT NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[CONVERTED_ACCOUNTING_AMT] [numeric](15, 2) NULL,
	[ACCTNG_CONVERSION_RATE_PCT] [numeric](11, 8) NULL,
	[PAYABLE_ORDER_NBR] [numeric](10, 0) NULL,
	[EXCHANGE_RATE_DIFF_AMT] [numeric](15, 2) NULL,
	[DEBIT_CREDIT_DESC] [varchar](1) NULL,
	[RECEIVABLE_ORDER_NBR] [numeric](10, 0) NULL,
	[RECONCILIATION_REFERENCE_DESC] [varchar](15) NULL,
	[INVESTMENT_ID] [numeric](10, 0) NULL,
	[CONTRACT_ID] [numeric](10, 0) NULL,
	[REAL_ESTATE_ID] [numeric](10, 0) NULL,
	[FISCAL_REGIME_CODE] [varchar](7) NULL,
	[FISCAL_REGIME_DESC] [varchar](110) NULL,
	[BATCH_RUN_ID] [numeric](10, 0) NULL,
	[PAYMENT_ALLOCATION_TYPE_CODE] [varchar](15) NULL,
	[PAYMENT_ALLOCATION_TYPE_DESC] [varchar](110) NULL,
	[DRAW_PAYABLE_ID] [numeric](10, 0) NULL,
	[PARTIAL_REIMBURS_ELEMENT_NBR] [numeric](10, 0) NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NULL,
	[TRANSFER_TRANSACTION_ID] [numeric](10, 0) NULL,
	[REJECTION_TRANSACTION_ID] [numeric](10, 0) NULL,
	[CUSTOMER_ACTOR_ID] [numeric](10, 0) NULL,
	[TRANSACTION_TYPE_CODE] [varchar](7) NULL,
	[TRANSACTION_TYPE_DESC] [varchar](110) NULL,
	[CURRENCY_EXCHANGE_RATE_PCT] [numeric](11, 8) NULL,
	[CONTRACT_CURRENCY_AMT] [numeric](15, 2) NULL,
	[CONTRACT_CURRENCY_CODE] [varchar](3) NULL,
	[CONTRACT_CURRENCY_DESC] [varchar](25) NULL,
	[CONSOLIDATED_CURRENCY_CODE] [varchar](3) NULL,
	[CONSOLIDATED_CURRENCY_DESC] [varchar](25) NULL,
	[CONS_CURRENCY_INC_TAX_AMT] [numeric](15, 2) NULL,
	[CONS_EXCHANGE_RATE_PCT] [numeric](11, 8) NULL,
	[EXCHANGE_GAP_AMT] [numeric](15, 2) NULL,
	[REASON_CODE] [varchar](15) NULL,
	[REASON_DESC] [varchar](110) NULL,
	[CONTRACT_BUSINESS_TYPE_CODE] [varchar](7) NULL,
	[CONTRACT_BUSINESS_TYPE_DESC] [varchar](50) NULL,
	[INTEREST_IND] [numeric](1, 0) NULL,
	[PRINCIPAL_IND] [numeric](1, 0) NULL,
	[TAX_ESCROW_IND] [numeric](1, 0) NULL,
	[INSURANCE_ESCROW_IND] [numeric](1, 0) NULL,
	[RESERVE_ESCROW_IND] [numeric](1, 0) NULL,
	[SUSPENSE_IND] [numeric](1, 0) NULL,
	[BORROWER_ADVANCE_IND] [numeric](1, 0) NULL,
	[TAX_ESCROW_ADVANCE_IND] [numeric](1, 0) NULL,
	[INSURANCE_ESCROW_ADVANCE_IND] [numeric](1, 0) NULL,
	[OTHER_ADVANCE_IND] [numeric](1, 0) NULL,
	[NON_RECOVERABLE_ADVANCE_IND] [numeric](1, 0) NULL,
	[CAPITALIZED_INTEREST_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_TRANS_LINE_ITEMS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[TRANSACTION_ID] ASC,
	[TRANSACTION_LINE_ITEM_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC,
	[PROCESS_ALLOCATION_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_TRANSACTIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_TRANSACTIONS](
	[TRANSACTION_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[REJECTION_ID] [numeric](10, 0) NULL,
	[COMPANY_ACTOR_ID] [numeric](10, 0) NULL,
	[CREATED_BY_CODE] [varchar](30) NULL,
	[CREATED_BY_DESC] [varchar](50) NULL,
	[CURRENCY_CODE] [varchar](3) NULL,
	[CURRENCY_DESC] [varchar](25) NULL,
	[MANDATE_ID] [numeric](10, 0) NULL,
	[REFERENCE_DESC] [varchar](15) NULL,
	[PAYMENT_DT] [date] NULL,
	[VALUE_DT] [date] NULL,
	[ENTRY_DT] [date] NULL,
	[PAYMENT_TYPE_CODE] [varchar](7) NULL,
	[PAYMENT_TYPE_DESC] [varchar](110) NULL,
	[VOUCHER_ID] [numeric](10, 0) NULL,
	[ACTOR_ID] [numeric](10, 0) NULL,
	[BANK_ACCOUNT_ID] [numeric](10, 0) NULL,
	[ACTOR_ADDRESS_ORDER_NBR] [numeric](10, 0) NULL,
	[BANK_PAYMENT_ID] [numeric](10, 0) NULL,
	[PAYMENT_METHOD_CODE] [varchar](7) NULL,
	[PAYMENT_METHOD_DESC] [varchar](50) NULL,
	[REJECTION_DT] [date] NULL,
	[APPROVAL_DT] [date] NULL,
	[TRANSACTION_AMT] [numeric](15, 2) NULL,
	[COMMENT_DESC] [varchar](500) NULL,
	[REJECTION_COST_TAX_AMT] [numeric](15, 2) NULL,
	[REJECTION_COST_PRETAX_AMT] [numeric](15, 2) NULL,
	[BANK_BRANCH_DESC] [varchar](50) NULL,
	[CHECK_NUMBER_DESC] [varchar](15) NULL,
	[VALID_IND] [numeric](1, 0) NULL,
	[BATCH_PROCESS_ID] [numeric](10, 0) NULL,
	[EVENT_ID] [numeric](10, 0) NULL,
	[REJECTION_PROCESS_ID] [numeric](10, 0) NULL,
	[BATCH_RUN_ID] [numeric](10, 0) NULL,
	[FIRST_CHECK_NBR_PRINT_DESC] [varchar](15) NULL,
	[BDOC_PRINT_IN_PROCESS_IND] [numeric](1, 0) NULL,
	[REGDTEDLCHEXTERNE_DT] [date] NULL,
	[RECONCILIATION_DT] [date] NULL,
	[RECONCILIATION_REJECT_DT] [date] NULL,
	[RECONCILIATION_BATCH_ID] [numeric](10, 0) NULL,
	[OUTPUT_FILE_GEN_DT] [date] NULL,
	[REJECTS_FILE_GEN_DT] [date] NULL,
	[ASYNC_MODE_STATUS_CODE] [varchar](7) NULL,
	[ASYNC_MODE_STATUS_DESC] [varchar](110) NULL,
	[BANK_ACCOUNT_SEPA_ID] [numeric](10, 0) NULL,
	[MANDATE_ORDER_NBR] [numeric](10, 0) NULL,
	[SEPA_CONTRACT_ID] [numeric](10, 0) NULL,
	[CARD_ID] [numeric](10, 0) NULL,
	[REQUESTED_AMT] [numeric](15, 2) NULL,
	[PTP_TYPE_CODE] [varchar](15) NULL,
	[PTP_TYPE_DESC] [varchar](250) NULL,
	[AUN_ORDER_NBR] [numeric](10, 0) NULL,
	[TRANSFERRED_IND] [numeric](1, 0) NULL,
	[EXCLUDE_SUSPENSE_IND] [numeric](1, 0) NULL,
 CONSTRAINT [DW_TRANSACTIONS_KEY] PRIMARY KEY NONCLUSTERED 
(
	[TRANSACTION_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_USERS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_USERS](
	[USER_CODE] [varchar](30) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[BUSINESS_UNIT_CODE] [varchar](7) NOT NULL,
	[GROUP_CODE] [varchar](7) NOT NULL,
	[GROUP_DESC] [varchar](50) NOT NULL,
	[USER_NAME] [varchar](100) NOT NULL,
	[USER_FIRST_NAME] [varchar](100) NULL,
	[ACTIVE_IND] [numeric](1, 0) NULL,
	[USER_PHONE_NBR] [varchar](50) NULL,
	[USER_UPD_DT] [date] NULL,
	[USER_MADE_CHG] [varchar](50) NULL,
	[PWD_CHG_DT] [date] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[DW_VARIABLE_RATE_FORMULA]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[DW_VARIABLE_RATE_FORMULA](
	[VAR_RATE_FORMULA_ID] [numeric](10, 0) NOT NULL,
	[DIM_DATE_KEY] [numeric](8, 0) NOT NULL,
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[MANAGEMENT_UNIT_CODE] [varchar](7) NOT NULL,
	[FORMULA_CODE] [varchar](7) NOT NULL,
	[FORMULA_DESC] [varchar](255) NULL,
	[FORMULA_TYPE_START_CODE] [varchar](7) NULL,
	[FORMULA_TYPE_START_DESC] [varchar](255) NULL,
	[FORMULA_TYPE_END_CODE] [varchar](7) NULL,
	[FORMULA_TYPE_END_DESC] [varchar](255) NULL,
	[FORMULAT_MARGIN] [numeric](10, 2) NULL,
	[FORMULA_TYPE_MARGIN_CODE] [varchar](7) NULL,
	[FORMULA_TYPE_MARGIN_DESC] [varchar](255) NULL,
	[FORMULA_BASIS_COUNT_CODE] [varchar](7) NULL,
	[FORMULA_BASIS_COUNT_DESC] [varchar](255) NULL,
	[FORMULA_SCALE] [numeric](5, 0) NULL,
	[FORMULA_ROUNDING_CODE] [varchar](7) NULL,
	[FORMULA_ROUNDING_DESC] [varchar](255) NULL,
	[FORMULA_METHOD] [varchar](7) NULL,
	[FORMULA_VALID_IND] [numeric](1, 0) NULL,
	[FORMULA_CORRECTION_NUM_CODE] [varchar](7) NULL,
	[FORMULA_CORRECTION_NUM_DESC] [varchar](255) NULL,
	[FORMULA_CORRECTION_DEN_CODE] [varchar](7) NULL,
	[FORMULA_CORRECTION_DEN_DESC] [varchar](255) NULL,
	[FORMULA_FILTER] [varchar](7) NULL,
	[FORMULA_AVERAGE_TYPE] [varchar](7) NOT NULL,
	[FORMULA_SECOND_ROUNDING] [varchar](7) NULL,
	[FORMULA_SECOND_SCALE] [numeric](5, 0) NULL,
	[FORMULA_NATURE_CODE] [varchar](15) NULL,
	[FORMULA_NATURE_DESC] [varchar](255) NULL,
	[FORMULA_RESULT_TYPE] [varchar](15) NULL,
	[FORMULA_MATRIX] [varchar](2000) NULL,
	[DEPARTMENT_CODE] [varchar](7) NULL,
	[FORMULA_DEFAULT_VALUE] [varchar](15) NULL,
	[FORMULA_DESCRIPTION] [varchar](250) NULL,
	[FORMULA_CATEGORY] [varchar](15) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [dbo].[ETL_CONTROL]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ETL_CONTROL](
	[RUN_ID] [numeric](10, 0) NOT NULL,
	[RUN_START_TIME] [date] NULL,
	[RUN_END_TIME] [date] NULL,
	[JOB_NAME] [varchar](100) NULL,
	[JOB_STATUS] [varchar](100) NULL,
	[FROM_DATE] [date] NULL,
	[TO_DATE] [date] NULL,
	[RUN_TYPE] [varchar](10) NULL,
	[JOB_COMMENT] [varchar](2000) NULL,
 CONSTRAINT [ETL_CONTROL_KEY] PRIMARY KEY NONCLUSTERED 
(
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [etl].[CNTRL]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [etl].[CNTRL](
	[SUBJECT_AREA] [varchar](100) NULL,
	[OBJECT_NAME] [varchar](100) NULL,
	[OBJECT_TYPE] [varchar](100) NULL,
	[DATA_AS_OF_DATE] [date] NULL,
	[RUN_ID] [int] NULL,
	[DS_INSERT_DATE] [date] NULL,
	[DS_INSERT_TIME] [datetime2](7) NULL,
	[DW_STATUS_IND] [char](1) NULL,
	[DW_EXECUTION_ORDER] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [etl].[CNTRL_ARCHIVE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [etl].[CNTRL_ARCHIVE](
	[SUBJECT_AREA] [varchar](100) NULL,
	[OBJECT_NAME] [varchar](100) NULL,
	[OBJECT_TYPE] [varchar](100) NULL,
	[DATA_AS_OF_DATE] [date] NULL,
	[RUN_ID] [int] NULL,
	[DS_INSERT_DATE] [date] NULL,
	[DS_INSERT_TIME] [datetime2](7) NULL,
	[DW_STATUS_IND] [char](1) NULL,
	[DW_EXECUTION_ORDER] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [etl].[FACILITY_EPB]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [etl].[FACILITY_EPB](
	[RUN_ID] [int] NULL,
	[LENDING_ORGANIZATION] [varchar](200) NULL,
	[MEMBER_NAME] [varchar](200) NULL,
	[MEMBER_ID] [varchar](200) NULL,
	[FACILITY_ID] [varchar](200) NULL,
	[LOAN_ID] [varchar](200) NULL,
	[GL_NAME] [varchar](200) NULL,
	[GL_ACCOUNT] [varchar](200) NULL,
	[EPB] [numeric](15, 2) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [etl].[LOGGING]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [etl].[LOGGING](
	[LOGGING_ID] [int] IDENTITY(1,1) NOT NULL,
	[SUBJECT_AREA] [varchar](100) NULL,
	[DATA_AS_OF_DATE] [date] NULL,
	[RUN_ID] [int] NULL,
	[PROCEDURE_NAME] [varchar](150) NULL,
	[DW_OBJECT_NAME] [varchar](150) NULL,
	[STG_OBJECT_NAME] [varchar](150) NULL,
	[SOURCE_TYPE] [varchar](50) NULL,
	[RUN_STATUS] [varchar](100) NULL,
	[ERROR_MSG] [varchar](8000) NULL,
	[START_TIME] [smalldatetime] NULL,
	[END_TIME] [smalldatetime] NULL,
	[CNT_DW] [int] NULL,
	[CNT_STG] [int] NULL,
	[CNT_DIF] [int] NULL,
	[CNT_DUP] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [etl].[LOGGING_ARCHIVE]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [etl].[LOGGING_ARCHIVE](
	[VALID_BATCH_ID] [varchar](150) NULL,
	[LOGGING_ID] [int] NULL,
	[SUBJECT_AREA] [varchar](100) NULL,
	[DATA_AS_OF_DATE] [date] NULL,
	[RUN_ID] [int] NULL,
	[PROCEDURE_NAME] [varchar](150) NULL,
	[DW_OBJECT_NAME] [varchar](150) NULL,
	[STG_OBJECT_NAME] [varchar](150) NULL,
	[SOURCE_TYPE] [varchar](50) NULL,
	[RUN_STATUS] [varchar](100) NULL,
	[ERROR_MSG] [varchar](8000) NULL,
	[START_TIME] [smalldatetime] NULL,
	[END_TIME] [smalldatetime] NULL,
	[CNT_DW] [int] NULL,
	[CNT_STG] [int] NULL,
	[CNT_DIF] [int] NULL,
	[CNT_DUP] [int] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [etl].[TASK_MSTR]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [etl].[TASK_MSTR](
	[SUBJECT_AREA] [varchar](100) NULL,
	[OBJECT_NAME] [varchar](100) NULL,
	[DW_EXECUTION_ORDER] [int] NULL,
	[IS_ENABLED] [bit] NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [kpods].[BatchControl]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [kpods].[BatchControl](
	[BatchID] [int] IDENTITY(1,1) NOT NULL,
	[BatchType] [int] NOT NULL,
	[KPLastRunId] [int] NOT NULL,
	[BatchStatus] [varchar](50) NOT NULL,
	[BatchStartTime] [datetime] NULL,
	[BatchEndTime] [datetime] NULL,
	[Note] [varchar](2000) NULL,
	[InsertDate] [datetime] NOT NULL DEFAULT (getdate()),
	[InsertUser] [varchar](128) NOT NULL DEFAULT (user_name()),
	[LastUpdateDate] [datetime] NULL,
	[LastUpdateUser] [varchar](128) NULL,
 CONSTRAINT [PK_BatchControl] PRIMARY KEY CLUSTERED 
(
	[BatchID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [kpods].[BatchRunDomainLog]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [kpods].[BatchRunDomainLog](
	[SSISExecGUID] [varchar](50) NULL,
	[LoadStartTime] [datetime] NULL,
	[LoadEndTime] [datetime] NULL,
	[LoadStatus] [varchar](50) NULL,
	[InsertDate] [datetime] NOT NULL DEFAULT (getdate()),
	[InsertUser] [varchar](128) NOT NULL DEFAULT (user_name()),
	[LastUpdateDate] [datetime] NULL,
	[LastUpdateUser] [varchar](128) NULL,
	[BatchID] [int] NOT NULL,
	[KPRunId] [int] NOT NULL,
	[DomainName] [varchar](100) NOT NULL,
 CONSTRAINT [PK_BatchRunDomainLog] PRIMARY KEY CLUSTERED 
(
	[BatchID] ASC,
	[KPRunId] ASC,
	[DomainName] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [kpods].[BatchRunInfo]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [kpods].[BatchRunInfo](
	[BatchID] [int] NOT NULL,
	[KPRunId] [int] NOT NULL,
	[RunStartTime] [datetime] NULL,
	[RunEndTime] [datetime] NULL,
	[RunStatus] [varchar](50) NULL,
	[KPRunType] [varchar](128) NULL,
	[KPJobName] [varchar](128) NULL,
	[KPJobStatus] [char](128) NULL,
	[KPFromDate] [datetime] NULL,
	[KPToDate] [datetime] NULL,
	[InsertDate] [datetime] NOT NULL DEFAULT (getdate()),
	[InsertUser] [varchar](128) NOT NULL DEFAULT (user_name()),
	[LastUpdateDate] [datetime] NULL,
	[LastUpdateUser] [varchar](128) NULL,
 CONSTRAINT [PK_BatchRunInfo] PRIMARY KEY CLUSTERED 
(
	[BatchID] ASC,
	[KPRunId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [kpods].[BatchType]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [kpods].[BatchType](
	[BatchType] [int] NOT NULL,
	[BatchTypeDesc] [varchar](250) NOT NULL,
	[InsertDate] [datetime] NOT NULL DEFAULT (getdate()),
	[InsertUser] [varchar](128) NOT NULL DEFAULT (user_name()),
	[LastUpdateDate] [datetime] NULL,
	[LastUpdateUser] [varchar](128) NULL,
 CONSTRAINT [PK_BatchType] PRIMARY KEY CLUSTERED 
(
	[BatchType] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  View [rpt].[VW_CHARACTERISTIC_CODE_FLAT]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [rpt].[VW_CHARACTERISTIC_CODE_FLAT]
AS
SELECT 
         CONTRACT_ID,
         DIM_DATE_KEY,
         RUN_ID,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'ADVPURP' THEN STRING_VALUE_DESC END) AS CONTLoanadvancepurp,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'ADVRCOM' THEN STRING_VALUE_DESC END) AS CONTAdvanceRelatedCMT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'AGREEDA' THEN DATE_VALUE_DT END) AS CONTDrawPrdendDT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'APPRDATE' THEN DATE_VALUE_DT END) AS CONTFinalApprDT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'ARRDATE' THEN DATE_VALUE_DT END) AS CONTAppReqRcvdDT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'CMBCCHVAL153' THEN STRING_VALUE_DESC END) AS CONTTypSyndCrdt,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'DRAWCOM' THEN STRING_VALUE_DESC END) AS CONTDrawPrdCMT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'FACCHAR' THEN STRING_VALUE_DESC END) AS CONTSecuredIND,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'FACPGR' THEN STRING_VALUE_DESC END) AS CONTFacProgram,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'INTMONC' THEN STRING_VALUE_DESC END) AS CONTIntrnlMntrngCMT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'INTMONI' THEN BOOLEAN_VALUE_IND END) AS CONTIntrnlMntrngIND,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'INTRCOM' THEN STRING_VALUE_DESC END) AS CONTInterestRateCMT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'LADVINT' THEN STRING_VALUE_DESC END) AS CONTLoanAdvanceIntent,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'LAPCOMENT' THEN STRING_VALUE_DESC END) AS CONTLoanAdvancePurposeCMT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'LOCPERP' THEN BOOLEAN_VALUE_IND END) AS CONTLOCPerpInd,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'MANPAYD' THEN BOOLEAN_VALUE_IND END) AS CONTMandatoryPaydownIND,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'MATDATE' THEN DATE_VALUE_DT END) AS CONTMaturityDT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'PREPCOM' THEN STRING_VALUE_DESC END) AS CONTPrepRsnCMT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'PREREAS' THEN STRING_VALUE_DESC END) AS CONTPrepaymentreason,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'PRNREPM' THEN STRING_VALUE_DESC END) AS CONTPrinRepymntMethod,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'PRVDATE' THEN DATE_VALUE_DT END) AS CONTEffDT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'PRVDATE' THEN STRING_VALUE_DESC END) AS CONTRengtiatnRsn,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'RESCCOMM' THEN STRING_VALUE_DESC END) AS CONTRescissionCMT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'RESCTYPE' THEN STRING_VALUE_DESC END) AS CONTRescissonTYP,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'RUSLIEN' THEN STRING_VALUE_DESC END) AS CONTRUSLienAccmdtn,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'SCCAM' THEN NUMERIC_VALUE_AMT END) AS CONTSCCAMT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'SCCPP' THEN NUMERIC_VALUE_AMT END) AS CONTSCCPP,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'STORDTBL' THEN STRING_VALUE_DESC END) AS TBDCONTStopOrders,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'SUBTYPE3' THEN STRING_VALUE_DESC END) AS CONTProductSubTYP,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'TMPBABA' THEN STRING_VALUE_DESC END) AS CONTABACNT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'TMPBACC' THEN STRING_VALUE_DESC END) AS CONTAcctNBR,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'TMPCBABA' THEN STRING_VALUE_DESC END) AS CONTCorrpndngABAANBR,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'TMPCBACC' THEN STRING_VALUE_DESC END) AS CONTCorrpndngAcctCNT,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'TMPCNAME' THEN STRING_VALUE_DESC END) AS CONTCorgBenefNM,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'TMPCNUMB' THEN STRING_VALUE_DESC END) AS CONTCorrpndngRefNBR,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'TMPNAME' THEN STRING_VALUE_DESC END) AS CONTBeneficiaryNM,
         MAX(CASE WHEN CHARACTERISTIC_CODE= 'TMPNUMB' THEN STRING_VALUE_DESC END) AS CONTRefNBR
FROM DW_CONTRACT_CHARACTERISTICS
GROUP BY CONTRACT_ID,DIM_DATE_KEY,RUN_ID
GO
/****** Object:  View [rpt].[VW_DW_ELEMENT_CHARACTERISTICS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE VIEW [rpt].[VW_DW_ELEMENT_CHARACTERISTICS]
AS
SELECT CONTRACT_ID,
	RUN_ID,
	DIM_DATE_KEY,
	ELEMENT_ORDER_NBR,
	MAX(CASE CHARACTERISTIC_CODE WHEN 'PERFROM' THEN STRING_VALUE_DESC ELSE NULL END) PERFORMANCE_INDICATOR,	
	MAX(CASE CHARACTERISTIC_CODE WHEN 'LNBRTCD' THEN STRING_VALUE_DESC ELSE NULL END) BASE_RATE_CODE,	
	MAX(CASE CHARACTERISTIC_CODE WHEN 'REPEFFDT' THEN DATE_VALUE_DT ELSE NULL END) NEXT_REPRICING_DATE	
FROM DW_ELEMENT_CHARACTERISTICS
GROUP BY CONTRACT_ID
	, RUN_ID
	, DIM_DATE_KEY
	,ELEMENT_ORDER_NBR
GO
/****** Object:  View [rpt].[VW_DW_LOAN_BALANCES]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE VIEW [rpt].[VW_DW_LOAN_BALANCES]
AS
SELECT   
                 CONTRACT_ID
                ,ELEMENT_ORDER_NBR
                ,RUN_ID
                ,DIM_DATE_KEY
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'ACCRUED_INT'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_ACCRUED_INT
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'ACTUAL_OPB'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_ACTUAL_OPB
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_EARNED_CYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_EARNED_CYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_EARNED_FYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_EARNED_FYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_EARNED_LTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_EARNED_LTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_EARNED_MTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_EARNED_MTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_PAID_CYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_PAID_CYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_PAID_FYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_PAID_FYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_PAID_LTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_PAID_LTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_PAID_MTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_PAID_MTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_PAID_PCYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_PAID_PCYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'FEE_PAID_PFYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_FEE_PAID_PFYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_EARNED_CYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_EARNED_CYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_EARNED_FYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_EARNED_FYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_EARNED_LTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_EARNED_LTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_EARNED_MTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_EARNED_MTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_PAID_CYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_PAID_CYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_PAID_FYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_PAID_FYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_PAID_LTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_PAID_LTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_PAID_MTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_PAID_MTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_PAID_PCYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_PAID_PCYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_PAID_PFYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_PAID_PFYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_WAIVED_CYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_WAIVED_CYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_WAIVED_FYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_WAIVED_FYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_WAIVED_LTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_WAIVED_LTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'INT_WAIVED_MTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_INT_WAIVED_MTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'ITDCAPINT'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_ITDCAPINT
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'LOANPRINC_PAID_FYTD'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_LOANPRINC_PAID_FYTD
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'PRINCIPAL'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_PRINCIPAL
                ,MAX(CASE BALANCE_TYPE_DESC WHEN 'SCHEDULE_OPB'  THEN VALUE_DATE_AMT ELSE NULL END) AS LOAN_SCHEDULE_OPB
FROM DW_ELEMENT_BALANCES
GROUP BY 
                 CONTRACT_ID
                ,ELEMENT_ORDER_NBR
                ,RUN_ID
                ,DIM_DATE_KEY
                ;
GO
/****** Object:  View [rpt].[VW_DW_STOP_ORDER]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE VIEW [rpt].[VW_DW_STOP_ORDER]
AS
SELECT CONTRACT_ID,
	LINE_NUM,
	RUN_ID,
	DIM_Date_Key,
	MAX(CASE CVG_CD WHEN 'SOGROUP' THEN STRING_VALUE_DESC ELSE NULL END) STOP_ORDER_GROUP,
	MAX(CASE CVG_CD WHEN 'SOTYPE' THEN STRING_VALUE_DESC ELSE NULL END) STOP_ORDER_TYPE,	
	SUM(CASE CVG_CD WHEN 'SOAMOUNT' THEN NUMERIC_VALUE_AMT ELSE NULL END) STOP_ORDER_AMOUNT,	
	MAX(CASE CVG_CD WHEN 'SOSTART' THEN DATE_VALUE_DT ELSE NULL END) STOP_ORDER_START_DT,	
	MAX(CASE CVG_CD WHEN 'SOENDDT' THEN DATE_VALUE_DT ELSE NULL END) STOP_ORDER_END_DT,
	MAX(CASE CVG_CD WHEN 'SOCOMM' THEN STRING_VALUE_DESC ELSE NULL END) STOP_ORDER_COMM
FROM DW_GRID_CHARACTERISTICS
GROUP BY CONTRACT_ID
	, LINE_NUM
	, RUN_ID
	, DIM_Date_Key
GO
/****** Object:  View [rpt].[VW_MasterFacility]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE VIEW [rpt].[VW_MasterFacility]
AS
SELECT 
          MF.CONTRACT_ID,
          DEAL.DEAL_ID,
          DEAL.DEAL_VERSION_CODE,
          DEAL.PRODUCT_CODE AS Deal_PRODUCT_CODE,
         -- MF.CONTRACT_ID,
          MF.DIM_DATE_KEY,
          MF.RUN_ID,
          MF.CURRENCY_CODE,
          MF.CURRENCY_DESC,
          MF.COMPANY_ACTOR_ID,
          MF.USERNAME_CODE,
          MF.USERNAME_DESC,
          MF.BUSINESS_TYPE_CODE,
          MF.BUSINESS_TYPE_DESC,
          MF.CONTRACT_NUMBER_DESC,
          MF.CONTRACT_NAME_DESC,
          -- MANDATE_ID,
          MF.CONTRACT_AMENDMENT_NBR,
          MF.CONTRACT_STATUS_CODE,
          MF.CONTRACT_STATUS_DESC,
          MF.TERM_IN_DAYS_NBR,
          MF.TERM_IN_MONTHS_NBR,
          MF.TERM_IN_YEARS_NBR,
          MF.CONTRACT_START_DT,
          MF.CONTRACT_END_DT,
          MF.LAST_UPDATE_DT,
          MF.SIGNATURE_DT,
          --PUT_OPTION_DT,
          MF.COMMITTEE_APPROVAL_DT,
          MF.LEASE_START_DT,
          MF.CONTRACT_1ST_ENTRY_DT,
          MF.REG_PAYMENTS_START_DT,
          --DOSPREAVIS_NBR,
          MF.EARLY_PAYOFF_PENALTY_TYPE_CODE,
          MF.EARLY_PAYOFF_PENALTY_TYPE_DESC,
          MF.PENALTY_AMT,
          MF.FISCAL_REGIME_CODE,
          MF.FISCAL_REGIME_DESC,
          MF.SYNDICATION_CODE,
          MF.SYNDICATION_DESC,
          MF.INITIAL_CONTRACT_RATE_PCT,
          MF.NEGOTIATED_RATE_PCT,
          MF.EXPECTED_MARGIN_RATE_PCT,
          MF.REVISABLE_IND,
          MF.FINANCING_TYPE_CODE,
          MF.FINANCING_TYPE_DESC,
          MF.REVISED_TERM_IN_YEARS_NBR,
          MF.REVISED_TERM_IN_MONTHS_NBR,
          MF.REVISED_TERM_IN_DAYS_NBR,
          MF.SIGNED_AMT,
          MF.COMMITTEE_AMT,
          MF.CREATION_AMT,
          MF.IN_SERVICE_AMT,
          MF.PRODUCT_CODE AS MF_PRODUCT_CODE,
          MF.PRODUCT_DESC,
          MF.DEPARTMENT_CODE,
          MF.DEPARTMENT_DESC,
          MF.SCHEDULE_TYPE_CODE,
          MF.SCHEDULE_TYPE_DESC,
          MF.EXPECTED_MARGIN_AMT,
         MF.REFINANCING_CONTRACT_ID,
          MF.STRUCTURED_FINANCING_TYPE_CODE,
          MF.STRUCTURED_FINANCING_TYPE_DESC,
          MF.LUMP_SUM_ADDED_AMT,
          MF.EARLY_TERM_PENALTY_PCT,
          MF.US_GAAP_CODE,
          MF.US_GAAP_DESC,
          MF.CANCEL_PENALTY_CALC_TYPE_CODE,
          MF.CANCEL_PENALTY_CALC_TYPE_DESC,
          MF.LUMP_SUM_CANCELLATION_COMP_AMT,
          MF.EARLY_TERMINATION_RATE_PCT,
          MF.ASSET_CLASS_CODE,
          MF.ASSET_CLASS_DESC,
          MF.COUNTRY_CODE,
          MF.COUNTRY_DESC,
          -- DOSFLAGRESTRUCT_IND,
          -- DOSDTDEBRESTRUCT_DT,
          -- TRANSFERABILITY_CODE,
          -- TRANSFERABILITY_DESC,
          -- CONFIDENTIAL_IND,
          MF.EFFECTIVE_CALCULATED_RATE_PCT,
          -- IAS_FISCAL_YEAR_NBR,
          -- IAS_CONTRACT_CLASS_CODE,
          -- IAS_CONTRACT_CLASS_DESC,
          -- MICROCOVERED_IND,
          -- SPECIFIC_ASSET_NATURE_IND,
          -- RENT_AT_TERMINATION_IND,
          -- OWNERSHIP_TRANSFER_AT_TERM_IND,
          -- ASSET_LIFE_SPAN_IN_YEARS_NBR,
          -- AUTO_INVOICE_RESIDUAL_IND,
          -- RESIDUAL_LIFESPAN_MONTHS_NBR,
          -- RESIDUAL_LIFESPAN_DAYS_NBR,
          -- INITIAL_FAIR_VALUE_AMT,
          -- RELATED_CONTRACT_ID,
          -- ACTUARIAL_RATE_PCT,
          -- IAS_CLASS_UPDATE_IND,
          -- FORCED_CLASS_REASON_DESC,
          MF.BAD_DEBT_IND,
          MF.BAD_DEBT_LAST_XFER_DT,
          MF.RATE_CODE,
          MF.RATE_DESC,
          -- IAS_MARKET_CODE,
          -- IAS_MARKET_DESC,
          -- IAS_PRODUCT_CODE,
          -- IAS_PRODUCT_DESC,
          -- MARKET_RATE_VALUE_PCT,
          -- MARKET_RATE_GAP_FOR_CLASS_PCT,
          -- MARKET_RATE_GAP_FOR_IRREV_PCT,
          -- INITIAL_DISCOUNT_AMT,
          -- HEDGING_CATEGORY_CODE,
          -- HEDGING_CATEGORY_DESC,
          MF.CALENDAR_CODE,
          MF.CALENDAR_DESC,
          MF.COMMITMENT_END_DT,
          MF.CONTRACT_COMMENT_DESC,
          -- EXTERNAL_REFERENCE_DESC,
          -- COMMERCIAL_NETWORK_CODE,
          -- COMMERCIAL_NETWORK_DESC,
          -- STATE_COUNTRY_CODE,
          -- STATE_COUNTRY_DESC,
          -- STATE_CODE,
          -- STATE_DESC,
          -- STATE_TYPE_CODE,
          -- STATE_TYPE_DESC,
          MF.CONTRACT_VERSION_DESC,
          MF.PRICING_CRITERIA_ID,
          MF.PRICING_CRITERIA_ORDER_NBR,
          MF.ANNUAL_USAGE_AMT,
          -- UNIT_OF_MEASURE_CODE,
          -- UNIT_OF_MEASURE_DESC,
          -- PURCHASE_USAGE_AMT,
          -- EXTERNAL_GRADE_CODE,
          -- EXTERNAL_GRADE_DESC,
          -- EXCESS_COST_USE_AMT,
          -- SUBVENTION_TYPE_CODE,
          -- SUBVENTION_TYPE_DESC,
          MF.MASTER_FACILITY_TYPE_CODE,
          MF.MASTER_FACILITY_TYPE_DESC,
          MF.DISCOUNT_INTEREST_RATE_PCT,
          MF.CONTRACT_TYPE_CODE,
          MF.CONTRACT_TYPE_DESC,
          -- PROJECT_FINANCING_AMT,
          MF.PROJECT_FINANCING_DURATION_NBR,
          MF.PROJECT_FINANCING_CONTRACT_AMT,
          MF.CONSTRUCTION_DURATION_NBR,
          MF.GUARANTEE_AMT,
          MF.MATURITY_DT
          -- COLLATERAL_CREDIT_LIMIT_AMT,
          -- SALES_CREDIT_LIMIT_AMT,
          -- STRAT_DLR_BLOCK_CRED_LIMIT_AMT,
          -- IPD_DT
FROM DW_CONTRACTS MF
          INNER JOIN DW_DEALS_FO DEAL
             ON DEAL.DEAL_ID=MF.CONTRACT_ID
                AND DEAL.DEAL_VERSION_CODE='PROD'
                AND DEAL.PRODUCT_CODE LIKE 'AUT%'  -- Needed to identify Master Facility
                AND DEAL.RUN_ID = MF.RUN_ID
GO
/****** Object:  View [rpt].[VW_RECEIVABLES_ELEMENTS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE VIEW [rpt].[VW_RECEIVABLES_ELEMENTS]
AS
SELECT DW_ELEMENTS_CONTRACT_ID = E.CONTRACT_ID
, DW_ELEMENTS_ELEMENT_CLASS_DESC = E.ELEMENT_CLASS_DESC
, DW_ELEMENTS_ADDITIONAL_TAX_CODE = E.ADDITIONAL_TAX_CODE
, DW_ELEMENTS_ADDITIONAL_TAX_DESC = E.ADDITIONAL_TAX_DESC
, DW_ELEMENTS_ADDITIONAL_TAX_START_DT = E.ADDITIONAL_TAX_START_DT
, DW_ELEMENTS_SECURITY_DEPOSIT_BASIS_IND = E.SECURITY_DEPOSIT_BASIS_IND
, DW_ELEMENTS_AMOUNT_PERIODICITY_CODE = E.AMOUNT_PERIODICITY_CODE
, DW_ELEMENTS_AMOUNT_PERIODICITY_DESC = E.AMOUNT_PERIODICITY_DESC
, DW_ELEMENTS_PROVISION_TYPE_CODE = E.PROVISION_TYPE_CODE
, DW_ELEMENTS_PROVISION_TYPE_DESC = E.PROVISION_TYPE_DESC
, DW_ELEMENTS_GUARANTOR_CAN_CALL_IND = E.GUARANTOR_CAN_CALL_IND
, DW_ELEMENTS_CUR_ACCT_TAX_METHOD_CODE = E.CUR_ACCT_TAX_METHOD_CODE
, DW_ELEMENTS_START_DT = E.START_DT
, DW_ELEMENTS_CUR_ACCT_TAX_METHOD_DESC = E.CUR_ACCT_TAX_METHOD_DESC
, DW_ELEMENTS_LOAN_NBR = E.LOAN_NBR
, DW_ELEMENTS_ELEMENT_NOMINAL_RATE_PCT = E.ELEMENT_NOMINAL_RATE_PCT
, DW_ELEMENTS_INVOICING_SUSPENDED_IND = E.INVOICING_SUSPENDED_IND
, DW_ELEMENTS_ELEMENT_DESC = E.ELEMENT_DESC
, DW_ELEMENTS_TRANSFER_ACTOR_ORDER_NBR = E.TRANSFER_ACTOR_ORDER_NBR
, DW_ELEMENTS_TRANSFER_TAX_CODE = E.TRANSFER_TAX_CODE
, DW_ELEMENTS_TRANSFER_TAX_DESC = E.TRANSFER_TAX_DESC
, DW_ELEMENTS_RATE_APPL_PERIOD_MGMT_CODE = E.RATE_APPL_PERIOD_MGMT_CODE
, DW_ELEMENTS_RATE_APPL_PERIOD_MGMT_DESC = E.RATE_APPL_PERIOD_MGMT_DESC
, DW_ELEMENTS_CONTRACT_REVISION_NBR = E.CONTRACT_REVISION_NBR
, DW_ELEMENTS_RESTRUCTURED_ELEMENT_IND = E.RESTRUCTURED_ELEMENT_IND
, DW_ELEMENTS_RESTRUCTURED_START_DT = E.RESTRUCTURED_START_DT
, DW_ELEMENTS_SCHEDULE_ID = E.SCHEDULE_ID
, DW_ELEMENTS_EVOLUTION_ORDER_NBR = E.EVOLUTION_ORDER_NBR
, DW_ELEMENTS_AMOUNT_ORDER_NBR = E.AMOUNT_ORDER_NBR
, DW_ELEMENTS_TIME_SPAN_ORDER_NBR = E.TIME_SPAN_ORDER_NBR
, DW_ELEMENTS_LUMP_SUM_PERIOD_CODE = E.LUMP_SUM_PERIOD_CODE
, DW_ELEMENTS_LUMP_SUM_PERIOD_DESC = E.LUMP_SUM_PERIOD_DESC
, DW_ELEMENTS_RENEWAL_METHOD_CODE = E.RENEWAL_METHOD_CODE
, DW_ELEMENTS_RENEWAL_METHOD_DESC = E.RENEWAL_METHOD_DESC
, DW_ELEMENTS_PREVIOUS_ORDER_NBR = E.PREVIOUS_ORDER_NBR
, DW_ELEMENTS_RENEWAL_ELEMENT_ID = E.RENEWAL_ELEMENT_ID
, DW_ELEMENTS_LEASE_RENEWAL_PERIOD_IND = E.LEASE_RENEWAL_PERIOD_IND
, DW_ELEMENTS_POST_RENEWAL_PERIODICITY_CODE = E.POST_RENEWAL_PERIODICITY_CODE
, DW_ELEMENTS_POST_RENEWAL_PERIODICITY_DESC = E.POST_RENEWAL_PERIODICITY_DESC
, DW_ELEMENTS_POST_RENEWAL_PERIOD_MULT_NBR = E.POST_RENEWAL_PERIOD_MULT_NBR
, DW_ELEMENTS_POST_RENEWAL_ELEMENT_NBR = E.POST_RENEWAL_ELEMENT_NBR
, DW_ELEMENTS_LAST_COMPLETE_TERM_RENEWAL_IND = E.LAST_COMPLETE_TERM_RENEWAL_IND
, DW_ELEMENTS_RENEWAL_AMT = E.RENEWAL_AMT
, DW_ELEMENTS_RESIDUAL_VALUE_PCT = E.RESIDUAL_VALUE_PCT
, DW_ELEMENTS_INSURANCE_POLICY_ID = E.INSURANCE_POLICY_ID
, DW_ELEMENTS_INVOICE_ORDER_NBR = E.INVOICE_ORDER_NBR
, DW_ELEMENTS_INSURED_ACTOR_ORDER_NBR = E.INSURED_ACTOR_ORDER_NBR
, DW_ELEMENTS_TRANSFER_PCT = E.TRANSFER_PCT
, DW_ELEMENTS_FACIAL_RATE_PCT = E.FACIAL_RATE_PCT
, DW_ELEMENTS_CURRENCY_CODE = E.CURRENCY_CODE
, DW_ELEMENTS_CURRENCY_DESC = E.CURRENCY_DESC
, DW_ELEMENTS_ACCRUAL_CONTRACT_ID = E.ACCRUAL_CONTRACT_ID
, DW_ELEMENTS_ACCRUAL_ELEMENT_ORDER_NBR = E.ACCRUAL_ELEMENT_ORDER_NBR
, DW_ELEMENTS_FIX_PARITY_RATE_PCT = E.FIX_PARITY_RATE_PCT
, DW_ELEMENTS_PARITY_SEARCH_METHOD_CODE = E.PARITY_SEARCH_METHOD_CODE
, DW_ELEMENTS_PARITY_SEARCH_METHOD_DESC = E.PARITY_SEARCH_METHOD_DESC
, DW_ELEMENTS_PARENT_ORDER_NBR = E.PARENT_ORDER_NBR
, DW_ELEMENTS_FIXING_DT = E.FIXING_DT
, DW_ELEMENTS_PARITY_SEARCH_GAP_CODE = E.PARITY_SEARCH_GAP_CODE
, DW_ELEMENTS_PARITY_SEARCH_GAP_DESC = E.PARITY_SEARCH_GAP_DESC
, DW_ELEMENTS_CALENDAR_CODE = E.CALENDAR_CODE
, DW_ELEMENTS_CALENDAR_DESC = E.CALENDAR_DESC
, DW_ELEMENTS_BANK_ACCOUNT_ID = E.BANK_ACCOUNT_ID
, DW_ELEMENTS_FIX_RATE_SPREAD_PCT = E.FIX_RATE_SPREAD_PCT
, DW_ELEMENTS_ROUNDING_METHOD_ON_UPB_CODE = E.ROUNDING_METHOD_ON_UPB_CODE
, DW_ELEMENTS_ROUNDING_METHOD_ON_UPB_DESC = E.ROUNDING_METHOD_ON_UPB_DESC
, DW_ELEMENTS_SUPPLIER_SHIFT_RATE_PCT = E.SUPPLIER_SHIFT_RATE_PCT
, DW_ELEMENTS_GROUP_ORDER_NBR = E.GROUP_ORDER_NBR
, DW_ELEMENTS_MARKET_RATE_DATE_TIME_DT = E.MARKET_RATE_DATE_TIME_DT
, DW_ELEMENTS_DEPOSIT_PCT = E.DEPOSIT_PCT
, DW_ELEMENTS_OPB_ROUNDING_UNIT_NBR = E.OPB_ROUNDING_UNIT_NBR
, DW_ELEMENTS_ROUNDING_METHOD_CODE = E.ROUNDING_METHOD_CODE
, DW_ELEMENTS_ROUNDING_METHOD_DESC = E.ROUNDING_METHOD_DESC
, DW_ELEMENTS_ROUNDING_UNIT_NBR = E.ROUNDING_UNIT_NBR
, DW_ELEMENTS_MONEY_FACTOR_NBR = E.MONEY_FACTOR_NBR
, DW_ELEMENTS_LATE_PYMTS_NBR = E.LATE_PYMTS_NBR
, DW_ELEMENTS_MIN_RV_AMT = E.MIN_RV_AMT
, DW_ELEMENTS_MAX_RV_AMT = E.MAX_RV_AMT
, DW_ELEMENTS_SYNDICATION_ID = E.SYNDICATION_ID
, DW_ELEMENTS_PRICING_CRITERIA_ID = E.PRICING_CRITERIA_ID
, DW_ELEMENTS_PRICING_CRITERIA_ORDER_NBR = E.PRICING_CRITERIA_ORDER_NBR
, DW_ELEMENTS_PRICING_ELEMENT_ID = E.PRICING_ELEMENT_ID
, DW_ELEMENTS_EXTENSION_RATE_PCT = E.EXTENSION_RATE_PCT
, DW_ELEMENTS_CARD_INTEREST_RATE_GRADE_CODE = E.CARD_INTEREST_RATE_GRADE_CODE
, DW_ELEMENTS_CARD_INTEREST_RATE_GRADE_DESC = E.CARD_INTEREST_RATE_GRADE_DESC
, DW_ELEMENTS_CARD_SERVICE_RATE_GRADE_CODE = E.CARD_SERVICE_RATE_GRADE_CODE
, DW_ELEMENTS_CARD_SERVICE_RATE_GRADE_DESC = E.CARD_SERVICE_RATE_GRADE_DESC
, DW_ELEMENTS_CUSTOMER_TYPE_CODE = E.CUSTOMER_TYPE_CODE
, DW_ELEMENTS_CUSTOMER_TYPE_DESC = E.CUSTOMER_TYPE_DESC
, DW_ELEMENTS_TAX_RATE_CODE = E.TAX_RATE_CODE
, DW_ELEMENTS_CARD_BASIC_LIMIT_AMT = E.CARD_BASIC_LIMIT_AMT
, DW_ELEMENTS_CARD_SERVICE_LIMIT_AMT = E.CARD_SERVICE_LIMIT_AMT
, DW_ELEMENTS_HOLD_CARD_LIMIT_IND = E.HOLD_CARD_LIMIT_IND
, DW_ELEMENTS_LOAN_CARD_ONLY_IND = E.LOAN_CARD_ONLY_IND
, DW_ELEMENTS_PRIME_LOAN_CRD_TRANS_LIMIT_IND = E.PRIME_LOAN_CRD_TRANS_LIMIT_IND
, DW_ELEMENTS_FORCED_END_DATE_IND = E.FORCED_END_DATE_IND
, DW_ELEMENTS_TAX_RATE_DESC = E.TAX_RATE_DESC
, DW_ELEMENTS_ORDER_NBR = E.ORDER_NBR
, DW_ELEMENTS_ACTOR_ORDER_NBR = E.ACTOR_ORDER_NBR
, DW_ELEMENTS_ACTOR_ID = E.ACTOR_ID
, DW_ELEMENTS_END_DT = E.END_DT
, DW_ELEMENTS_USED_FIXED_RATE_PCT = E.USED_FIXED_RATE_PCT
, DW_ELEMENTS_ACTUARIAL_RATE_PCT = E.ACTUARIAL_RATE_PCT
, DW_ELEMENTS_INITIAL_BASIS_AMT = E.INITIAL_BASIS_AMT
, DW_ELEMENTS_RESIDUAL_AMT = E.RESIDUAL_AMT
, DW_ELEMENTS_FINANCIAL_PMT_SCHED_TYPE_CODE = E.FINANCIAL_PMT_SCHED_TYPE_CODE
, DW_ELEMENTS_FINANCIAL_PMT_SCHED_TYPE_DESC = E.FINANCIAL_PMT_SCHED_TYPE_DESC
, DW_ELEMENTS_INTEREST_CALC_METHOD_CODE = E.INTEREST_CALC_METHOD_CODE
, DW_ELEMENTS_DIM_DATE_KEY = E.DIM_DATE_KEY
, DW_ELEMENTS_INTEREST_CALC_METHOD_DESC = E.INTEREST_CALC_METHOD_DESC
, DW_ELEMENTS_INT_NUMERATOR_COUNT_CODE = E.INT_NUMERATOR_COUNT_CODE
, DW_ELEMENTS_INT_NUMERATOR_COUNT_DESC = E.INT_NUMERATOR_COUNT_DESC
, DW_ELEMENTS_INT_DENOMINATOR_COUNT_CODE = E.INT_DENOMINATOR_COUNT_CODE
, DW_ELEMENTS_INT_DENOMINATOR_COUNT_DESC = E.INT_DENOMINATOR_COUNT_DESC
, DW_ELEMENTS_REG_PAYMENT_UPDATE_DT = E.REG_PAYMENT_UPDATE_DT
, DW_ELEMENTS_ELEMENT_UPDATE_DT = E.ELEMENT_UPDATE_DT
, DW_ELEMENTS_INCIDENTAL_CALC_BASIS_CODE = E.INCIDENTAL_CALC_BASIS_CODE
, DW_ELEMENTS_INCIDENTAL_CALC_BASIS_DESC = E.INCIDENTAL_CALC_BASIS_DESC
, DW_ELEMENTS_DISCOUNTING_BASIS_CODE = E.DISCOUNTING_BASIS_CODE
, DW_ELEMENTS_RUN_ID = E.RUN_ID
, DW_ELEMENTS_DISCOUNTING_BASIS_DESC = E.DISCOUNTING_BASIS_DESC
, DW_ELEMENTS_DISCOUNTING_START_DT = E.DISCOUNTING_START_DT
, DW_ELEMENTS_CURRENT_ACCOUNT_IND = E.CURRENT_ACCOUNT_IND
, DW_ELEMENTS_INVOICE_GROUPING_IND = E.INVOICE_GROUPING_IND
, DW_ELEMENTS_CONSTANT_REP_PMT_DEPR_CODE = E.CONSTANT_REP_PMT_DEPR_CODE
, DW_ELEMENTS_CONSTANT_REP_PMT_DEPR_DESC = E.CONSTANT_REP_PMT_DEPR_DESC
, DW_ELEMENTS_INCIDENTAL_MIN_BASIS_AMT = E.INCIDENTAL_MIN_BASIS_AMT
, DW_ELEMENTS_INCIDENTAL_MAX_BASIS_AMT = E.INCIDENTAL_MAX_BASIS_AMT
, DW_ELEMENTS_INCIDENTAL_EXEMPTIONS_AMT = E.INCIDENTAL_EXEMPTIONS_AMT
, DW_ELEMENTS_RATE_TYPE_CODE = E.RATE_TYPE_CODE
, DW_ELEMENTS_PROCESS_ALLOCATION_ID = E.PROCESS_ALLOCATION_ID
, DW_ELEMENTS_RATE_TYPE_DESC = E.RATE_TYPE_DESC
, DW_ELEMENTS_MANUALLY_DEFINED_IND = E.MANUALLY_DEFINED_IND
, DW_ELEMENTS_APR_CALCULATION_IND = E.APR_CALCULATION_IND
, DW_ELEMENTS_AUTOMATIC_RENEWAL_IND = E.AUTOMATIC_RENEWAL_IND
, DW_ELEMENTS_CONSTANT_REG_PMT_IND = E.CONSTANT_REG_PMT_IND
, DW_ELEMENTS_REFRAMED_INT_NUMER_COUNT_CODE = E.REFRAMED_INT_NUMER_COUNT_CODE
, DW_ELEMENTS_REFRAMED_INT_NUMER_COUNT_DESC = E.REFRAMED_INT_NUMER_COUNT_DESC
, DW_ELEMENTS_REFRAMED_INT_DENOM_COUNT_CODE = E.REFRAMED_INT_DENOM_COUNT_CODE
, DW_ELEMENTS_REFRAMED_INT_DENOM_COUNT_DESC = E.REFRAMED_INT_DENOM_COUNT_DESC
, DW_ELEMENTS_RATE_CONVERSION_METHOD_CODE = E.RATE_CONVERSION_METHOD_CODE
, DW_ELEMENTS_ENTERED_BY_CODE = E.ENTERED_BY_CODE
, DW_ELEMENTS_RATE_CONVERSION_METHOD_DESC = E.RATE_CONVERSION_METHOD_DESC
, DW_ELEMENTS_REFRAMING_DT = E.REFRAMING_DT
, DW_ELEMENTS_RECENTERING_PMT_TERM_CODE = E.RECENTERING_PMT_TERM_CODE
, DW_ELEMENTS_RECENTERING_PMT_TERM_DESC = E.RECENTERING_PMT_TERM_DESC
, DW_ELEMENTS_INCOMPLETE_PERIOD_OFFSET_NBR = E.INCOMPLETE_PERIOD_OFFSET_NBR
, DW_ELEMENTS_RECENTERING_METHOD_CODE = E.RECENTERING_METHOD_CODE
, DW_ELEMENTS_RECENTERING_METHOD_DESC = E.RECENTERING_METHOD_DESC
, DW_ELEMENTS_CUST_CURRENT_ACCT_PART_AMT = E.CUST_CURRENT_ACCT_PART_AMT
, DW_ELEMENTS_ADV_TRANS_METH_CURR_ACT_CODE = E.ADV_TRANS_METH_CURR_ACT_CODE
, DW_ELEMENTS_ADV_TRANS_METH_CURR_ACT_DESC = E.ADV_TRANS_METH_CURR_ACT_DESC
, DW_ELEMENTS_ENTERED_BY_DESC = E.ENTERED_BY_DESC
, DW_ELEMENTS_SPREAD_ON_CURRENT_ACCOUNT_PCT = E.SPREAD_ON_CURRENT_ACCOUNT_PCT
, DW_ELEMENTS_DEPOSIT_ACCT_INT_DISPLAY_IND = E.DEPOSIT_ACCT_INT_DISPLAY_IND
, DW_ELEMENTS_FINANCING_PMT_SCHED_TYPE_CODE = E.FINANCING_PMT_SCHED_TYPE_CODE
, DW_ELEMENTS_FINANCING_PMT_SCHED_TYPE_DESC = E.FINANCING_PMT_SCHED_TYPE_DESC
, DW_ELEMENTS_SEASONAL_PERIOD_EXP_CODE = E.SEASONAL_PERIOD_EXP_CODE
, DW_ELEMENTS_SEASONAL_PERIOD_EXP_DESC = E.SEASONAL_PERIOD_EXP_DESC
, DW_ELEMENTS_SEASONAL_PERIOD_MULTIPLE_NBR = E.SEASONAL_PERIOD_MULTIPLE_NBR
, DW_ELEMENTS_ELEMENT_TYPE_CODE = E.ELEMENT_TYPE_CODE
, DW_ELEMENTS_ELEMENT_TYPE_DESC = E.ELEMENT_TYPE_DESC
, DW_ELEMENTS_SIMPLE_INT_PERIODICITY_CODE = E.SIMPLE_INT_PERIODICITY_CODE
, DW_ELEMENTS_FINANCIAL_ELEMENT_SIGN_DESC = E.FINANCIAL_ELEMENT_SIGN_DESC
, DW_ELEMENTS_SIMPLE_INT_PERIODICITY_DESC = E.SIMPLE_INT_PERIODICITY_DESC
, DW_ELEMENTS_SIMPLE_INT_PERIOD_MULT_NBR = E.SIMPLE_INT_PERIOD_MULT_NBR
, DW_ELEMENTS_INTEREST_RATE_NATURE_CODE = E.INTEREST_RATE_NATURE_CODE
, DW_ELEMENTS_INTEREST_RATE_NATURE_DESC = E.INTEREST_RATE_NATURE_DESC
, DW_ELEMENTS_INTERNAL_FLOW_VALIDATION_CODE = E.INTERNAL_FLOW_VALIDATION_CODE
, DW_ELEMENTS_INTERNAL_FLOW_VALIDATION_DESC = E.INTERNAL_FLOW_VALIDATION_DESC
, DW_ELEMENTS_RATE_REF_PERIODICITY_CODE = E.RATE_REF_PERIODICITY_CODE
, DW_ELEMENTS_RATE_REF_PERIODICITY_DESC = E.RATE_REF_PERIODICITY_DESC
, DW_ELEMENTS_RATE_REF_PERIOD_UNIT_NBR = E.RATE_REF_PERIOD_UNIT_NBR
, DW_ELEMENTS_CUR_ACCT_TAX_MGMT_METH_CODE = E.CUR_ACCT_TAX_MGMT_METH_CODE
, DW_ELEMENTS_ELEMENT_CLASS_CODE = E.ELEMENT_CLASS_CODE
, DW_ELEMENTS_CUR_ACCT_TAX_MGMT_METH_DESC = E.CUR_ACCT_TAX_MGMT_METH_DESC
, DW_ELEMENTS_CASH_ACCT_REVISION_MODE_CODE = E.CASH_ACCT_REVISION_MODE_CODE
, DW_ELEMENTS_CASH_ACCT_REVISION_MODE_DESC = E.CASH_ACCT_REVISION_MODE_DESC
, DW_ELEMENTS_CUR_ACCT_INT_RATE_ORIGIN_CODE = E.CUR_ACCT_INT_RATE_ORIGIN_CODE
, DW_ELEMENTS_CUR_ACCT_INT_RATE_ORIGIN_DESC = E.CUR_ACCT_INT_RATE_ORIGIN_DESC
, DW_ELEMENTS_CUR_ACCT_MANUAL_RATE_PCT = E.CUR_ACCT_MANUAL_RATE_PCT
, DW_ELEMENTS_ACCRUED_INT_CAPITALIZE_IND = E.ACCRUED_INT_CAPITALIZE_IND
, DW_ELEMENTS_CAP_INT_PREPAY_CEILING_AMT = E.CAP_INT_PREPAY_CEILING_AMT
, DW_ELEMENTS_VAT_FIXED_TERM_MOS_NBR = E.VAT_FIXED_TERM_MOS_NBR
, DW_ELEMENTS_IMMEDIATE_LUMP_SUM_IND = E.IMMEDIATE_LUMP_SUM_IND
, DW_RECEIVABLE_DETAILS_RECEIVABLE_ID = RD.RECEIVABLE_ID
, DW_RECEIVABLE_DETAILS_PAYABLE_ID = RD.PAYABLE_ID
, DW_RECEIVABLE_DETAILS_PAYABLE_NUMBER_DESC = RD.PAYABLE_NUMBER_DESC
, DW_RECEIVABLE_DETAILS_CONTRACT_AMENDMENT_NBR = RD.CONTRACT_AMENDMENT_NBR
, DW_RECEIVABLE_DETAILS_SYNDICATION_ID = RD.SYNDICATION_ID
, DW_RECEIVABLE_DETAILS_NOMENCLATURE_CODE = RD.NOMENCLATURE_CODE
, DW_RECEIVABLE_DETAILS_NOMENCLATURE_DESC = RD.NOMENCLATURE_DESC
, DW_RECEIVABLE_DETAILS_ELEMENT_NBR = RD.ELEMENT_NBR
, DW_RECEIVABLE_DETAILS_PROPERTY_ID = RD.PROPERTY_ID
, DW_RECEIVABLE_DETAILS_INVESTMENT_ID = RD.INVESTMENT_ID
, DW_RECEIVABLE_DETAILS_SORT_ORDER_CODE = RD.SORT_ORDER_CODE
, DW_RECEIVABLE_DETAILS_ORDER_NBR = RD.ORDER_NBR
, DW_RECEIVABLE_DETAILS_SORT_ORDER_DESC = RD.SORT_ORDER_DESC
, DW_RECEIVABLE_DETAILS_DRAW_ID = RD.DRAW_ID
, DW_RECEIVABLE_DETAILS_DELIVERY_TYPE_CODE = RD.DELIVERY_TYPE_CODE
, DW_RECEIVABLE_DETAILS_DELIVERY_TYPE_DESC = RD.DELIVERY_TYPE_DESC
, DW_RECEIVABLE_DETAILS_CURRENT_TURN_AMT = RD.CURRENT_TURN_AMT
, DW_RECEIVABLE_DETAILS_REMAINING_TURNS_AMT = RD.REMAINING_TURNS_AMT
, DW_RECEIVABLE_DETAILS_LOAN_BALANCE_AMT = RD.LOAN_BALANCE_AMT
, DW_RECEIVABLE_DETAILS_PRINCIPAL_PAID_AMT = RD.PRINCIPAL_PAID_AMT
, DW_RECEIVABLE_DETAILS_PREVIOUS_MONTHLY_UNPAID_AMT = RD.PREVIOUS_MONTHLY_UNPAID_AMT
, DW_RECEIVABLE_DETAILS_PREVIOUS_OVERPAID_AMT = RD.PREVIOUS_OVERPAID_AMT
, DW_RECEIVABLE_DETAILS_DIM_DATE_KEY = RD.DIM_DATE_KEY
, DW_RECEIVABLE_DETAILS_PREV_MNT_DELINQUENT_PRINC_AMT = RD.PREV_MNT_DELINQUENT_PRINC_AMT
, DW_RECEIVABLE_DETAILS_LATE_CHARGE_AMT = RD.LATE_CHARGE_AMT
, DW_RECEIVABLE_DETAILS_PREV_MNT_DELINQUENT_TOTAL_AMT = RD.PREV_MNT_DELINQUENT_TOTAL_AMT
, DW_RECEIVABLE_DETAILS_CURR_MNT_BILLING_TOTAL_AMT = RD.CURR_MNT_BILLING_TOTAL_AMT
, DW_RECEIVABLE_DETAILS_RUN_ID = RD.RUN_ID
, DW_RECEIVABLE_DETAILS_CONTRACT_ID = RD.CONTRACT_ID
, DW_RECEIVABLE_DETAILS_CONTRACT_NUMBER_DESC = RD.CONTRACT_NUMBER_DESC
, DW_RECEIVABLE_DETAILS_DESCRIPTION_DESC = RD.DESCRIPTION_DESC
, DW_RECEIVABLE_DETAILS_CUSTOMER_COMMENT_DESC = RD.CUSTOMER_COMMENT_DESC
, DW_RECEIVABLE_DETAILS_CUSTOMER_REFERENCE_DESC = RD.CUSTOMER_REFERENCE_DESC
, DW_RECEIVABLE_LINE_ITEMS_RECEIVABLE_ID = RLI.RECEIVABLE_ID
, DW_RECEIVABLE_LINE_ITEMS_REVISION_ID = RLI.REVISION_ID
, DW_RECEIVABLE_LINE_ITEMS_ACTUALIZATION_ID = RLI.ACTUALIZATION_ID
, DW_RECEIVABLE_LINE_ITEMS_CREDIT_NOTE_RECEIVABLE_ID = RLI.CREDIT_NOTE_RECEIVABLE_ID
, DW_RECEIVABLE_LINE_ITEMS_UNPAID_RECEIVABLE_ID = RLI.UNPAID_RECEIVABLE_ID
, DW_RECEIVABLE_LINE_ITEMS_TERM_OCCURRENCE_NBR = RLI.TERM_OCCURRENCE_NBR
, DW_RECEIVABLE_LINE_ITEMS_TOTAL_AMT = RLI.TOTAL_AMT
, DW_RECEIVABLE_LINE_ITEMS_REVISED_AMT = RLI.REVISED_AMT
, DW_RECEIVABLE_LINE_ITEMS_PRINCIPAL_AMT = RLI.PRINCIPAL_AMT
, DW_RECEIVABLE_LINE_ITEMS_TAX_RATE_PCT = RLI.TAX_RATE_PCT
, DW_RECEIVABLE_LINE_ITEMS_PERIOD_START_DT = RLI.PERIOD_START_DT
, DW_RECEIVABLE_LINE_ITEMS_RECEIVABLE_LINE_ITEM_NBR = RLI.RECEIVABLE_LINE_ITEM_NBR
, DW_RECEIVABLE_LINE_ITEMS_PERIOD_END_DT = RLI.PERIOD_END_DT
, DW_RECEIVABLE_LINE_ITEMS_LINE_REGROUPING_NBR = RLI.LINE_REGROUPING_NBR
, DW_RECEIVABLE_LINE_ITEMS_VARIABLE_RATE_VALUE_PCT = RLI.VARIABLE_RATE_VALUE_PCT
, DW_RECEIVABLE_LINE_ITEMS_CASHFLOW_AGGREEMENT_ORDER_NBR = RLI.CASHFLOW_AGGREEMENT_ORDER_NBR
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_BAL_IDX_PREV_AMT = RLI.CURACCT_BAL_IDX_PREV_AMT
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_BAL_IDX_EOP_AMT = RLI.CURACCT_BAL_IDX_EOP_AMT
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_BAL_IDX_PRETX_PRV_AMT = RLI.CURACCT_BAL_IDX_PRETX_PRV_AMT
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_BAL_IDX_PRETX_EOP_AMT = RLI.CURACCT_BAL_IDX_PRETX_EOP_AMT
, DW_RECEIVABLE_LINE_ITEMS_LOAN_DESC = RLI.LOAN_DESC
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_VAT_PRV_AMT = RLI.CURACCT_VAT_PRV_AMT
, DW_RECEIVABLE_LINE_ITEMS_DIM_DATE_KEY = RLI.DIM_DATE_KEY
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_VAT_EOP_AMT = RLI.CURACCT_VAT_EOP_AMT
, DW_RECEIVABLE_LINE_ITEMS_PREVIOUS_REVISION_ID = RLI.PREVIOUS_REVISION_ID
, DW_RECEIVABLE_LINE_ITEMS_ELEMENT_CLASS_CODE = RLI.ELEMENT_CLASS_CODE
, DW_RECEIVABLE_LINE_ITEMS_ELEMENT_CLASS_DESC = RLI.ELEMENT_CLASS_DESC
, DW_RECEIVABLE_LINE_ITEMS_FINANCIAL_ELEMENT_TYPE_CODE = RLI.FINANCIAL_ELEMENT_TYPE_CODE
, DW_RECEIVABLE_LINE_ITEMS_FINANCIAL_ELEMENT_TYPE_DESC = RLI.FINANCIAL_ELEMENT_TYPE_DESC
, DW_RECEIVABLE_LINE_ITEMS_CURR_ACCT_INT_RATE_ORIG_CODE = RLI.CURR_ACCT_INT_RATE_ORIG_CODE
, DW_RECEIVABLE_LINE_ITEMS_CURR_ACCT_INT_RATE_ORIG_DESC = RLI.CURR_ACCT_INT_RATE_ORIG_DESC
, DW_RECEIVABLE_LINE_ITEMS_CALCULATION_BASIS_AMT = RLI.CALCULATION_BASIS_AMT
, DW_RECEIVABLE_LINE_ITEMS_INCIDENTAL_RATE_PCT = RLI.INCIDENTAL_RATE_PCT
, DW_RECEIVABLE_LINE_ITEMS_RUN_ID = RLI.RUN_ID
, DW_RECEIVABLE_LINE_ITEMS_REVISION_DT = RLI.REVISION_DT
, DW_RECEIVABLE_LINE_ITEMS_TERM_DT = RLI.TERM_DT
, DW_RECEIVABLE_LINE_ITEMS_END_OF_PREVIOUS_PERIOD_DT = RLI.END_OF_PREVIOUS_PERIOD_DT
, DW_RECEIVABLE_LINE_ITEMS_ACTOR_OCCURRENCE_NBR = RLI.ACTOR_OCCURRENCE_NBR
, DW_RECEIVABLE_LINE_ITEMS_INTEREST_CALC_METHOD_CODE = RLI.INTEREST_CALC_METHOD_CODE
, DW_RECEIVABLE_LINE_ITEMS_INTEREST_CALC_METHOD_DESC = RLI.INTEREST_CALC_METHOD_DESC
, DW_RECEIVABLE_LINE_ITEMS_INTERST_RATE_TYPE_CODE = RLI.INTERST_RATE_TYPE_CODE
, DW_RECEIVABLE_LINE_ITEMS_INTERST_RATE_TYPE_DESC = RLI.INTERST_RATE_TYPE_DESC
, DW_RECEIVABLE_LINE_ITEMS_TAX_MGMT_METHOD_CODE = RLI.TAX_MGMT_METHOD_CODE
, DW_RECEIVABLE_LINE_ITEMS_TAX_MGMT_METHOD_DESC = RLI.TAX_MGMT_METHOD_DESC
, DW_RECEIVABLE_LINE_ITEMS_RECEIVABLE_DETAILS_ORDER_NBR = RLI.RECEIVABLE_DETAILS_ORDER_NBR
, DW_RECEIVABLE_LINE_ITEMS_FLIDRUCVTMODEINDEX_CODE = RLI.FLIDRUCVTMODEINDEX_CODE
, DW_RECEIVABLE_LINE_ITEMS_FLIDRUCVTMODEINDEX_DESC = RLI.FLIDRUCVTMODEINDEX_DESC
, DW_RECEIVABLE_LINE_ITEMS_FLIDRUCCFLAGAFFICHINT_IND = RLI.FLIDRUCCFLAGAFFICHINT_IND
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_INTEREST_IND = RLI.CURACCT_INTEREST_IND
, DW_RECEIVABLE_LINE_ITEMS_PERCEPTION_CODE = RLI.PERCEPTION_CODE
, DW_RECEIVABLE_LINE_ITEMS_PERCEPTION_DESC = RLI.PERCEPTION_DESC
, DW_RECEIVABLE_LINE_ITEMS_REVISION_MODE_CODE = RLI.REVISION_MODE_CODE
, DW_RECEIVABLE_LINE_ITEMS_REVISION_MODE_DESC = RLI.REVISION_MODE_DESC
, DW_RECEIVABLE_LINE_ITEMS_INTEREST_CALC_BASIS_AMT = RLI.INTEREST_CALC_BASIS_AMT
, DW_RECEIVABLE_LINE_ITEMS_MEMO_ID = RLI.MEMO_ID
, DW_RECEIVABLE_LINE_ITEMS_PROCESS_ALLOCATION_ID = RLI.PROCESS_ALLOCATION_ID
, DW_RECEIVABLE_LINE_ITEMS_TRANSFER_ACTOR_NBR = RLI.TRANSFER_ACTOR_NBR
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_TAX_CODE_CODE = RLI.PAYMENT_TAX_CODE_CODE
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_TAX_CODE_DESC = RLI.PAYMENT_TAX_CODE_DESC
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_SCHED_TYPE_CODE = RLI.PAYMENT_SCHED_TYPE_CODE
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_SCHED_TYPE_DESC = RLI.PAYMENT_SCHED_TYPE_DESC
, DW_RECEIVABLE_LINE_ITEMS_ELEMENT_DESC = RLI.ELEMENT_DESC
, DW_RECEIVABLE_LINE_ITEMS_PAYABLE_ID = RLI.PAYABLE_ID
, DW_RECEIVABLE_LINE_ITEMS_PAYABLE_LINE_ITEM_NBR = RLI.PAYABLE_LINE_ITEM_NBR
, DW_RECEIVABLE_LINE_ITEMS_ORIGINAL_CREDIT_NOTE_ID = RLI.ORIGINAL_CREDIT_NOTE_ID
, DW_RECEIVABLE_LINE_ITEMS_ORIGINAL_CREDIT_NOTE_LINE_NBR = RLI.ORIGINAL_CREDIT_NOTE_LINE_NBR
, DW_RECEIVABLE_LINE_ITEMS_PRE_TAX_AMT = RLI.PRE_TAX_AMT
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_CODE_CODE = RLI.PAYMENT_CODE_CODE
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_CODE_DESC = RLI.PAYMENT_CODE_DESC
, DW_RECEIVABLE_LINE_ITEMS_WORK_ID = RLI.WORK_ID
, DW_RECEIVABLE_LINE_ITEMS_BUDGET_ORDER_NBR = RLI.BUDGET_ORDER_NBR
, DW_RECEIVABLE_LINE_ITEMS_ANNUAL_RATE_PCT = RLI.ANNUAL_RATE_PCT
, DW_RECEIVABLE_LINE_ITEMS_ELEMENT_NBR = RLI.ELEMENT_NBR
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_NBR = RLI.PAYMENT_NBR
, DW_RECEIVABLE_LINE_ITEMS_CONSTRUCTION_STEP_NBR = RLI.CONSTRUCTION_STEP_NBR
, DW_RECEIVABLE_LINE_ITEMS_PRETAX_PASSIVE_ELEMENT_AMT = RLI.PRETAX_PASSIVE_ELEMENT_AMT
, DW_RECEIVABLE_LINE_ITEMS_PASSIVE_ELEMENT_PRINCIPAL_AMT = RLI.PASSIVE_ELEMENT_PRINCIPAL_AMT
, DW_RECEIVABLE_LINE_ITEMS_TAX_CODE = RLI.TAX_CODE
, DW_RECEIVABLE_LINE_ITEMS_FOREIGN_EXCHANGE_RATE_PCT = RLI.FOREIGN_EXCHANGE_RATE_PCT
, DW_RECEIVABLE_LINE_ITEMS_ORIGINAL_CURRENCY_CODE = RLI.ORIGINAL_CURRENCY_CODE
, DW_RECEIVABLE_LINE_ITEMS_ORIGINAL_CURRENCY_DESC = RLI.ORIGINAL_CURRENCY_DESC
, DW_RECEIVABLE_LINE_ITEMS_INTEREST_IND = RLI.INTEREST_IND
, DW_RECEIVABLE_LINE_ITEMS_TAX_ESCROW_IND = RLI.TAX_ESCROW_IND
, DW_RECEIVABLE_LINE_ITEMS_INS_ESCROW_IND = RLI.INS_ESCROW_IND
, DW_RECEIVABLE_LINE_ITEMS_RES_ESCROW_IND = RLI.RES_ESCROW_IND
, DW_RECEIVABLE_LINE_ITEMS_LATE_CHARGE_IND = RLI.LATE_CHARGE_IND
, DW_RECEIVABLE_LINE_ITEMS_FEES_IND = RLI.FEES_IND
, DW_RECEIVABLE_LINE_ITEMS_SERVICE_FEES_IND = RLI.SERVICE_FEES_IND
, DW_RECEIVABLE_LINE_ITEMS_TAX_DESC = RLI.TAX_DESC
, DW_RECEIVABLE_LINE_ITEMS_OTHER_IND = RLI.OTHER_IND
, DW_RECEIVABLE_LINE_ITEMS_ADDRESS_ID = RLI.ADDRESS_ID
, DW_RECEIVABLES_RECEIVABLE_ID = R.RECEIVABLE_ID
, DW_RECEIVABLES_ORIGINAL_RECEIVABLE_ID = R.ORIGINAL_RECEIVABLE_ID
, DW_RECEIVABLES_PAYEE_ADRESS_ORDER_NBR = R.PAYEE_ADRESS_ORDER_NBR
, DW_RECEIVABLES_EVENT_ID = R.EVENT_ID
, DW_RECEIVABLES_ACTOR_ROLE_CODE = R.ACTOR_ROLE_CODE
, DW_RECEIVABLES_ACTOR_ROLE_DESC = R.ACTOR_ROLE_DESC
, DW_RECEIVABLES_ACCOUNTING_CURRENCY_CODE = R.ACCOUNTING_CURRENCY_CODE
, DW_RECEIVABLES_ACCOUNTING_CURRENCY_DESC = R.ACCOUNTING_CURRENCY_DESC
, DW_RECEIVABLES_INVOICE_NUMBER_DESC = R.INVOICE_NUMBER_DESC
, DW_RECEIVABLES_RECEIVABLE_TYPE_CODE = R.RECEIVABLE_TYPE_CODE
, DW_RECEIVABLES_RECEIVABLE_TYPE_DESC = R.RECEIVABLE_TYPE_DESC
, DW_RECEIVABLES_DIM_DATE_KEY = R.DIM_DATE_KEY
, DW_RECEIVABLES_TOTAL_INVOICE_AMT = R.TOTAL_INVOICE_AMT
, DW_RECEIVABLES_INVOICE_DT = R.INVOICE_DT
, DW_RECEIVABLES_PROCESSING_DT = R.PROCESSING_DT
, DW_RECEIVABLES_GRACE_PERIOD_NBR = R.GRACE_PERIOD_NBR
, DW_RECEIVABLES_CO_VAT_TYPE_CODE = R.CO_VAT_TYPE_CODE
, DW_RECEIVABLES_CO_VAT_TYPE_DESC = R.CO_VAT_TYPE_DESC
, DW_RECEIVABLES_CUSTOMER_COPY_IND = R.CUSTOMER_COPY_IND
, DW_RECEIVABLES_CREDIT_NOTE_IND = R.CREDIT_NOTE_IND
, DW_RECEIVABLES_TEMPORARY_IND = R.TEMPORARY_IND
, DW_RECEIVABLES_BATCH_JOB_ID = R.BATCH_JOB_ID
, DW_RECEIVABLES_RUN_ID = R.RUN_ID
, DW_RECEIVABLES_CUSTOMER_CONTACT_DESC = R.CUSTOMER_CONTACT_DESC
, DW_RECEIVABLES_TOTAL_CONVERTED_AMT = R.TOTAL_CONVERTED_AMT
, DW_RECEIVABLES_CONVERSION_RATE_PCT = R.CONVERSION_RATE_PCT
, DW_RECEIVABLES_CONSTRUCTION_BUDGET_ID = R.CONSTRUCTION_BUDGET_ID
, DW_RECEIVABLES_BUDGET_OCCURRENCE_NBR = R.BUDGET_OCCURRENCE_NBR
, DW_RECEIVABLES_USERNAME_CODE = R.USERNAME_CODE
, DW_RECEIVABLES_USERNAME_DESC = R.USERNAME_DESC
, DW_RECEIVABLES_CLAIM_ID = R.CLAIM_ID
, DW_RECEIVABLES_MANDATE_ID = R.MANDATE_ID
, DW_RECEIVABLES_INVOICE_RECAP_CODE = R.INVOICE_RECAP_CODE
, DW_RECEIVABLES_COMPANY_ACTOR_ID = R.COMPANY_ACTOR_ID
, DW_RECEIVABLES_INVOICE_RECAP_DESC = R.INVOICE_RECAP_DESC
, DW_RECEIVABLES_BATCH_RUN_ID = R.BATCH_RUN_ID
, DW_RECEIVABLES_INVOICE_CENTER_ORDER_NBR = R.INVOICE_CENTER_ORDER_NBR
, DW_RECEIVABLES_TRANSFER_STATUS_CODE = R.TRANSFER_STATUS_CODE
, DW_RECEIVABLES_TRANSFER_STATUS_DESC = R.TRANSFER_STATUS_DESC
, DW_RECEIVABLES_INITIAL_DUE_DT = R.INITIAL_DUE_DT
, DW_RECEIVABLES_RELATED_INVOICE_ID = R.RELATED_INVOICE_ID
, DW_RECEIVABLES_CREDIT_NOTE_REASON_CODE = R.CREDIT_NOTE_REASON_CODE
, DW_RECEIVABLES_CREDIT_NOTE_REASON_DESC = R.CREDIT_NOTE_REASON_DESC
, DW_RECEIVABLES_PAYMENT_CURRENCY_CODE = R.PAYMENT_CURRENCY_CODE
, DW_RECEIVABLES_CONTRACT_TYPE_CODE = R.CONTRACT_TYPE_CODE
, DW_RECEIVABLES_PAYMENT_CURRENCY_DESC = R.PAYMENT_CURRENCY_DESC
, DW_RECEIVABLES_CURRENCY_EXCHANGE_RATE_PCT = R.CURRENCY_EXCHANGE_RATE_PCT
, DW_RECEIVABLES_CONSOLIDATION_CURRENCY_CODE = R.CONSOLIDATION_CURRENCY_CODE
, DW_RECEIVABLES_CONSOLIDATION_CURRENCY_DESC = R.CONSOLIDATION_CURRENCY_DESC
, DW_RECEIVABLES_TOTAL_CONSOLIDATED_AMT = R.TOTAL_CONSOLIDATED_AMT
, DW_RECEIVABLES_EXCHANGE_RATE_PCT = R.EXCHANGE_RATE_PCT
, DW_RECEIVABLES_INVOICE_STATUS_CODE = R.INVOICE_STATUS_CODE
, DW_RECEIVABLES_INVOICE_STATUS_DESC = R.INVOICE_STATUS_DESC
, DW_RECEIVABLES_DIRECT_DEBIT_REFERENCE_DESC = R.DIRECT_DEBIT_REFERENCE_DESC
, DW_RECEIVABLES_E_PAYMENTS_REFERENCE_DESC = R.E_PAYMENTS_REFERENCE_DESC
, DW_RECEIVABLES_CONTRACT_TYPE_DESC = R.CONTRACT_TYPE_DESC
, DW_RECEIVABLES_REVIEWED_RECEIVABLE_ID = R.REVIEWED_RECEIVABLE_ID
, DW_RECEIVABLES_RECEIVABLE_ID2 = R.RECEIVABLE_ID2
, DW_RECEIVABLES_NORECOVERY_REASON_CODE = R.NORECOVERY_REASON_CODE
, DW_RECEIVABLES_NORECOVERY_REASON_DESC = R.NORECOVERY_REASON_DESC
, DW_RECEIVABLES_INVOICE_CENTER_NBR_DESC = R.INVOICE_CENTER_NBR_DESC
, DW_RECEIVABLES_CURRENCY_CODE = R.CURRENCY_CODE
, DW_RECEIVABLES_CURRENCY_DESC = R.CURRENCY_DESC
, DW_RECEIVABLES_PAYEE_ACTOR_ID = R.PAYEE_ACTOR_ID 
FROM DW_RECEIVABLES R
INNER JOIN DW_RECEIVABLE_DETAILS RD
       ON R.RECEIVABLE_ID = RD.RECEIVABLE_ID
              AND R.DIM_DATE_KEY = RD.DIM_DATE_KEY
              AND R.RUN_ID = RD.RUN_ID
INNER JOIN DW_RECEIVABLE_LINE_ITEMS RLI
       ON R.RECEIVABLE_ID = RLI.RECEIVABLE_ID
              AND R.DIM_DATE_KEY = RLI.DIM_DATE_KEY
              AND R.RUN_ID = RLI.RUN_ID
INNER JOIN DW_ELEMENTS E
       ON E.CONTRACT_ID = RD.CONTRACT_ID
              AND E.ORDER_NBR = RD.ORDER_NBR
              AND E.DIM_DATE_KEY = RD.DIM_DATE_KEY
              AND E.RUN_ID = RD.RUN_ID;
GO
/****** Object:  View [rpt].[VW_RECEIVABLES_TRANSACTIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [rpt].[VW_RECEIVABLES_TRANSACTIONS]
AS
SELECT 
  DW_RECEIVABLES_RECEIVABLE_ID = R.RECEIVABLE_ID
, DW_RECEIVABLES_ORIGINAL_RECEIVABLE_ID = R.ORIGINAL_RECEIVABLE_ID
, DW_RECEIVABLES_PAYEE_ADRESS_ORDER_NBR = R.PAYEE_ADRESS_ORDER_NBR
, DW_RECEIVABLES_EVENT_ID = R.EVENT_ID
, DW_RECEIVABLES_ACTOR_ROLE_CODE = R.ACTOR_ROLE_CODE
, DW_RECEIVABLES_ACTOR_ROLE_DESC = R.ACTOR_ROLE_DESC
, DW_RECEIVABLES_ACCOUNTING_CURRENCY_CODE = R.ACCOUNTING_CURRENCY_CODE
, DW_RECEIVABLES_ACCOUNTING_CURRENCY_DESC = R.ACCOUNTING_CURRENCY_DESC
, DW_RECEIVABLES_INVOICE_NUMBER_DESC = R.INVOICE_NUMBER_DESC
, DW_RECEIVABLES_RECEIVABLE_TYPE_CODE = R.RECEIVABLE_TYPE_CODE
, DW_RECEIVABLES_RECEIVABLE_TYPE_DESC = R.RECEIVABLE_TYPE_DESC
, DW_RECEIVABLES_DIM_DATE_KEY = R.DIM_DATE_KEY
, DW_RECEIVABLES_TOTAL_INVOICE_AMT = R.TOTAL_INVOICE_AMT
, DW_RECEIVABLES_INVOICE_DT = R.INVOICE_DT
, DW_RECEIVABLES_PROCESSING_DT = R.PROCESSING_DT
, DW_RECEIVABLES_GRACE_PERIOD_NBR = R.GRACE_PERIOD_NBR
, DW_RECEIVABLES_CO_VAT_TYPE_CODE = R.CO_VAT_TYPE_CODE
, DW_RECEIVABLES_CO_VAT_TYPE_DESC = R.CO_VAT_TYPE_DESC
, DW_RECEIVABLES_CUSTOMER_COPY_IND = R.CUSTOMER_COPY_IND
, DW_RECEIVABLES_CREDIT_NOTE_IND = R.CREDIT_NOTE_IND
, DW_RECEIVABLES_TEMPORARY_IND = R.TEMPORARY_IND
, DW_RECEIVABLES_BATCH_JOB_ID = R.BATCH_JOB_ID
, DW_RECEIVABLES_RUN_ID = R.RUN_ID
, DW_RECEIVABLES_CUSTOMER_CONTACT_DESC = R.CUSTOMER_CONTACT_DESC
, DW_RECEIVABLES_TOTAL_CONVERTED_AMT = R.TOTAL_CONVERTED_AMT
, DW_RECEIVABLES_CONVERSION_RATE_PCT = R.CONVERSION_RATE_PCT
, DW_RECEIVABLES_CONSTRUCTION_BUDGET_ID = R.CONSTRUCTION_BUDGET_ID
, DW_RECEIVABLES_BUDGET_OCCURRENCE_NBR = R.BUDGET_OCCURRENCE_NBR
, DW_RECEIVABLES_USERNAME_CODE = R.USERNAME_CODE
, DW_RECEIVABLES_USERNAME_DESC = R.USERNAME_DESC
, DW_RECEIVABLES_CLAIM_ID = R.CLAIM_ID
, DW_RECEIVABLES_MANDATE_ID = R.MANDATE_ID
, DW_RECEIVABLES_INVOICE_RECAP_CODE = R.INVOICE_RECAP_CODE
, DW_RECEIVABLES_COMPANY_ACTOR_ID = R.COMPANY_ACTOR_ID
, DW_RECEIVABLES_INVOICE_RECAP_DESC = R.INVOICE_RECAP_DESC
, DW_RECEIVABLES_BATCH_RUN_ID = R.BATCH_RUN_ID
, DW_RECEIVABLES_INVOICE_CENTER_ORDER_NBR = R.INVOICE_CENTER_ORDER_NBR
, DW_RECEIVABLES_TRANSFER_STATUS_CODE = R.TRANSFER_STATUS_CODE
, DW_RECEIVABLES_TRANSFER_STATUS_DESC = R.TRANSFER_STATUS_DESC
, DW_RECEIVABLES_INITIAL_DUE_DT = R.INITIAL_DUE_DT
, DW_RECEIVABLES_RELATED_INVOICE_ID = R.RELATED_INVOICE_ID
, DW_RECEIVABLES_CREDIT_NOTE_REASON_CODE = R.CREDIT_NOTE_REASON_CODE
, DW_RECEIVABLES_CREDIT_NOTE_REASON_DESC = R.CREDIT_NOTE_REASON_DESC
, DW_RECEIVABLES_PAYMENT_CURRENCY_CODE = R.PAYMENT_CURRENCY_CODE
, DW_RECEIVABLES_CONTRACT_TYPE_CODE = R.CONTRACT_TYPE_CODE
, DW_RECEIVABLES_PAYMENT_CURRENCY_DESC = R.PAYMENT_CURRENCY_DESC
, DW_RECEIVABLES_CURRENCY_EXCHANGE_RATE_PCT = R.CURRENCY_EXCHANGE_RATE_PCT
, DW_RECEIVABLES_CONSOLIDATION_CURRENCY_CODE = R.CONSOLIDATION_CURRENCY_CODE
, DW_RECEIVABLES_CONSOLIDATION_CURRENCY_DESC = R.CONSOLIDATION_CURRENCY_DESC
, DW_RECEIVABLES_TOTAL_CONSOLIDATED_AMT = R.TOTAL_CONSOLIDATED_AMT
, DW_RECEIVABLES_EXCHANGE_RATE_PCT = R.EXCHANGE_RATE_PCT
, DW_RECEIVABLES_INVOICE_STATUS_CODE = R.INVOICE_STATUS_CODE
, DW_RECEIVABLES_INVOICE_STATUS_DESC = R.INVOICE_STATUS_DESC
, DW_RECEIVABLES_DIRECT_DEBIT_REFERENCE_DESC = R.DIRECT_DEBIT_REFERENCE_DESC
, DW_RECEIVABLES_E_PAYMENTS_REFERENCE_DESC = R.E_PAYMENTS_REFERENCE_DESC
, DW_RECEIVABLES_CONTRACT_TYPE_DESC = R.CONTRACT_TYPE_DESC
, DW_RECEIVABLES_REVIEWED_RECEIVABLE_ID = R.REVIEWED_RECEIVABLE_ID
, DW_RECEIVABLES_RECEIVABLE_ID2 = R.RECEIVABLE_ID2
, DW_RECEIVABLES_NORECOVERY_REASON_CODE = R.NORECOVERY_REASON_CODE
, DW_RECEIVABLES_NORECOVERY_REASON_DESC = R.NORECOVERY_REASON_DESC
, DW_RECEIVABLES_INVOICE_CENTER_NBR_DESC = R.INVOICE_CENTER_NBR_DESC
, DW_RECEIVABLES_CURRENCY_CODE = R.CURRENCY_CODE
, DW_RECEIVABLES_CURRENCY_DESC = R.CURRENCY_DESC
, DW_RECEIVABLES_PAYEE_ACTOR_ID = R.PAYEE_ACTOR_ID
, DW_RECEIVABLE_LINE_ITEMS_RECEIVABLE_ID = RLI.RECEIVABLE_ID
, DW_RECEIVABLE_LINE_ITEMS_REVISION_ID = RLI.REVISION_ID
, DW_RECEIVABLE_LINE_ITEMS_ACTUALIZATION_ID = RLI.ACTUALIZATION_ID
, DW_RECEIVABLE_LINE_ITEMS_CREDIT_NOTE_RECEIVABLE_ID = RLI.CREDIT_NOTE_RECEIVABLE_ID
, DW_RECEIVABLE_LINE_ITEMS_UNPAID_RECEIVABLE_ID = RLI.UNPAID_RECEIVABLE_ID
, DW_RECEIVABLE_LINE_ITEMS_TERM_OCCURRENCE_NBR = RLI.TERM_OCCURRENCE_NBR
, DW_RECEIVABLE_LINE_ITEMS_TOTAL_AMT = RLI.TOTAL_AMT
, DW_RECEIVABLE_LINE_ITEMS_REVISED_AMT = RLI.REVISED_AMT
, DW_RECEIVABLE_LINE_ITEMS_PRINCIPAL_AMT = RLI.PRINCIPAL_AMT
, DW_RECEIVABLE_LINE_ITEMS_TAX_RATE_PCT = RLI.TAX_RATE_PCT
, DW_RECEIVABLE_LINE_ITEMS_PERIOD_START_DT = RLI.PERIOD_START_DT
, DW_RECEIVABLE_LINE_ITEMS_RECEIVABLE_LINE_ITEM_NBR = RLI.RECEIVABLE_LINE_ITEM_NBR
, DW_RECEIVABLE_LINE_ITEMS_PERIOD_END_DT = RLI.PERIOD_END_DT
, DW_RECEIVABLE_LINE_ITEMS_LINE_REGROUPING_NBR = RLI.LINE_REGROUPING_NBR
, DW_RECEIVABLE_LINE_ITEMS_VARIABLE_RATE_VALUE_PCT = RLI.VARIABLE_RATE_VALUE_PCT
, DW_RECEIVABLE_LINE_ITEMS_CASHFLOW_AGGREEMENT_ORDER_NBR = RLI.CASHFLOW_AGGREEMENT_ORDER_NBR
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_BAL_IDX_PREV_AMT = RLI.CURACCT_BAL_IDX_PREV_AMT
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_BAL_IDX_EOP_AMT = RLI.CURACCT_BAL_IDX_EOP_AMT
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_BAL_IDX_PRETX_PRV_AMT = RLI.CURACCT_BAL_IDX_PRETX_PRV_AMT
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_BAL_IDX_PRETX_EOP_AMT = RLI.CURACCT_BAL_IDX_PRETX_EOP_AMT
, DW_RECEIVABLE_LINE_ITEMS_LOAN_DESC = RLI.LOAN_DESC
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_VAT_PRV_AMT = RLI.CURACCT_VAT_PRV_AMT
, DW_RECEIVABLE_LINE_ITEMS_DIM_DATE_KEY = RLI.DIM_DATE_KEY
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_VAT_EOP_AMT = RLI.CURACCT_VAT_EOP_AMT
, DW_RECEIVABLE_LINE_ITEMS_PREVIOUS_REVISION_ID = RLI.PREVIOUS_REVISION_ID
, DW_RECEIVABLE_LINE_ITEMS_ELEMENT_CLASS_CODE = RLI.ELEMENT_CLASS_CODE
, DW_RECEIVABLE_LINE_ITEMS_ELEMENT_CLASS_DESC = RLI.ELEMENT_CLASS_DESC
, DW_RECEIVABLE_LINE_ITEMS_FINANCIAL_ELEMENT_TYPE_CODE = RLI.FINANCIAL_ELEMENT_TYPE_CODE
, DW_RECEIVABLE_LINE_ITEMS_FINANCIAL_ELEMENT_TYPE_DESC = RLI.FINANCIAL_ELEMENT_TYPE_DESC
, DW_RECEIVABLE_LINE_ITEMS_CURR_ACCT_INT_RATE_ORIG_CODE = RLI.CURR_ACCT_INT_RATE_ORIG_CODE
, DW_RECEIVABLE_LINE_ITEMS_CURR_ACCT_INT_RATE_ORIG_DESC = RLI.CURR_ACCT_INT_RATE_ORIG_DESC
, DW_RECEIVABLE_LINE_ITEMS_CALCULATION_BASIS_AMT = RLI.CALCULATION_BASIS_AMT
, DW_RECEIVABLE_LINE_ITEMS_INCIDENTAL_RATE_PCT = RLI.INCIDENTAL_RATE_PCT
, DW_RECEIVABLE_LINE_ITEMS_RUN_ID = RLI.RUN_ID
, DW_RECEIVABLE_LINE_ITEMS_REVISION_DT = RLI.REVISION_DT
, DW_RECEIVABLE_LINE_ITEMS_TERM_DT = RLI.TERM_DT
, DW_RECEIVABLE_LINE_ITEMS_END_OF_PREVIOUS_PERIOD_DT = RLI.END_OF_PREVIOUS_PERIOD_DT
, DW_RECEIVABLE_LINE_ITEMS_ACTOR_OCCURRENCE_NBR = RLI.ACTOR_OCCURRENCE_NBR
, DW_RECEIVABLE_LINE_ITEMS_INTEREST_CALC_METHOD_CODE = RLI.INTEREST_CALC_METHOD_CODE
, DW_RECEIVABLE_LINE_ITEMS_INTEREST_CALC_METHOD_DESC = RLI.INTEREST_CALC_METHOD_DESC
, DW_RECEIVABLE_LINE_ITEMS_INTERST_RATE_TYPE_CODE = RLI.INTERST_RATE_TYPE_CODE
, DW_RECEIVABLE_LINE_ITEMS_INTERST_RATE_TYPE_DESC = RLI.INTERST_RATE_TYPE_DESC
, DW_RECEIVABLE_LINE_ITEMS_TAX_MGMT_METHOD_CODE = RLI.TAX_MGMT_METHOD_CODE
, DW_RECEIVABLE_LINE_ITEMS_TAX_MGMT_METHOD_DESC = RLI.TAX_MGMT_METHOD_DESC
, DW_RECEIVABLE_LINE_ITEMS_RECEIVABLE_DETAILS_ORDER_NBR = RLI.RECEIVABLE_DETAILS_ORDER_NBR
, DW_RECEIVABLE_LINE_ITEMS_FLIDRUCVTMODEINDEX_CODE = RLI.FLIDRUCVTMODEINDEX_CODE
, DW_RECEIVABLE_LINE_ITEMS_FLIDRUCVTMODEINDEX_DESC = RLI.FLIDRUCVTMODEINDEX_DESC
, DW_RECEIVABLE_LINE_ITEMS_FLIDRUCCFLAGAFFICHINT_IND = RLI.FLIDRUCCFLAGAFFICHINT_IND
, DW_RECEIVABLE_LINE_ITEMS_CURACCT_INTEREST_IND = RLI.CURACCT_INTEREST_IND
, DW_RECEIVABLE_LINE_ITEMS_PERCEPTION_CODE = RLI.PERCEPTION_CODE
, DW_RECEIVABLE_LINE_ITEMS_PERCEPTION_DESC = RLI.PERCEPTION_DESC
, DW_RECEIVABLE_LINE_ITEMS_REVISION_MODE_CODE = RLI.REVISION_MODE_CODE
, DW_RECEIVABLE_LINE_ITEMS_REVISION_MODE_DESC = RLI.REVISION_MODE_DESC
, DW_RECEIVABLE_LINE_ITEMS_INTEREST_CALC_BASIS_AMT = RLI.INTEREST_CALC_BASIS_AMT
, DW_RECEIVABLE_LINE_ITEMS_MEMO_ID = RLI.MEMO_ID
, DW_RECEIVABLE_LINE_ITEMS_PROCESS_ALLOCATION_ID = RLI.PROCESS_ALLOCATION_ID
, DW_RECEIVABLE_LINE_ITEMS_TRANSFER_ACTOR_NBR = RLI.TRANSFER_ACTOR_NBR
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_TAX_CODE_CODE = RLI.PAYMENT_TAX_CODE_CODE
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_TAX_CODE_DESC = RLI.PAYMENT_TAX_CODE_DESC
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_SCHED_TYPE_CODE = RLI.PAYMENT_SCHED_TYPE_CODE
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_SCHED_TYPE_DESC = RLI.PAYMENT_SCHED_TYPE_DESC
, DW_RECEIVABLE_LINE_ITEMS_ELEMENT_DESC = RLI.ELEMENT_DESC
, DW_RECEIVABLE_LINE_ITEMS_PAYABLE_ID = RLI.PAYABLE_ID
, DW_RECEIVABLE_LINE_ITEMS_PAYABLE_LINE_ITEM_NBR = RLI.PAYABLE_LINE_ITEM_NBR
, DW_RECEIVABLE_LINE_ITEMS_ORIGINAL_CREDIT_NOTE_ID = RLI.ORIGINAL_CREDIT_NOTE_ID
, DW_RECEIVABLE_LINE_ITEMS_ORIGINAL_CREDIT_NOTE_LINE_NBR = RLI.ORIGINAL_CREDIT_NOTE_LINE_NBR
, DW_RECEIVABLE_LINE_ITEMS_PRE_TAX_AMT = RLI.PRE_TAX_AMT
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_CODE_CODE = RLI.PAYMENT_CODE_CODE
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_CODE_DESC = RLI.PAYMENT_CODE_DESC
, DW_RECEIVABLE_LINE_ITEMS_WORK_ID = RLI.WORK_ID
, DW_RECEIVABLE_LINE_ITEMS_BUDGET_ORDER_NBR = RLI.BUDGET_ORDER_NBR
, DW_RECEIVABLE_LINE_ITEMS_ANNUAL_RATE_PCT = RLI.ANNUAL_RATE_PCT
, DW_RECEIVABLE_LINE_ITEMS_ELEMENT_NBR = RLI.ELEMENT_NBR
, DW_RECEIVABLE_LINE_ITEMS_PAYMENT_NBR = RLI.PAYMENT_NBR
, DW_RECEIVABLE_LINE_ITEMS_CONSTRUCTION_STEP_NBR = RLI.CONSTRUCTION_STEP_NBR
, DW_RECEIVABLE_LINE_ITEMS_PRETAX_PASSIVE_ELEMENT_AMT = RLI.PRETAX_PASSIVE_ELEMENT_AMT
, DW_RECEIVABLE_LINE_ITEMS_PASSIVE_ELEMENT_PRINCIPAL_AMT = RLI.PASSIVE_ELEMENT_PRINCIPAL_AMT
, DW_RECEIVABLE_LINE_ITEMS_TAX_CODE = RLI.TAX_CODE
, DW_RECEIVABLE_LINE_ITEMS_FOREIGN_EXCHANGE_RATE_PCT = RLI.FOREIGN_EXCHANGE_RATE_PCT
, DW_RECEIVABLE_LINE_ITEMS_ORIGINAL_CURRENCY_CODE = RLI.ORIGINAL_CURRENCY_CODE
, DW_RECEIVABLE_LINE_ITEMS_ORIGINAL_CURRENCY_DESC = RLI.ORIGINAL_CURRENCY_DESC
, DW_RECEIVABLE_LINE_ITEMS_INTEREST_IND = RLI.INTEREST_IND
, DW_RECEIVABLE_LINE_ITEMS_TAX_ESCROW_IND = RLI.TAX_ESCROW_IND
, DW_RECEIVABLE_LINE_ITEMS_INS_ESCROW_IND = RLI.INS_ESCROW_IND
, DW_RECEIVABLE_LINE_ITEMS_RES_ESCROW_IND = RLI.RES_ESCROW_IND
, DW_RECEIVABLE_LINE_ITEMS_LATE_CHARGE_IND = RLI.LATE_CHARGE_IND
, DW_RECEIVABLE_LINE_ITEMS_FEES_IND = RLI.FEES_IND
, DW_RECEIVABLE_LINE_ITEMS_SERVICE_FEES_IND = RLI.SERVICE_FEES_IND
, DW_RECEIVABLE_LINE_ITEMS_TAX_DESC = RLI.TAX_DESC
, DW_RECEIVABLE_LINE_ITEMS_OTHER_IND = RLI.OTHER_IND
, DW_RECEIVABLE_LINE_ITEMS_ADDRESS_ID = RLI.ADDRESS_ID
, DW_RECEIVABLE_DETAILS_RECEIVABLE_ID = RD.RECEIVABLE_ID
, DW_RECEIVABLE_DETAILS_PAYABLE_ID = RD.PAYABLE_ID
, DW_RECEIVABLE_DETAILS_PAYABLE_NUMBER_DESC = RD.PAYABLE_NUMBER_DESC
, DW_RECEIVABLE_DETAILS_CONTRACT_AMENDMENT_NBR = RD.CONTRACT_AMENDMENT_NBR
, DW_RECEIVABLE_DETAILS_SYNDICATION_ID = RD.SYNDICATION_ID
, DW_RECEIVABLE_DETAILS_NOMENCLATURE_CODE = RD.NOMENCLATURE_CODE
, DW_RECEIVABLE_DETAILS_NOMENCLATURE_DESC = RD.NOMENCLATURE_DESC
, DW_RECEIVABLE_DETAILS_ELEMENT_NBR = RD.ELEMENT_NBR
, DW_RECEIVABLE_DETAILS_PROPERTY_ID = RD.PROPERTY_ID
, DW_RECEIVABLE_DETAILS_INVESTMENT_ID = RD.INVESTMENT_ID
, DW_RECEIVABLE_DETAILS_SORT_ORDER_CODE = RD.SORT_ORDER_CODE
, DW_RECEIVABLE_DETAILS_ORDER_NBR = RD.ORDER_NBR
, DW_RECEIVABLE_DETAILS_SORT_ORDER_DESC = RD.SORT_ORDER_DESC
, DW_RECEIVABLE_DETAILS_DRAW_ID = RD.DRAW_ID
, DW_RECEIVABLE_DETAILS_DELIVERY_TYPE_CODE = RD.DELIVERY_TYPE_CODE
, DW_RECEIVABLE_DETAILS_DELIVERY_TYPE_DESC = RD.DELIVERY_TYPE_DESC
, DW_RECEIVABLE_DETAILS_CURRENT_TURN_AMT = RD.CURRENT_TURN_AMT
, DW_RECEIVABLE_DETAILS_REMAINING_TURNS_AMT = RD.REMAINING_TURNS_AMT
, DW_RECEIVABLE_DETAILS_LOAN_BALANCE_AMT = RD.LOAN_BALANCE_AMT
, DW_RECEIVABLE_DETAILS_PRINCIPAL_PAID_AMT = RD.PRINCIPAL_PAID_AMT
, DW_RECEIVABLE_DETAILS_PREVIOUS_MONTHLY_UNPAID_AMT = RD.PREVIOUS_MONTHLY_UNPAID_AMT
, DW_RECEIVABLE_DETAILS_PREVIOUS_OVERPAID_AMT = RD.PREVIOUS_OVERPAID_AMT
, DW_RECEIVABLE_DETAILS_DIM_DATE_KEY = RD.DIM_DATE_KEY
, DW_RECEIVABLE_DETAILS_PREV_MNT_DELINQUENT_PRINC_AMT = RD.PREV_MNT_DELINQUENT_PRINC_AMT
, DW_RECEIVABLE_DETAILS_LATE_CHARGE_AMT = RD.LATE_CHARGE_AMT
, DW_RECEIVABLE_DETAILS_PREV_MNT_DELINQUENT_TOTAL_AMT = RD.PREV_MNT_DELINQUENT_TOTAL_AMT
, DW_RECEIVABLE_DETAILS_CURR_MNT_BILLING_TOTAL_AMT = RD.CURR_MNT_BILLING_TOTAL_AMT
, DW_RECEIVABLE_DETAILS_RUN_ID = RD.RUN_ID
, DW_RECEIVABLE_DETAILS_CONTRACT_ID = RD.CONTRACT_ID
, DW_RECEIVABLE_DETAILS_CONTRACT_NUMBER_DESC = RD.CONTRACT_NUMBER_DESC
, DW_RECEIVABLE_DETAILS_DESCRIPTION_DESC = RD.DESCRIPTION_DESC
, DW_RECEIVABLE_DETAILS_CUSTOMER_COMMENT_DESC = RD.CUSTOMER_COMMENT_DESC
, DW_RECEIVABLE_DETAILS_CUSTOMER_REFERENCE_DESC = RD.CUSTOMER_REFERENCE_DESC
, DW_TRANSACTION_LINE_ITEMS_TRANSACTION_ID = TLI.TRANSACTION_ID
, DW_TRANSACTION_LINE_ITEMS_CURRENCY_DESC = TLI.CURRENCY_DESC
, DW_TRANSACTION_LINE_ITEMS_CONVERTED_ACCOUNTING_AMT = TLI.CONVERTED_ACCOUNTING_AMT
, DW_TRANSACTION_LINE_ITEMS_ACCTNG_CONVERSION_RATE_PCT = TLI.ACCTNG_CONVERSION_RATE_PCT
, DW_TRANSACTION_LINE_ITEMS_PAYABLE_ORDER_NBR = TLI.PAYABLE_ORDER_NBR
, DW_TRANSACTION_LINE_ITEMS_EXCHANGE_RATE_DIFF_AMT = TLI.EXCHANGE_RATE_DIFF_AMT
, DW_TRANSACTION_LINE_ITEMS_DEBIT_CREDIT_DESC = TLI.DEBIT_CREDIT_DESC
, DW_TRANSACTION_LINE_ITEMS_RECEIVABLE_ORDER_NBR = TLI.RECEIVABLE_ORDER_NBR
, DW_TRANSACTION_LINE_ITEMS_RECONCILIATION_REFERENCE_DESC = TLI.RECONCILIATION_REFERENCE_DESC
, DW_TRANSACTION_LINE_ITEMS_INVESTMENT_ID = TLI.INVESTMENT_ID
, DW_TRANSACTION_LINE_ITEMS_CONTRACT_ID = TLI.CONTRACT_ID
, DW_TRANSACTION_LINE_ITEMS_TRANSACTION_LINE_ITEM_NBR = TLI.TRANSACTION_LINE_ITEM_NBR
, DW_TRANSACTION_LINE_ITEMS_REAL_ESTATE_ID = TLI.REAL_ESTATE_ID
, DW_TRANSACTION_LINE_ITEMS_FISCAL_REGIME_CODE = TLI.FISCAL_REGIME_CODE
, DW_TRANSACTION_LINE_ITEMS_FISCAL_REGIME_DESC = TLI.FISCAL_REGIME_DESC
, DW_TRANSACTION_LINE_ITEMS_BATCH_RUN_ID = TLI.BATCH_RUN_ID
, DW_TRANSACTION_LINE_ITEMS_PAYMENT_ALLOCATION_TYPE_CODE = TLI.PAYMENT_ALLOCATION_TYPE_CODE
, DW_TRANSACTION_LINE_ITEMS_PAYMENT_ALLOCATION_TYPE_DESC = TLI.PAYMENT_ALLOCATION_TYPE_DESC
, DW_TRANSACTION_LINE_ITEMS_DRAW_PAYABLE_ID = TLI.DRAW_PAYABLE_ID
, DW_TRANSACTION_LINE_ITEMS_PARTIAL_REIMBURS_ELEMENT_NBR = TLI.PARTIAL_REIMBURS_ELEMENT_NBR
, DW_TRANSACTION_LINE_ITEMS_BANK_ACCOUNT_ID = TLI.BANK_ACCOUNT_ID
, DW_TRANSACTION_LINE_ITEMS_TRANSFER_TRANSACTION_ID = TLI.TRANSFER_TRANSACTION_ID
, DW_TRANSACTION_LINE_ITEMS_DIM_DATE_KEY = TLI.DIM_DATE_KEY
, DW_TRANSACTION_LINE_ITEMS_REJECTION_TRANSACTION_ID = TLI.REJECTION_TRANSACTION_ID
, DW_TRANSACTION_LINE_ITEMS_CUSTOMER_ACTOR_ID = TLI.CUSTOMER_ACTOR_ID
, DW_TRANSACTION_LINE_ITEMS_TRANSACTION_TYPE_CODE = TLI.TRANSACTION_TYPE_CODE
, DW_TRANSACTION_LINE_ITEMS_TRANSACTION_TYPE_DESC = TLI.TRANSACTION_TYPE_DESC
, DW_TRANSACTION_LINE_ITEMS_CURRENCY_EXCHANGE_RATE_PCT = TLI.CURRENCY_EXCHANGE_RATE_PCT
, DW_TRANSACTION_LINE_ITEMS_CONTRACT_CURRENCY_AMT = TLI.CONTRACT_CURRENCY_AMT
, DW_TRANSACTION_LINE_ITEMS_CONTRACT_CURRENCY_CODE = TLI.CONTRACT_CURRENCY_CODE
, DW_TRANSACTION_LINE_ITEMS_CONTRACT_CURRENCY_DESC = TLI.CONTRACT_CURRENCY_DESC
, DW_TRANSACTION_LINE_ITEMS_CONSOLIDATED_CURRENCY_CODE = TLI.CONSOLIDATED_CURRENCY_CODE
, DW_TRANSACTION_LINE_ITEMS_CONSOLIDATED_CURRENCY_DESC = TLI.CONSOLIDATED_CURRENCY_DESC
, DW_TRANSACTION_LINE_ITEMS_RUN_ID = TLI.RUN_ID
, DW_TRANSACTION_LINE_ITEMS_CONS_CURRENCY_INC_TAX_AMT = TLI.CONS_CURRENCY_INC_TAX_AMT
, DW_TRANSACTION_LINE_ITEMS_CONS_EXCHANGE_RATE_PCT = TLI.CONS_EXCHANGE_RATE_PCT
, DW_TRANSACTION_LINE_ITEMS_EXCHANGE_GAP_AMT = TLI.EXCHANGE_GAP_AMT
, DW_TRANSACTION_LINE_ITEMS_REASON_CODE = TLI.REASON_CODE
, DW_TRANSACTION_LINE_ITEMS_REASON_DESC = TLI.REASON_DESC
, DW_TRANSACTION_LINE_ITEMS_CONTRACT_BUSINESS_TYPE_CODE = TLI.CONTRACT_BUSINESS_TYPE_CODE
, DW_TRANSACTION_LINE_ITEMS_CONTRACT_BUSINESS_TYPE_DESC = TLI.CONTRACT_BUSINESS_TYPE_DESC
, DW_TRANSACTION_LINE_ITEMS_INTEREST_IND = TLI.INTEREST_IND
, DW_TRANSACTION_LINE_ITEMS_PRINCIPAL_IND = TLI.PRINCIPAL_IND
, DW_TRANSACTION_LINE_ITEMS_TAX_ESCROW_IND = TLI.TAX_ESCROW_IND
, DW_TRANSACTION_LINE_ITEMS_PAYABLE_ID = TLI.PAYABLE_ID
, DW_TRANSACTION_LINE_ITEMS_INSURANCE_ESCROW_IND = TLI.INSURANCE_ESCROW_IND
, DW_TRANSACTION_LINE_ITEMS_RESERVE_ESCROW_IND = TLI.RESERVE_ESCROW_IND
, DW_TRANSACTION_LINE_ITEMS_SUSPENSE_IND = TLI.SUSPENSE_IND
, DW_TRANSACTION_LINE_ITEMS_BORROWER_ADVANCE_IND = TLI.BORROWER_ADVANCE_IND
, DW_TRANSACTION_LINE_ITEMS_TAX_ESCROW_ADVANCE_IND = TLI.TAX_ESCROW_ADVANCE_IND
, DW_TRANSACTION_LINE_ITEMS_INSURANCE_ESCROW_ADVANCE_IND = TLI.INSURANCE_ESCROW_ADVANCE_IND
, DW_TRANSACTION_LINE_ITEMS_OTHER_ADVANCE_IND = TLI.OTHER_ADVANCE_IND
, DW_TRANSACTION_LINE_ITEMS_NON_RECOVERABLE_ADVANCE_IND = TLI.NON_RECOVERABLE_ADVANCE_IND
, DW_TRANSACTION_LINE_ITEMS_CAPITALIZED_INTEREST_IND = TLI.CAPITALIZED_INTEREST_IND
, DW_TRANSACTION_LINE_ITEMS_RECEIVABLE_ID = TLI.RECEIVABLE_ID
, DW_TRANSACTION_LINE_ITEMS_PAID_AMT = TLI.PAID_AMT
, DW_TRANSACTION_LINE_ITEMS_PROCESS_ALLOCATION_ID = TLI.PROCESS_ALLOCATION_ID
, DW_TRANSACTION_LINE_ITEMS_CURRENCY_CODE = TLI.CURRENCY_CODE
, DW_TRANSACTIONS_TRANSACTION_ID = DT.TRANSACTION_ID
, DW_TRANSACTIONS_MANDATE_ID = DT.MANDATE_ID
, DW_TRANSACTIONS_REFERENCE_DESC = DT.REFERENCE_DESC
, DW_TRANSACTIONS_PAYMENT_DT = DT.PAYMENT_DT
, DW_TRANSACTIONS_VALUE_DT = DT.VALUE_DT
, DW_TRANSACTIONS_ENTRY_DT = DT.ENTRY_DT
, DW_TRANSACTIONS_PAYMENT_TYPE_CODE = DT.PAYMENT_TYPE_CODE
, DW_TRANSACTIONS_PAYMENT_TYPE_DESC = DT.PAYMENT_TYPE_DESC
, DW_TRANSACTIONS_VOUCHER_ID = DT.VOUCHER_ID
, DW_TRANSACTIONS_ACTOR_ID = DT.ACTOR_ID
, DW_TRANSACTIONS_BANK_ACCOUNT_ID = DT.BANK_ACCOUNT_ID
, DW_TRANSACTIONS_DIM_DATE_KEY = DT.DIM_DATE_KEY
, DW_TRANSACTIONS_ACTOR_ADDRESS_ORDER_NBR = DT.ACTOR_ADDRESS_ORDER_NBR
, DW_TRANSACTIONS_BANK_PAYMENT_ID = DT.BANK_PAYMENT_ID
, DW_TRANSACTIONS_PAYMENT_METHOD_CODE = DT.PAYMENT_METHOD_CODE
, DW_TRANSACTIONS_PAYMENT_METHOD_DESC = DT.PAYMENT_METHOD_DESC
, DW_TRANSACTIONS_REJECTION_DT = DT.REJECTION_DT
, DW_TRANSACTIONS_APPROVAL_DT = DT.APPROVAL_DT
, DW_TRANSACTIONS_TRANSACTION_AMT = DT.TRANSACTION_AMT
, DW_TRANSACTIONS_COMMENT_DESC = DT.COMMENT_DESC
, DW_TRANSACTIONS_REJECTION_COST_TAX_AMT = DT.REJECTION_COST_TAX_AMT
, DW_TRANSACTIONS_REJECTION_COST_PRETAX_AMT = DT.REJECTION_COST_PRETAX_AMT
, DW_TRANSACTIONS_RUN_ID = DT.RUN_ID
, DW_TRANSACTIONS_BANK_BRANCH_DESC = DT.BANK_BRANCH_DESC
, DW_TRANSACTIONS_CHECK_NUMBER_DESC = DT.CHECK_NUMBER_DESC
, DW_TRANSACTIONS_VALID_IND = DT.VALID_IND
, DW_TRANSACTIONS_BATCH_PROCESS_ID = DT.BATCH_PROCESS_ID
, DW_TRANSACTIONS_EVENT_ID = DT.EVENT_ID
, DW_TRANSACTIONS_REJECTION_PROCESS_ID = DT.REJECTION_PROCESS_ID
, DW_TRANSACTIONS_BATCH_RUN_ID = DT.BATCH_RUN_ID
, DW_TRANSACTIONS_FIRST_CHECK_NBR_PRINT_DESC = DT.FIRST_CHECK_NBR_PRINT_DESC
, DW_TRANSACTIONS_BDOC_PRINT_IN_PROCESS_IND = DT.BDOC_PRINT_IN_PROCESS_IND
, DW_TRANSACTIONS_REGDTEDLCHEXTERNE_DT = DT.REGDTEDLCHEXTERNE_DT
, DW_TRANSACTIONS_REJECTION_ID = DT.REJECTION_ID
, DW_TRANSACTIONS_RECONCILIATION_DT = DT.RECONCILIATION_DT
, DW_TRANSACTIONS_RECONCILIATION_REJECT_DT = DT.RECONCILIATION_REJECT_DT
, DW_TRANSACTIONS_RECONCILIATION_BATCH_ID = DT.RECONCILIATION_BATCH_ID
, DW_TRANSACTIONS_OUTPUT_FILE_GEN_DT = DT.OUTPUT_FILE_GEN_DT
, DW_TRANSACTIONS_REJECTS_FILE_GEN_DT = DT.REJECTS_FILE_GEN_DT
, DW_TRANSACTIONS_ASYNC_MODE_STATUS_CODE = DT.ASYNC_MODE_STATUS_CODE
, DW_TRANSACTIONS_ASYNC_MODE_STATUS_DESC = DT.ASYNC_MODE_STATUS_DESC
, DW_TRANSACTIONS_BANK_ACCOUNT_SEPA_ID = DT.BANK_ACCOUNT_SEPA_ID
, DW_TRANSACTIONS_MANDATE_ORDER_NBR = DT.MANDATE_ORDER_NBR
, DW_TRANSACTIONS_SEPA_CONTRACT_ID = DT.SEPA_CONTRACT_ID
, DW_TRANSACTIONS_COMPANY_ACTOR_ID = DT.COMPANY_ACTOR_ID
, DW_TRANSACTIONS_CARD_ID = DT.CARD_ID
, DW_TRANSACTIONS_REQUESTED_AMT = DT.REQUESTED_AMT
, DW_TRANSACTIONS_PTP_TYPE_CODE = DT.PTP_TYPE_CODE
, DW_TRANSACTIONS_PTP_TYPE_DESC = DT.PTP_TYPE_DESC
, DW_TRANSACTIONS_AUN_ORDER_NBR = DT.AUN_ORDER_NBR
, DW_TRANSACTIONS_TRANSFERRED_IND = DT.TRANSFERRED_IND
, DW_TRANSACTIONS_EXCLUDE_SUSPENSE_IND = DT.EXCLUDE_SUSPENSE_IND
, DW_TRANSACTIONS_CREATED_BY_CODE = DT.CREATED_BY_CODE
, DW_TRANSACTIONS_CREATED_BY_DESC = DT.CREATED_BY_DESC
, DW_TRANSACTIONS_CURRENCY_CODE = DT.CURRENCY_CODE
, DW_TRANSACTIONS_CURRENCY_DESC = DT.CURRENCY_DESC
FROM   DW_RECEIVABLES R
INNER JOIN [dbo].DW_RECEIVABLE_LINE_ITEMS RLI
       ON R.RECEIVABLE_ID = RLI.RECEIVABLE_ID
              AND R.DIM_DATE_KEY = RLI.DIM_DATE_KEY
              AND R.RUN_ID = RLI.RUN_ID
INNER JOIN [dbo].DW_RECEIVABLE_DETAILS RD
       ON RLI.RECEIVABLE_ID = RD.RECEIVABLE_ID
              AND RLI.RECEIVABLE_LINE_ITEM_NBR = RD.ORDER_NBR
              AND RLI.DIM_DATE_KEY = RD.DIM_DATE_KEY
              AND RLI.RUN_ID = RD.RUN_ID
INNER JOIN [dbo].[DW_TRANSACTION_LINE_ITEMS] TLI
	  ON RLI.RECEIVABLE_LINE_ITEM_NBR= TLI.RECEIVABLE_ORDER_NBR
	 AND  RLI.RECEIVABLE_ID = TLI.RECEIVABLE_ID
	 AND  RLI.DIM_DATE_KEY = RD.DIM_DATE_KEY
	 AND  RLI.RUN_ID = RD.RUN_ID
INNER JOIN [dbo].[DW_TRANSACTIONS] DT
	  ON TLI.TRANSACTION_ID = DT.TRANSACTION_ID
	 AND  TLI.DIM_DATE_KEY = DT.DIM_DATE_KEY
	 AND  TLI.RUN_ID = DT.RUN_ID
	 --AND  DT.[REJECTION_DT] IS NULL
GO
/****** Object:  View [rpt].[VW_UnderlyingFacility]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE VIEW [rpt].[VW_UnderlyingFacility]
AS
SELECT 
          FAC.CONTRACT_ID,
          DEAL.DEAL_ID,
          DEAL.DEAL_VERSION_CODE,
          DEAL.PRODUCT_CODE AS Deal_PRODUCT_CODE,
          --FAC.CONTRACT_ID,
          FAC.DIM_DATE_KEY,
          FAC.RUN_ID,
          FAC.CURRENCY_CODE,
          FAC.CURRENCY_DESC,
          FAC.COMPANY_ACTOR_ID,
          FAC.USERNAME_CODE,
          FAC.USERNAME_DESC,
          FAC.BUSINESS_TYPE_CODE,
          FAC.BUSINESS_TYPE_DESC,
          FAC.CONTRACT_NUMBER_DESC,
          FAC.CONTRACT_NAME_DESC,
          -- MANDATE_ID,
          FAC.CONTRACT_AMENDMENT_NBR,
          FAC.CONTRACT_STATUS_CODE,
          FAC.CONTRACT_STATUS_DESC,
          FAC.TERM_IN_DAYS_NBR,
          FAC.TERM_IN_MONTHS_NBR,
          FAC.TERM_IN_YEARS_NBR,
          FAC.CONTRACT_START_DT,
          FAC.CONTRACT_END_DT,
          FAC.LAST_UPDATE_DT,
          FAC.SIGNATURE_DT,
          --PUT_OPTION_DT,
          FAC.COMMITTEE_APPROVAL_DT,
          FAC.LEASE_START_DT,
          FAC.CONTRACT_1ST_ENTRY_DT,
          FAC.REG_PAYMENTS_START_DT,
          --DOSPREAVIS_NBR,
          FAC.EARLY_PAYOFF_PENALTY_TYPE_CODE,
          FAC.EARLY_PAYOFF_PENALTY_TYPE_DESC,
          FAC.PENALTY_AMT,
          FAC.FISCAL_REGIME_CODE,
          FAC.FISCAL_REGIME_DESC,
          FAC.SYNDICATION_CODE,
          FAC.SYNDICATION_DESC,
          FAC.INITIAL_CONTRACT_RATE_PCT,
          FAC.NEGOTIATED_RATE_PCT,
          FAC.EXPECTED_MARGIN_RATE_PCT,
          FAC.REVISABLE_IND,
          FAC.FINANCING_TYPE_CODE,
          FAC.FINANCING_TYPE_DESC,
          FAC.REVISED_TERM_IN_YEARS_NBR,
          FAC.REVISED_TERM_IN_MONTHS_NBR,
          FAC.REVISED_TERM_IN_DAYS_NBR,
          FAC.SIGNED_AMT,
          FAC.COMMITTEE_AMT,
          FAC.CREATION_AMT,
          FAC.IN_SERVICE_AMT,
          FAC.PRODUCT_CODE AS FAC_Product_Code,
          FAC.PRODUCT_DESC,
          FAC.DEPARTMENT_CODE,
          FAC.DEPARTMENT_DESC,
          FAC.SCHEDULE_TYPE_CODE,
          FAC.SCHEDULE_TYPE_DESC,
          FAC.EXPECTED_MARGIN_AMT,
          FAC.REFINANCING_CONTRACT_ID,
          FAC.STRUCTURED_FINANCING_TYPE_CODE,
          FAC.STRUCTURED_FINANCING_TYPE_DESC,
          FAC.LUMP_SUM_ADDED_AMT,
          FAC.EARLY_TERM_PENALTY_PCT,
          FAC.US_GAAP_CODE,
          FAC.US_GAAP_DESC,
          FAC.CANCEL_PENALTY_CALC_TYPE_CODE,
          FAC.CANCEL_PENALTY_CALC_TYPE_DESC,
          FAC.LUMP_SUM_CANCELLATION_COMP_AMT,
          FAC.EARLY_TERMINATION_RATE_PCT,
          FAC.ASSET_CLASS_CODE,
          FAC.ASSET_CLASS_DESC,
          FAC.COUNTRY_CODE,
          FAC.COUNTRY_DESC,
          -- DOSFLAGRESTRUCT_IND,
          -- DOSDTDEBRESTRUCT_DT,
          -- TRANSFERABILITY_CODE,
          -- TRANSFERABILITY_DESC,
          -- CONFIDENTIAL_IND,
          FAC.EFFECTIVE_CALCULATED_RATE_PCT,
          -- IAS_FISCAL_YEAR_NBR,
          -- IAS_CONTRACT_CLASS_CODE,
          -- IAS_CONTRACT_CLASS_DESC,
          -- MICROCOVERED_IND,
          -- SPECIFIC_ASSET_NATURE_IND,
          -- RENT_AT_TERMINATION_IND,
          -- OWNERSHIP_TRANSFER_AT_TERM_IND,
          -- ASSET_LIFE_SPAN_IN_YEARS_NBR,
          -- AUTO_INVOICE_RESIDUAL_IND,
          -- RESIDUAL_LIFESPAN_MONTHS_NBR,
          -- RESIDUAL_LIFESPAN_DAYS_NBR,
          -- INITIAL_FAIR_VALUE_AMT,
          -- RELATED_CONTRACT_ID,
          -- ACTUARIAL_RATE_PCT,
          -- IAS_CLASS_UPDATE_IND,
          -- FORCED_CLASS_REASON_DESC,
          FAC.BAD_DEBT_IND,
          FAC.BAD_DEBT_LAST_XFER_DT,
          FAC.RATE_CODE,
          FAC.RATE_DESC,
          -- IAS_MARKET_CODE,
          -- IAS_MARKET_DESC,
          -- IAS_PRODUCT_CODE,
          -- IAS_PRODUCT_DESC,
          -- MARKET_RATE_VALUE_PCT,
          -- MARKET_RATE_GAP_FOR_CLASS_PCT,
          -- MARKET_RATE_GAP_FOR_IRREV_PCT,
          -- INITIAL_DISCOUNT_AMT,
          -- HEDGING_CATEGORY_CODE,
          -- HEDGING_CATEGORY_DESC,
          FAC.CALENDAR_CODE,
          FAC.CALENDAR_DESC,
          FAC.COMMITMENT_END_DT,
          FAC.CONTRACT_COMMENT_DESC,
          -- EXTERNAL_REFERENCE_DESC,
          -- COMMERCIAL_NETWORK_CODE,
          -- COMMERCIAL_NETWORK_DESC,
          -- STATE_COUNTRY_CODE,
          -- STATE_COUNTRY_DESC,
          -- STATE_CODE,
          -- STATE_DESC,
          -- STATE_TYPE_CODE,
          -- STATE_TYPE_DESC,
          FAC.CONTRACT_VERSION_DESC,
          FAC.PRICING_CRITERIA_ID,
          FAC.PRICING_CRITERIA_ORDER_NBR,
          FAC.ANNUAL_USAGE_AMT,
          -- UNIT_OF_MEASURE_CODE,
          -- UNIT_OF_MEASURE_DESC,
          -- PURCHASE_USAGE_AMT,
          -- EXTERNAL_GRADE_CODE,
          -- EXTERNAL_GRADE_DESC,
          -- EXCESS_COST_USE_AMT,
          -- SUBVENTION_TYPE_CODE,
          -- SUBVENTION_TYPE_DESC,
          FAC.MASTER_FACILITY_TYPE_CODE,
          FAC.MASTER_FACILITY_TYPE_DESC,
          FAC.DISCOUNT_INTEREST_RATE_PCT,
          FAC.CONTRACT_TYPE_CODE,
          FAC.CONTRACT_TYPE_DESC,
          -- PROJECT_FINANCING_AMT,
          FAC.PROJECT_FINANCING_DURATION_NBR,
          FAC.PROJECT_FINANCING_CONTRACT_AMT,
          FAC.CONSTRUCTION_DURATION_NBR,
          FAC.GUARANTEE_AMT,
          FAC.MATURITY_DT
          -- COLLATERAL_CREDIT_LIMIT_AMT,
          -- SALES_CREDIT_LIMIT_AMT,
          -- STRAT_DLR_BLOCK_CRED_LIMIT_AMT,
          -- IPD_DT
FROM DW_CONTRACTS FAC
          INNER JOIN DW_DEALS_FO DEAL
             ON DEAL.DEAL_ID=FAC.CONTRACT_ID
                AND DEAL.DEAL_VERSION_CODE='PROD'
                AND DEAL.PRODUCT_CODE NOT LIKE 'AUT%'
	AND DEAL.RUN_ID = FAC.RUN_ID
GO
/****** Object:  Index [DW_CONTRACT_GUARANTEE_KEY_INDEX]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE UNIQUE NONCLUSTERED INDEX [DW_CONTRACT_GUARANTEE_KEY_INDEX] ON [dbo].[DW_CONTRACT_GUARANTEE]
(
	[CONTRACT_ID] ASC,
	[ACTOR_ORDER_NBR] ASC,
	[ORDER_NBR] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [DW_DEAL_CHARACTERISTICS_KEY_INDEX]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE UNIQUE NONCLUSTERED INDEX [DW_DEAL_CHARACTERISTICS_KEY_INDEX] ON [dbo].[DW_DEAL_CHARACTERISTICS]
(
	[DEAL_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [DW_GRID_CHARACTERISTIC_KEY_INDEX]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE UNIQUE NONCLUSTERED INDEX [DW_GRID_CHARACTERISTIC_KEY_INDEX] ON [dbo].[DW_GRID_CHARACTERISTICS]
(
	[GRID_CHARACTERISTIC_ID] ASC,
	[RUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [DW_INVOLVED_USER_KEY_INDEX]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE UNIQUE NONCLUSTERED INDEX [DW_INVOLVED_USER_KEY_INDEX] ON [dbo].[DW_INVOLVED_USER]
(
	[CONTRACT_ID] ASC,
	[DIM_DATE_KEY] ASC,
	[RUN_ID] ASC,
	[DEPARTMENT_CODE] ASC,
	[BUSINESS_CODE] ASC,
	[USER_BY_CODE] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [idx_BatchControl_01]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE NONCLUSTERED INDEX [idx_BatchControl_01] ON [kpods].[BatchControl]
(
	[BatchType] ASC,
	[KPLastRunId] ASC,
	[BatchStatus] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [idx_BatchRunInfo_01]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE NONCLUSTERED INDEX [idx_BatchRunInfo_01] ON [kpods].[BatchRunInfo]
(
	[KPRunId] ASC,
	[RunStatus] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IDX_CLMSTR_PROCESS_ALLOCATIONS]    Script Date: 8/24/2016 11:31:11 AM ******/
CREATE NONCLUSTERED COLUMNSTORE INDEX [IDX_CLMSTR_PROCESS_ALLOCATIONS] ON [dbo].[DW_PROCESS_ALLOCATIONS]
(
	[PROCESS_ALLOCATION_ID],
	[DIM_DATE_KEY],
	[RUN_ID],
	[PROCESS_ALLOCATION_CODE],
	[PROCESS_ALLOCATION_DESC],
	[INTEREST_IND],
	[TAX_ESCROW_IND],
	[INSURANCE_ESCROW_IND],
	[RESERVE_ESCROW_IND]
)WITH (DROP_EXISTING = OFF) ON [PRIMARY]
GO
ALTER TABLE [kpods].[BatchControl]  WITH NOCHECK ADD  CONSTRAINT [FK_BatchControl_BatchType] FOREIGN KEY([BatchType])
REFERENCES [kpods].[BatchType] ([BatchType])
GO
ALTER TABLE [kpods].[BatchControl] CHECK CONSTRAINT [FK_BatchControl_BatchType]
GO
ALTER TABLE [kpods].[BatchRunDomainLog]  WITH NOCHECK ADD  CONSTRAINT [FK_BatchRunDomainLog_BatchRunInfo] FOREIGN KEY([BatchID], [KPRunId])
REFERENCES [kpods].[BatchRunInfo] ([BatchID], [KPRunId])
GO
ALTER TABLE [kpods].[BatchRunDomainLog] CHECK CONSTRAINT [FK_BatchRunDomainLog_BatchRunInfo]
GO
ALTER TABLE [kpods].[BatchRunInfo]  WITH NOCHECK ADD  CONSTRAINT [FK_BatchRunInfo_BatchControl] FOREIGN KEY([BatchID])
REFERENCES [kpods].[BatchControl] ([BatchID])
GO
ALTER TABLE [kpods].[BatchRunInfo] CHECK CONSTRAINT [FK_BatchRunInfo_BatchControl]
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_Actor]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_Actor]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN

	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingDataActor AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.ManagementUnitCode
	,stg.JudicialCategoryCode
	,stg.LanguageCode
	,stg.CreatedByCode
	,stg.CountryCode
	,stg.ActorCode
	,stg.ShortName
	,stg.TradeName
	,stg.ModifiedByCode
	,stg.NAFCode
	,stg.CurrencyCode
	,stg.SecondTradeName
	,stg.FederalTaxIdNumber
	,stg.ProfessionalTaxIndicator
	,stg.FirstEntryDate
	,stg.LastUpdateDate
	,stg.EUVATCode
	,stg.CommercialRegistryTypeCode
	,stg.LastFiscalYearMonthNumber
	,stg.CompanyRegisterId
	,stg.Memo
	,stg.RegularCapitalAmount
	,stg.PrintOnCheck
	,stg.VATRegimeCode
	,stg.SupplierApprovalIndicator
	,stg.SupplierActorRelationLevelCode
	,stg.CompanyCreationDate
	,stg.NumberOfEmployees
	,stg.ActivityCode
	,stg.DeclassifyIndicator
	,stg.DomainCode
	,stg.CompoundingActorIndicator
	,stg.ActivityEffectiveDate
	,stg.ActivityCountryCode
	,stg.JudicialCategoryCountryCode
	,stg.ActorTypeCode
	,stg.CreationChannelCode
	,stg.CreationChannelActorCode
	,stg.ExternalDepartment
	,stg.HireDate
	,stg.ResidentCode
	,stg.Representative
	,stg.RepresentativeName
	,stg.Corporate
	,stg.GuarantorIndicator
	,stg.QualificationClassCode
	,stg.AsyncModeStatusCode
	,stg.EmployeeIdNumber)), 2) AS HashValue
	FROM Actor AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingDataActor AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingDataActor AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[Actor] AS txn ON (txn.ActorId = stg.ActorId AND txn.HashValue != stg.HashValue)
	),
	IncomingDataActor AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingDataActor AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[Actor] AS txn ON (txn.ActorId = stg.ActorId)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	)
	SELECT *
	FROM IncomingDataActor
	UNION
	SELECT *
	FROM UpdatingDataActor
	
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorAddress]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorAddress]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingDataActorAddress AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.AddressId
	,stg.ActorAddressLinkCreatedByCode
	,stg.EventId
	,stg.ReplacedByOrderNumber
	,stg.StartDate
	,stg.Complement
	,stg.ActorAddressLinkModifiedDate
	,stg.ReplacementDate
	,stg.HeadOfficeIndicator
	,stg.MailingAddressIndicator
	,stg.InvoicingAddressIndicator
	,stg.DeliveryAddressIndicator
	,stg.AddressTypeCode
	,stg.FlowChannelCode
	,stg.LastContactUsedDate
	,stg.ErrorCodeKP
	,stg.ContactResultCode
	,stg.ContactSuccessCode
	)), 2) AS HashValue
	FROM ActorAddress AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingDataActorAddress AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingDataActorAddress AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorAddress] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber = stg.OrderNumber 
	AND txn.HashValue != stg.HashValue)
	),
	IncomingDataActorAddress AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingDataActorAddress AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorAddress] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber = stg.OrderNumber)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.OrderNumber IS NULL
	)
	SELECT *
	FROM IncomingDataActorAddress
	UNION
	SELECT *
	FROM UpdatingDataActorAddress
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorBankAccount]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorBankAccount]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.ReplacingBankId
	,stg.EventId
	,stg.ReplacementDate
	,stg.StartDate
	,stg.AccountTypeCode
	,stg.IntermediateBankId
	,stg.AccountBlockedIndicator
	,stg.BlockingReasonCode
	,stg.BankProvidedCode
	,stg.DACOMCode
	,stg.DACOM2Code
	,stg.BankCodePassword
	,stg.AccountCheckDate
	,stg.CertLetterRequestIndicator
	,stg.CertRequestReasonCode
	,stg.SSN)), 2) AS HashValue
	FROM ActorBankAccount AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorBankAccount] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.BankAccountId = stg.BankAccountId
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorBankAccount] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.BankAccountId = stg.BankAccountId)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.BankAccountId IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorCharacteristic]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorCharacteristic]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.ActorId
	,stg.Characteristic
	,stg.DataType
	,stg.NumericValue
	,stg.StringValue
	,stg.DateValue
	,stg.BooleanValueIndicator)), 2) AS HashValue
	FROM ActorCharacteristic AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorCharacteristic] AS txn ON (txn.ActorCharacteristicId = stg.ActorCharacteristicId
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorCharacteristic] AS txn ON (txn.ActorCharacteristicId = stg.ActorCharacteristicId)
	WHERE stg.RunId = @_RunId
	AND txn.ActorCharacteristicId IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorCompany]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorCompany]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.BankIssuerCode
	,stg.TransmitterCode
	,stg.NormalDrawingCode
	,stg.TransferDrawingCode
	,stg.EffectiveDrawingCode
	,stg.ProcessAllocationID
	,stg.RateCode
	,stg.InterestCalcMothodCode
	,stg.CompanyLogo
	,stg.InterbankCode
	,stg.InvoicePaymentDelayNumber
	,stg.ServericCode
	,stg.DirectDebitCode
	,stg.PaymentValidDelayNumber
	,stg.LateChargeInvoicingIndicator
	,stg.LateChargeCheckIndicator
	,stg.MinimumInvoiceAmount
	,stg.FICPCode
	,stg.CalendarCode
	,stg.TAXRegimeCode
	,stg.LatePaymentMarginPercent
	,stg.SEPACreditorId
	,stg.CountryCode
	,stg.AccountingActorId)), 2) AS HashValue
	FROM ActorCompany AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorCompany] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorCompany] AS txn ON (txn.ActorId = stg.ActorId)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorCompanyRole]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorCompanyRole]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.RoleName
	,stg.PaymentMothodCode
	,stg.RateCode
	,stg.ProcessAllocationID
	,stg.InterestCalcMothodCode
	,stg.CashInPaymentMothodCode
	,stg.VARRateCeilingFormulaCode
	,stg.VARRateFloorFormulaCode
	,stg.EndDate
	,stg.PaymentGracePeriodCode
	,stg.StartBasisCode
	,stg.DaysInMonthOrFixedDayNumber
	,stg.EarlyPaymentRebatePercent
	,stg.LatePaymentIndicator
	,stg.SeparateInvoiceIndicator
	,stg.ForcedCheckPaymentIndicator
	,stg.LatePaymentMinimumBasisAmount
	,stg.LatePaymentLumpSumAmount
	,stg.FloorRatePercent
	,stg.CeilingRatePercent
	,stg.LatePaymentMarginPercent
	,stg.LatePaymentFixedRatePercent
	,stg.OpenRecAppliedPercent
	,stg.BlockRemindersCode
	,stg.NoRemindersReasonCode
	,stg.MeansOfTransferNoticeCode
	,stg.LatePaymentTriggerNumber
	,stg.LatePaymentToleranceNumber
	,stg.LatePaymentDelayNumber
	,stg.StopRemindersEndDate
	,stg.StopRemindersTypeCode
	,stg.LateChargeFloorTypeCode
	,stg.LateChargeCeilingTypeCode
	,stg.InvoicingOffsetCode
	,stg.GracePeriodCollRuleCode
	,stg.CardId
	,stg.PhaseCode
	,stg.StepCode
	,stg.TargetCode
	,stg.EventId
	,stg.ExternalReferenceCode
	,stg.FleetRegisterReasonCode
	,stg.CWBranchDepartmentCode
	,stg.CWRejectReasonCode
	,stg.VATPaidLocalCurrCollIndicator
	,stg.VATPaidLocalCurrDisbIndicator
	,stg.TerminationChannelCode
	,stg.TerminationReasonCode)), 2) AS HashValue
	FROM ActorCompanyRole AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorCompanyRole] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.RoleCode = stg.RoleCode
	AND txn.CompanyActorId = stg.CompanyActorId
	AND txn.ValidDate = stg.ValidDate 
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorCompanyRole] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.RoleCode = stg.RoleCode
	AND txn.CompanyActorId = stg.CompanyActorId
	AND txn.ValidDate = stg.ValidDate )
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.RoleCode IS NULL
	AND txn.ValidDate IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorContact]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorContact]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.ContactTypeCode
	,stg.ActorOrderNumber
	,stg.ContractID
	,stg.StartDate
	,stg.Memo
	,stg.BuildingId
	,stg.InvestmentId
	,stg.SiteId
	,stg.ReceivableId
	,stg.PayableId
	,stg.WorkOrderId
	,stg.TransactionId
	,stg.MandateId
	,stg.InsurancePolicyId
	,stg.ClaimId
	,stg.ServicingAgreementId
	,stg.TenderId
	,stg.NoteObjectCode
	,stg.ModifiedDate
	,stg.CovenantId
	,stg.CovenantOrderNumber
	,stg.ParentActorId
	,stg.ParentActorOrderNumber
	,stg.CreatedByCode
	,stg.EventId
	,stg.CollateralId
	,stg.ConfidentialityTypeCode
	,stg.MethodCode
	,stg.ReplyCode
	,stg.DealId
	,stg.NoteCharacterCode
	,stg.ResultLevel1
	,stg.ResultLevel2
	,stg.ResultLevel3
	,stg.CounselingTypeCode
	,stg.RespondedRelationCode
	,stg.RespondedPersonCode
	,stg.CallDurationNumber
	,stg.SourceNumber
	,stg.TargetNumber
	,stg.CounselingNumber
	,stg.NoteId
	,stg.ContactChannelCode
	,stg.CardId
	,stg.ApplicantTypeCode
	,stg.ContRelativeZipCode
	,stg.RelativeAddress
	,stg.RelativeSSN
	,stg.RelativeName
	,stg.RelativeCallTimeDate)), 2) AS HashValue
	FROM ActorContact AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorContact] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.OrderNumber = stg.OrderNumber
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorContact] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber = stg.OrderNumber)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.OrderNumber IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorCorrespondant]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorCorrespondant]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.Surname
	,stg.TitleCode
	,stg.PositionCode
	,stg.PreferredIndicator
	,stg.FirstName
	,stg.MiddleInitial
	,stg.StartDate
	,stg.EndDate
	,stg.CharacterCode
	,stg.DecisionPowerCode
	,stg.QualificationCode
	,stg.FederalTaxID
	,stg.BirthdayDate
	,stg.BirthdayCalendarCode
	,stg.WeddingDate
	,stg.SexNumber
	,stg.Memo
	,stg.MaritalStatusCode
	,stg.ForeignName
	,stg.EmployerActorId
	,stg.QualificationClassCode
	,stg.ContractID
	,stg.DealId
	,stg.ErrorCodeKP
	,stg.CustomerContactResultCode
	,stg.CustomerContactSuccessCode
	,stg.DecisionDate)), 2) AS HashValue
	FROM ActorCorrespondant AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorCorrespondant] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber = stg.OrderNumber 
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorCorrespondant] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber = stg.OrderNumber)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.OrderNumber IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorIndividual]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorIndividual]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.CountryCode
	,stg.BirthDate
	,stg.CountryOfBirthCode
	,stg.BirthPlaceCode
	,stg.NumberOfChildren
	,stg.GenderNumber
	,stg.EmployerReference
	,stg.MaritalStatusCode
	,stg.RealEStateOwnershipIndicator
	,stg.PositionCode
	,stg.MarriedName
	,stg.MaritalFiscalStatusCode
	,stg.TownOfBirth
	,stg.MaidenName
	,stg.BankRefusalIndicator
	,stg.CapitalOwnershipPercent
	,stg.YearsExpInBusinessTypeNumber
	,stg.YearsExperienceNumber
	,stg.EducationLevelCode
	,stg.InheritancePreparedIndicator
	,stg.KeyManInsuredIndicator
	,stg.MaritalFiscalStatusChangeCode
	,stg.HeadManagerIndicator
	,stg.HeadManagerFunctionCode
	,stg.DrivingTestPassedDate
	,stg.FirstName
	,stg.LastMarriageContractUpdDate
	,stg.BirthdayCalendarCode
	,stg.Analyst
	,stg.Executor
	,stg.ProbateCaseNumber
	,stg.DeathDate
	,stg.DeathCertificateDate
	,stg.InvolvedAssetCode
	,stg.StateCountryCode
	,stg.RegionCode
	,stg.StateTypeCode
	,stg.ProbateFiledDate
	,stg.ProbateOpenDate
	,stg.PostalCodePrefixCode)), 2) AS HashValue
	FROM ActorIndividual AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorIndividual] AS txn ON (txn.ActorId = stg.ActorId AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorIndividual] AS txn ON (txn.ActorId = stg.ActorId)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorPhase]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorPhase]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.Phase
	,stg.PhaseDestinationCode
	,stg.PhaseStepCode
	,stg.PhaseStartDate
	,stg.CreatedByCode
	,stg.EventId
	,stg.PhaseEndDate
	,stg.ModifiedDate)), 2) AS HashValue
	FROM ActorPhase AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorPhase] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber = stg.OrderNumber 
	AND txn.PhaseCode = stg.PhaseCode
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorPhase] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber = stg.OrderNumber
	AND txn.PhaseCode = stg.PhaseCode)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.OrderNumber IS NULL
	AND txn.PhaseCode IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorRelation]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorRelation]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.AscedingRelation
	,stg.DescendingRelation
	,stg.NumberOfSharesAmount
	,stg.EndDate
	,stg.FrontOfficeAggregateId
	,stg.CustomerIncomingPathCode
	,stg.RoleCode
	,stg.RoleRelationNumber)), 2) AS HashValue
	FROM ActorRelation AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorRelation] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.RelationCode = stg.RelationCode
	AND txn.RelatedActorId = stg.RelatedActorId
	AND txn.StartDate = stg.StartDate
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorRelation] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.RelationCode = stg.RelationCode
	AND txn.RelatedActorId = stg.RelatedActorId
	AND txn.StartDate = stg.StartDate)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.RelationCode IS NULL
	AND txn.RelatedActorId IS NULL
	AND txn.StartDate IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END

*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorRiskRating]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorRiskRating]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.Rating
	,stg.StartDate
	,stg.EventId
	,stg.CreatedByCode
	,stg.ModifiedDate
	,stg.EndDate
	,stg.CotationText
	,stg.LeadSubsidiaryCode
	,stg.RatingSubsidiaryCode
	,stg.OverrideIndicator
	,stg.Comment
	,stg.ScoreNumber
	,stg.RatingValidDate
	,stg.PeriodCode)), 2) AS HashValue
	FROM ActorRiskRating AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorRiskRating] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.OrderNumber != stg.OrderNumber
	AND txn.RatingCode != stg.RatingCode
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorRiskRating] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber != stg.OrderNumber
	AND txn.RatingCode != stg.RatingCode)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.OrderNumber IS NULL
	AND txn.RatingCode IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorRole]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorRole]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS
/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.RoleName
	,stg.OutvoiceCopiesNumber
	,stg.InvoiceRecapitulationCode
	,stg.InvoiceGroupingNumber
	,stg.DirectDebitGroupingNumber
	,stg.ExternalReference
	,stg.InvoiceInAdvanceNumber
	,stg.InvoicingPeriodicityCode
	,stg.PeriodMultipleNumber
	,stg.InvoicePrintingTypeCode
	,stg.AutoTotalOutlayIndicator
	,stg.TransferMeansNoticeCode
	,stg.OutputFormatCode
	,stg.BillingStatementMothodCode
	,stg.SpecialCareIndicator
	,stg.SpecialCareTypeCode
	,stg.SpecialCareMemo
	,stg.SpecialCareDocument
	,stg.SpecialCareRegistrationDate
	,stg.SpecialCareDepartmentCode
	,stg.SpecialCareUser1Code
	,stg.SpecialCareUser2Code)), 2) AS HashValue
	FROM ActorRole AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorRole] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.RoleCode = stg.RoleCode
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorRole] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.RoleCode = stg.RoleCode)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.RoleCode IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_ActorTelecom]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_ActorTelecom]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.Email
	,stg.TypeCode
	,stg.StartDate
	,stg.EndDate
	,stg.PreferredIndicator
	,stg.DomainCode
	,stg.AssentIndicator
	,stg.Extension
	,stg.IncomingPathCode
	,stg.LastContactDate
	,stg.ErrorCodeKP
	,stg.ContactResultCode
	,stg.ContactSuccessCode
	,stg.PreferredNonBusinessHoursIndicator)), 2) AS HashValue
	FROM ActorTelecom AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[ActorTelecom] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.OrderNumber = stg.OrderNumber 
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[ActorTelecom] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.OrderNumber = stg.OrderNumber)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.OrderNumber IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_Address]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_Address]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5',CONCAT(
	stg.CountryCode
	,stg.CreatedByCode
	,stg.StateCode
	,stg.Address1
	,stg.Address2
	,stg.PostalCode
	,stg.City
	,stg.UpdateDate
	,stg.CEDEX
	,stg.SubRegion
	,stg.RegionTypeCode
	,stg.MSACode
	,stg.LatitudeAngleNumber
	,stg.LatitudeCardinalRef
	,stg.LongitudeAngleNumber
	,stg.LongitudeCardinalRef
	,stg.BuildingName
	,stg.AppartmentNumber
	,stg.TaxAreaCode
	,stg.District
	,stg.Town
	,stg.NewStreetFormat
	,stg.NewPostalCodeFormat
	,stg.NewCityFormat
	,stg.NewBlockNumberFormat
	,stg.NewSubRegionFormat
	,stg.NewBuildingNameFormat
	,stg.NewApartmentNumberFormat
	,stg.NewDistrictFormat
	,stg.TaxablePercent
	,stg.TaxCode
	,stg.TaxableBalanceAmount
	,stg.ADRStreetCodeSeqCode
	,stg.ADRBuildingMainCode
	,stg.ADRBuildingSubCode
	,stg.ADRSTRTADDUSECode
	,stg.ADRRange
	,stg.BuildingCodeSequenceCode)), 2) AS HashValue
	FROM Address AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[Address] AS txn ON (txn.AddressId = stg.AddressId AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[Address] AS txn ON (txn.AddressId = stg.AddressId)
	WHERE stg.RunId = @_RunId
	AND txn.AddressId IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_RefActorCorrAdr]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_RefActorCorrAdr]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5', CAST(AddressId AS VARCHAR(128))), 2) AS HashValue
	FROM RefActorCorrAdr AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[RefActorCorrAdr] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.AddressOrderNumber = stg.AddressOrderNumber 
	AND txn.CorrespondantOrderNumber = stg.CorrespondantOrderNumber
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[RefActorCorrAdr] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.AddressOrderNumber = stg.AddressOrderNumber 
	AND txn.CorrespondantOrderNumber = stg.CorrespondantOrderNumber)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.AddressOrderNumber IS NULL
	AND txn.CorrespondantOrderNumber IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END
*/
GO
/****** Object:  StoredProcedure [dbo].[ExtractDataForTransaction_RefActorCorrTel]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:	Jonathan Louie
-- Create date: 12/9/2015
-- Description:	Extract ACTOR domain data from 
--	Staging DB to Transaction DB  
-- =============================================
CREATE PROCEDURE [dbo].[ExtractDataForTransaction_RefActorCorrTel]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10)
AS/*
BEGIN
	-- SET NOCOUNT ON added to prevent extra result setsFROM
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	--SET FMTONLY OFF;

	--Declare and initialize internal variables
	DECLARE @_RunId INT = CAST(@RunId AS INT);

	-- Perform data transformations by selecting data from relevant table
	WITH StagingData AS(
	SELECT stg.*, 
	CONVERT(VARCHAR(128), HASHBYTES('MD5', CAST(PreferredIndicator AS VARCHAR(128))), 2) AS HashValue
	FROM RefActorCorrTel AS stg
	WHERE stg.RunId = @_RunId
	),
	UpdatingData AS (
	--Find items in TXN that need to be updated
	SELECT stg.*,
	txn.SCDStartDate AS SCDStartDate,
	txn.SCDEndDate AS SCDEndDate,
	txn.SCDCurrentFlag AS SCDCurrentFlag,
	txn.DWInsertDate AS DWInsertDate,
	txn.DWInsertUser AS DWInsertUser,
	GETDATE() AS DWUpdateDate,
	CAST(USER AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	INNER JOIN [LOP_ODS_TXN].[dbo].[RefActorCorrTel] AS txn ON (txn.ActorId = stg.ActorId 
	AND txn.TelecomOrderNumber = stg.TelecomOrderNumber 
	AND txn.CorrespondantOrderNumber = stg.CorrespondantOrderNumber
	AND txn.HashValue != stg.HashValue)
	),
	IncomingData AS (
	SELECT stg.*,
	CAST(NULL AS DATETIME) AS SCDStartDate,
	CAST(NULL AS DATETIME) AS SCDEndDate,
	1 AS SCDCurentFlag,
	GETDATE() AS DWInsertDate,
	CAST(USER AS VARCHAR(128)) AS DWInsertUser,
	CAST(NULL AS DATETIME) AS DWUpdateDate,
	CAST(NULL AS VARCHAR(128)) AS DWUpdateUser
	FROM StagingData AS stg
	LEFT JOIN [LOP_ODS_TXN].[dbo].[RefActorCorrTel] AS txn ON (txn.ActorId = stg.ActorId
	AND txn.TelecomOrderNumber = stg.TelecomOrderNumber 
	AND txn.CorrespondantOrderNumber = stg.CorrespondantOrderNumber)
	WHERE stg.RunId = @_RunId
	AND txn.ActorId IS NULL
	AND txn.TelecomOrderNumber IS NULL
	AND txn.CorrespondantOrderNumber IS NULL
	)
	SELECT *
	FROM IncomingData
	UNION
	SELECT *
	FROM UpdatingData
END


*/
GO
/****** Object:  StoredProcedure [dbo].[OnBatchExecutionError]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:	Jon Louie
-- Create date: 11/13/2015
-- Description: Stored procedure called on ETL event failure. 
--	Any incomplete in the BatchControl will have its 
--	status set to 'FAILED'
-- =============================================
Create PROCEDURE [dbo].[OnBatchExecutionError]

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	DECLARE @BatchId INT = (SELECT MAX(BatchID) 
	FROM kpods.BatchControl 
	WHERE BatchStatus = 'In Progress')
	
	IF @BatchId IS NOT NULL
	UPDATE kpods.BatchControl
	SET BatchStatus = 'FAILED'
	WHERE BatchID = @BatchId


	DECLARE @KPRunId INT = (SELECT MAX(KPRunId) 
	FROM kpods.BatchRunInfo 
	WHERE BatchID = @BatchId
	AND RunStatus = 'In Progress')	

	IF @KPRunId IS NOT NULL
	UPDATE kpods.BatchRunInfo
	SET RunStatus = 'FAILED'
	WHERE BatchID = @BatchId
	AND KPRunId = @KPRunId

	UPDATE kpods.BatchRunDomainLog
	SET LoadStatus = 'FAILED'
	WHERE BatchID = @BatchId
	AND KPRunId = @KPRunId 
	AND LoadStatus = 'In Progress'

END
GO
/****** Object:  StoredProcedure [dbo].[usp_CleanTables]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:	Jonathan Louie
-- Create date: 
-- Description:	Cleans tables in preparation for incoming data 
--	by deleting rows from a failed run (for tables 
--	where rows are updated based on Run_Id field value) 
--	or by truncating the table entirely (any table where 
--	rows are not inserted based on Run_id field value).
-- =============================================
CREATE PROCEDURE [dbo].[usp_CleanTables]
	-- Add the parameters for the stored procedure here
	@RunId VARCHAR(10),
	@TableName VARCHAR(128)
AS

BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	DECLARE @_RunId INT = CAST(@RunId AS INT)
	DECLARE @_TableName VARCHAR(128) = @TableName
	DECLARE @SqlStatement NVARCHAR(2000)
	DECLARE @Parameters NVARCHAR(2000)
	EXEC sp_msforeachtable 'ALTER TABLE ? NOCHECK CONSTRAINT all'

	IF COL_LENGTH(@_TableName,'RUN_ID') IS NOT NULL
	BEGIN
	SET @SqlStatement = 'DELETE FROM ' + @_TableName + ' WHERE RUN_ID = @_RunId'
	SET @Parameters = '@_RunId INT'
	EXEC sp_executesql @SqlStatement, @Parameters, @_RunId = @_RunId
	END
	ELSE
	BEGIN
	SET @SqlStatement = 'DELETE FROM ' + @_TableName
	EXEC sp_executesql @SqlStatement
	END

	
	EXEC sp_msforeachtable 'ALTER TABLE ? CHECK CONSTRAINT all'
	
END
GO
/****** Object:  StoredProcedure [etl].[uspAUDIT]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [etl].[uspAUDIT]
@SUBJECT_AREA varchar(100)='LEGACY',
@TASK_NUMBER INT
AS

DECLARE @Load_Error_check INT
DECLARE @Load_Rows_check INT 
DECLARE @Batch_ID varchar(50)
DECLARE @Set INT
DECLARE @Load_Window varchar(50)

SET @Load_Error_check=0
SET @Load_Rows_check=0
SET @Batch_ID=''
SET @Load_Window=''

SELECT @Load_Error_check=COUNT(*) FROM [ETL].[LOGGING] WHERE [ERROR_MSG] IS NOT NULL;

SELECT @Set=COUNT(*) FROM [ETL].[LOGGING]; 

IF ( @Load_Error_check=0 )

BEGIN
SELECT @Load_Window=CONVERT(VARCHAR(40),DATEDIFF(minute, MIN(START_TIME),MAX(END_TIME)))
FROM ETL.LOGGING
SELECT @Batch_ID= @SUBJECT_AREA+'-'+CONVERT(VARCHAR(10),MIN(START_TIME),102) +'.'+CONVERT(VARCHAR(10),MAX(END_TIME),108)+'-' +@Load_Window 
 FROM ETL.LOGGING

INSERT [ETL].[LOGGING_ARCHIVE] (
            [VALID_BATCH_ID]
           ,[LOGGING_ID]
           ,[SUBJECT_AREA]
           ,[DATA_AS_OF_DATE]
	   ,[RUN_ID]
           ,[PROCEDURE_NAME]
	   ,[DW_OBJECT_NAME]
	   ,[STG_OBJECT_NAME]
           ,[SOURCE_TYPE]
           ,[RUN_STATUS]
           ,[ERROR_MSG]
           ,[START_TIME]
           ,[END_TIME]
	   ,[CNT_DW]
           ,[CNT_STG]
           ,[CNT_DIF]
           ,[CNT_DUP])
SELECT
            @Batch_ID
           ,[LOGGING_ID]
           ,[SUBJECT_AREA]
           ,[DATA_AS_OF_DATE]
	   ,[RUN_ID]
           ,[PROCEDURE_NAME]
	   ,[DW_OBJECT_NAME]
           ,[STG_OBJECT_NAME]
           ,[SOURCE_TYPE]
           ,[RUN_STATUS]
           ,[ERROR_MSG]
           ,[START_TIME]
           ,[END_TIME]
	   ,[CNT_DW]
           ,[CNT_STG]
           ,[CNT_DIF]
           ,[CNT_DUP]
FROM [ETL].[LOGGING]

 END

IF ( @Load_Error_check>0 )
BEGIN
PRINT 'NO RECORDS HAVE BEEN MOVED - ERRORS FOUND'
RETURN
END



GO
/****** Object:  StoredProcedure [etl].[uspFACILITY_EPB_LOAD]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [etl].[uspFACILITY_EPB_LOAD]
@DW_STATUS_IND char(1)
AS
BEGIN TRY

DECLARE @Proc_Name varchar(150)='etl.uspFACILITY_EPB_LOAD'
DECLARE @dw_object_name varchar(150)='etl.FACILITY_EPB'
DECLARE @stg_object_name varchar(150)='STG.FACILITY'
DECLARE @Source_Type varchar(15)='TABLE'
DECLARE @Error_Message varchar(1500)=''
DECLARE @Subject_Area varchar(150)='LEGACY'
DECLARE @cnt_dw int=0
DECLARE @cnt_stg int=0
DECLARE @cnt_dif int=0
DECLARE @cnt_dup int=0
DECLARE @DATA_AS_OF_DATE DATE='01/01/1900'
DECLARE @RUN_ID INT

SELECT RUN_ID FROM ETL.CNTRL WHERE [OBJECT_NAME]=@Proc_Name AND SUBJECT_AREA=@Subject_Area


-- TRUNCATE TABLE [MD].[DOCUMENT_STATUS];
--------------------------------------------------------------------------------------------------------------
--------- REMOVAL LOGIC STARTS HERE---------------------------------------------------------------------------
---------PARAMETER 'D' STANDS FOR 'DELETE' REQUEST -----------------------------------------------------------

 IF @DW_STATUS_IND = 'D'
BEGIN
	DELETE FROM [etl].[FACILITY_EPB] WHERE [RUN_ID]=@RUN_ID
END

 -------------------------------------------------------------------------------------------------------------------------
 --------  SECTION (FULL LOAD ) STARTS HERE ------------------------------------------------------------------------------
 ---------PARAMETER COMBINATION OF 'F' FOR STATUS TOGETHER WITH '1900-01-01' FOR DATE STANDS FOR 'ALL DATA IN STAGING'----
 -------------------------------------------------------------------------------------------------------------------------
IF @DW_STATUS_IND = 'F' 
BEGIN

SELECT @cnt_stg=COUNT(*) FROM [etl].[FACILITY_EPB];
EXEC etl.uspLOG_LOAD 'START',@Subject_Area,@RUN_ID,@DATA_AS_OF_DATE,@Proc_Name,@dw_object_name,@stg_object_name,@Source_Type,@Error_Message,@cnt_dw,@cnt_stg,@cnt_dif,@cnt_dup

MERGE INTO [etl].[FACILITY_EPB] TGT
	 USING (
	SELECT 	DISTINCT 
	             DE.RUN_ID AS RUN_ID,
	             DA.SHORT_NAME_DESC AS [LENDING_ORGANIZATION],
	 DA_BORR.TRADE_NAME_DESC AS [MEMBER_NAME],
	 DA_BORR.ACTOR_CODE_DESC AS [MEMBER_ID],
	 DC.CONTRACT_NUMBER_DESC AS [FACILITY_ID],
	 DE.LOAN_NBR [LOAN_ID],
	 GL_Name [GL_NAME],
	 GL_ACCOUNT_NUMBER_DESC [GL_ACCOUNT],
	 DEB.VALUE_DATE_AMT AS  [EPB]

   FROM [dbo].[DW_ELEMENTS] DE
	INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] DEB
	ON  DE.CONTRACT_ID = DEB.CONTRACT_ID
	AND DE.RUN_ID = DEB.RUN_ID
	AND DE.DIM_DATE_KEY = DEB.DIM_DATE_KEY
	AND DE.ORDER_NBR = DEB.ELEMENT_ORDER_NBR
	AND BALANCE_TYPE_DESC = 'PRINCIPAL'
	INNER JOIN [dbo].[DW_CONTRACTS] DC
	ON  DE.RUN_ID = DC.RUN_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.CONTRACT_ID = DC.CONTRACT_ID
	INNER JOIN (select DC.RUN_ID,DC.DIM_DATE_KEY,DC.CONTRACT_ID, LOAN_NBR,
	Case when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LT Loan)'
	 when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LT NonPerform'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LOC Loan)'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LOC NonPerform'
	-------------------
	 when DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LT Loan)'
	 when DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate  LT NonPerform'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LOC Loan)'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate LOC NonPerform'
	 END AS 'GL_Name' 
	FROM [dbo].[DW_CONTRACTS] DC
	INNER JOIN [dbo].[DW_ELEMENTS] DE
	ON  DC.RUN_ID = DE.RUN_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.CONTRACT_ID = DE.CONTRACT_ID
	INNER JOIN [DBO].[DW_PROCESS_ALLOCATIONS] DPA
	ON  DE.RUN_ID = DPA.RUN_ID
	AND DE.DIM_DATE_KEY = DPA.DIM_DATE_KEY
	AND DE.PROCESS_ALLOCATION_ID = DPA.PROCESS_ALLOCATION_ID
	
	 ) LoansGL
	ON DE.RUN_ID = LoansGL.RUN_ID
	AND DE.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY
	AND DE.CONTRACT_ID = LoansGL.CONTRACT_ID
	AND DE.LOAN_NBR = LoansGL.LOAN_NBR
	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] DCOA
	ON  LoansGL.RUN_ID = DCOA.RUN_ID
	AND LoansGL.DIM_DATE_KEY = DCOA.DIM_DATE_KEY
	AND LoansGL.GL_Name = DCOA.GL_ACCOUNT_DESC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID	  
	  
	--     WHERE DE.RUN_ID = @RUN_ID

	  ) SRC

	 ON
TGT.RUN_ID = SRC.RUN_ID AND
TGT.LENDING_ORGANIZATION=SRC.LENDING_ORGANIZATION AND
TGT.MEMBER_NAME=SRC.MEMBER_NAME AND
TGT.MEMBER_ID=SRC.MEMBER_ID AND
TGT.FACILITY_ID=SRC.FACILITY_ID
WHEN MATCHED THEN 
UPDATE SET 

TGT.RUN_ID	 = SRC.RUN_ID,
TGT.LENDING_ORGANIZATION = SRC.LENDING_ORGANIZATION,
TGT.MEMBER_NAME=SRC.MEMBER_NAME,
TGT.MEMBER_ID=SRC.MEMBER_ID,
TGT.FACILITY_ID=SRC.FACILITY_ID,
TGT.LOAN_ID=SRC.LOAN_ID,
TGT.GL_NAME=SRC.GL_NAME, 
TGT.GL_ACCOUNT=SRC.GL_ACCOUNT,
TGT.EPB=SRC.EPB


WHEN NOT MATCHED THEN
INSERT 
(
         RUN_ID,
         LENDING_ORGANIZATION,
	 MEMBER_NAME,
	 MEMBER_ID,
	 FACILITY_ID,
	 LOAN_ID,
	 GL_NAME,
	 GL_ACCOUNT,
	 EPB
)

VALUES( 

         SRC.RUN_ID,
         SRC.LENDING_ORGANIZATION,
	 SRC.MEMBER_NAME,
	 SRC.MEMBER_ID,
	 SRC.FACILITY_ID,
	 SRC.LOAN_ID,
	 SRC.GL_NAME,
	 SRC.GL_ACCOUNT,
	 SRC.EPB

);

SELECT @cnt_dw=COUNT(*) FROM [etl].[FACILITY_EPB];
SELECT @cnt_dif=(@cnt_stg-@cnt_dw)
SELECT @cnt_dup=COUNT(*) FROM [etl].[FACILITY_EPB] GROUP BY RUN_ID, FACILITY_ID HAVING COUNT(*)>1; 
UPDATE [etl].[CNTRL] SET [DW_STATUS_IND] = 'F', [DS_INSERT_DATE]=GETDATE(),[DS_INSERT_TIME]=GETDATE()  WHERE [OBJECT_NAME]=@Proc_Name;

EXEC ETL.uspLOG_LOAD 'END',@Subject_Area,@RUN_ID,@DATA_AS_OF_DATE,@Proc_Name,@dw_object_name,@stg_object_name,@Source_Type,@Error_Message,@cnt_dw,@cnt_stg,@cnt_dif,@cnt_dup


END

 -----------------------------------------------------------------------------------------------------------------------
--------------SECTION (INCREMENTAL LOAD ) STARTS HERE ------------------------------------------------------------------ 
 ------------------------------------------------------------------------------------------------------------------------

IF @DW_STATUS_IND = 'S' 
BEGIN

SELECT @RUN_ID=RUN_ID FROM ETL.CNTRL WHERE [OBJECT_NAME]=@Proc_Name;

SELECT @cnt_stg=COUNT(*) FROM [etl].[FACILITY_EPB];
EXEC etl.uspLOG_LOAD 'START',@Subject_Area,@RUN_ID,@DATA_AS_OF_DATE,@Proc_Name,@dw_object_name,@stg_object_name,@Source_Type,@Error_Message,@cnt_dw,@cnt_stg,@cnt_dif,@cnt_dup

MERGE INTO [etl].[FACILITY_EPB] TGT
	 USING (
	SELECT 	DISTINCT 
	             @RUN_ID AS RUN_ID,
	             DA.SHORT_NAME_DESC AS [LENDING_ORGANIZATION],
	 DA_BORR.TRADE_NAME_DESC AS [MEMBER_NAME],
	 DA_BORR.ACTOR_CODE_DESC AS [MEMBER_ID],
	 DC.CONTRACT_NUMBER_DESC AS [FACILITY_ID],
	 DE.LOAN_NBR [LOAN_ID],
	 GL_Name [GL_NAME],
	 GL_ACCOUNT_NUMBER_DESC [GL_ACCOUNT],
	 DEB.VALUE_DATE_AMT AS  [EPB]

   FROM [dbo].[DW_ELEMENTS] DE
	INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] DEB
	ON  DE.CONTRACT_ID = DEB.CONTRACT_ID
	AND DE.RUN_ID = DEB.RUN_ID
	AND DE.DIM_DATE_KEY = DEB.DIM_DATE_KEY
	AND DE.ORDER_NBR = DEB.ELEMENT_ORDER_NBR
	AND BALANCE_TYPE_DESC = 'PRINCIPAL'
	INNER JOIN [dbo].[DW_CONTRACTS] DC
	ON  DE.RUN_ID = DC.RUN_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.CONTRACT_ID = DC.CONTRACT_ID
	INNER JOIN (select DC.RUN_ID,DC.DIM_DATE_KEY,DC.CONTRACT_ID, LOAN_NBR,
	Case when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LT Loan)'
	 when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LT NonPerform'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LOC Loan)'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LOC NonPerform'
	-------------------
	 when DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LT Loan)'
	 when DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate  LT NonPerform'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LOC Loan)'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate LOC NonPerform'
	 END AS 'GL_Name' 
	FROM [dbo].[DW_CONTRACTS] DC
	INNER JOIN [dbo].[DW_ELEMENTS] DE
	ON  DC.RUN_ID = DE.RUN_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.CONTRACT_ID = DE.CONTRACT_ID
	INNER JOIN [DBO].[DW_PROCESS_ALLOCATIONS] DPA
	ON  DE.RUN_ID = DPA.RUN_ID
	AND DE.DIM_DATE_KEY = DPA.DIM_DATE_KEY
	AND DE.PROCESS_ALLOCATION_ID = DPA.PROCESS_ALLOCATION_ID
	
	 ) LoansGL
	ON DE.RUN_ID = LoansGL.RUN_ID
	AND DE.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY
	AND DE.CONTRACT_ID = LoansGL.CONTRACT_ID
	AND DE.LOAN_NBR = LoansGL.LOAN_NBR
	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] DCOA
	ON  LoansGL.RUN_ID = DCOA.RUN_ID
	AND LoansGL.DIM_DATE_KEY = DCOA.DIM_DATE_KEY
	AND LoansGL.GL_Name = DCOA.GL_ACCOUNT_DESC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID	  
	  
	     WHERE DE.RUN_ID = @RUN_ID

	  ) SRC

	 ON
TGT.RUN_ID = SRC.RUN_ID AND
TGT.LENDING_ORGANIZATION=SRC.LENDING_ORGANIZATION AND
TGT.MEMBER_NAME=SRC.MEMBER_NAME AND
TGT.MEMBER_ID=SRC.MEMBER_ID AND
TGT.FACILITY_ID=SRC.FACILITY_ID
WHEN MATCHED THEN 
UPDATE SET 

TGT.RUN_ID	 = SRC.RUN_ID,
TGT.LENDING_ORGANIZATION = SRC.LENDING_ORGANIZATION,
TGT.MEMBER_NAME=SRC.MEMBER_NAME,
TGT.MEMBER_ID=SRC.MEMBER_ID,
TGT.FACILITY_ID=SRC.FACILITY_ID,
TGT.LOAN_ID=SRC.LOAN_ID,
TGT.GL_NAME=SRC.GL_NAME, 
TGT.GL_ACCOUNT=SRC.GL_ACCOUNT,
TGT.EPB=SRC.EPB


WHEN NOT MATCHED THEN
INSERT 
(
         RUN_ID,
         LENDING_ORGANIZATION,
	 MEMBER_NAME,
	 MEMBER_ID,
	 FACILITY_ID,
	 LOAN_ID,
	 GL_NAME,
	 GL_ACCOUNT,
	 EPB
)

VALUES( 

         SRC.RUN_ID,
         SRC.LENDING_ORGANIZATION,
	 SRC.MEMBER_NAME,
	 SRC.MEMBER_ID,
	 SRC.FACILITY_ID,
	 SRC.LOAN_ID,
	 SRC.GL_NAME,
	 SRC.GL_ACCOUNT,
	 SRC.EPB

);

SELECT @cnt_dw=COUNT(*) FROM [etl].[FACILITY_EPB];
SELECT @cnt_dif=(@cnt_stg-@cnt_dw)
SELECT @cnt_dup=COUNT(*) FROM [etl].[FACILITY_EPB] GROUP BY RUN_ID, FACILITY_ID HAVING COUNT(*)>1; 
UPDATE [etl].[CNTRL] SET [DW_STATUS_IND] = 'S', [DS_INSERT_DATE]=GETDATE(),[DS_INSERT_TIME]=GETDATE()  WHERE [OBJECT_NAME]=@Proc_Name

EXEC ETL.uspLOG_LOAD 'END',@Subject_Area,@RUN_ID,@DATA_AS_OF_DATE,@Proc_Name,@dw_object_name,@stg_object_name,@Source_Type,@Error_Message,@cnt_dw,@cnt_stg,@cnt_dif,@cnt_dup


END


END TRY 


BEGIN CATCH
-------------ERROR HANDLING AREA----------------------------------------------
 SET @Error_Message = ERROR_MESSAGE() 
 EXEC ETL.uspLOG_LOAD 'FAILED',@Subject_Area,@RUN_ID,@DATA_AS_OF_DATE,@Proc_Name,@dw_object_name,@stg_object_name,@Source_Type,@Error_Message,@cnt_dw,@cnt_stg,@cnt_dif,@cnt_dup
 ------------------------------------------------------------------------------
END CATCH

GO
/****** Object:  StoredProcedure [etl].[uspLOG_LOAD]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [etl].[uspLOG_LOAD]
@batch_control as varchar(20),
@subject_area varchar(50),
@run_id int,
@data_as_of_date date,
@procedure_name as varchar(50),
@dw_object_name as varchar(450),
@stg_object_name as varchar(450),
@source_type as varchar(50),
@error varchar(2000) = null,
@cnt_dw int,
@cnt_stg int,
@cnt_dif int,
@cnt_dup int
AS

DECLARE @Start_Time SMALLDATETIME

IF (UPPER(@batch_control)='START')
BEGIN
  set @Start_Time = getdate()
  INSERT INTO ETL.LOGGING (
  
    [SUBJECT_AREA], 
	[DATA_AS_OF_DATE] ,
	[RUN_ID] ,
	[PROCEDURE_NAME] ,
	[DW_OBJECT_NAME],
	[STG_OBJECT_NAME] ,
	[SOURCE_TYPE] ,
	[RUN_STATUS] ,
	[START_TIME] ,
	[CNT_STG] 
	  
  )
              VALUES 
  (
  
  @subject_area,
  @data_as_of_date,
  @run_id,
  @procedure_name,
  @dw_object_name,
  @stg_object_name,
  @source_type,
  'IN-PROCESS',
  @Start_Time,
  @cnt_stg
    
  )
 
END
IF (UPPER(@batch_control)='END') 
BEGIN
     UPDATE ETL.LOGGING   
            SET END_TIME=GETDATE(),
                RUN_STATUS='FINISHED',
	CNT_DW=@cnt_dw,
	CNT_DIF=@cnt_dif,
	CNT_DUP=@cnt_dup,
	DATA_AS_OF_DATE=@data_as_of_date
    WHERE 
 LOGGING_ID = (SELECT MAX(LOGGING_ID) FROM ETL.LOGGING WHERE [PROCEDURE_NAME]=@procedure_name  AND END_TIME IS NULL )
 
END
           
 
IF (UPPER(@batch_control)='FAILED') 
BEGIN
     UPDATE ETL.LOGGING   
            SET END_TIME=GETDATE(),
                RUN_STATUS='FAILED',
                ERROR_MSG = @error
	WHERE LOGGING_ID = (SELECT MAX(LOGGING_ID) FROM ETL.LOGGING WHERE [PROCEDURE_NAME]=@procedure_name  )

END  
IF ((UPPER(@batch_control) <> 'FAILED') AND (UPPER(@batch_control) <> 'START') AND (UPPER(@batch_control) <> 'END'))
BEGIN
  RAISERROR ('Invalid Status!', 16, 1)
END
----------------------
GO
/****** Object:  StoredProcedure [etl].[uspMSRT_CNTRL]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [etl].[uspMSRT_CNTRL]
@subj_area varchar(50)='LEGACY',
@task_cnt INT=1,
@load_type char(1)='F' 
AS

BEGIN

DECLARE @RUN_ID INT
SELECT @RUN_ID=MAX(RUN_ID) FROM ETL_CONTROL;

INSERT [ETL].[CNTRL] ([SUBJECT_AREA],[OBJECT_NAME],[OBJECT_TYPE],[DATA_AS_OF_DATE],[RUN_ID],[DS_INSERT_DATE],[DS_INSERT_TIME],[DW_STATUS_IND],[DW_EXECUTION_ORDER])
SELECT @subj_area, [OBJECT_NAME],'PROCEDURE','1900-01-01',@RUN_ID,CONVERT(DATE,GETDATE(),120),GETDATE(),@load_type, DW_EXECUTION_ORDER
FROM ETL.TASK_MSTR WHERE @subj_area='LEGACY' AND IS_ENABLED=1


END
GO
/****** Object:  StoredProcedure [rpt].[BUS002DocumentExpirationDate]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--- In the system test environment running this will get some values back ----
--EXEC [rpt].[BUS002DocumentExpirationDate] 142, '07/24/2016','06/30/2016','09/28/2016'

CREATE PROCEDURE [rpt].[BUS002DocumentExpirationDate]
	(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE, @LegalDocExpirationStartDate_PAR DATE, @LegalDocExpirationEndDate_PAR DATE)
AS
BEGIN





	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	      , @ReportDate DATE
	  , @LegalDocExpirationStartDate DATE
	  , @LegalDocExpirationEndDate DATE

	SELECT @RunID = @RunID_PAR
	, @ReportDate = @ReportDate_PAR
	, @LegalDocExpirationStartDate = @LegalDocExpirationStartDate_PAR
	, @LegalDocExpirationEndDate = @LegalDocExpirationEndDate_PAR


;WITH EventModified
AS
(
SELECT 
CONTRACT_ID, 
DIM_DATE_KEY, 
RUN_ID,
EFFECTIVE_DT,
ROW_RANK = ROW_NUMBER() OVER(PARTITION BY CONTRACT_ID, DIM_DATE_KEY, RUN_ID ORDER BY EFFECTIVE_DT DESC)
FROM DW_EVENTS
WHERE EFFECTIVE_DT  <= @ReportDate
)


SELECT DISTINCT 
	     LendingOrganization= C.SHORT_NAME_DESC
	    , MemberID =  ISNULL(A.ACTOR_CODE_DESC,'-')
	, MemberName = ISNULL(A.SHORT_NAME_DESC ,'-')
	, UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
	, ProductType = U.PRODUCT_DESC
	, ProductSubType = PST.CHARACTERISTIC_CODE
	, UnderlyingFacilityCommitmentAmount = u.SIGNED_AMT
	, UnexecutedDocumentsSentDate = E.EFFECTIVE_DT
	, LegalDocumentsExpirationDate = LDED.DATE_VALUE_DT
	, LegalDocsReceivedDate = CASE WHEN PST.CHARACTERISTIC_CODE='RCVDOC' THEN PST.DATE_VALUE_DT ELSE NULL END
	, AVP = AVP.USER_BY_DESC
	, RVP = RVP.USER_BY_DESC	
	FROM DW_CONTRACTS U
	LEFT JOIN DW_CONTRACT_ACTORS CA 
	ON U.CONTRACT_ID = CA.CONTRACT_ID
	AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
	AND U.RUN_ID = CA.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
   LEFT JOIN DW_CONTRACT_CHARACTERISTICS PST
	ON U.CONTRACT_ID = PST.CONTRACT_ID
	AND U.DIM_DATE_KEY = PST.DIM_DATE_KEY
	AND U.RUN_ID = PST.RUN_ID
	AND PST.CHARACTERISTIC_CODE IN ('100', 'CONCUR', 'CORP'
	, 'EQUIT', 'LUM', 'MULTIAUT', 'MULTIMAT'
	, 'OTHERG', 'POWER', 'PP', 'RUSGU', 'SINGLEI'
	, 'SINGLM', 'TAX', 'TAXE', 'OFFERED','RCVDOC')
   LEFT JOIN DW_DEAL_CHARACTERISTICS LDED
                     ON U.CONTRACT_ID = LDED.DEAL_ID
                           AND U.DIM_DATE_KEY = LDED.DIM_DATE_KEY
                           AND U.RUN_ID = LDED.RUN_ID
                           AND LDED.CHARACTERISTIC_CODE = 'LDED'
    LEFT JOIN EventModified E
	    ON E.CONTRACT_ID=U.CONTRACT_ID 
	   AND E.DIM_DATE_KEY=U.DIM_DATE_KEY
	   AND E.RUN_ID=U.RUN_ID
	   AND E.ROW_RANK=1
   	LEFT JOIN DW_ACTORS A 
	ON CA.ACTOR_ID = A.ACTOR_ID
	AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND CA.RUN_ID = A.RUN_ID
	LEFT JOIN DW_ACTORS C 
	ON U.COMPANY_ACTOR_ID = C.ACTOR_ID
	AND U.DIM_DATE_KEY = C.DIM_DATE_KEY
	AND U.RUN_ID = C.RUN_ID
	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'
	LEFT JOIN DW_CONTRACT_BALANCES AVAIL 
	ON U.CONTRACT_ID = AVAIL.CONTRACT_ID
	AND U.DIM_DATE_KEY = AVAIL.DIM_DATE_KEY
	AND U.RUN_ID = AVAIL.RUN_ID
	AND AVAIL.BALANCE_TYPE_DESC = 'AVAILABLE'
	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 	
	LEFT JOIN DW_INVOLVED_USER AVP
	ON u.CONTRACT_ID = AVP.CONTRACT_ID
	AND u.DIM_DATE_KEY = AVP.DIM_DATE_KEY
	AND u.RUN_ID = AVP.RUN_ID	
	AND AVP.BUSINESS_CODE = 'AVP'
	LEFT JOIN DW_INVOLVED_USER RVP
	ON u.CONTRACT_ID = RVP.CONTRACT_ID
	AND u.DIM_DATE_KEY = RVP.DIM_DATE_KEY
	AND u.RUN_ID = RVP.RUN_ID	
	AND RVP.BUSINESS_CODE = 'RVP'	
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	    	AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT AND ISNULL(CP.PHASE_END_DT, @ReportDate))
	     
	--AND (LDED.DATE_VALUE_DT BETWEEN @LegalDocExpirationStartDate AND ISNULL(@LegalDocExpirationEndDate, @ReportDate))
	        AND U.RUN_ID = @RunID
	AND LDED.DATE_VALUE_DT IS NOT NULL
	--ORDER BY U.CONTRACT_END_DT
	--	, A.ACTOR_CODE_DESC
	--, U.CONTRACT_NUMBER_DESC
END

GO
/****** Object:  StoredProcedure [rpt].[BUS003FacilityPipeline_FO]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [rpt].[BUS003FacilityPipeline_FO]
	(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @ReportDate DATE

	SELECT @RunID = @RunID_PAR
	, @ReportDate = @ReportDate_PAR

	SELECT DISTINCT LendingOrganization = PA.SHORT_NAME_DESC
	, LendingOrganizationID = PA.ACTOR_ID
	, MemberName = MA.TRADE_NAME_DESC
	, MemberID =  MA.ACTOR_CODE_DESC
	, RVP = RVP.CREATED_BY_DESC
	, AVP = AVP.CREATED_BY_DESC
	, AVPCode = AVP.CREATED_BY_CODE
	, MasterFacilityID = M.DEAL_NUMBER_DESC
	, MasterFacilityStatus = MDP.STEP_DESC
	, UnderlyingFacilityID = U.DEAL_NUMBER_DESC
	, DEAL_ID = U.DEAL_ID
	, UnderlyingFacilityStatus = DP.STEP_DESC
	, UnderlyingFacilityAmount = DI.INVESTMENT_AMT
	, ProductType = U.PRODUCT_CODE
	, ProductSubType = PST.CHARACTERISTIC_CODE
	, ApplicationRequestReceivedDate = ARRD.DATE_VALUE_DT
	, FinalApprovalDate = FAD.EFFECTIVE_DT
	, DateofBorrowersBoardMeeting = BBM.DATE_VALUE_DT
	, UnexecutedDocumentsSentDate = UNEX.EFFECTIVE_DT
	, LegalDocumentExpirationDate = LDED.DATE_VALUE_DT
	, LegalClearanceCompletionDate = LEG.EFFECTIVE_DT
	FROM DW_DEALS_FO U
	INNER JOIN DW_DEAL_PHASE_FO DP
	ON u.DEAL_ID = DP.DEAL_ID
	AND u.DEAL_VERSION_CODE = DP.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = DP.DIM_DATE_KEY
	AND u.RUN_ID = DP.RUN_ID	
	INNER JOIN DW_DEAL_INVESTMENT_FO DI
	ON  u.DEAL_ID = DI.DEAL_ID
	AND u.DEAL_VERSION_CODE = DI.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = DI.DIM_DATE_KEY
	AND u.RUN_ID = DI.RUN_ID	
	LEFT JOIN DW_DEAL_DETAILS_FO DD 
	ON u.DEAL_ID = DD.DEAL_ID
	AND u.DEAL_VERSION_CODE = DD.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = DD.DIM_DATE_KEY
	AND u.RUN_ID = DD.RUN_ID 
	LEFT JOIN DW_DEALS_FO M 
	ON DD.LIMITING_CONTRACT_ID = M.DEAL_ID
	AND u.DEAL_VERSION_CODE = M.DEAL_VERSION_CODE
	AND U.DIM_DATE_KEY = M.DIM_DATE_KEY
	AND U.RUN_ID = M.RUN_ID
	LEFT JOIN DW_DEAL_PHASE_FO MDP
	ON M.DEAL_ID = MDP.DEAL_ID
	AND M.DEAL_VERSION_CODE = MDP.DEAL_VERSION_CODE
	AND M.DIM_DATE_KEY = MDP.DIM_DATE_KEY
	AND M.RUN_ID = MDP.RUN_ID
	AND MDP.END_DT IS NULL
	LEFT JOIN DW_DEAL_ACTORS_FO PDA 
	ON U.DEAL_ID = PDA.DEAL_ID
	AND u.DEAL_VERSION_CODE = PDA.DEAL_VERSION_CODE
	AND U.DIM_DATE_KEY = PDA.DIM_DATE_KEY
	AND U.RUN_ID = PDA.RUN_ID
	AND PDA.ROLE_CODE = 'PARTEN'
	LEFT JOIN DW_ACTORS PA 
	ON PDA.ACTOR_ID = PA.ACTOR_ID
	AND PDA.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND PDA.RUN_ID = PA.RUN_ID
	LEFT JOIN DW_DEAL_ACTORS_FO MDA 
	ON U.DEAL_ID = MDA.DEAL_ID
	AND u.DEAL_VERSION_CODE = MDA.DEAL_VERSION_CODE
	AND U.DIM_DATE_KEY = MDA.DIM_DATE_KEY
	AND U.RUN_ID = MDA.RUN_ID
	AND MDA.ROLE_CODE = 'EMPRUNT'
	LEFT JOIN DW_ACTORS MA 
	ON MDA.ACTOR_ID = MA.ACTOR_ID
	AND MDA.DIM_DATE_KEY = MA.DIM_DATE_KEY
	AND MDA.RUN_ID = MA.RUN_ID
	LEFT JOIN DW_DEAL_CHARACTERISTICS ARRD
	ON U.DEAL_ID = ARRD.DEAL_ID
	AND U.DIM_DATE_KEY = ARRD.DIM_DATE_KEY
	AND U.RUN_ID = ARRD.RUN_ID
	AND ARRD.CHARACTERISTIC_CODE = 'ARRDATE'
	LEFT JOIN DW_DEAL_CHARACTERISTICS BBM
	ON U.DEAL_ID = BBM.DEAL_ID
	AND U.DIM_DATE_KEY = BBM.DIM_DATE_KEY
	AND U.RUN_ID = BBM.RUN_ID
	AND BBM.CHARACTERISTIC_CODE = 'BBMDATE'
	LEFT JOIN DW_DEAL_CHARACTERISTICS LDED
	ON U.DEAL_ID = LDED.DEAL_ID
	AND U.DIM_DATE_KEY = LDED.DIM_DATE_KEY
	AND U.RUN_ID = LDED.RUN_ID
	AND LDED.CHARACTERISTIC_CODE = 'LDED'
	LEFT JOIN DW_DEAL_PHASE_FO UNEX
	ON u.DEAL_ID = UNEX.DEAL_ID
	AND u.DEAL_VERSION_CODE = UNEX.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = UNEX.DIM_DATE_KEY
	AND u.RUN_ID = UNEX.RUN_ID	
	AND UNEX.STEP_CODE = 'UNEXDOC'
	LEFT JOIN DW_DEAL_PHASE_FO LEG
	ON u.DEAL_ID = LEG.DEAL_ID
	AND u.DEAL_VERSION_CODE = LEG.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = LEG.DIM_DATE_KEY
	AND u.RUN_ID = LEG.RUN_ID	
	AND LEG.STEP_CODE = 'LEGCLPE'
	LEFT JOIN DW_DEAL_INVOLVED_USERS_FO AVP
	ON u.DEAL_ID = AVP.DEAL_ID
	AND u.DEAL_VERSION_CODE = AVP.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = AVP.DIM_DATE_KEY
	AND u.RUN_ID = AVP.RUN_ID	
	AND AVP.BUSINESS_CODE = 'AVP'
	--AND @ReportDate BETWEEN AVP.ASSIGNMENT_START_DT
	--	AND ISNULL(AVP.ASSIGNMENT_END_DT, @ReportDate) 
	LEFT JOIN DW_DEAL_INVOLVED_USERS_FO RVP
	ON u.DEAL_ID = RVP.DEAL_ID
	AND u.DEAL_VERSION_CODE = RVP.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = RVP.DIM_DATE_KEY
	AND u.RUN_ID = RVP.RUN_ID	
	AND RVP.BUSINESS_CODE = 'RVP'
	--AND @ReportDate BETWEEN RVP.ASSIGNMENT_START_DT
	--	AND ISNULL(RVP.ASSIGNMENT_END_DT, @ReportDate) 
	LEFT JOIN DW_DEAL_CHARACTERISTICS PST
	ON U.DEAL_ID = PST.DEAL_ID
	AND U.DIM_DATE_KEY = PST.DIM_DATE_KEY
	AND U.RUN_ID = PST.RUN_ID
	AND PST.CHARACTERISTIC_CODE IN ('100', 'CONCUR', 'CORP'
	, 'EQUIT', 'LUM', 'MULTIAUT', 'MULTIMAT'
	, 'OTHERG', 'POWER', 'PP', 'RUSGU', 'SINGLEI'
	, 'SINGLM', 'TAX', 'TAXE', 'OFFERED')
	 LEFT JOIN DW_DEAL_PHASE_FO FAD
	ON u.DEAL_ID = FAD.DEAL_ID
	AND u.DEAL_VERSION_CODE = FAD.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = FAD.DIM_DATE_KEY
	AND u.RUN_ID = FAD.RUN_ID	
	AND FAD.STEP_CODE = 'APPROK'
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND U.RUN_ID = @RunID
	AND (U.CONTRACT_NUMBER_DESC IS  NULL
	OR (U.CONTRACT_NUMBER_DESC IS NOT NULL 
	AND dp.EFFECTIVE_DT >= DATEADD(DAY, -30, @ReportDate) 
	)
	)
	AND DP.END_DT IS NULL
	ORDER BY MA.ACTOR_CODE_DESC
	, M.DEAL_NUMBER_DESC
	, U.DEAL_NUMBER_DESC
END
GO
/****** Object:  StoredProcedure [rpt].[BUS004FacilityMaturity]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[BUS004FacilityMaturity]
	(@RunID_PAR NUMERIC(10,0), @BeginDT_PAR DATE, @EndDT_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @BeginDT DATE
	, @EndDT DATE

	SELECT @RunID = @RunID_PAR , @BeginDT = @BeginDT_PAR , @EndDT = @EndDT_PAR

	SELECT DISTINCT 
	     -- AVPName = ISNULL(AVP.CREATED_BY_DESC,'-')
	 --  AVPNameCode = ISNULL(AVP.CREATED_BY_CODE,'-')
          FacilityStatus= CP.STEP_DESC
	, MemberID =  A.ACTOR_CODE_DESC
	    , MemeberName = A.SHORT_NAME_DESC
	, AVPName = AVP.USER_BY_DESC
	, UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
	, UnderlyingFacilityMaturityDate = U.CONTRACT_END_DT
	, ProductType = U.PRODUCT_DESC
	, SecuredIndicator= ISNULL(SecI.STRING_VALUE_DESC, 0)

	, UnderlyingFacilityCommitmentAmount = SUM(U.SIGNED_AMT)
	, UnpaidPrincipalBalance = SUM(ISNULL(UNPAID.VALUE_DATE_AMT,0))
	, UnpaidInterestBalance  =  SUM(ISNULL(INTR.VALUE_DATE_AMT,0))
	, UnpaidFeeBalance= SUM(ISNULL(ES.TOTAL_AMT,0) + ISNULL(RLIB.VALUE_DATE_AMT,0))
	
	, TotalOutstandingBalance = SUM(ISNULL(UNPAID.VALUE_DATE_AMT,0)+ISNULL(INTR.VALUE_DATE_AMT,0) + (ISNULL(ES.TOTAL_AMT,0) + ISNULL(RLIB.VALUE_DATE_AMT,0)))
	--, 'ReplacementUnderlyingFacilityNumber'
	--, 'ReplacementDateRequestReceived'
	--, 'ReplacementUnderlyingFacilityAmount'
	--, 'ReplacementUnderlyingFacilityStatus'


	FROM DW_CONTRACTS U
	LEFT JOIN DW_CONTRACT_ACTORS CA 
	ON U.CONTRACT_ID = CA.CONTRACT_ID
	AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
	AND U.RUN_ID = CA.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

	LEFT JOIN DW_ACTORS A 
	ON CA.ACTOR_ID = A.ACTOR_ID
	AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND CA.RUN_ID = A.RUN_ID

	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'

	LEFT JOIN DW_CONTRACT_BALANCES AVAIL 
	ON U.CONTRACT_ID = AVAIL.CONTRACT_ID
	AND U.DIM_DATE_KEY = AVAIL.DIM_DATE_KEY
	AND U.RUN_ID = AVAIL.RUN_ID
	AND AVAIL.BALANCE_TYPE_DESC = 'AVAILABLE'

    LEFT JOIN DW_ELEMENTS E
	     ON E.CONTRACT_ID=U.CONTRACT_ID AND
	    E.DIM_DATE_KEY=U.DIM_DATE_KEY AND
	E.RUN_ID=U.RUN_ID 

	LEFT JOIN DW_PROCESS_ALLOCATIONS PA
       	ON PA.PROCESS_ALLOCATION_ID=E.PROCESS_ALLOCATION_ID AND
	   PA.DIM_DATE_KEY=E.DIM_DATE_KEY AND
	   PA.RUN_ID=E.RUN_ID AND
	   PA.PROCESS_ALLOCATION_CODE LIKE 'FEE%' 	
      
	LEFT JOIN DW_ELEMENT_SCHEDULE ES
	     ON ES.CONTRACT_ID=E.CONTRACT_ID AND
	    ES.DIM_DATE_KEY=E.DIM_DATE_KEY AND
	ES.RUN_ID=E.RUN_ID AND
	ES.ELEMENT_ORDER_NBR=E.ORDER_NBR AND
	ES.RECEIVABLE_ID IS NULL
	AND ES.TOTAL_AMT > 0	   	

    LEFT JOIN DW_RECEIVABLE_DETAILS RD
             ON RD.CONTRACT_ID=U.CONTRACT_ID AND
	    RD.DIM_DATE_KEY=U.DIM_DATE_KEY AND
	RD.RUN_ID = U.RUN_ID

    LEFT JOIN   DW_RECEIVABLE_LINE_ITEMS RLI
             ON RLI.RECEIVABLE_ID=RD.RECEIVABLE_ID AND
	    RLI.RECEIVABLE_DETAILS_ORDER_NBR = RD.ORDER_NBR AND 
	    RLI.DIM_DATE_KEY = RD.DIM_DATE_KEY AND 
	RLI.RUN_ID = RD.RUN_ID
   
     LEFT JOIN DW_REC_LINE_ITEM_BALANCES RLIB
	          ON RLIB.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
	     RLIB.RECEIVABLE_LINE_ITEM_NBR=RLI.RECEIVABLE_LINE_ITEM_NBR AND
	 RLIB.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND
	 RLIB.RUN_ID=RLI.RUN_ID
	 AND RLIB.BALANCE_TYPE_DESC='UNPAID'
	 AND RLIB.VALUE_DATE_AMT > 0 

    LEFT JOIN DW_PROCESS_ALLOCATIONS PA1
       	ON PA1.PROCESS_ALLOCATION_ID=RLI.PROCESS_ALLOCATION_ID AND
	   PA1.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND
	   PA1.RUN_ID=RLI.RUN_ID AND
	   PA1.PROCESS_ALLOCATION_CODE LIKE 'FEE%' 	
    

    LEFT JOIN DW_CONTRACT_BALANCES INTR 
	ON U.CONTRACT_ID = INTR.CONTRACT_ID
	AND U.DIM_DATE_KEY = INTR.DIM_DATE_KEY
	AND U.RUN_ID = INTR.RUN_ID
	AND INTR.BALANCE_TYPE_DESC = 'INTEREST'

    LEFT JOIN DW_CONTRACT_CHARACTERISTICS SecI
       ON U.CONTRACT_ID = SecI.CONTRACT_ID
              AND U.DIM_DATE_KEY = SecI.DIM_DATE_KEY
              AND U.RUN_ID = SecI.RUN_ID
	AND SecI.[CHARACTERISTIC_CODE]='FACCHAR'

	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 
	
	LEFT JOIN DW_INVOLVED_USER AVP
	     ON AVP.CONTRACT_ID=U.CONTRACT_ID AND
	    AVP.DIM_DATE_KEY=U.DIM_DATE_KEY AND
	AVP.RUN_ID=U.RUN_ID 
	AND AVP.BUSINESS_CODE='AVP'

	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	    AND (CP.STEP_DESC = 'Active' OR  (CP.STEP_DESC = 'Matured with Outstanding Balance' AND ISNULL(UNPAID.VALUE_DATE_AMT,0)>0))
	AND  U.CONTRACT_END_DT BETWEEN @BeginDT and @EndDT
	--AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT
	--	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )
	AND U.RUN_ID = @RunID
	
GROUP BY 
       --  ISNULL(AVP.CREATED_BY_CODE,'-'),
         CP.STEP_DESC,
         A.ACTOR_CODE_DESC,
	 AVP.USER_BY_DESC,
	 A.SHORT_NAME_DESC,
	 U.CONTRACT_NUMBER_DESC,
	 U.CONTRACT_END_DT,
	 U.PRODUCT_DESC,
	ISNULL(SecI.STRING_VALUE_DESC, 0)
ORDER BY  
--ISNULL(AVP.CREATED_BY_CODE,'-'), 
U.CONTRACT_END_DT


END

GO
/****** Object:  StoredProcedure [rpt].[BUS010FacilityApprovalLevels]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[BUS010FacilityApprovalLevels]
(@RunID_PAR NUMERIC(10,0), @FinalApprovalBeginDT_PAR DATE, @FinalApprovalEndDT_PAR DATE, @ReportDate_PAR DATE)
AS
BEGIN
--EXEC [rpt].[BUS010FacilityApprovalLevels] 505, '05/01/2015', '05/01/2016' , '05/31/2015'
	SET NOCOUNT ON;

	DECLARE  @RunID NUMERIC(10,0), @FinalApprovalBeginDT DATE, @FinalApprovalEndDT DATE, @ReportDate DATE

	SELECT @RunID = @RunID_PAR, @FinalApprovalBeginDT = @FinalApprovalBeginDT_PAR, @FinalApprovalEndDT = @FinalApprovalEndDT_PAR, @ReportDate = @ReportDate_PAR
	
SELECT DISTINCT
	FinalApprovalLevel = ISNULL(FAL.DECISION_TYPE_DESC, '-'),
	MemeberName = ISNULL(A.TRADE_NAME_DESC, '-'),
	UnderlyingFacilityID = ISNULL(U.CONTRACT_NUMBER_DESC, '-'),
	UnderlyingFacilityCommitmentAmount = ISNULL(U.SIGNED_AMT, 0), 
	FacilityPurpose = ISNULL(CC.STRING_VALUE_DESC, 0),
	ProductType = ISNULL(U.PRODUCT_DESC, 0),
	UnderlyingFacilityStatus = MP.PHASE_DESC ,
	FinalApprovalDate = FAD.EFFECTIVE_DT,
	FacilityRiskRating = FRR.VALUE_DESC,
	FRRAssessmentDate = AD.VALUE_DESC,
	BorrowerRiskRating = RR.RATING_CODE,
	BRRAssessmentDate = RR.START_DT, 
	BusinessType = BT.STRING_VALUE_DESC,
	MemberClass = MC.STRING_VALUE_DESC,
	AVP = AVP.USER_BY_DESC
	, AVPCode = AVP.USER_BY_CODE
	, LendingOrganizationID = PA.ACTOR_ID
	,LendingOrganization = PA.SHORT_NAME_DESC    
	,ProductCode = ISNULL(U.PRODUCT_CODE, 0)
                                        
FROM DW_CONTRACTS U
LEFT JOIN DW_CONTRACT_PHASES MP
                       ON U.REFINANCING_CONTRACT_ID = MP.CONTRACT_ID
                                 AND U.DIM_DATE_KEY = MP.DIM_DATE_KEY
                                  AND U.RUN_ID = MP.RUN_ID 
LEFT JOIN DW_CONTRACT_ACTORS CA 
              ON U.CONTRACT_ID = CA.CONTRACT_ID
                     AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
                     AND U.RUN_ID = CA.RUN_ID
                     AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
LEFT JOIN DW_ACTORS A 
              ON CA.ACTOR_ID = A.ACTOR_ID
                     AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
                     AND CA.RUN_ID = A.RUN_ID
LEFT JOIN DW_ACTORS PA
              ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
                           AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
              AND U.RUN_ID = PA.RUN_ID
LEFT JOIN DW_CONTRACT_CHARACTERISTICS CC
                       ON U.CONTRACT_ID = CC.CONTRACT_ID
                                  AND U.DIM_DATE_KEY = CC.DIM_DATE_KEY
                                  AND U.RUN_ID = CC.RUN_ID
                                  AND CC.CHARACTERISTIC_CODE ='LNPURP'
LEFT JOIN DW_CONTRACT_PHASES CP
              ON U.CONTRACT_ID = CP.CONTRACT_ID
                     AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
                     AND U.RUN_ID = CP.RUN_ID 
 AND CP.PHASE_END_DT is null 

LEFT JOIN DW_ACTOR_CHARACTERISTICS BT 
              ON A.ACTOR_ID = BT. ACTOR_ID
              AND A.DIM_DATE_KEY = BT.DIM_DATE_KEY
              AND A.RUN_ID = BT.RUN_ID
              AND BT.CHARACTERISTIC_CODE='BORBTYP' 

LEFT JOIN DW_ACTOR_CHARACTERISTICS MC 
              ON A.ACTOR_ID = MC.ACTOR_ID
              AND A.DIM_DATE_KEY = MC.DIM_DATE_KEY
              AND A.RUN_ID = MC.RUN_ID
              AND MC.CHARACTERISTIC_CODE = 'MEMCDESC' 

LEFT JOIN DW_ACTOR_RISK_RATING RR
              ON CA.ACTOR_ID = RR.ACTOR_ID 
              AND CA.DIM_DATE_KEY = RR.DIM_DATE_KEY
              AND CA.RUN_ID =RR.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT' 
              AND RR.END_DT IS NULL              
LEFT JOIN DW_INVOLVED_USER AVP
              ON U.DIM_DATE_KEY = AVP.DIM_DATE_KEY
              AND U.RUN_ID = AVP.RUN_ID
              AND U.CONTRACT_ID= AVP.CONTRACT_ID
              AND AVP.BUSINESS_CODE = 'AVP'
LEFT JOIN DW_DEAL_PHASE_FO FAD
                     ON U.REFINANCING_CONTRACT_ID = FAD.DEAL_ID
                           --AND FAD.DEAL_VERSION_CODE = 'PROD'
                           AND U.DIM_DATE_KEY = FAD.DIM_DATE_KEY
                           AND U.RUN_ID = FAD.RUN_ID  
                           AND FAD.STEP_CODE = 'APPROK'
LEFT JOIN DW_DEAL_DECISIONS_FO FAL
              ON U.REFINANCING_CONTRACT_ID = FAL.DEAL_ID 
              AND U.DIM_DATE_KEY = FAL.DIM_DATE_KEY
              AND U.RUN_ID = FAL.RUN_ID
                       AND FAL.DEAL_VERSION_CODE = 'PROD'
LEFT JOIN DW_ANALYSIS DA 
              ON U.CONTRACT_ID = DA.DEAL_ID
                        AND U.DIM_DATE_KEY = DA.DIM_DATE_KEY
                        AND U.RUN_ID = DA.RUN_ID
                        --AND DA.DEAL_VERSION_CODE = 'PROD'                                                        
                        AND DA.ANALYSIS_MATRIX_CODE = 'FRR'
LEFT JOIN DW_ANALYSIS_DETAILS_FO FRR 
                                                ON DA.ANALYSIS_ID = FRR.ANALYSIS_ID
                                              
                  AND DA.DIM_DATE_KEY = FRR.DIM_DATE_KEY
                                                                AND DA.RUN_ID = FRR.RUN_ID
                                                                AND FRR.RATIO_CODE='FACRISK'
LEFT JOIN DW_ANALYSIS_DETAILS_FO AD 
                                                ON DA.ANALYSIS_ID = AD.ANALYSIS_ID
                                                                AND DA.DIM_DATE_KEY = AD.DIM_DATE_KEY
                                                                AND DA.RUN_ID = AD.RUN_ID
                                                                AND AD.RATIO_CODE='CFC-1.1.4'

WHERE U.RUN_ID = @RunID
AND U.PRODUCT_CODE NOT LIKE '%AUT%'
AND FAD.EFFECTIVE_DT BETWEEN @FinalApprovalBeginDT AND @FinalApprovalEndDT
AND CP.STEP_CODE = 'ENG'
AND (@ReportDate BETWEEN MP.PHASE_EFFECTIVE_DT
	AND ISNULL(MP.PHASE_END_DT, @ReportDate) )
AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT
	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )

--ORDER BY U.CONTRACT_NUMBER_DESC
END
GO
/****** Object:  StoredProcedure [rpt].[BUS011DrawPeriodEndDate]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE PROCEDURE [rpt].[BUS011DrawPeriodEndDate]
	(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @ReportDate DATE

	SELECT @RunID = @RunID_PAR
	, @ReportDate = @ReportDate_PAR

	SELECT AVP = AVP.USER_BY_DESC 
	, UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
	, ProductType = U.PRODUCT_CODE
	, ProductSubType = PST.CHARACTERISTIC_CODE
	, UnderlyingFacilityEffectiveDate = U.CONTRACT_START_DT
	, DrawPeriodEndDate = DPED.DATE_VALUE_DT
	, CurrentAvailableAmount  =  AVAIL.VALUE_DATE_AMT
	, StopOrderAmount = SO.STOP_ORDER_AMOUNT
	FROM DW_CONTRACTS U
	LEFT JOIN DW_INVOLVED_USER AVP
	ON u.CONTRACT_ID = AVP.CONTRACT_ID
	AND u.DIM_DATE_KEY = AVP.DIM_DATE_KEY
	AND u.RUN_ID = AVP.RUN_ID	
	AND AVP.BUSINESS_CODE = 'AVP'
	--AND @ReportDate BETWEEN AVP.START_DT
	--	AND ISNULL(AVP.END_DT, @ReportDate) 
	LEFT JOIN DW_CONTRACT_BALANCES AVAIL 
	ON U.CONTRACT_ID = AVAIL.CONTRACT_ID
	AND U.DIM_DATE_KEY = AVAIL.DIM_DATE_KEY
	AND U.RUN_ID = AVAIL.RUN_ID
	AND AVAIL.BALANCE_TYPE_DESC = 'AVAILABLE'
	LEFT JOIN DW_CONTRACT_CHARACTERISTICS PST
	ON U.CONTRACT_ID = PST.CONTRACT_ID
	AND U.DIM_DATE_KEY = PST.DIM_DATE_KEY
	AND U.RUN_ID = PST.RUN_ID
	AND PST.CHARACTERISTIC_CODE IN ('100', 'CONCUR', 'CORP'
	, 'EQUIT', 'LUM', 'MULTIAUT', 'MULTIMAT'
	, 'OTHERG', 'POWER', 'PP', 'RUSGU', 'SINGLEI'
	, 'SINGLM', 'TAX', 'TAXE', 'OFFERED')
	LEFT JOIN DW_CONTRACT_CHARACTERISTICS DPED
	ON U.CONTRACT_ID = DPED.CONTRACT_ID
	AND U.DIM_DATE_KEY = DPED.DIM_DATE_KEY
	AND U.RUN_ID = DPED.RUN_ID
	AND DPED.CHARACTERISTIC_CODE = 'AGREEDA'
	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID
	LEFT JOIN rpt.VW_DW_STOP_ORDER SO
	ON U.CONTRACT_ID = SO.CONTRACT_ID
	AND U.DIM_DATE_KEY = SO.DIM_DATE_KEY
	AND U.RUN_ID = SO.RUN_ID
	AND SO.STOP_ORDER_TYPE = 'Draw Period End Date'
	AND @ReportDate BETWEEN SO.STOP_ORDER_START_DT
	AND ISNULL(SO.STOP_ORDER_END_DT, @ReportDate) 
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND CP.STEP_DESC IN ('Active', 'Matured with Outstanding Balance', 'Matured') 
	AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT
	AND ISNULL(CP.PHASE_END_DT, @ReportDate) 
	)
	AND U.RUN_ID = @RunID
	AND DPED.DATE_VALUE_DT < @ReportDate
	--AND ( (DPED.DATE_VALUE_DT < @ReportDate 
	--	AND AVAIL.VALUE_DATE_AMT > 0)
	--	OR 
	--	DPED.DATE_VALUE_DT BETWEEN  @ReportDate AND DATEADD(MONTH, 3, @ReportDate )
	--	)
	ORDER BY AVP.USER_BY_DESC 
	, U.CONTRACT_NUMBER_DESC
END
GO
/****** Object:  StoredProcedure [rpt].[BUS012CommittedFacilities]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[BUS012CommittedFacilities]
	(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	
	DECLARE @RunID NUMERIC(10,0)
	, @ReportDate DATE

	SELECT @RunID = @RunID_PAR
	, @ReportDate = @ReportDate_PAR

	
	SELECT DISTINCT U.CONTRACT_ID,
	LendingOrganization=ISNULL(PA.SHORT_NAME_DESC, 0),
	MemeberName = ISNULL(A.TRADE_NAME_DESC, '-')
	, UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
	, MemberClassDescription = AC.STRING_VALUE_DESC
	, ProductType = U.PRODUCT_DESC
	, ProductSubType = PST.CHARACTERISTIC_CODE
	, HybridIndicator = NULL
	, RevolvingIndicator = CASE RI.REVOLVING_CREDIT_IND 
	WHEN '1' THEN 'Revolving'
	WHEN '0' THEN 'Not Revolving'
	END
	, UnderlyingFacilityCommitmentAmount = U.SIGNED_AMT
	, ExternalReportingStopOrderAmount = SO.STOP_ORDER_AMOUNT
	, UseOfProceedsStopOrderAmount = SO.STOP_ORDER_AMOUNT 
	, UnpaidPrincipalBalance = UNPAID.VALUE_DATE_AMT
	, CurrentAvailableAmount  =  AVAIL.VALUE_DATE_AMT
	, UnderlyingFacilityEffectiveDate = U.CONTRACT_1ST_ENTRY_DT
	, UnderlyingFacilityMaturityDate = U.CONTRACT_END_DT
	, BorrowerRiskRating = BRR.RATING_CODE
	, FacilityRiskRating = FRR.VALUE_DESC

--SELECT  *
FROM DW_CONTRACTS U
	LEFT JOIN DW_CONTRACT_ACTORS CA 
       ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
LEFT JOIN DW_ACTORS PA
	ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
	  AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
              AND U.RUN_ID = PA.RUN_ID
LEFT JOIN DW_ACTORS A 
       ON CA.ACTOR_ID = A.ACTOR_ID
              AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
              AND CA.RUN_ID = A.RUN_ID
	
LEFT JOIN DW_ACTOR_CHARACTERISTICS AC
	ON A.RUN_ID = AC.RUN_ID
	AND A.DIM_DATE_KEY = AC.DIM_DATE_KEY
	AND A.ACTOR_ID = AC.ACTOR_ID
	AND AC.CHARACTERISTIC_CODE = 'MEMCDESC'

LEFT JOIN DW_ACTOR_RISK_RATING BRR
	ON CA.ACTOR_ID = BRR.ACTOR_ID
	AND CA.DIM_DATE_KEY = BRR.DIM_DATE_KEY
	AND CA.RUN_ID =BRR.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT' 

LEFT JOIN DW_CONTRACT_CHARACTERISTICS PST
	ON U.CONTRACT_ID = PST.CONTRACT_ID
	AND U.DIM_DATE_KEY = PST.DIM_DATE_KEY
	AND U.RUN_ID = PST.RUN_ID
	AND PST.CHARACTERISTIC_CODE = 'SUBTYPE3'
LEFT JOIN DW_CONTRACT_CREDIT_INFO RI
	ON U.RUN_ID = RI.RUN_ID
	AND U.DIM_DATE_KEY = RI.DIM_DATE_KEY
	AND U.CONTRACT_ID = RI.CONTRACT_ID

LEFT JOIN rpt.VW_DW_STOP_ORDER SO
	ON U.CONTRACT_ID = SO.CONTRACT_ID
	AND U.DIM_DATE_KEY = SO.DIM_DATE_KEY
	AND U.RUN_ID = SO.RUN_ID
	AND SO.STOP_ORDER_GROUP IN ('External Reporting','Use of Proceeds')
	AND @ReportDate BETWEEN SO.STOP_ORDER_START_DT
	    AND ISNULL(SO.STOP_ORDER_END_DT, @ReportDate) 

LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'

LEFT JOIN DW_CONTRACT_BALANCES AVAIL 
	ON U.CONTRACT_ID = AVAIL.CONTRACT_ID
	AND U.DIM_DATE_KEY = AVAIL.DIM_DATE_KEY
	AND U.RUN_ID = AVAIL.RUN_ID
	AND AVAIL.BALANCE_TYPE_DESC = 'AVAILABLE'

LEFT JOIN DW_ANALYSIS DA 
              ON U.CONTRACT_ID = DA.DEAL_ID
                        AND U.DIM_DATE_KEY = DA.DIM_DATE_KEY
                        AND U.RUN_ID = DA.RUN_ID
                        --AND DA.DEAL_VERSION_CODE = 'PROD'                                                        
                        AND DA.ANALYSIS_MATRIX_CODE = 'FRR'

LEFT JOIN DW_ANALYSIS_DETAILS_FO FRR 
               ON DA.ANALYSIS_ID = FRR.ANALYSIS_ID
	AND DA.DIM_DATE_KEY = FRR.DIM_DATE_KEY
                        AND DA.RUN_ID = FRR.RUN_ID
                        AND FRR.RATIO_CODE='FACRISK'

LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 

WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	--AND CP.STEP_CODE = 'ENG'
	AND CP.STEP_DESC = 'Committed'
	AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT
	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )
	AND U.RUN_ID = @RunID

	--ORDER BY PA.SHORT_NAME_DESC
	--, U.CONTRACT_NUMBER_DESC


END
GO
/****** Object:  StoredProcedure [rpt].[BUS013FRR_BRRAssessmentDateDifference]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [rpt].[BUS013FRR_BRRAssessmentDateDifference]
(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR

	SELECT AVP = AVP.USER_BY_DESC 
	, UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
	, ManualAdjustmentType = CASE MAT.VALUE_DESC 
	WHEN '1' THEN 'Manual Adjustment'
	WHEN '0' THEN 'No Manual Adjustment'
	END
	, FRRAssessmentDate = FRRA.VALUE_DESC
	, BRRAssessmentDate = BRR.START_DT
	FROM DW_CONTRACTS U
	LEFT JOIN DW_INVOLVED_USER AVP 
	ON u.CONTRACT_ID = AVP.CONTRACT_ID
	AND u.DIM_DATE_KEY = AVP.DIM_DATE_KEY
	AND u.RUN_ID = AVP.RUN_ID	
	AND AVP.BUSINESS_CODE = 'AVP'
	AND AVP.END_DT IS NULL
	LEFT JOIN DW_CONTRACT_ACTORS CA 
	ON U.CONTRACT_ID = CA.CONTRACT_ID
	AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
	AND U.RUN_ID = CA.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
	LEFT JOIN DW_ACTORS A 
	ON CA.ACTOR_ID = A.ACTOR_ID
	AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND CA.RUN_ID = A.RUN_ID
	LEFT JOIN DW_ACTOR_RISK_RATING BRR
	ON A.ACTOR_ID = BRR.ACTOR_ID
	AND A.DIM_DATE_KEY = BRR.DIM_DATE_KEY
	AND A.RUN_ID = BRR.RUN_ID
	AND BRR.RATING_CODE = 'BRR'
	AND BRR.END_DT IS NULL
	LEFT JOIN DW_ANALYSIS DA
	ON U.CONTRACT_ID = DA.DEAL_ID
	AND U.DIM_DATE_KEY = DA.DIM_DATE_KEY
	AND U.RUN_ID = DA.RUN_ID
	--AND DA.DEAL_VERSION_CODE = 'PROD'
	AND DA.ANALYSIS_MATRIX_CODE = 'FRR'
	LEFT JOIN DW_ANALYSIS_DETAILS_FO FRRA
	ON DA.ANALYSIS_ID = FRRA.ANALYSIS_ID
	AND DA.DIM_DATE_KEY = FRRA.DIM_DATE_KEY
	AND DA.RUN_ID = FRRA.RUN_ID
	AND FRRA.RATIO_CODE='CFC-1.1.4'
	LEFT JOIN DW_ANALYSIS_DETAILS_FO MAT
	ON DA.ANALYSIS_ID = MAT.ANALYSIS_ID
	AND DA.DIM_DATE_KEY = MAT.DIM_DATE_KEY
	AND DA.RUN_ID = MAT.RUN_ID
	AND MAT.RATIO_CODE='CFC-1.3.5'
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND u.RUN_ID = @RunID
	AND FRRA.VALUE_DESC < BRR.START_DT
	ORDER BY AVP.USER_BY_DESC 
	, U.CONTRACT_NUMBER_DESC

END
GO
/****** Object:  StoredProcedure [rpt].[BUS013FRRandBRRAssessmentDateDifference]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[BUS013FRRandBRRAssessmentDateDifference]
(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR

	; WITH ManualAdjustment
	AS
	(	SELECT MA.DEAL_ID
	, MA.DIM_DATE_KEY
	, MA.RUN_ID
	, MA.CHARACTERISTIC_CODE
	, RowRank =  ROW_NUMBER() OVER(PARTITION BY MA.DEAL_ID ORDER BY MA.DEAL_CHARACTERISTIC_ID DESC) 
	FROM DW_DEAL_CHARACTERISTICS MA
	WHERE MA.RUN_ID = @RunID
	AND MA.CHARACTERISTIC_CODE IN ('FRRB2', 'FRRB3', 'FRRC2', 'FRRC9', 'FRRD1', 'FRRE1')
	AND MA.STRING_VALUE_DESC IS NOT NULL	
	)
	
	SELECT AVP = AVP.USER_BY_DESC 
	, UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
	, ManualAdjustmentType = RIGHT(MA.CHARACTERISTIC_CODE, 2)
	, FRRAssessmentDate = FRRA.VALUE_DESC
	, BRRAssessmentDate = BRR.START_DT
	, LendingOrganization = LO.SHORT_NAME_DESC
	, LendingOrganizationID = LO.ACTOR_ID
	FROM DW_CONTRACTS U
	LEFT JOIN DW_INVOLVED_USER AVP 
	ON u.CONTRACT_ID = AVP.CONTRACT_ID
	AND u.DIM_DATE_KEY = AVP.DIM_DATE_KEY
	AND u.RUN_ID = AVP.RUN_ID	
	AND AVP.BUSINESS_CODE = 'AVP'
	AND AVP.END_DT IS NULL
	LEFT JOIN DW_CONTRACT_ACTORS CA 
	ON U.CONTRACT_ID = CA.CONTRACT_ID
	AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
	AND U.RUN_ID = CA.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
	LEFT JOIN DW_ACTORS A 
	ON CA.ACTOR_ID = A.ACTOR_ID
	AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND CA.RUN_ID = A.RUN_ID
	LEFT JOIN DW_ACTOR_RISK_RATING BRR
	ON A.ACTOR_ID = BRR.ACTOR_ID
	AND A.DIM_DATE_KEY = BRR.DIM_DATE_KEY
	AND A.RUN_ID = BRR.RUN_ID
	AND BRR.END_DT IS NULL
	LEFT JOIN DW_ANALYSIS DA
	ON U.CONTRACT_ID = DA.DEAL_ID
	AND U.DIM_DATE_KEY = DA.DIM_DATE_KEY
	AND U.RUN_ID = DA.RUN_ID
	--AND DA.DEAL_VERSION_CODE = 'PROD'
	AND DA.ANALYSIS_MATRIX_CODE = 'FRR'
	LEFT JOIN DW_ANALYSIS_DETAILS_FO FRRA
	ON DA.ANALYSIS_ID = FRRA.ANALYSIS_ID
	AND DA.DIM_DATE_KEY = FRRA.DIM_DATE_KEY
	AND DA.RUN_ID = FRRA.RUN_ID
	AND FRRA.RATIO_CODE='CFC-1.1.4'
	LEFT JOIN ManualAdjustment MA
	ON U.CONTRACT_ID = MA.DEAL_ID
	AND U.DIM_DATE_KEY = MA.DIM_DATE_KEY
	AND U.RUN_ID = MA.RUN_ID
	AND MA.RowRank = 1
	LEFT JOIN DW_ACTORS LO
	ON U.COMPANY_ACTOR_ID=LO.ACTOR_ID
	AND U.DIM_DATE_KEY = LO.DIM_DATE_KEY
	AND U.RUN_ID = LO.RUN_ID
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND u.RUN_ID = @RunID
	AND FRRA.VALUE_DESC < BRR.START_DT
	ORDER BY AVP.USER_BY_DESC 
	, U.CONTRACT_NUMBER_DESC

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0020AmortizationSchedule_Detail]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
PURPOSE:-This procedure is used to build the report [rpt].[RPT0020AmortizationSchedule]
CREATED BY:- RAVITEJA
CREATED DATE:-05/12/2016
Functions Used:- This procedure uses the function dbo.fn_MVParam to split the Report Parameters into comma seperated values
---------------------------------------------------------REVISION HISTORY-----------------------------
MODIFIED BY:
MODIFIED DATE:
BASE VERSION:
TAG USED:
*/
CREATE PROCEDURE [rpt].[RPT0020AmortizationSchedule_Detail]
(@RunID_PAR NUMERIC(10,0), @LendingOrg_PAR VARCHAR(MAX),@CustomerID_PAR Varchar(MAX),@FacilityID_PAR Varchar(MAX),@LoanId_PAR Varchar(MAX))
AS
BEGIN
	
	SET NOCOUNT ON;

-----------Declaring new set of varibles to pass report parameter values-----------------------
	DECLARE  @RunID NUMERIC(10,0), @LendingOrg VARCHAR(MAX),@CustomerID Varchar(MAX),@FacilityID Varchar(MAX),@LoanId Varchar(MAX)

----------Declaring Flag variables
	DECLARE @CustomerID_Flag Int = 0,@FacilityID_Flag Int = 0,@LoanId_Flag Int = 0

----------Passing Report Parameter values to procedure Parameters------------------------------
	SELECT  @RunID = @RunID_PAR, 
	@LendingOrg = @LendingOrg_PAR,
	@CustomerID = @CustomerID_PAR,
	@FacilityID = @FacilityID_PAR, 
	@LoanId = @LoanId_PAR

/* Setting Flag to fetch for all Customers/Facility/Loans if They select Nulls in report*/

IF @CustomerID_PAR IS NULL OR @CustomerID_PAR LIKE '%Null%'
	Begin
	set @CustomerID_Flag = 1
	End
IF @FacilityID_PAR IS NULL OR @FacilityID_PAR LIKE '%Null%'
	BEGIN
	SET @FacilityID_Flag = 1
	END
IF @LoanId_PAR IS NULL OR @LoanId_PAR LIKE '%Null%'
	BEGIN
	SET @LoanId_Flag = 1
	END
----------------------------------Uncomment below commands for testing--------------------------------------------------
--	SELECT  @RunID,
--	@CustomerID ,
--	@FacilityID  ,
--	@LoanId  
------------------------------------Comment above block once testing is done----------------------------
SELECT DISTINCT
	DE.Loan_NBR AS [Loan ID],
	DA_BORR.TRADE_NAME_DESC AS [Customer Name],
	DA_BORR.ACTOR_CODE_DESC AS [Customer ID],
	Substring(DC.CONTRACT_NUMBER_DESC,6,4) AS [Facility ID],
	DA.SHORT_NAME_DESC AS [Lending Organization],
	DESH.PAYMENT_DUE_DT AS [Payment Due Date],
	DESH.TOTAL_AMT AS [Total Amount],
	DESH.PRINCIPAL_AMT AS [Principal Amount],
	DESH.INTEREST_AMT AS [Interest Amount],
	DESH.POST_PRINCIPAL_BALANCE_AMT AS [Ending Balance],
	DESH.ANNUAL_PERCENTAGE_RATE_PCT AS [Interest Rate],
	DESH.PRINCIPAL_AMT + DESH.POST_PRINCIPAL_BALANCE_AMT AS [Beginning Balance],
	DE.INITIAL_BASIS_AMT AS [Loan Approved Amount],
	DE.FINANCIAL_PMT_SCHED_TYPE_DESC AS [Amortization Method],
	EXTERNAL_TERM_NBR AS [No of Payments],
	CASE WHEN PERIOD_TYPE_CODE = '360' THEN 'Annual'
	 WHEN PERIOD_TYPE_CODE = '180' THEN 'Semi-annual'
	 WHEN PERIOD_TYPE_CODE = '090' THEN 'Quarterly'
	 WHEN PERIOD_TYPE_CODE = '030' THEN 'Monthly'
	 Else 'Not a valid Frequency'
	END AS [Billing Frequency],
	PERIOD_TYPE_CODE,
	CASE DE.INT_NUMERATOR_COUNT_CODE WHEN '365/366' THEN 'ACTUAL' ELSE DE.INT_NUMERATOR_COUNT_CODE END+'/'+CASE DE.INT_DENOMINATOR_COUNT_CODE WHEN '365/366' THEN 'ACTUAL' ELSE DE.INT_DENOMINATOR_COUNT_CODE END AS [Day Code]
	
	FROM [dbo].[DW_ELEMENTS] DE 
	Left JOIN DW_ELEMENT_SCHEDULE DESH
	ON  DE.CONTRACT_ID = DESH.CONTRACT_ID
	AND DE.ORDER_NBR = DESH.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DESH.DIM_DATE_KEY
	AND DE.RUN_ID = DESH.RUN_ID
	Inner JOIN [dbo].[DW_ELEMENT_FLOWS] DEF
	ON  DE.CONTRACT_ID = DEF.CONTRACT_ID
	AND DE.ORDER_NBR = DEF.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DEF.DIM_DATE_KEY
	AND DE.RUN_ID = DEF.RUN_ID
	AND DEF.PERIOD_TYPE_CODE <>'001'
	Inner Join DW_CONTRACTS DC
	ON  DE.CONTRACT_ID = DC.CONTRACT_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.RUN_ID = DC.RUN_ID
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID
	
	WHERE DE.RUN_ID = @RunID
	--	AND	(DESH.PAYMENT_DUE_DT >=  @PaymentCycleBeginDT AND DESH.PAYMENT_DUE_DT <= @PaymentCycleEndDT)
	AND (DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	AND (@CustomerID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@CustomerID,',')))
	AND (@FacilityID_Flag = 1 OR DC.CONTRACT_NUMBER_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
	AND EXTERNAL_TERM_NBR IS NOT NULL -- EXCLUDING INVESTMENTS AND ESTIMATED PAYOFF DATE
	AND DE.ELEMENT_CLASS_CODE = 'F' AND DE.ELEMENT_TYPE_CODE = 'F' -- EXCLUDING FEE
	AND DC.PRODUCT_CODE = 'P1P'-- FOR LONG TERM LOANS
	AND DE.INTEREST_RATE_NATURE_CODE = 'TF' -- FOR ONLY FIXED LOANS
	AND DE.Loan_NBR IS NOT NULL
	
END



--EXEC [rpt].[RPT0020AmortizationSchedule_Detail] 623,'RTFC',Null,Null,nULL
--EXEC [rpt].[RPT0020AmortizationSchedule_Detail] 162,'Null,AK003,AK005,AK601,AL042,AR010,NH004,VT015',Null,Null
--EXEC [rpt].[RPT0320ForecastReport] 162,Null,Null,5,'RTFC,cfc','AK001,AK002,AK003,AK005'
GO
/****** Object:  StoredProcedure [rpt].[RPT0030ADBReasonableness]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--EXEC [rpt].[RPT0030ADBReasonableness]  505,'05/31/2015'
--EXEC [rpt].[RPT0030ADBReasonableness]  162,'2016-05-04'
--EXEC [rpt].[RPT0030ADBReasonableness]  162,'2016-05-04'

CREATE PROCEDURE [rpt].[RPT0030ADBReasonableness]
(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)

AS


BEGIN
	
	SET NOCOUNT ON;

	DECLARE   @RunID NUMERIC(10,0), @ReportDate DATE, @NumberOfPeriodsMonth INT, @NumberOfPeriodsYear INT

	SELECT @RunID = @RunID_PAR, @ReportDate = @ReportDate_PAR--,@Short_name_desc = @Short_name_desc_PAR


SELECT @NumberOfPeriodsMonth=COUNT(DISTINCT RUN_ID) FROM DW_ELEMENT_BALANCES WHERE 
MONTH(@ReportDate)=LEFT(RIGHT(EFFECTIVE_DATE_KEY,4),2) AND
YEAR(@ReportDate)=LEFT(EFFECTIVE_DATE_KEY,4)

SELECT @NumberOfPeriodsYear=COUNT(DISTINCT RUN_ID) FROM DW_ELEMENT_BALANCES WHERE 
YEAR(@ReportDate)=LEFT(EFFECTIVE_DATE_KEY,4)


;WITH ElementBalances
AS
(
       SELECT          CONTRACT_ID
                     , ELEMENT_ORDER_NBR
                     , BALANCE_TYPE_DESC
                     , VALUE_DATE_AMT
                     , EFFECTIVE_DATE_KEY
                     , ROW_RANK = ROW_NUMBER() OVER(PARTITION BY CONTRACT_ID, ELEMENT_ORDER_NBR, BALANCE_TYPE_DESC ORDER BY EFFECTIVE_DATE_KEY DESC) 
       FROM DW_ELEMENT_BALANCES
       WHERE BALANCE_TYPE_DESC IN ('PRINCIPAL', 'INTEREST','INT_PAID_MTD','INT_PAID_FYTD')
       AND CAST(CAST(EFFECTIVE_DATE_KEY AS VARCHAR(8)) AS DATE) <= @ReportDate
)

,
ADBMonthBal
AS
(

SELECT                 CONTRACT_ID 
                     , ELEMENT_ORDER_NBR
                     , BALANCE_TYPE_DESC
	 , MONTH(@ReportDate) as MTH
	 , YEAR(@ReportDate) as YR
                     , SUM(VALUE_DATE_AMT) as BALANCE
       
	   FROM DW_ELEMENT_BALANCES
       WHERE BALANCE_TYPE_DESC IN ('PRINCIPAL', 'INTEREST')
	    AND MONTH(CAST(CAST(EFFECTIVE_DATE_KEY AS VARCHAR(8)) AS DATE)) <= MONTH(@ReportDate)
	   GROUP BY        CONTRACT_ID
                     , ELEMENT_ORDER_NBR
                     , BALANCE_TYPE_DESC
	 --, MONTH('05/31/2015')
	-- , YEAR('05/31/2015')

),

ADBYearBal
AS
(

SELECT                 CONTRACT_ID 
                     , ELEMENT_ORDER_NBR
                     , BALANCE_TYPE_DESC
	 , YEAR(@ReportDate) as YR
                     , SUM(VALUE_DATE_AMT) as BALANCE
       
	   FROM DW_ELEMENT_BALANCES
       WHERE BALANCE_TYPE_DESC IN ('PRINCIPAL', 'INTEREST')
	   AND YEAR(CAST(CAST(EFFECTIVE_DATE_KEY AS VARCHAR(8)) AS DATE)) <= YEAR(@ReportDate)
	   GROUP BY        CONTRACT_ID
                     , ELEMENT_ORDER_NBR
                     , BALANCE_TYPE_DESC
	 --, MONTH('05/31/2015')
	-- , YEAR('05/31/2015')
)

SELECT 
DISTINCT
       LendingOrganizationID=ISNULL(PA.ACTOR_ID, 0),
	   FacilityID= U.CONTRACT_ID,
	   FixedVariable= E.INTEREST_RATE_NATURE_CODE,
	   InterestRateType = E.INTEREST_RATE_NATURE_DESC,
	   RateFormula=EVRD.RATE_TYPE_DESC, 
       ProductType=ISNULL(U.PRODUCT_DESC, 0),
       MemberID = ISNULL(A.ACTOR_CODE_DESC,'-'),
       MemberName=ISNULL(A.TRADE_NAME_DESC, 0),
       LoanID = ISNULL(E.LOAN_NBR, '-'),
       AllInRate = ISNULL(E.USED_FIXED_RATE_PCT, 0),
       ADBMonthBalance = ADBM.BALANCE/@NumberOfPeriodsMonth,
	   ADBYearBalance = ADBY.BALANCE/@NumberOfPeriodsYear ,
	   UnpaidInterestBalance=ISNULL(UNPAIDI.VALUE_DATE_AMT, 0),
	   UnpaidPrincipalBalance=ISNULL(UNPAIDP.VALUE_DATE_AMT, 0),   
	   InterestIncomeFYTD = ISNULL(INT_PAID_FYTD.VALUE_DATE_AMT, 0),
       InterestIncomeMTD = ISNULL(INT_PAID_MTD.VALUE_DATE_AMT, 0)
      
FROM DW_ELEMENTS E

LEFT JOIN DW_ELEMENT_VARIABLE_RATES EV
	ON EV.ELEMENT_ORDER_NBR=E.ORDER_NBR
	AND EV.ELEMENT_ORDER_NBR = E.ORDER_NBR
	  AND EV.CONTRACT_ID = E.CONTRACT_ID
              AND EV.DIM_DATE_KEY = E.DIM_DATE_KEY
              AND EV.RUN_ID = E.RUN_ID

LEFT JOIN [DW_ELEMENT_VAR_RATE_DETAILS] EVRD
       ON EV.ELEMENT_ORDER_NBR=EVRD.ELEMENT_ORDER_NBR AND
	      EV.CONTRACT_ID=EVRD.CONTRACT_ID AND
	  EV.DIM_DATE_KEY=EVRD.DIM_DATE_KEY AND
	  EV.RUN_ID=EVRD.DIM_DATE_KEY

--LEFT JOIN DW_ELEMENT_CHARACTERISTICS BRC
--       ON E.CONTRACT_ID = BRC.CONTRACT_ID
--	   AND E.ORDER_NBR = BRC.ELEMENT_ORDER_NBR
--              AND E.DIM_DATE_KEY = BRC.DIM_DATE_KEY
--              AND E.RUN_ID = BRC.RUN_ID
--              AND BRC.[CHARACTERISTIC_CODE] = 'LNBRTCD'

LEFT JOIN DW_ELEMENT_CHARACTERISTICS NRD
       ON E.CONTRACT_ID = NRD.CONTRACT_ID
	   AND E.ORDER_NBR = NRD.ELEMENT_ORDER_NBR
              AND E.DIM_DATE_KEY = NRD.DIM_DATE_KEY
              AND E.RUN_ID = NRD.RUN_ID
              AND NRD.[CHARACTERISTIC_CODE] = 'REPEFFDT'

INNER JOIN DW_CONTRACTS U
       ON E.CONTRACT_ID = U.CONTRACT_ID
              AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND E.RUN_ID = U.RUN_ID

LEFT JOIN DW_CONTRACT_ACTORS CA 
       ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
LEFT JOIN DW_ACTORS PA
ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
 AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
              AND U.RUN_ID = PA.RUN_ID
LEFT JOIN DW_ACTORS A 
       ON CA.ACTOR_ID = A.ACTOR_ID
              AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
              AND CA.RUN_ID = A.RUN_ID

LEFT JOIN DW_CONTRACT_CHARACTERISTICS SecI
	ON U.CONTRACT_ID = SecI.CONTRACT_ID
	AND U.DIM_DATE_KEY = SecI.DIM_DATE_KEY
	AND U.RUN_ID = SecI.RUN_ID
	and SecI.CHARACTERISTIC_CODE ='FACCHAR'
	
LEFT JOIN DW_ELEMENT_SCHEDULE es 
       ON e.CONTRACT_ID = es.CONTRACT_ID
                     AND e.ORDER_NBR = es.ELEMENT_ORDER_NBR
                     AND e.DIM_DATE_KEY = es.DIM_DATE_KEY
                     AND e.RUN_ID = es.RUN_ID 

LEFT JOIN ElementBalances UNPAIDP 
       ON E.CONTRACT_ID = UNPAIDP.CONTRACT_ID
            AND E.ORDER_NBR = UNPAIDP.ELEMENT_ORDER_NBR
            AND UNPAIDP.BALANCE_TYPE_DESC = 'PRINCIPAL'
	AND UNPAIDP.ROW_RANK = 1

 JOIN ADBMonthBal ADBM 
       ON E.CONTRACT_ID = ADBM.CONTRACT_ID
            AND E.ORDER_NBR = ADBM.ELEMENT_ORDER_NBR
            AND ADBM.BALANCE_TYPE_DESC = 'PRINCIPAL'
	AND ADBM.MTH=MONTH(@ReportDate)

 JOIN ADBYearBal ADBY 
       ON E.CONTRACT_ID = ADBY.CONTRACT_ID
            AND E.ORDER_NBR = ADBY.ELEMENT_ORDER_NBR
            AND ADBY.BALANCE_TYPE_DESC = 'PRINCIPAL'
	AND ADBY.YR=YEAR(@ReportDate)	

LEFT JOIN ElementBalances UNPAIDI 
       ON E.CONTRACT_ID = UNPAIDI.CONTRACT_ID
	       AND E.ORDER_NBR = UNPAIDI.ELEMENT_ORDER_NBR
           AND UNPAIDI.BALANCE_TYPE_DESC = 'INTEREST'
	   AND UNPAIDI.ROW_RANK = 1

LEFT JOIN ElementBalances INT_PAID_MTD 
       ON E.CONTRACT_ID = INT_PAID_MTD.CONTRACT_ID
	       AND E.ORDER_NBR = INT_PAID_MTD.ELEMENT_ORDER_NBR
           AND INT_PAID_MTD.BALANCE_TYPE_DESC = 'INT_PAID_MTD'
	   AND INT_PAID_MTD.ROW_RANK = 1

LEFT JOIN ElementBalances INT_PAID_FYTD 
       ON E.CONTRACT_ID = INT_PAID_FYTD.CONTRACT_ID
	       AND E.ORDER_NBR = INT_PAID_FYTD.ELEMENT_ORDER_NBR
           AND INT_PAID_FYTD.BALANCE_TYPE_DESC = 'INT_PAID_FYTD'
	   AND INT_PAID_FYTD.ROW_RANK = 1

WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND E.ELEMENT_CLASS_CODE = 'F'
	AND E.ELEMENT_TYPE_CODE = 'F'
	AND U.RUN_ID = @RunID
	--AND E.LOAN_NBR='KS8279002007'
	--AND ES.EXTERNAL_TERM_NBR IS NOT NULL

END

GO
/****** Object:  StoredProcedure [rpt].[RPT0040GLSubledger]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
PURPOSE:-This procedure is used to build the report [rpt].[RPT0040GLSubledger]
CREATED BY:- RAVITEJA
CREATED DATE:-07/18/2016
Functions Used:- This procedure uses the function dbo.fn_MVParam to split the Report Parameters into comma seperated values
---------------------------------------------------------REVISION HISTORY-----------------------------
MODIFIED BY:
MODIFIED DATE:
BASE VERSION:
TAG USED:
*/
CREATE PROCEDURE [rpt].[RPT0040GLSubledger]
(@RunID_PAR NUMERIC(10,0), @LendingOrg_PAR Varchar(100), @MemberID_PAR Varchar(MAX),@FacilityID_PAR VARCHAR (MAX),@LoanId_PAR VARCHAR(MAX),@GLNumbers_PAR VARCHAR(MAX),@AccountingAsOfDate_PAR Date)
AS
BEGIN
	
	SET NOCOUNT ON;

-----------Declaring new set of varibles to pass report parameter values-----------------------
	DECLARE @RunID NUMERIC(10,0), @LendingOrg Varchar(100), @MemberID  Varchar(MAX),@FacilityID VARCHAR (MAX),@LoanId VARCHAR(MAX),@GLNumbers VARCHAR(MAX),@AccountingAsOfDate Date
----------Declaring Flag variables
	DECLARE @MemberID_Flag Int = 0,@FacilityID_Flag Int = 0,@LoanId_Flag Int = 0,@GLNumbers_Flag Int = 0


----------Passing Report Parameter values to procedure Parameters------------------------------
	SELECT  @RunID = @RunID_PAR,
	@LendingOrg = @LendingOrg_PAR, 
	@MemberID = @MemberID_PAR,
	@FacilityID = @FacilityID_PAR,
	@LoanId = @LoanId_PAR,
	@GLNumbers = @GLNumbers_PAR,
	@AccountingAsOfDate = @AccountingAsOfDate_PAR

/* Setting Flag to fetch for all Customers/Facility/Loans if They select Nulls in report*/
IF @MemberID_PAR IS NULL OR @MemberID_PAR LIKE '%Null%'
	Begin
	set @MemberID_Flag = 1
	End
IF @FacilityID_PAR IS NULL OR @FacilityID_PAR LIKE '%Null%'
	BEGIN
	SET @FacilityID_Flag = 1
	END
IF @LoanId_PAR IS NULL OR @LoanId_PAR LIKE '%Null%'
	BEGIN
	SET @LoanId_Flag = 1
	END	
IF @GLNumbers_PAR IS NULL OR @GLNumbers_PAR LIKE '%Null%'
	BEGIN
	SET @GLNumbers_Flag = 1
	END
----------------------------------Uncomment below commands for testing--------------------------------------------------
--	SELECT  @RunID = -
--	@LendingOrg = 
--	@MemberID = 
--	@LoanId = 
--	@GLNumbers =
--	@AccountingAsOfDate =
----------------------------------Comment above block once testing is done----------------------------

SELECT 	DISTINCT DA.SHORT_NAME_DESC AS [Lending Organization],
	 DA_BORR.TRADE_NAME_DESC AS [Member Name],
	 DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	 DC.CONTRACT_NUMBER_DESC AS [Facility ID],
	 DE.LOAN_NBR,
	 GL_Name,
	 GL_ACCOUNT_NUMBER_DESC,
	 SUM(DEB.VALUE_DATE_AMT) AS  [Ending Period Balance],
	 'Loan Receivables' AS 'Report_Section'
--SELECT DISTINCT *
   FROM [dbo].[DW_ELEMENTS] DE
	INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] DEB
	ON  DE.CONTRACT_ID = DEB.CONTRACT_ID
	AND DE.RUN_ID = DEB.RUN_ID
	AND DE.DIM_DATE_KEY = DEB.DIM_DATE_KEY
	AND DE.ORDER_NBR = DEB.ELEMENT_ORDER_NBR
	AND BALANCE_TYPE_DESC = 'PRINCIPAL'
	INNER JOIN [dbo].[DW_CONTRACTS] DC
	ON  DE.RUN_ID = DC.RUN_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.CONTRACT_ID = DC.CONTRACT_ID
	INNER JOIN (select DC.RUN_ID,DC.DIM_DATE_KEY,DC.CONTRACT_ID, LOAN_NBR,
	Case when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LT Loan)'
	 when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LT NonPerform'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LOC Loan)'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LOC NonPerform'
	-------------------
	 when DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LT Loan)'
	 when DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate  LT NonPerform'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LOC Loan)'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate LOC NonPerform'
	 END AS 'GL_Name' 
	FROM [dbo].[DW_CONTRACTS] DC
	INNER JOIN [dbo].[DW_ELEMENTS] DE
	ON  DC.RUN_ID = DE.RUN_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.CONTRACT_ID = DE.CONTRACT_ID
	INNER JOIN [DBO].[DW_PROCESS_ALLOCATIONS] DPA
	ON  DE.RUN_ID = DPA.RUN_ID
	AND DE.DIM_DATE_KEY = DPA.DIM_DATE_KEY
	AND DE.PROCESS_ALLOCATION_ID = DPA.PROCESS_ALLOCATION_ID
	WHERE DC.RUN_ID = @RunID 
	  AND DE.START_DT <= @AccountingAsOfDate AND DE.END_DT >= @AccountingAsOfDate
	 ) LoansGL
	ON DE.RUN_ID = LoansGL.RUN_ID
	AND DE.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY
	AND DE.CONTRACT_ID = LoansGL.CONTRACT_ID
	AND DE.LOAN_NBR = LoansGL.LOAN_NBR
	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] DCOA
	ON  LoansGL.RUN_ID = DCOA.RUN_ID
	AND LoansGL.DIM_DATE_KEY = DCOA.DIM_DATE_KEY
	AND LoansGL.GL_Name = DCOA.GL_ACCOUNT_DESC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID	
WHERE 
	 DE.RUN_ID = @RunID
	  AND (DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	  AND (@MemberID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@MemberID,',')))
	  AND (@FacilityID_Flag = 1 OR Substring(DC.CONTRACT_NUMBER_DESC,6,4) IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	  AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
   
 GROUP BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC,DE.LOAN_NBR,GL_Name,GL_ACCOUNT_NUMBER_DESC

UNION ALL

SELECT 	DISTINCT DA.SHORT_NAME_DESC AS [Lending Organization],
	 DA_BORR.TRADE_NAME_DESC AS [Member Name],
	 DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	 DC.CONTRACT_NUMBER_DESC AS [Facility ID],
	 DE.LOAN_NBR,
	 GL_Name,
	 GL_ACCOUNT_NUMBER_DESC,
	 SUM(DE.INITIAL_BASIS_AMT - DEB.VALUE_DATE_AMT) AS  [Ending Period Balance],
	 'Loan Receivables' AS 'Report_Section'
--SELECT DISTINCT *
   FROM [dbo].[DW_ELEMENTS] DE
	INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] DEB
	ON  DE.CONTRACT_ID = DEB.CONTRACT_ID
	AND DE.RUN_ID = DEB.RUN_ID
	AND DE.DIM_DATE_KEY = DEB.DIM_DATE_KEY
	AND DE.ORDER_NBR = DEB.ELEMENT_ORDER_NBR
	AND BALANCE_TYPE_DESC = 'CUTOFF_ORI'
	INNER JOIN [dbo].[DW_CONTRACTS] DC
	ON  DE.RUN_ID = DC.RUN_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.CONTRACT_ID = DC.CONTRACT_ID
	INNER JOIN (select DC.RUN_ID,DC.DIM_DATE_KEY,DC.CONTRACT_ID, LOAN_NBR,
	Case WHEN DPA.PROCESS_ALLOCATION_CODE = 'COSTORI'
	 THEN  'Deferred Loan Origination Costs'
	 END AS 'GL_Name' 
	FROM [dbo].[DW_CONTRACTS] DC
	INNER JOIN [dbo].[DW_ELEMENTS] DE
	ON  DC.RUN_ID = DE.RUN_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.CONTRACT_ID = DE.CONTRACT_ID
	INNER JOIN [DBO].[DW_PROCESS_ALLOCATIONS] DPA
	ON  DE.RUN_ID = DPA.RUN_ID
	AND DE.DIM_DATE_KEY = DPA.DIM_DATE_KEY
	AND DE.PROCESS_ALLOCATION_ID = DPA.PROCESS_ALLOCATION_ID
	WHERE DC.RUN_ID = @RunID 
	  AND DE.START_DT <= @AccountingAsOfDate AND DE.END_DT >= @AccountingAsOfDate
	 ) LoansGL
	ON DE.RUN_ID = LoansGL.RUN_ID
	AND DE.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY
	AND DE.CONTRACT_ID = LoansGL.CONTRACT_ID
	AND DE.LOAN_NBR = LoansGL.LOAN_NBR
	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] DCOA
	ON  LoansGL.RUN_ID = DCOA.RUN_ID
	AND LoansGL.DIM_DATE_KEY = DCOA.DIM_DATE_KEY
	AND LoansGL.GL_Name = DCOA.GL_ACCOUNT_DESC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID	
WHERE 
	  DE.RUN_ID = @RunID
	  AND (DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	  AND (@MemberID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@MemberID,',')))
	  AND (@FacilityID_Flag = 1 OR Substring(DC.CONTRACT_NUMBER_DESC,6,4) IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	  AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
   
 GROUP BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC,DE.LOAN_NBR,GL_Name,GL_ACCOUNT_NUMBER_DESC


UNION ALL 	 

 SELECT 	DISTINCT DA.SHORT_NAME_DESC AS [Lending Organization],
	 DA_BORR.TRADE_NAME_DESC AS [Member Name],
	 DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	 DC.CONTRACT_NUMBER_DESC AS [Facility ID],
	 DE.LOAN_NBR,
	 GL_Name,
	 GL_ACCOUNT_NUMBER_DESC,
	 CASE WHEN SUM(DEB_Earned.VALUE_DATE_AMT) IS NULL AND SUM(DEB_Paid.VALUE_DATE_AMT) IS NULL THEN NULL
	  ELSE  ISNULL(SUM(DEB_Earned.VALUE_DATE_AMT),0) - ISNULL(SUM(DEB_Paid.VALUE_DATE_AMT),0) 
	 END AS  [Ending Period Balance],
	 'Interest Receivable' AS 'Report_Section'
	
--SELECT DISTINCT *
   FROM [dbo].[DW_ELEMENTS] DE
	INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] DEB_Earned
	ON  DE.CONTRACT_ID = DEB_Earned.CONTRACT_ID
	AND DE.RUN_ID = DEB_Earned.RUN_ID
	AND DE.DIM_DATE_KEY = DEB_Earned.DIM_DATE_KEY
	AND DE.ORDER_NBR = DEB_Earned.ELEMENT_ORDER_NBR
	AND DEB_Earned.BALANCE_TYPE_DESC = 'INT_EARNED_LTD'
	INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] DEB_Paid
	ON  DE.CONTRACT_ID = DEB_Paid.CONTRACT_ID
	AND DE.RUN_ID = DEB_Paid.RUN_ID
	AND DE.DIM_DATE_KEY = DEB_Paid.DIM_DATE_KEY
	AND DE.ORDER_NBR = DEB_Paid.ELEMENT_ORDER_NBR
	AND DEB_Paid.BALANCE_TYPE_DESC = 'INT_PAID_LTD'
	INNER JOIN [dbo].[DW_CONTRACTS] DC
	ON  DE.RUN_ID = DC.RUN_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.CONTRACT_ID = DC.CONTRACT_ID
	INNER JOIN (select DC.RUN_ID,DC.DIM_DATE_KEY,DC.CONTRACT_ID, LOAN_NBR,
	Case when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Int Receivable from Members - Fixed Rate Loans/LT Loan'
	 when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Int Receivable from Members - Fixed Rate Loans/LT Loan - Non Performing'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Int Receivable from Members - Fixed Rate Loans/LOC Loan'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Int Receivable from Members - Fixed Rate Loans/LOC Loan - Non Performing'
	-------------------
	 when DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Int Receivable from Members - Variable Rate Loans/LT Loan'
	 when DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Int Receivable from Members - Variable Rate Loans/LT Loan - Non Performing'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL)
	THEN 'Int Receivable from Members - Variable Rate Loans/LOC Loan'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Int Receivable from Members - Variable Rate Loans/LOC Loan - Non Performing'
	 END AS 'GL_Name' 
	FROM [dbo].[DW_CONTRACTS] DC
	INNER JOIN [dbo].[DW_ELEMENTS] DE
	ON  DC.RUN_ID = DE.RUN_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.CONTRACT_ID = DE.CONTRACT_ID
	WHERE DC.RUN_ID = @RunID 
	  AND DE.START_DT <= @AccountingAsOfDate AND DE.END_DT >= @AccountingAsOfDate
	 ) LoansGL
	ON DE.RUN_ID = LoansGL.RUN_ID
	AND DE.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY
	AND DE.CONTRACT_ID = LoansGL.CONTRACT_ID
	AND DE.LOAN_NBR = LoansGL.LOAN_NBR
	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] DCOA
	ON  LoansGL.RUN_ID = DCOA.RUN_ID
	AND LoansGL.DIM_DATE_KEY = DCOA.DIM_DATE_KEY
	AND LoansGL.GL_Name = DCOA.GL_ACCOUNT_DESC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID	
WHERE 
	  DE.RUN_ID = @RunID
	  AND (DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	  AND (@MemberID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@MemberID,',')))
	  AND (@FacilityID_Flag = 1 OR DC.CONTRACT_NUMBER_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	  AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
 GROUP BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC,DE.LOAN_NBR,GL_Name,GL_ACCOUNT_NUMBER_DESC
  
UNION ALL 	 

 SELECT 	DISTINCT DA.SHORT_NAME_DESC AS [Lending Organization],
	 DA_BORR.TRADE_NAME_DESC AS [Member Name],
	 DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	 DC.CONTRACT_NUMBER_DESC AS [Facility ID],
	 DE.LOAN_NBR,
	 GL_Name,
	 GL_ACCOUNT_NUMBER_DESC,
	 CASE WHEN SUM(DEB_Earned.VALUE_DATE_AMT) IS NULL AND SUM(DEB_Paid.VALUE_DATE_AMT) IS NULL THEN NULL
	  ELSE  ISNULL(SUM(DEB_Earned.VALUE_DATE_AMT),0) - ISNULL(SUM(DEB_Paid.VALUE_DATE_AMT),0) 
	 END AS  [Ending Period Balance],
	 'Interest Receivable' AS 'Report_Section'
   FROM [dbo].[DW_ELEMENTS] DE
	
	INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] DEB_Earned
	ON  DE.CONTRACT_ID = DEB_Earned.CONTRACT_ID
	AND DE.RUN_ID = DEB_Earned.RUN_ID
	AND DE.DIM_DATE_KEY = DEB_Earned.DIM_DATE_KEY
	AND DE.ORDER_NBR = DEB_Earned.ELEMENT_ORDER_NBR
	AND DEB_Earned.BALANCE_TYPE_DESC = 'INT_EARNED_LTD'
	INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] DEB_Paid
	ON  DE.CONTRACT_ID = DEB_Paid.CONTRACT_ID
	AND DE.RUN_ID = DEB_Paid.RUN_ID
	AND DE.DIM_DATE_KEY = DEB_Paid.DIM_DATE_KEY
	AND DE.ORDER_NBR = DEB_Paid.ELEMENT_ORDER_NBR
	AND DEB_Paid.BALANCE_TYPE_DESC = 'INT_PAID_LTD'
	INNER JOIN [dbo].[DW_CONTRACTS] DC
	ON  DE.RUN_ID = DC.RUN_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.CONTRACT_ID = DC.CONTRACT_ID
	INNER JOIN (select DC.RUN_ID,DC.DIM_DATE_KEY,DC.CONTRACT_ID, LOAN_NBR,
	Case WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Non-accrual Interest Receivable Offset-FR'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'TF' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Non-accrual Interest Receivable Offset-FRLOC'
	 -------------------
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'P1P' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Non-accrual Interest Receivable Offset-VR'
	 WHEN DE.INTEREST_RATE_NATURE_CODE = 'VR' AND DC.PRODUCT_CODE = 'LCS' AND (DC.BAD_DEBT_IND <> '0' AND DC.BAD_DEBT_IND IS NOT NULL)
	THEN 'Non-accrual Interest Receivable Offset-VRLOC'
	 END AS 'GL_Name' 
	FROM [dbo].[DW_CONTRACTS] DC
	INNER JOIN [dbo].[DW_ELEMENTS] DE
	ON  DC.RUN_ID = DE.RUN_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.CONTRACT_ID = DE.CONTRACT_ID
	WHERE DC.RUN_ID = @RunID 
	  AND DE.START_DT <= @AccountingAsOfDate AND DE.END_DT >= @AccountingAsOfDate
	 ) LoansGL
	ON DE.RUN_ID = LoansGL.RUN_ID
	AND DE.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY
	AND DE.CONTRACT_ID = LoansGL.CONTRACT_ID
	AND DE.LOAN_NBR = LoansGL.LOAN_NBR
	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] DCOA
	ON  LoansGL.RUN_ID = DCOA.RUN_ID
	AND LoansGL.DIM_DATE_KEY = DCOA.DIM_DATE_KEY
	AND LoansGL.GL_Name = DCOA.GL_ACCOUNT_DESC
	INNER JOIN DW_ACTORS DA 
	ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                AND DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                AND DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID	
WHERE 
	  DE.RUN_ID = @RunID
	  AND (DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	  AND (@MemberID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@MemberID,',')))
	  AND (@FacilityID_Flag = 1 OR DC.CONTRACT_NUMBER_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	  AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
   GROUP BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC,DE.LOAN_NBR,GL_Name,GL_ACCOUNT_NUMBER_DESC

UNION ALL 	 

 SELECT 	DISTINCT DA.SHORT_NAME_DESC AS [Lending Organization],
	 DA_BORR.TRADE_NAME_DESC AS [Member Name],
	 DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	 DC.CONTRACT_NUMBER_DESC AS [Facility ID],
	 DE.LOAN_NBR,
	 GL_ACCOUNT_DESC AS GL_Name,
	 GL_ACCOUNT_NUMBER_DESC,
	 SUM(DGE.ACCOUNTING_CURRENCY_AMT) AS  [Ending Period Balance],
	 'Interest Income' AS 'Report_Section'
	 
--SELECT DISTINCT *
   FROM [dbo].[DW_ELEMENTS] DE

	LEFT JOIN   [dbo].[DW_GL_ENTRIES] DGE
	 ON DE.RUN_ID = DGE.RUN_ID
	AND DE.DIM_DATE_KEY = DGE.DIM_DATE_KEY
	AND DE.ORDER_NBR = DGE.ELEMENT_ORDER_NBR
	AND DE.LOAN_NBR = DGE.LOAN_NBR
	INNER JOIN [dbo].[DW_CONTRACTS] DC
	ON  DE.RUN_ID = DC.RUN_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.CONTRACT_ID = DC.CONTRACT_ID
	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] DCOA
	ON  DGE.RUN_ID = DCOA.RUN_ID
	AND DGE.DIM_DATE_KEY = DCOA.DIM_DATE_KEY
	AND DGE.GL_ACCOUNT_NBR_DESC= DCOA.GL_ACCOUNT_NUMBER_DESC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID	
WHERE 
	  DE.RUN_ID = @RunID
	  AND DE.START_DT <= @AccountingAsOfDate AND DE.END_DT >= @AccountingAsOfDate
	  AND (DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	  AND (@MemberID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@MemberID,',')))
	  AND (@FacilityID_Flag = 1 OR DC.CONTRACT_NUMBER_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	  AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
	  AND (@GLNumbers_Flag = 1 OR DGE.GL_ACCOUNT_NBR_DESC in ('50.411105.00.105','50.411105.00.120','50.411105.00.205','50.411105.00.220','50.411125.00.105','50.411125.00.120','50.411125.00.205','50.411125.00.220'))
   
 GROUP BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC,DE.LOAN_NBR,GL_ACCOUNT_DESC,GL_ACCOUNT_NUMBER_DESC

UNION ALL 	 

 SELECT 	DISTINCT DA.SHORT_NAME_DESC AS [Lending Organization],
	 DA_BORR.TRADE_NAME_DESC AS [Member Name],
	 DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	 DC.CONTRACT_NUMBER_DESC AS [Facility ID],
	 DE.LOAN_NBR,
	 GL_ACCOUNT_DESC AS GL_Name,
	 GL_ACCOUNT_NUMBER_DESC,
	 SUM(RLB.VALUE_DATE_AMT) AS  [Ending Period Balance],
	 'Other Payables' AS 'Report_Section'
	 
--SELECT DISTINCT DE.LOAN_NBR
   FROM [dbo].[DW_ELEMENTS] DE
	INNER join [dbo].[DW_RECEIVABLE_LINE_ITEMS] RLI
	ON  DE.RUN_ID = RLI.RUN_ID
	AND DE.DIM_DATE_KEY = RLI.DIM_DATE_KEY
	AND DE.LOAN_NBR = RLI.LOAN_DESC
	    AND DE.CONTRACT_ID = RLI.CONTRACT_ID
	INNER JOIN [dbo].[DW_PROCESS_ALLOCATIONS] DPA
	ON  RLI.DIM_DATE_KEY = DPA.DIM_DATE_KEY
	AND RLI.RUN_ID = DPA.RUN_ID
	AND RLI.PROCESS_ALLOCATION_ID = DPA.PROCESS_ALLOCATION_ID
	AND DPA.PROCESS_ALLOCATION_CODE = 'FEEUNDR'
	INNER JOIN [dbo].[DW_RECEIVABLE_LINE_BALANCE] RLB
	ON  RLI.RECEIVABLE_ID = RLB.RECEIVABLE_ID
	AND RLI.RECEIVABLE_LINE_ITEM_NBR = RLB.RECEIVABLE_LINE_ITEM_NBR
	AND RLI.DIM_DATE_KEY = RLB.DIM_DATE_KEY
	AND RLI.RUN_ID = RLB.RUN_ID 
	AND RLB.BALANCE_TYPE_DESC = 'PAID_PRINCIPAL'
	INNER JOIN   [dbo].[DW_GL_ENTRIES] DGE
	ON  DE.RUN_ID = DGE.RUN_ID
	AND DE.DIM_DATE_KEY = DGE.DIM_DATE_KEY
	AND DE.ORDER_NBR = DGE.ELEMENT_ORDER_NBR
	AND DE.LOAN_NBR = DGE.LOAN_NBR
	INNER JOIN [dbo].[DW_CONTRACTS] DC
	ON  DE.RUN_ID = DC.RUN_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.CONTRACT_ID = DC.CONTRACT_ID
	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] DCOA
	ON  DGE.RUN_ID = DCOA.RUN_ID
	AND DGE.DIM_DATE_KEY = DCOA.DIM_DATE_KEY
	AND DGE.GL_ACCOUNT_NBR_DESC= DCOA.GL_ACCOUNT_NUMBER_DESC
	INNER JOIN DW_ACTORS DA 
	ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                AND DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                AND DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID	

WHERE 
	 DE.RUN_ID = @RunID
	  AND  DE.START_DT <= @AccountingAsOfDate AND DE.END_DT >= @AccountingAsOfDate
	  AND (DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	  AND (@MemberID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@MemberID,',')))
	  AND (@FacilityID_Flag = 1 OR DC.CONTRACT_NUMBER_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	  AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
	  AND (@GLNumbers_Flag = 1 OR DGE.GL_ACCOUNT_NBR_DESC in ('50.297185.00.000','50.297225.00.105'))
   
 GROUP BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC,DE.LOAN_NBR,GL_ACCOUNT_DESC,GL_ACCOUNT_NUMBER_DESC

END

--EXEC [rpt].[RPT0040GLSubledger] 662,'RTFC',Null,Null,Null,Null,'2016-09-30'
--EXEC [rpt].[RPT0040GLSubledger] 322,'RTFC',Null,Null,Null,'2018-01-01'
GO
/****** Object:  StoredProcedure [rpt].[RPT0050LoanRepricing]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--EXEC [rpt].[RPT0050LoanRepricing] 505, '08/01/2016', '08/29/2016'
CREATE PROCEDURE [rpt].[RPT0050LoanRepricing]
(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR date, @NextRepricingDate_PAR Date, @NextRepricingBeginDT_PAR date, @NextRepricingEndDT_PAR date)



AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE   @RunID NUMERIC(10,0), @ReportDate date, @NextRepricingDate Date, @NextRepricingBeginDT date, @NextRepricingEndDT date

    SELECT @RunID = @RunID_PAR, @ReportDate = @ReportDate_PAR, @NextRepricingDate = @NextRepricingDate_PAR, @NextRepricingBeginDT = @NextRepricingBeginDT_PAR, @NextRepricingEndDT = @NextRepricingEndDT_PAR 

;with CTE1       
       AS
              (
SELECT DISTINCT 
	   
	   MemberID = A.ACTOR_CODE_DESC,
	   MemberName = A.TRADE_NAME_DESC,
	   BorrowerType = AC.STRING_VALUE_DESC,
	   NextRepricingDate= NRD.DATE_VALUE_DT,
	   DATEADD(MONTH,-1,NRD.DATE_VALUE_DT) AS [Thirty Day Repricing Window Start Date],
	   DATEADD(MONTH,-3,NRD.DATE_VALUE_DT) AS [Ninety Day Repricing Window Start Date],
	   UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC,
	   LoanID = ISNULL(E.LOAN_NBR, '-'),
	   ProductSubType = NULL,
	   UnpaidPrincipalBalance = UNPAIDP.VALUE_DATE_AMT,
	   LoanMaturityDate = E.END_DT,
	   RemainingLoanTerm = DATEDIFF(MONTH, GETDATE(), E.END_DT) ,
	   LoanAdvanceFinalPaymentDate = ES.PAYMENT_DUE_DT,	
	   InterestRateTenor = NULL, --DATEDIFF(MONTH, E.START_DT, NRD.DATE_VALUE_DT),
	   StatedInterestRate = E.USED_FIXED_RATE_PCT,
	   AVP = AVP.USER_BY_DESC,
	   RVP = RVP.USER_BY_DESC,
	   LendingTeam = NULL,
	   LendingOrganizationID = PA.ACTOR_ID,
       LendingOrganization = PA.SHORT_NAME_DESC                 
   
FROM DW_ELEMENTS E

LEFT JOIN DW_ELEMENT_CHARACTERISTICS NRD
       ON E.CONTRACT_ID = NRD.CONTRACT_ID
	   AND E.ORDER_NBR = NRD.ELEMENT_ORDER_NBR
              AND E.DIM_DATE_KEY = NRD.DIM_DATE_KEY
              AND E.RUN_ID = NRD.RUN_ID
              AND NRD.[CHARACTERISTIC_CODE] = 'REPEFFDT'

	  
INNER JOIN DW_CONTRACTS U
       ON E.CONTRACT_ID = U.CONTRACT_ID
              AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND E.RUN_ID = U.RUN_ID

INNER JOIN DW_CONTRACT_ACTORS CA 
       ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

INNER JOIN DW_ACTORS PA
	ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
	  AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
              AND U.RUN_ID = PA.RUN_ID

INNER JOIN DW_ACTORS A 
       ON CA.ACTOR_ID = A.ACTOR_ID
              AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
              AND CA.RUN_ID = A.RUN_ID

LEFT JOIN DW_ACTOR_CHARACTERISTICS AC
	ON CA.ACTOR_ID = AC.ACTOR_ID
	AND CA.DIM_DATE_KEY = AC.DIM_DATE_KEY
	AND CA.RUN_ID = AC.RUN_ID
	AND AC.CHARACTERISTIC_CODE = 'BORTYPE'

LEFT JOIN DW_CONTRACT_CHARACTERISTICS PST
	ON U.CONTRACT_ID = PST.CONTRACT_ID
	AND U.DIM_DATE_KEY = PST.DIM_DATE_KEY
	AND U.RUN_ID = PST.RUN_ID
	AND PST.CHARACTERISTIC_CODE = 'SUBTYPE3'
	
LEFT JOIN DW_ELEMENT_BALANCES UNPAIDP 
       ON E.CONTRACT_ID = UNPAIDP.CONTRACT_ID
              AND E.DIM_DATE_KEY = UNPAIDP.DIM_DATE_KEY
	  AND E.ORDER_NBR = UNPAIDP.ELEMENT_ORDER_NBR
              AND E.RUN_ID = UNPAIDP.RUN_ID
              AND UNPAIDP.BALANCE_TYPE_DESC = 'PRINCIPAL'

LEFT JOIN DW_INVOLVED_USER AVP
	ON u.CONTRACT_ID = AVP.CONTRACT_ID
	AND u.DIM_DATE_KEY = AVP.DIM_DATE_KEY
	AND u.RUN_ID = AVP.RUN_ID	
	AND AVP.BUSINESS_CODE = 'AVP'
LEFT JOIN DW_INVOLVED_USER RVP
	ON u.CONTRACT_ID = RVP.CONTRACT_ID
	AND u.DIM_DATE_KEY = RVP.DIM_DATE_KEY
	AND u.RUN_ID = RVP.RUN_ID	
	AND RVP.BUSINESS_CODE = 'RVP'

INNER JOIN DW_ELEMENT_SCHEDULE ES1 
       ON e.CONTRACT_ID = ES1.CONTRACT_ID
                     AND e.ORDER_NBR = ES1.ELEMENT_ORDER_NBR
                     AND e.DIM_DATE_KEY = ES1.DIM_DATE_KEY
                     AND e.RUN_ID = ES1.RUN_ID	

LEFT JOIN (SELECT * FROM 

(SELECT A.*, RANK() OVER( ORDER BY PAYMENT_DUE_DT DESC) RNK FROM
	( Select  DIM_DATE_KEY, RUN_ID, CONTRACT_ID, ELEMENT_ORDER_NBR,ORDER_NBR, PAYMENT_DUE_DT
FROM DW_ELEMENT_SCHEDULE
WHERE EXTERNAL_TERM_NBR IS NOT NULL 
GROUP BY DIM_DATE_KEY, RUN_ID, PAYMENT_DUE_DT, CONTRACT_ID,ELEMENT_ORDER_NBR, ORDER_NBR 
 
)A) B) ES 
ON ES.CONTRACT_ID = E.CONTRACT_ID
AND ES.ELEMENT_ORDER_NBR = E.ORDER_NBR
AND ES.RNK = 1
AND ES.RUN_ID = E.RUN_ID
AND ES.DIM_DATE_KEY = E.DIM_DATE_KEY

Where	U.PRODUCT_CODE NOT LIKE 'AUT%'
	
	AND E.ELEMENT_CLASS_CODE = 'F' --EXCLUDING FEE
	AND E.ELEMENT_TYPE_CODE = 'F'-- EXCLUDING FEE
	AND U.RUN_ID = @RunID --TO GET THE MAX RUN_ID
	AND ES.PAYMENT_DUE_DT BETWEEN @NextRepricingBeginDT and @NextRepricingEndDT -- FOR NEXT REPRICING DATE RANGE PARAMETER IN THE REPORT
            AND U.PRODUCT_CODE = 'P1P'-- FOR LONG TERM LOANS
            AND E.INTEREST_RATE_NATURE_CODE = 'TF' -- FOR ONLY FIXED LOANS
	AND PST.STRING_VALUE_DESC <> 'LUM'	-- EXCLUDING PRODUCT SUBTYPE 'LUM'	
	AND ES1.EXTERNAL_TERM_NBR IS NOT NULL -- EXCLUDING INVESTMENTS AND ESTIMATED 
	

),
	
       CTE2
              as     (
                           select *, ROW_NUMBER() over(partition by LoanID order by LoanMaturityDate desc) as 'Row_num' from CTE1 )

 select DISTINCT 
                           MemberID ,
	   MemberName,
	   BorrowerType,
	   NextRepricingDate,
	   [Thirty Day Repricing Window Start Date],
	   [Ninety Day Repricing Window Start Date],
	   UnderlyingFacilityID ,
	   LoanID ,
	   ProductSubType ,
	   UnpaidPrincipalBalance,
	   LoanMaturityDate ,
	   RemainingLoanTerm ,
	   LoanAdvanceFinalPaymentDate,
	   InterestRateTenor,
	   StatedInterestRate,
	   AVP ,
	   RVP ,
	   LendingTeam,
	   LendingOrganizationID,
	   LendingOrganization 
                           from CTE2 
                           where Row_num = 1
ORDER BY MemberID, UnderlyingFacilityID, LoanID
END
GO
/****** Object:  StoredProcedure [rpt].[RPT0060InvoiceRegister]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0060InvoiceRegister]
	(@RunID_PAR NUMERIC(10,0), @BatchJobID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @BatchJobID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR
	, @BatchJobID = @BatchJobID_PAR

SELECT DISTINCT MemberID = A.ACTOR_CODE_DESC
	, PeriodStartDate = RLI.PERIOD_START_DT
	, PeriodEndDate = RLI.PERIOD_END_DT
	, InvoiceNumber = R.INVOICE_NUMBER_DESC
	, UnderlyingFacilityID = u.CONTRACT_NUMBER_DESC
	, LoanID = E.LOAN_NBR
	, ProductType = U.PRODUCT_DESC 
	, InterestDueAmount = RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	, PrincipalDueAmount = RLI.PRINCIPAL_AMT
	, InvoiceAdjustmentType = NULL
	, InvoiceAdjustmentAmount = UNPAIDINT.VALUE_DATE_AMT + UNPAIDPRI.VALUE_DATE_AMT
	, LendingOrganization = LO.SHORT_NAME_DESC
	, LendingOrganizationID = LO.ACTOR_ID
FROM DW_RECEIVABLES R
INNER JOIN DW_RECEIVABLE_DETAILS RD
       ON R.RECEIVABLE_ID = RD.RECEIVABLE_ID
              AND R.DIM_DATE_KEY = RD.DIM_DATE_KEY
              AND R.RUN_ID = RD.RUN_ID
INNER JOIN DW_RECEIVABLE_LINE_ITEMS RLI
       ON R.RECEIVABLE_ID = RLI.RECEIVABLE_ID
              AND R.DIM_DATE_KEY = RLI.DIM_DATE_KEY
              AND R.RUN_ID = RLI.RUN_ID
INNER JOIN DW_ELEMENTS E
       ON E.CONTRACT_ID = RD.CONTRACT_ID
              AND E.ORDER_NBR = RD.ORDER_NBR
              AND E.DIM_DATE_KEY = RD.DIM_DATE_KEY
              AND E.RUN_ID = RD.RUN_ID
INNER JOIN DW_CONTRACTS U 
	ON E.CONTRACT_ID = U.CONTRACT_ID
        AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
        AND E.RUN_ID = U.RUN_ID
LEFT JOIN DW_CONTRACT_ACTORS CA 
    ON U.CONTRACT_ID = CA.CONTRACT_ID
        AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
        AND U.RUN_ID = CA.RUN_ID
        AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
LEFT JOIN DW_ACTORS A 
	ON CA.ACTOR_ID = A.ACTOR_ID
	AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND CA.RUN_ID = A.RUN_ID
LEFT JOIN DW_RECEIVABLE_LINE_BALANCE UNPAIDPRI 
      ON RLI.RECEIVABLE_ID = UNPAIDPRI.RECEIVABLE_ID
        AND RLI.RECEIVABLE_LINE_ITEM_NBR = UNPAIDPRI.RECEIVABLE_LINE_ITEM_NBR
        AND RLI.RUN_ID=UNPAIDPRI.RUN_ID
        AND RLI.DIM_DATE_KEY = UNPAIDPRI.DIM_DATE_KEY
	AND UNPAIDPRI.BALANCE_TYPE_DESC = 'UNPAID_PRINCIPAL'
LEFT JOIN DW_RECEIVABLE_LINE_BALANCE UNPAIDINT 
      ON RLI.RECEIVABLE_ID = UNPAIDINT.RECEIVABLE_ID
        AND RLI.RECEIVABLE_LINE_ITEM_NBR = UNPAIDINT.RECEIVABLE_LINE_ITEM_NBR
        AND RLI.RUN_ID=UNPAIDINT.RUN_ID
        AND RLI.DIM_DATE_KEY = UNPAIDINT.DIM_DATE_KEY
	AND UNPAIDINT.BALANCE_TYPE_DESC = 'UNPAID_INTEREST'
LEFT JOIN DW_ACTORS LO
	ON U.COMPANY_ACTOR_ID=LO.ACTOR_ID
	AND U.DIM_DATE_KEY = LO.DIM_DATE_KEY
        AND U.RUN_ID = LO.RUN_ID
WHERE R.BATCH_JOB_ID = @BatchJobID
	AND u.RUN_ID = @RunID
ORDER BY A.ACTOR_CODE_DESC
	, RLI.PERIOD_START_DT
	, RLI.PERIOD_END_DT
	, E.LOAN_NBR

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0070DelinquencyRpt_Detail]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
PURPOSE:-This procedure is used to build the report [rpt].[RPT0070DelinquencyRpt_Detail]
CREATED BY:- RAVITEJA
CREATED DATE:-05/18/2016
Functions Used:- This procedure uses the function dbo.fn_MVParam to split the Report Parameters into comma seperated values
---------------------------------------------------------REVISION HISTORY-----------------------------
MODIFIED BY:
MODIFIED DATE:
BASE VERSION:
TAG USED:
*/
CREATE PROCEDURE [rpt].[RPT0070DelinquencyRpt_Detail]
(@RunID_PAR NUMERIC(10,0), @LendingOrg_PAR Varchar(100), @CustomerID_PAR Varchar(MAX),@FacilityID_PAR VARCHAR(MAX),@LoanId_PAR VARCHAR(MAX),@DelinquencyDate_PAR Date,@ToleranceAmt_PAR Numeric(15,2),@Delinquency1to5_PAR Int)
AS
BEGIN
	
	SET NOCOUNT ON;

-----------Declaring new set of varibles to pass report parameter values-----------------------
	DECLARE  @RunID NUMERIC(10,0), @LendingOrg Varchar(100), @CustomerID Varchar(MAX),@FacilityID VARCHAR(MAX),@LoanId VARCHAR(MAX),@DelinquencyDate Date,@ToleranceAmt Numeric(15,2),@Delinquency1to5 Int

----------Declaring Flag variables
	DECLARE @CustomerID_Flag Int = 0,@FacilityID_Flag Int = 0,@LoanId_Flag Int = 0

----------Passing Report Parameter values to procedure Parameters------------------------------
	SELECT  @RunID = @RunID_PAR,
	@LendingOrg = @LendingOrg_PAR, 
	@CustomerID = @CustomerID_PAR,
	@FacilityID = @FacilityID_PAR,
	@LoanId = @LoanID_PAR,
	@DelinquencyDate = ISNULL(@DelinquencyDate_PAR, GETDATE()),
	@ToleranceAmt = @ToleranceAmt_PAR,
	@Delinquency1to5 = @Delinquency1to5_PAR

/* Setting Flag to fetch for all Customers/Facility/Loans if They select Nulls in report*/
IF @CustomerID_PAR IS NULL OR @CustomerID_PAR LIKE '%Null%'
	Begin
	set @CustomerID_Flag = 1
	End
IF @FacilityID_PAR IS NULL OR @FacilityID_PAR LIKE '%Null%'
	BEGIN
	SET @FacilityID_Flag = 1
	END
IF @LoanId_PAR IS NULL OR @LoanId_PAR LIKE '%Null%'
	BEGIN
	SET @LoanId_Flag = 1
	END
----------------------------------Uncomment below commands for testing--------------------------------------------------
--	SELECT  @RunID = -
--	@CustomerID = 
--	@FacilityID = 
--	@LoanId = 
----------------------------------Comment above block once testing is done----------------------------
;WITH CTE1 
AS
(SELECT DISTINCT
	DA.SHORT_NAME_DESC AS [Lending Organization],
	DA_BORR.TRADE_NAME_DESC AS [Member Name],
	DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	Substring(DC.CONTRACT_NUMBER_DESC,6,4) AS [Facility ID],
	DE.LOAN_NBR,
	DE.FINANCIAL_PMT_SCHED_TYPE_DESC AS [Amortization Method],
	CASE WHEN PERIOD_TYPE_CODE = '360' THEN 'Annual'
	 WHEN PERIOD_TYPE_CODE = '180' THEN 'Semi-annual'
	 WHEN PERIOD_TYPE_CODE = '090' THEN 'Quarterly'
	 WHEN PERIOD_TYPE_CODE = '030' THEN 'Monthly'
	 Else 'Not a valid Frequency'
	END AS [Billing Frequency],
	ISNULL(DEB_Pri.VALUE_DATE_AMT, 0) AS  [Unpaid Principal Balance Book Value],
	CASE WHEN SUM(DEB_Int.VALUE_DATE_AMT) IS NULL AND SUM(RLB_Int.VALUE_DATE_AMT) IS NULL THEN NULL
	 ELSE SUM(ISNULL(DEB_Int.VALUE_DATE_AMT, 0)) - SUM(ISNULL(RLB_Int.VALUE_DATE_AMT, 0))
	END AS [Unpaid Interest Amount],
	MIN(DRE.INITIAL_DUE_DT) AS [Oldest Due],
	MAX(DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate)) AS [Oldest Aging],
	-----------FOR PRINCIPAL BALANCES-----------------
	SUM(Case WHEN DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 5 THEN RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidPrin_1to5],
	SUM(Case WHEN DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 5 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 30 THEN RLI.PRINCIPAL_AMT	
	 ELSE NULL
	END) AS [UnpaidPrin_6to30],
	SUM(Case WHEN DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 30 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 60 THEN RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidPrin_31to60],
	SUM(Case WHEN DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 60 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 90 THEN RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidPrin_61to90],
	SUM(Case WHEN DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 90 THEN RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidPrin_Over90],
	----------FOR INTEREST BALANCES----------------------
	SUM(Case WHEN DPA_Int.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 5 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidInter_1to5],
	SUM(Case WHEN DPA_Int.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 5 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 30 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidInter_6to30],
	SUM(Case WHEN DPA_Int.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 30 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 60 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidInter_31to60],
	SUM(Case WHEN DPA_Int.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 60 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 90 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidInter_61to90],
	SUM(Case WHEN DPA_Int.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 90 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidInter_Over90],
	----------FOR FEE BALANCES----------------------
	SUM(Case WHEN DPA_Fees.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 5 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidFees_1to5],
	SUM(Case WHEN DPA_Fees.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 5 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 30 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidFees_6to30],
	SUM(Case WHEN DPA_Fees.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 30 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 60 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidFees_31to60],
	SUM(Case WHEN DPA_Fees.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 60 AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) <= 90 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidFees_61to90],
	SUM(Case WHEN DPA_Fees.PROCESS_ALLOCATION_ID IS NOT NULL AND DateDiff(DD,DRE.INITIAL_DUE_DT,@DelinquencyDate) > 90 THEN RLI.PRE_TAX_AMT - RLI.PRINCIPAL_AMT
	 ELSE NULL
	END) AS [UnpaidFees_Over90],
	DRPI.PAYMENT_VALUE_DT
--select DE.Run_id,DRPI.PAYMENT_VALUE_DT,de.loan_nbr,DRE.DW_RECEIVABLES_INITIAL_DUE_DT
	FROM [dbo].[DW_ELEMENTS] DE 
	INNER JOIN [dbo].[DW_ELEMENT_FLOWS] DEF
	ON  DE.CONTRACT_ID = DEF.CONTRACT_ID
	AND DE.ORDER_NBR = DEF.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DEF.DIM_DATE_KEY
	AND DE.RUN_ID = DEF.RUN_ID
	AND DEF.PERIOD_TYPE_CODE <>'001'
	LEFT JOIN [dbo].[DW_ELEMENT_BALANCES] DEB_Pri 
                    ON DE.CONTRACT_ID = DEB_Pri.CONTRACT_ID
                   AND DE.DIM_DATE_KEY = DEB_Pri.DIM_DATE_KEY	/*JOINED TO GET THE BOOK VALUE OF UNPAID PRINCIPAL*/
                   AND DE.ORDER_NBR = DEB_Pri.ELEMENT_ORDER_NBR
                   AND DE.RUN_ID = DEB_Pri.RUN_ID
                   AND DEB_Pri.BALANCE_TYPE_DESC = 'PRINCIPAL'
	--LEFT JOIN [dbo].[DW_ELEMENT_BALANCES] DEB_Int 
   --                 ON DE.CONTRACT_ID = DEB_Int.CONTRACT_ID
   --                AND DE.DIM_DATE_KEY = DEB_Int.DIM_DATE_KEY	/* JOINED TO GET THE UNPAID INTEREST AMOUNT*/
   --                AND DE.ORDER_NBR = DEB_Int.ELEMENT_ORDER_NBR
   --                AND DE.RUN_ID = DEB_Int.RUN_ID
   --                AND DEB_Int.BALANCE_TYPE_DESC = 'INT_EARNED_LTD'
	-------------------------------------------------------------------------------
	LEFT JOIN DW_ELEMENT_BALANCES DEB_Int
	   ON DE.RUN_ID = DEB_Int.RUN_ID
	  AND DE.CONTRACT_ID = DEB_Int.CONTRACT_ID
	  AND DE.DIM_DATE_KEY = DEB_Int.DIM_DATE_KEY
	  AND DE.ORDER_NBR = DEB_Int.ELEMENT_ORDER_NBR
	  AND DEB_Int.CURRENT_IND = 1 
	  AND DEB_Int.BALANCE_TYPE_DESC = 'ACCRUED_INT'
--AND E.LOAN_NBR = 'AK5169001001' 

	LEFT JOIN DW_RECEIVABLE_LINE_ITEMS RLI_Int 
	   ON DE.LOAN_NBR = RLI_Int.LOAN_DESC 
	  AND DE.RUN_ID = RLI_Int.RUN_ID 
	  AND DE.DIM_DATE_KEY = RLI_Int.DIM_DATE_KEY 
	  AND DE.CONTRACT_ID = RLI_Int.CONTRACT_ID

	LEFT JOIN [dbo].[DW_RECEIVABLE_LINE_BALANCE] RLB_Int
	   ON RLI_Int.RECEIVABLE_ID = RLB_Int.RECEIVABLE_ID
	  AND RLI_Int.RECEIVABLE_LINE_ITEM_NBR = RLB_Int.RECEIVABLE_LINE_ITEM_NBR
	  AND RLI_Int.DIM_DATE_KEY = RLB_Int.DIM_DATE_KEY
	  AND RLI_Int.RUN_ID = RLB_Int.RUN_ID 
	  AND RLB_Int.BALANCE_TYPE_DESC = 'PAID_INTEREST' 
	---------------------------------------------------------------------------------
	INNER Join DW_CONTRACTS DC
	ON  DE.CONTRACT_ID = DC.CONTRACT_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.RUN_ID = DC.RUN_ID
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID
------------------------------------------------------------------------------------------------------------
	INNER JOIN  DW_RECEIVABLE_DETAILS DRD
	ON  DE.CONTRACT_ID = DRD.CONTRACT_ID
	AND DE.ORDER_NBR = DRD.ORDER_NBR
	AND DE.DIM_DATE_KEY = DRD.DIM_DATE_KEY
	AND DE.RUN_ID = DRD.RUN_ID
	INNER JOIN  DW_RECEIVABLES DRE
	    ON  DRD.RECEIVABLE_ID = DRE.RECEIVABLE_ID 
	AND DRD.DIM_DATE_KEY = DRE.DIM_DATE_KEY 
	AND DRD.RUN_ID = DRE.RUN_ID
	INNER JOIN DW_RECEIVABLE_LINE_ITEMS RLI
	ON  DRE.RECEIVABLE_ID = RLI.RECEIVABLE_ID
	AND DRE.DIM_DATE_KEY = RLI.DIM_DATE_KEY
	AND DRE.RUN_ID = RLI.RUN_ID 
	LEFT JOIN [dbo].[DW_RECEIVABLE_PAYMENT_INFO] DRPI
	ON  DRD.RECEIVABLE_ID = DRPI.RECEIVABLE_ID
	AND DRD.DIM_DATE_KEY = DRPI.DIM_DATE_KEY	/* JOINED TO GET THE PAYMENT DATE*/
	AND DRD.RUN_ID = DRPI.RUN_ID
	LEFT JOIN DW_PROCESS_ALLOCATIONS DPA_Fees
	ON  RLI.PROCESS_ALLOCATION_ID = DPA_Fees.PROCESS_ALLOCATION_ID
	AND RLI.DIM_DATE_KEY = DPA_Fees.DIM_DATE_KEY	/*Joined to get the Unpaid FEES values*/
	AND RLI.RUN_ID = DPA_Fees.RUN_ID
	AND DPA_Fees.PROCESS_ALLOCATION_CODE LIKE '%FEE%'
	LEFT JOIN DW_PROCESS_ALLOCATIONS DPA_Int
	ON	RLI.PROCESS_ALLOCATION_ID = DPA_Int.PROCESS_ALLOCATION_ID
	AND RLI.DIM_DATE_KEY = DPA_Int.DIM_DATE_KEY
	AND RLI.RUN_ID = DPA_Int.RUN_ID	/*Joined to get the Unpaid interest values*/
	AND DPA_Int.PROCESS_ALLOCATION_CODE NOT LIKE '%FEE%'

-----------------------------------------------------------
	--LEFT JOIN [rpt].[VW_RECEIVABLES_ELEMENTS] DRE
	--	ON  DE.ORDER_NBR = DRE.DW_ELEMENTS_ORDER_NBR
	--	AND DE.DIM_DATE_KEY = DRE.DW_ELEMENTS_DIM_DATE_KEY
	--	AND DE.RUN_ID = DRE.DW_ELEMENTS_RUN_ID
	--LEFT JOIN [dbo].[DW_RECEIVABLE_PAYMENT_INFO] DRPI
	--	ON  DRE.DW_RECEIVABLE_DETAILS_RECEIVABLE_ID = DRPI.RECEIVABLE_ID
	--	AND DRE.DW_RECEIVABLE_DETAILS_DIM_DATE_KEY = DRPI.DIM_DATE_KEY	/* JOINED TO GET THE PAYMENT DATE*/
	--	AND DRE.DW_RECEIVABLE_DETAILS_RUN_ID = DRPI.RUN_ID
	--LEFT JOIN DW_PROCESS_ALLOCATIONS DPA_Fees
	--	ON  DRE.DW_RECEIVABLE_LINE_ITEMS_PROCESS_ALLOCATION_ID = DPA_Fees.PROCESS_ALLOCATION_ID
	--	AND DRE.DW_RECEIVABLE_LINE_ITEMS_DIM_DATE_KEY = DPA_Fees.DIM_DATE_KEY	/*Joined to get the Unpaid FEES values*/
	--	AND DRE.DW_RECEIVABLE_LINE_ITEMS_RUN_ID = DPA_Fees.RUN_ID
	--	AND DPA_Fees.PROCESS_ALLOCATION_CODE LIKE '%FEE%'
	--LEFT JOIN DW_PROCESS_ALLOCATIONS DPA_Int
	--	ON  DRE.DW_RECEIVABLE_LINE_ITEMS_PROCESS_ALLOCATION_ID = DPA_Int.PROCESS_ALLOCATION_ID
	--	AND DRE.DW_RECEIVABLE_LINE_ITEMS_DIM_DATE_KEY = DPA_Int.DIM_DATE_KEY
	--	AND DRE.DW_RECEIVABLE_LINE_ITEMS_RUN_ID = DPA_Int.RUN_ID	/*Joined to get the Unpaid interest values*/
	--	AND DPA_Int.PROCESS_ALLOCATION_CODE NOT LIKE '%FEE%'
----------------------------------------------------------------	
	WHERE 
	 DE.RUN_ID = @RunID
	  AND (DRPI.PAYMENT_VALUE_DT IS NULL AND DRE.INITIAL_DUE_DT <= @DelinquencyDate) /* CHECKING IF PAYMENT DUE DATE IS WITH IN THE DELINQUENCY DATE*/
	  AND (DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	  AND (@CustomerID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@CustomerID,',')))
	  AND (@FacilityID_Flag = 1 OR Substring(DC.CONTRACT_NUMBER_DESC,6,4) IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	  AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
	GROUP BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,Substring(DC.CONTRACT_NUMBER_DESC,6,4),	DE.LOAN_NBR,DE.FINANCIAL_PMT_SCHED_TYPE_DESC ,PERIOD_TYPE_CODE,
	 ISNULL(DEB_Pri.VALUE_DATE_AMT, 0),	ISNULL(DEB_Int.VALUE_DATE_AMT, 0),DRPI.PAYMENT_VALUE_DT

	)

	SELECT	[Lending Organization],
	[Member Name],
	[Member ID],
	[Facility ID],
	LOAN_NBR,
	[Amortization Method],
	[Billing Frequency],
	[Unpaid Principal Balance Book Value],
	[Unpaid Interest Amount],
	[Oldest Due],
	[Oldest Aging],
	PAYMENT_VALUE_DT,
	CASE WHEN UnpaidPrin_1to5 > @ToleranceAmt AND @Delinquency1to5 = 1 THEN UnpaidPrin_1to5 ELSE 0.00 END AS UnpaidPrin_1to5,
	CASE WHEN UnpaidPrin_6to30 > @ToleranceAmt  THEN UnpaidPrin_6to30 ELSE 0.00 END AS UnpaidPrin_6to30,
	CASE WHEN UnpaidPrin_31to60 > @ToleranceAmt THEN UnpaidPrin_31to60 ELSE 0.00 END AS UnpaidPrin_31to60,
	CASE WHEN UnpaidPrin_61to90 > @ToleranceAmt THEN UnpaidPrin_61to90 ELSE 0.00 END AS UnpaidPrin_61to90,
	CASE WHEN UnpaidPrin_Over90 > @ToleranceAmt THEN UnpaidPrin_Over90 ELSE 0.00 END AS UnpaidPrin_Over90,
	CASE WHEN UnpaidInter_1to5 > @ToleranceAmt AND @Delinquency1to5 = 1 THEN UnpaidInter_1to5 ELSE 0.00 END AS UnpaidInter_1to5,
	CASE WHEN UnpaidInter_6to30 > @ToleranceAmt THEN UnpaidInter_6to30 ELSE 0.00 END AS UnpaidInter_6to30,
	CASE WHEN UnpaidInter_31to60 > @ToleranceAmt THEN UnpaidInter_31to60 ELSE 0.00 END AS UnpaidInter_31to60,
	CASE WHEN UnpaidInter_61to90 > @ToleranceAmt THEN UnpaidInter_61to90 ELSE 0.00 END AS UnpaidInter_61to90,
	CASE WHEN UnpaidInter_Over90 > @ToleranceAmt THEN UnpaidInter_Over90 ELSE 0.00 END AS UnpaidInter_Over90,
	CASE WHEN UnpaidFees_1to5 > @ToleranceAmt AND @Delinquency1to5 = 1 THEN UnpaidFees_1to5 ELSE 0.00 END AS UnpaidFees_1to5,
	CASE WHEN UnpaidFees_6to30 > @ToleranceAmt THEN UnpaidFees_6to30 ELSE 0.00 END AS UnpaidFees_6to30,
	CASE WHEN UnpaidFees_31to60 > @ToleranceAmt THEN UnpaidFees_31to60 ELSE 0.00 END AS UnpaidFees_31to60,
	CASE WHEN UnpaidFees_61to90 > @ToleranceAmt THEN UnpaidFees_61to90 ELSE 0.00 END AS UnpaidFees_61to90,
	CASE WHEN UnpaidFees_Over90 > @ToleranceAmt THEN UnpaidFees_Over90 ELSE 0.00 END AS UnpaidFees_Over90	
	FROM CTE1 
	WHERE UnpaidPrin_1to5 > @ToleranceAmt OR UnpaidPrin_6to30 > @ToleranceAmt OR UnpaidPrin_31to60 > @ToleranceAmt OR UnpaidPrin_61to90 > @ToleranceAmt OR UnpaidPrin_Over90 > @ToleranceAmt
	   OR UnpaidInter_1to5 > @ToleranceAmt OR UnpaidInter_6to30 > @ToleranceAmt OR UnpaidInter_31to60 > @ToleranceAmt OR UnpaidInter_61to90 > @ToleranceAmt OR UnpaidInter_Over90 > @ToleranceAmt
	   OR UnpaidFees_1to5 > @ToleranceAmt OR UnpaidFees_6to30 > @ToleranceAmt OR UnpaidFees_31to60 > @ToleranceAmt OR UnpaidFees_61to90 > @ToleranceAmt OR UnpaidFees_Over90 > @ToleranceAmt
	ORDER BY [Member ID],[Facility ID],LOAN_NBR	

END



--EXEC [rpt].[RPT0070DelinquencyRpt_Detail] 621,'RTFC,CFC,NCSC',NULL,Null,nULL,'2017-06-29',0,0

GO
/****** Object:  StoredProcedure [rpt].[RPT0080FacilityHistory]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
PURPOSE:-This procedure is used to build the report RPT_0080_Faciltiy History
CREATED BY:- RAVITEJA
CREATED DATE:-04/29/2015
---------------------------------------------------------REVISION HISTORY-----------------------------
MODIFIED BY:
MODIFIED DATE:
BASE VERSION:
TAG USED:
*/
CREATE PROCEDURE [rpt].[RPT0080FacilityHistory]
(@RunID_PAR NUMERIC(10,0), @BillingCycleBeginDT_PAR DATE, @BillingCycleEndDT_PAR DATE)
AS
BEGIN
	
	SET NOCOUNT ON;

-----------Declaring new set of varibles to pass report parameter values-----------------------
	DECLARE  @RunID NUMERIC(10,0), @BillingCycleBeginDT DATE, @BillingCycleEndDT DATE

----------Passing Report Parameter values to procedure Parameters------------------------------
	SELECT @RunID = @RunID_PAR, @BillingCycleBeginDT = @BillingCycleBeginDT_PAR, @BillingCycleEndDT = @BillingCycleEndDT_PAR
	
SELECT DISTINCT
	DEV.EFFECTIVE_DT AS [Transaction Date],
	DA.SHORT_NAME_DESC AS [Lending Organization],
	DC.CONTRACT_NUMBER_DESC AS [Underlying Facility ID],
	DC.PRODUCT_DESC AS [Product Type],
	DCC.STRING_VALUE_DESC AS [Product Subtype],
	Case WHEN DCCI.REVOLVING_CREDIT_IND = 0 THEN 'N' 
	 WHEN DCCI.REVOLVING_CREDIT_IND = 1 THEN 'Y' 
	ELSE CONVERT(VARCHAR,DCCI.REVOLVING_CREDIT_IND)
	END AS [Revolving Indicator],
	'NOT IN R1' AS [Hybrid Indicator],
	DC.SIGNED_AMT AS [Underlying Facility Commitment Amount],
	VW_STOPORDER.STOP_ORDER_GROUP AS [Stop Order Group],
	IsNull(VW_STOPORDER.STOP_ORDER_AMOUNT,0.00) AS [Stop Order Amount],
	CASE WHEN (EVENT_DET_RESS1.NUMERIC_DATA_AMT ) -  (EVENT_DET_RESS2.NUMERIC_DATA_AMT ) > 0 THEN
	(EVENT_DET_RESS1.NUMERIC_DATA_AMT ) -  (EVENT_DET_RESS2.NUMERIC_DATA_AMT )
	 ELSE 0.00
	END AS [Rescission Amount],
	DCB_USED.VALUE_DATE_AMT AS [Loan Advance Amount],
	DCB_PRINCIPAL.VALUE_DATE_AMT AS [Unpaid Principal Balance],
	DCB_AVAILABLE.VALUE_DATE_AMT AS [Current Available Amount],
	DA_BORR.TRADE_NAME_DESC AS [Member Name],
	DA_BORR.ACTOR_CODE_DESC AS [Member ID]
	
--SELECT *  	
	FROM DW_CONTRACTS DC
	INNER JOIN [dbo].[DW_ELEMENTS] DE 
	ON  DC.CONTRACT_ID = DE.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.RUN_ID = DE.RUN_ID
	INNER JOIN [dbo].[DW_ELEMENT_SCHEDULE] DESH
	ON  DE.CONTRACT_ID = DESH.CONTRACT_ID
	AND DE.ORDER_NBR = DESH.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DESH.DIM_DATE_KEY
	AND DE.RUN_ID = DESH.RUN_ID
	LEFT JOIN [dbo].[DW_CONTRACT_BALANCES] DCB_USED
	ON  DC.CONTRACT_ID = DCB_USED.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCB_USED.DIM_DATE_KEY
	AND DC.RUN_ID = DCB_USED.RUN_ID
	AND DCB_USED.BALANCE_TYPE_DESC = 'USED_BALANCE'
	LEFT JOIN [dbo].[DW_CONTRACT_BALANCES] DCB_PRINCIPAL
	ON  DC.CONTRACT_ID = DCB_PRINCIPAL.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCB_PRINCIPAL.DIM_DATE_KEY
	AND DC.RUN_ID = DCB_PRINCIPAL.RUN_ID
	AND DCB_PRINCIPAL.BALANCE_TYPE_DESC = 'PRINCIPAL'
	LEFT JOIN [dbo].[DW_CONTRACT_BALANCES] DCB_AVAILABLE
	ON  DC.CONTRACT_ID = DCB_AVAILABLE.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCB_AVAILABLE.DIM_DATE_KEY
	AND DC.RUN_ID = DCB_AVAILABLE.RUN_ID
	AND DCB_AVAILABLE.BALANCE_TYPE_DESC = 'AVAILABLE'
	LEFT JOIN [dbo].[DW_CONTRACT_CREDIT_INFO] DCCI
	ON  DC.CONTRACT_ID = DCCI.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCCI.DIM_DATE_KEY
	AND DC.RUN_ID = DCCI.RUN_ID
	LEFT JOIN [dbo].[DW_CONTRACT_CHARACTERISTICS] DCC
	ON  DC.CONTRACT_ID = DCC.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCC.DIM_DATE_KEY
	AND DC.RUN_ID = DCC.RUN_ID
	AND DCC.CHARACTERISTIC_CODE IN ('LONGTERM','LETRCRED','LINECRED')
	LEFT JOIN (SELECT STOP_ORDER_GROUP,SUM(STOP_ORDER_AMOUNT) AS STOP_ORDER_AMOUNT ,CONTRACT_ID,DIM_Date_Key,RUN_ID 
	FROM [rpt].[VW_DW_STOP_ORDER]	-- THIS IS USED TO GET SUM OF STOP ORDER AMOUNT FOR ALL 	
	GROUP BY STOP_ORDER_GROUP,CONTRACT_ID,DIM_Date_Key,RUN_ID) VW_STOPORDER	--	CONTRACT_ID,DIM_Date_Key,RUN_ID
	ON  DC.CONTRACT_ID =  VW_STOPORDER.CONTRACT_ID
	AND DC.DIM_DATE_KEY = VW_STOPORDER.DIM_Date_Key
	AND DC.RUN_ID = VW_STOPORDER.RUN_ID
	LEFT JOIN [dbo].[DW_EVENTS] DEV
	ON  DC.RUN_ID = DEV.RUN_ID
	AND DC.DIM_DATE_KEY = DEV.DIM_DATE_KEY
	AND DC.CONTRACT_ID = DEV.CONTRACT_ID
	AND DEV.FUNCTION_CODE = 'EVD_DEBLOCFOND'
	LEFT JOIN (SELECT DEVNT.* FROM DW_EVENTS DEVNT 
	INNER JOIN DW_EVENT_DETAILS DED
	   ON  DEVNT.EVENT_ID = DED.EVENT_ID
	   AND DEVNT.DIM_DATE_KEY = DED.DIM_DATE_KEY
	   AND DEVNT.RUN_ID = DED.RUN_ID
	   AND DEVNT.FUNCTION_CODE = 'EVD_DEBLOCFOND'
	       AND DED.COLUMN_DESC = 'FONDS' 
	) EVENT_DET
	ON  DEV.EVENT_ID = EVENT_DET.EVENT_ID
	AND DEV.RUN_ID = EVENT_DET.RUN_ID
	AND DEV.DIM_DATE_KEY = EVENT_DET.DIM_DATE_KEY
	AND DEV.CONTRACT_ID = EVENT_DET.CONTRACT_ID
	LEFT JOIN (SELECT DEVNT.*,DED.NUMERIC_DATA_AMT FROM DW_EVENTS DEVNT 
	INNER JOIN DW_EVENT_DETAILS DED
	   ON  DEVNT.EVENT_ID = DED.EVENT_ID
	   AND DEVNT.DIM_DATE_KEY = DED.DIM_DATE_KEY
	   AND DEVNT.RUN_ID = DED.RUN_ID
	   AND DEVNT.FUNCTION_CODE = 'EVD_ENGM'
	       AND DED.COLUMN_DESC = 'ENGA_BEFORE' 
	) EVENT_DET_RESS1
	ON  --DC.EVENT_ID = EVENT_DET_RESS1.EVENT_ID
	DC.RUN_ID = EVENT_DET_RESS1.RUN_ID
	AND DC.DIM_DATE_KEY = EVENT_DET_RESS1.DIM_DATE_KEY
	AND DC.CONTRACT_ID = EVENT_DET_RESS1.CONTRACT_ID
	LEFT JOIN (SELECT DEVNT.*,DED.NUMERIC_DATA_AMT FROM DW_EVENTS DEVNT 
	INNER JOIN DW_EVENT_DETAILS DED
	   ON  DEVNT.EVENT_ID = DED.EVENT_ID
	   AND DEVNT.DIM_DATE_KEY = DED.DIM_DATE_KEY
	   AND DEVNT.RUN_ID = DED.RUN_ID
	   AND DEVNT.FUNCTION_CODE = 'EVD_ENGM'
	       AND DED.COLUMN_DESC = 'ENGA_AFTER' 
	) EVENT_DET_RESS2
	ON  EVENT_DET_RESS1.EVENT_ID = EVENT_DET_RESS2.EVENT_ID
	AND DC.RUN_ID = EVENT_DET_RESS2.RUN_ID
	AND DC.DIM_DATE_KEY = EVENT_DET_RESS2.DIM_DATE_KEY
	AND DC.CONTRACT_ID = EVENT_DET_RESS2.CONTRACT_ID
	LEFT JOIN DW_ACTORS DA 
	    ON DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND DC.RUN_ID = DA.RUN_ID
	LEFT JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	LEFT JOIN DW_ACTORS DA_BORR
	ON DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID

	WHERE DEV.VALIDATED_BY_CODE IS NOT NULL AND DEV.DELETED_BY_CODE IS NULL	---Only active Events are considered
	AND DC.RUN_ID = @RunID
	AND	DESH.ACCRUAL_PERIOD_START_DT >=  ISNULL(@BillingCycleBeginDT,'1111-01-01') AND DESH.ACCRUAL_PERIOD_END_DT <= @BillingCycleEndDT
	--AND DEV.EFFECTIVE_DT IS NOT NULL
	ORDER BY DEV.EFFECTIVE_DT
END


--EXEC [rpt].[RPT0080FacilityHistory] 82,NULL,'2099-12-22'
GO
/****** Object:  StoredProcedure [rpt].[RPT0100DrawPeriodEndDateforActiveFacilities]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE PROCEDURE [rpt].[RPT0100DrawPeriodEndDateforActiveFacilities]
	(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE, @DrawPeriodEndDateBegin_PAR DATE, @DrawPeriodEndDateEnd_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @DrawPeriodEndDateBegin DATE
	, @DrawPeriodEndDateEnd DATE
	, @ReportDate DATE

	SELECT @RunID = @RunID_PAR
	, @DrawPeriodEndDateBegin = @DrawPeriodEndDateBegin_PAR
	, @DrawPeriodEndDateEnd = @DrawPeriodEndDateEnd_PAR
	, @ReportDate = @ReportDate_PAR
	 
	SELECT AVP = AVP.USER_BY_DESC 
	, UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
	, ProductType = U.PRODUCT_DESC
	, ProductSubType = PST.CHARACTERISTIC_DESC
	, UnderlyingFacilityEffectiveDate = U.CONTRACT_START_DT
	, DrawPeriodEndDate = DPED.DATE_VALUE_DT
	, UnderlyingFacilityCommitmentAmount = u.SIGNED_AMT
	, CurrentAvailableAmount  =  AVAIL.VALUE_DATE_AMT
	, LendingOrganization = PA.SHORT_NAME_DESC + ' - ' + PA.TRADE_NAME_DESC
	, LendingOrganizationID = PA.ACTOR_ID
	FROM DW_CONTRACTS U
	LEFT JOIN DW_INVOLVED_USER AVP
	ON u.CONTRACT_ID = AVP.CONTRACT_ID
	AND u.DIM_DATE_KEY = AVP.DIM_DATE_KEY
	AND u.RUN_ID = AVP.RUN_ID	
	AND AVP.BUSINESS_CODE = 'AVP'
	--AND @ReportDate BETWEEN AVP.START_DT
	--	AND ISNULL(AVP.END_DT, @ReportDate) 
	LEFT JOIN DW_CONTRACT_BALANCES AVAIL 
	ON U.CONTRACT_ID = AVAIL.CONTRACT_ID
	AND U.DIM_DATE_KEY = AVAIL.DIM_DATE_KEY
	AND U.RUN_ID = AVAIL.RUN_ID
	AND AVAIL.BALANCE_TYPE_DESC = 'AVAILABLE'
	LEFT JOIN DW_CONTRACT_CHARACTERISTICS PST
	ON U.CONTRACT_ID = PST.CONTRACT_ID
	AND U.DIM_DATE_KEY = PST.DIM_DATE_KEY
	AND U.RUN_ID = PST.RUN_ID
	AND PST.CHARACTERISTIC_CODE  = 'SUBTYPE3'
	LEFT JOIN DW_CONTRACT_CHARACTERISTICS DPED
	ON U.CONTRACT_ID = DPED.CONTRACT_ID
	AND U.DIM_DATE_KEY = DPED.DIM_DATE_KEY
	AND U.RUN_ID = DPED.RUN_ID
	AND DPED.CHARACTERISTIC_CODE = 'AGREEDA'
	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID
	LEFT JOIN DW_ACTORS PA
	ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
	AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND U.RUN_ID = PA.RUN_ID
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND U.RUN_ID = @RunID
	AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT
	AND ISNULL(CP.PHASE_END_DT, @ReportDate) 
	)
	AND CP.STEP_DESC IN ('Active')
	AND AVAIL.VALUE_DATE_AMT > 0
	AND (DPED.DATE_VALUE_DT < @ReportDate
	OR  DPED.DATE_VALUE_DT BETWEEN @DrawPeriodEndDateBegin AND @DrawPeriodEndDateEnd
	)
	ORDER BY AVP.USER_BY_DESC 
	, DPED.DATE_VALUE_DT
END


GO
/****** Object:  StoredProcedure [rpt].[RPT0110InvoicePipeline]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0110InvoicePipeline]
	(@RunID_PAR NUMERIC(10,0), @PaymentDueBeginDate_PAR DATE, @PaymentDueEndDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

DECLARE @RunID NUMERIC(10,0)
	, @PaymentDueBeginDate DATE
	, @PaymentDueEndDate DATE

SELECT @RunID = @RunID_PAR
	, @PaymentDueBeginDate = @PaymentDueBeginDate_PAR
	, @PaymentDueEndDate = @PaymentDueEndDate_PAR

SELECT DISTINCT MemberID = M.ACTOR_CODE_DESC
	, ActorID = M.ACTOR_ID
	, ACCRUAL_PERIOD_START_DT = es.ACCRUAL_PERIOD_START_DT
	, ACCRUAL_PERIOD_END_DT = es.ACCRUAL_PERIOD_END_DT
	, UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
	, LoanID = E.LOAN_NBR
	, FeeID = NULL
	, ProductType = U.PRODUCT_DESC
	, AllInRate = ES.ANNUAL_PERCENTAGE_RATE_PCT
	, ScheduledInterestDueAmount = ES.INTEREST_AMT
	, ScheduledPrincipalDueAmount = ES.PRINCIPAL_AMT
	, ScheduledFeeDueAmount = NULL
	, LendingOrganization = LO.SHORT_NAME_DESC
	, LendingOrganizationID = LO.ACTOR_ID
FROM DW_ELEMENT_SCHEDULE ES 
LEFT JOIN DW_ELEMENTS E 
    ON ES.CONTRACT_ID = E.CONTRACT_ID
	AND ES.ELEMENT_ORDER_NBR = E.ORDER_NBR
	AND ES.DIM_DATE_KEY = E.DIM_DATE_KEY
	AND ES.RUN_ID = E.RUN_ID
LEFT JOIN DW_PROCESS_ALLOCATIONS PA
	ON E.PROCESS_ALLOCATION_ID = PA.PROCESS_ALLOCATION_ID
	AND E.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND E.RUN_ID = PA.RUN_ID
LEFT JOIN DW_CONTRACTS U
	ON E.CONTRACT_ID = U.CONTRACT_ID
	AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
	AND E.RUN_ID = U.RUN_ID
LEFT JOIN DW_CONTRACT_ACTORS CA 
    ON U.CONTRACT_ID = CA.CONTRACT_ID
        AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
        AND U.RUN_ID = CA.RUN_ID
        AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
LEFT JOIN DW_ACTORS M 
	ON CA.ACTOR_ID = M.ACTOR_ID
	AND CA.DIM_DATE_KEY = M.DIM_DATE_KEY
	AND CA.RUN_ID = M.RUN_ID
LEFT JOIN DW_ACTORS LO
	ON U.COMPANY_ACTOR_ID=LO.ACTOR_ID
	AND U.DIM_DATE_KEY = LO.DIM_DATE_KEY
        AND U.RUN_ID = PA.RUN_ID
WHERE U.PRODUCT_CODE NOT LIKE '%AUT%'
	AND ES.PAYMENT_DUE_DT BETWEEN @PaymentDueBeginDate AND @PaymentDueEndDate
	AND U.RUN_ID = @RunID
	AND (ES.INTEREST_AMT <> 0 OR ES.PRINCIPAL_AMT <> 0)
	AND PROCESS_ALLOCATION_CODE NOT LIKE 'FEE%'
ORDER BY M.ACTOR_CODE_DESC
	, es.ACCRUAL_PERIOD_START_DT
	, U.CONTRACT_NUMBER_DESC
	, E.LOAN_NBR
END
GO
/****** Object:  StoredProcedure [rpt].[RPT0260FlexibleFunding]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0260FlexibleFunding]
	(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE, @NumberOfYears_PAR INT)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @ReportDate DATE
	, @FirstMonthBeginDate DATE
	, @LastMonthEndDate DATE
	, @NumberOfYears INT

	SELECT @RunID = @RunID_PAR
	, @ReportDate = @ReportDate_PAR
	, @NumberOfYears = @NumberOfYears_PAR
	, @FirstMonthBeginDate = DATEADD(MONTH, DATEDIFF(MONTH, 0, @ReportDate),0)
	, @LastMonthEndDate = DATEADD(DAY, -1, DATEADD(YEAR, @NumberOfYears, @FirstMonthBeginDate))

IF OBJECT_ID('tempdb..#Month') IS NOT NULL 
	DROP TABLE #Month

;WITH Months AS
(
    SELECT FiscalYearSequenceNumber = 1
	, FiscalYear = YEAR(DATEADD(MONTH, 7, @FirstMonthBeginDate))
	, FiscalMonthNumber = MONTH(DATEADD(MONTH, 7, @FirstMonthBeginDate))
	, CalendarMonthName = DATENAME(MONTH, @FirstMonthBeginDate)
	, CalendarMonthBeginDate = @FirstMonthBeginDate
	, CalendarMonthNumber = MONTH(@FirstMonthBeginDate)
	, CalendarYear = YEAR(@FirstMonthBeginDate)
    
	UNION ALL
    
	SELECT FiscalYearSequenceNumber = 1+YEAR(DATEADD(MONTH, 8, CalendarMonthBeginDate)) - YEAR(DATEADD(MONTH, 7, @FirstMonthBeginDate))
	, FiscalYear = YEAR(DATEADD (MONTH, 8, CalendarMonthBeginDate)) 	
	, FiscalMonthNumber = MONTH(DATEADD(MONTH, 8, CalendarMonthBeginDate))	
	, CalendarMonthName = DATENAME(MONTH, DATEADD(MONTH, 1, CalendarMonthBeginDate))
	, CalendarMonthBeginDate = DATEADD(MONTH, 1, CalendarMonthBeginDate)
	, CalendarMonthNumber = MONTH(DATEADD(MONTH, 1, CalendarMonthBeginDate))
	, CalendarYear = YEAR(DATEADD(MONTH, 1, CalendarMonthBeginDate))
    FROM Months
    WHERE CalendarMonthBeginDate <  DATEADD(MONTH, -1, @LastMonthEndDate)
)

SELECT FiscalYearSequenceNumber
	, FiscalYear
	, FiscalMonthNumber
	, CalendarMonthName
	, CalendarMonthBeginDate
	, CalendarMonthNumber
	, CalendarYear
INTO #Month
FROM Months
OPTION (MAXRECURSION 0)

	SELECT dt.FiscalYear
	, dt.FiscalYearSequenceNumber
	, CalendarMonthName = LEFT(dt.CalendarMonthName, 3)
	, dt.FiscalMonthNumber
	, LendingOrganization = LO.SHORT_NAME_DESC
	, LendingOrganizationID = LO.ACTOR_ID
	, MemberID =  M.ACTOR_ID
	, LoanNumber = E.LOAN_NBR
	, LoanType = 'LT' + CASE WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' THEN 'F' ELSE 'V' END
	, Amortization = ES.PRINCIPAL_AMT
	, InterestRate = CASE WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' THEN ES.ANNUAL_PERCENTAGE_RATE_PCT END
	, WeightedAverageRateNom =  CASE WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' THEN ES.PRINCIPAL_AMT * ES.ANNUAL_PERCENTAGE_RATE_PCT END
	, NextRepricingUnpaidPrincipalBalance = CASE WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' AND NRD.DATE_VALUE_DT BETWEEN ES.ACCRUAL_PERIOD_START_DT AND ES.ACCRUAL_PERIOD_END_DT THEN ES.POST_PRINCIPAL_BALANCE_AMT END
 	, WeightedAverageRepricingRateNom =  CASE WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' AND NRD.DATE_VALUE_DT BETWEEN ES.ACCRUAL_PERIOD_START_DT AND ES.ACCRUAL_PERIOD_END_DT THEN ES.POST_PRINCIPAL_BALANCE_AMT END
	* ES.ANNUAL_PERCENTAGE_RATE_PCT 
	FROM  DW_ELEMENT_SCHEDULE ES 
	LEFT JOIN DW_ELEMENTS E 
	ON ES.CONTRACT_ID = E.CONTRACT_ID
	AND ES.ELEMENT_ORDER_NBR = E.ORDER_NBR
	AND ES.DIM_DATE_KEY = E.DIM_DATE_KEY
	AND ES.RUN_ID = E.RUN_ID
	LEFT JOIN DW_ELEMENT_CHARACTERISTICS NRD
	ON E.CONTRACT_ID = NRD.CONTRACT_ID
	AND E.ORDER_NBR = NRD.ELEMENT_ORDER_NBR
	AND E.DIM_DATE_KEY = NRD.DIM_DATE_KEY
	AND E.RUN_ID = NRD.RUN_ID
	AND NRD.[CHARACTERISTIC_CODE] = 'REPEFFDT'
	LEFT JOIN DW_CONTRACTS U
	ON  E.CONTRACT_ID = U.CONTRACT_ID
	AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
	AND E.RUN_ID = U.RUN_ID
	LEFT JOIN DW_ACTORS M 
	ON E.ACTOR_ID = M.ACTOR_ID
	AND E.DIM_DATE_KEY = M.DIM_DATE_KEY
	AND E.RUN_ID = M.RUN_ID
	LEFT JOIN DW_ACTORS LO
	ON U.COMPANY_ACTOR_ID=LO.ACTOR_ID
	AND U.DIM_DATE_KEY = LO.DIM_DATE_KEY
	AND U.RUN_ID = LO.RUN_ID
	INNER JOIN #Month dt
	ON  YEAR(ES.PAYMENT_DUE_DT) = dt.CalendarYear
	AND MONTH(ES.PAYMENT_DUE_DT) = dt.CalendarMonthNumber
	WHERE E.RUN_ID = @RunID
	AND E.ELEMENT_CLASS_CODE = 'F'
	AND E.ELEMENT_TYPE_CODE IN ('F', 'P')
	AND U.PRODUCT_CODE = 'P1P' --Long Term
	AND E.INTEREST_RATE_NATURE_CODE IN ('TF', 'VR') --Fixed, variable
	AND ES.PAYMENT_DUE_DT BETWEEN @FirstMonthBeginDate AND @LastMonthEndDate

UNION ALL

SELECT dt.FiscalYear
	, dt.FiscalYearSequenceNumber
	, CalendarMonthName = LEFT(dt.CalendarMonthName, 3)
	, dt.FiscalMonthNumber 
	, LendingOrganizationID = NULL
	, LendingOrganization =NULL
	, MemberID = NULL
	, LoanNumber = NULL
	, LoanType = NULL 
	, Amortization = 0 
	, InterestRate = 0
	, WeightedAverageRateNom = 0
	, NextRepricingUnpaidPrincipalBalance = 0
	, WeightedAverageRepricingRateNom =  0
FROM #Month dt
ORDER BY dt.FiscalYear, dt.FiscalMonthNumber

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0270LongTermAmortization]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/*
PURPOSE:-This procedure is used to build the report [rpt].[RPT0270LongTermAmortization]
CREATED BY:- RAVITEJA
CREATED DATE:-05/12/2016
Functions Used:- This procedure uses the function dbo.fn_MVParam to split the Report Parameters into comma seperated values
---------------------------------------------------------REVISION HISTORY-----------------------------
MODIFIED BY:
MODIFIED DATE:
BASE VERSION:
TAG USED:
*/
CREATE PROCEDURE [rpt].[RPT0270LongTermAmortization]
(@RunID_PAR NUMERIC(10,0),@LendingOrg_PAR Varchar(Max), @CustomerID_PAR Varchar(MAX),@FacilityID_PAR Varchar(MAX),@LoanId_PAR Varchar(MAX),@AmortizationCycleBeginDT_PAR Date,@AmortizationCycleEndDT_PAR Date)
AS
BEGIN
	
	SET NOCOUNT ON;

-----------Declaring new set of varibles to pass report parameter values-----------------------
	DECLARE  @RunID NUMERIC(10,0), @LendingOrg Varchar(Max),@CustomerID Varchar(MAX),@FacilityID Varchar(MAX),@LoanId Varchar(MAX),@AmortizationCycleBeginDT Date, @AmortizationCycleEndDT Date

----------Declaring Flag variables
	DECLARE @LendingOrg_Flag Int = 0,@CustomerID_Flag Int = 0,@FacilityID_Flag Int = 0,@LoanId_Flag Int = 0

----------Passing Report Parameter values to procedure Parameters------------------------------
	SELECT  @RunID = @RunID_PAR, 
	@LendingOrg= @LendingOrg_PAR,
	@CustomerID = @CustomerID_PAR,
	@FacilityID = @FacilityID_PAR, 
	@LoanId = @LoanId_PAR,
	@AmortizationCycleBeginDT = @AmortizationCycleBeginDT_PAR,
	@AmortizationCycleEndDT = @AmortizationCycleEndDT_PAR

/* Setting Flag to fetch for all Customers/Facility/Loans if They select Nulls in report*/
IF @LendingOrg_PAR IS NULL OR @LendingOrg_PAR LIKE '%NULL%'
	Begin
	set @LendingOrg_Flag = 1
	End
IF @CustomerID_PAR IS NULL OR @CustomerID_PAR LIKE '%Null%'
	Begin
	set @CustomerID_Flag = 1
	End
IF @FacilityID_PAR IS NULL OR @FacilityID_PAR LIKE '%Null%'
	BEGIN
	SET @FacilityID_Flag = 1
	END
IF @LoanId_PAR IS NULL OR @LoanId_PAR LIKE '%Null%'
	BEGIN
	SET @LoanId_Flag = 1
	END
----------------------------------Uncomment below commands for testing--------------------------------------------------
--	SELECT  @RunID,
--	@CustomerID ,
--	@FacilityID  ,
--	@LoanId  
------------------------------------Comment above block once testing is done----------------------------

/* Creating table #MonthTable to display all the months in the final repoart. The data will be blank if we dont have value for particular month*/

Create table #MonthTable	
	(	MemberName	Varchar(200),
	MemberId	Varchar(15),
	UnderlyingFac	Varchar(15),
	LendingOrg	Varchar(200),
	LendingOrgName	Varchar(500),
	LoanNbr	Varchar(15),
	YearName	Int,
	Month_Name	Char(3),
	Month_Number	Int,
	Principal_Amt	Numeric(15,2),
	WeightedRate	Numeric(15,2),
	LoanType	char(2)
)
-- Loading all months to the temp table------------
Insert into #MonthTable (Month_Name,Month_Number) Values ('Jan',1),('Feb',2),('Mar',3),('Apr',4),('May',5),('Jun',6),('Jul',7),('Aug',8),('Sep',9),('Oct',10),('Nov',11),('Dec',12)

--Using existing DW_DIM_DATE table, i am making cross join to year for specified time frame------------------
Insert into #MonthTable(MemberName,MemberId,UnderlyingFac,LendingOrg,LendingOrgName,LoanNbr,YearName,Month_Name,Month_Number,Principal_Amt,WeightedRate,LoanType)  
	Select TRADE_NAME_DESC ,ACTOR_CODE_DESC,CONTRACT_NUMBER_DESC,SHORT_NAME_DESC,Loan_Details.LendingOrgName,Loan_NBR,DIM_DATE.YEAR4,Month_Name,Month_Number,0.00,0.00,INTEREST_RATE_NATURE_CODE from #MonthTable
cross join 
(select distinct Year4 from [dbo].[DW_DIM_DATE] 
where (Year4 >= Datepart(YYYY,@AmortizationCycleBeginDT) And Year4 <= Datepart(YYYY,@AmortizationCycleEndDT)))DIM_DATE
------------cross joining below table to get all the combinations of lendingOrg/Member/Facility and loans with respective to Year and Month for 45 years
Cross Join

(Select distinct DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC AS CONTRACT_NUMBER_DESC , DA.SHORT_NAME_DESC,DA.TRADE_NAME_DESC AS LendingOrgName,DE.Loan_NBR,DE.INTEREST_RATE_NATURE_CODE From DW_CONTRACTS DC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID
	Left JOIN [dbo].[DW_ELEMENTS] DE 
	ON  DC.CONTRACT_ID = DE.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.RUN_ID = DE.RUN_ID
	Left JOIN DW_ELEMENT_SCHEDULE DESH
	ON  DE.CONTRACT_ID = DESH.CONTRACT_ID
	AND DE.ORDER_NBR = DESH.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DESH.DIM_DATE_KEY
	AND DE.RUN_ID = DESH.RUN_ID
WHERE DE.RUN_ID = @RunID
	AND	(@LendingOrg_Flag = 1 OR DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	AND (@CustomerID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@CustomerID,',')))
	AND (@FacilityID_Flag = 1 OR DC.CONTRACT_NUMBER_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
	AND DESH.PAYMENT_TYPE_CODE = 'LOYER' -- EXCLUDING INVESTMENTS
	--AND EXTERNAL_TERM_NBR IS NOT NULL -- EXCLUDING INVESTMENTS AND ESTIMATED PAYOFF DATE
	AND DE.ELEMENT_CLASS_CODE = 'F' AND DE.ELEMENT_TYPE_CODE = 'F' -- EXCLUDING FEE
	AND DC.PRODUCT_CODE = 'P1P'-- FOR LONG TERM LOANS
	--AND (DE.INTEREST_RATE_NATURE_CODE = 'TF' OR DE.INTEREST_RATE_NATURE_CODE = 'VR') -- FOR FIXED/VARIABLE LOANS
	AND (DESH.PAYMENT_DUE_DT >= @AmortizationCycleBeginDT And DESH.PAYMENT_DUE_DT <= @AmortizationCycleEndDT)
	AND DE.Loan_NBR IS NOT NULL
) Loan_Details
;

--select * from #MonthTable order by lendingorg,memberid,underlyingfac,yearname
;
----------------------Using CTE1 to create the main extract by spinning through all the tables--------------------
With CTE1
 AS
  (
	SELECT DISTINCT
	DA.SHORT_NAME_DESC AS [Lending Organization],
	DA.TRADE_NAME_DESC AS [Lending Org Name],
	DA_BORR.TRADE_NAME_DESC AS [Member Name],
	DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	DC.CONTRACT_NUMBER_DESC AS [Facility ID],
	DE.Loan_NBR AS [Loan ID],
	DATENAME(YEAR,DESH.PAYMENT_DUE_DT) AS [PaymentDueDate_Year],
	SUBSTRING(DATENAME(MONTH,DESH.PAYMENT_DUE_DT),1,3) AS [PaymentDueDate_Month],
	DatePart(Month,DESH.PAYMENT_DUE_DT) AS [PaymentDueDate_MonthNbr],
	SUM(DESH.PRINCIPAL_AMT) AS [Principal Amount],
	Case when DE.INTEREST_RATE_NATURE_CODE = 'TF' AND SUM(DESH.PRINCIPAL_AMT) > 0.00 then SUM(DESH.PRINCIPAL_AMT * ANNUAL_PERCENTAGE_RATE_PCT)/SUM(DESH.PRINCIPAL_AMT) End as WeightedRate,
	DE.INTEREST_RATE_NATURE_CODE AS LoanType
	FROM [dbo].[DW_ELEMENTS] DE 
	Left JOIN DW_ELEMENT_SCHEDULE DESH
	ON  DE.CONTRACT_ID = DESH.CONTRACT_ID
	AND DE.ORDER_NBR = DESH.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DESH.DIM_DATE_KEY
	AND DE.RUN_ID = DESH.RUN_ID
	Inner JOIN [dbo].[DW_ELEMENT_FLOWS] DEF
	ON  DE.CONTRACT_ID = DEF.CONTRACT_ID
	AND DE.ORDER_NBR = DEF.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DEF.DIM_DATE_KEY
	AND DE.RUN_ID = DEF.RUN_ID
	AND DEF.PERIOD_TYPE_CODE <>'001'
	Inner Join DW_CONTRACTS DC
	ON  DE.CONTRACT_ID = DC.CONTRACT_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.RUN_ID = DC.RUN_ID
	INNER JOIN DW_ACTORS DA 
	ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
	   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
	   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID
	
	WHERE DE.RUN_ID = @RunID
	AND	(@LendingOrg_Flag = 1 OR DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	AND (@CustomerID_Flag = 1 OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@CustomerID,',')))
	AND (@FacilityID_Flag = 1 OR DC.CONTRACT_NUMBER_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	AND (@LoanId_Flag = 1 OR DE.Loan_NBR IN (Select Param from [rpt_prm].[GetMVParam] (@LoanId,',')))
	AND DESH.PAYMENT_TYPE_CODE = 'LOYER' -- EXCLUDING INVESTMENTS
	--AND EXTERNAL_TERM_NBR IS NOT NULL -- EXCLUDING INVESTMENTS AND ESTIMATED PAYOFF DATE
	AND DE.ELEMENT_CLASS_CODE = 'F' AND DE.ELEMENT_TYPE_CODE IN ('F','P') -- EXCLUDING FEE
	AND DC.PRODUCT_CODE = 'P1P'-- FOR LONG TERM LOANS
	AND (DESH.PAYMENT_DUE_DT >= @AmortizationCycleBeginDT And DESH.PAYMENT_DUE_DT <= @AmortizationCycleEndDT)
	--AND DE.INTEREST_RATE_NATURE_CODE = 'TF' -- FOR ONLY FIXED LOANS
	AND DE.Loan_NBR IS NOT NULL
	GROUP BY DA.SHORT_NAME_DESC,DA.TRADE_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC,DE.Loan_NBR,DATENAME(YEAR,DESH.PAYMENT_DUE_DT),SUBSTRING(DATENAME(MONTH,DESH.PAYMENT_DUE_DT),1,3),DatePart(Month,DESH.PAYMENT_DUE_DT), DE.INTEREST_RATE_NATURE_CODE
	--ORDER BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,Substring(DC.CONTRACT_NUMBER_DESC,6,4),DE.Loan_NBR,DATENAME(YEAR,DESH.PAYMENT_DUE_DT),DATENAME(MONTH,DESH.PAYMENT_DUE_DT), DE.INTEREST_RATE_NATURE_CODE

Union
	 Select LendingOrg,LendingOrgName,MemberName,MemberId,UnderlyingFac,LoanNbr,YearName,ltrim(rtrim(Month_Name)),Month_Number,Principal_Amt,WeightedRate,LoanType from #MonthTable WHERE YearName is not null 
),

CTE2
	AS
	(
	SELECT [Lending Organization],[Lending Org Name],[Member Name],[Member ID],[Facility ID],[Loan ID],
	CASE WHEN	[PaymentDueDate_MonthNbr] <= 5 
	  Then [PaymentDueDate_Year]
	  Else [PaymentDueDate_Year] + 1
	End AS [PaymentDueDate_Year],[PaymentDueDate_Month],[PaymentDueDate_MonthNbr],SUM([Principal Amount]) AS [Principal Amount] ,SUM(WeightedRate) AS [Weighted Rate],LoanType FROM CTE1
	Where ([PaymentDueDate_Year] = Datepart(YYYY,@AmortizationCycleBeginDT) and [PaymentDueDate_MonthNbr] >= Datepart(Month,@AmortizationCycleBeginDT))
	 OR [PaymentDueDate_Year] > Datepart(YYYY,@AmortizationCycleBeginDT)
	GROUP BY [Lending Organization],[Lending Org Name],[Member Name],[Member ID],[Facility ID],[Loan ID],[PaymentDueDate_Year],[PaymentDueDate_Month],[PaymentDueDate_MonthNbr],LoanType
	)
	SELECT [Lending Organization],[Lending Org Name],[Member Name],[Member ID],[Facility ID],[Loan ID],DENSE_RANK() OVER(ORDER BY PaymentDueDate_Year asc) AS YearNumber, 
	   [PaymentDueDate_Year],[PaymentDueDate_Month],[PaymentDueDate_MonthNbr],[Principal Amount] AS [Principal Amount] ,[Weighted Rate],LoanType FROM CTE2
	   ORDER BY [Lending Organization],[Member Name],[Member ID],[Facility ID],[Loan ID],[PaymentDueDate_Year],[PaymentDueDate_MonthNbr],LoanType
	
	Drop table #MonthTable;

END



--EXEC [rpt].[RPT0270LongTermAmortization] 460,nULL,nULL,Null,Null,'2010-1-31'
--EXEC [rpt].[RPT0270LongTermAmortization] 162,'cfc','AK601,AL042,AR010,NH004,VT015',Null,nULL,'2015-01-01'
--EXEC [rpt].[RPT0020AmortizationSchedule_Detail] 162,'Null,AK003,AK005,AK601,AL042,AR010,NH004,VT015',Null,Null
--EXEC [rpt].[RPT0320ForecastReport] 162,Null,Null,5,'RTFC,cfc','AK001,AK002,AK003,AK005'




GO
/****** Object:  StoredProcedure [rpt].[RPT0280CreditConcentration]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0280CreditConcentration]
(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)


AS
BEGIN
	
SET NOCOUNT ON;

DECLARE   @RunID NUMERIC(10,0),
	      @ReportDate DATE

SELECT @RunID = @RunID_PAR, @ReportDate = @ReportDate_PAR


;WITH ElementBalances
AS
(
       SELECT          CONTRACT_ID
                     , ELEMENT_ORDER_NBR
                     , BALANCE_TYPE_DESC
                     , VALUE_DATE_AMT
                     , EFFECTIVE_DATE_KEY
                     , ROW_RANK = ROW_NUMBER() OVER(PARTITION BY CONTRACT_ID, ELEMENT_ORDER_NBR, BALANCE_TYPE_DESC ORDER BY EFFECTIVE_DATE_KEY DESC) 
       FROM DW_ELEMENT_BALANCES
       WHERE BALANCE_TYPE_DESC IN ('PRINCIPAL', 'INTEREST')
       AND CAST(CAST(EFFECTIVE_DATE_KEY AS VARCHAR(8)) AS DATE) <= @ReportDate
)



SELECT DISTINCT
       LendingOrganization = PA.SHORT_NAME_DESC + ' - ' + PA.TRADE_NAME_DESC, 
       LendingOrganizationID = PA.ACTOR_ID,
	   MemberState=ISNULL(LEFT(A.ACTOR_CODE_DESC,2), 0),
	   A.ACTOR_ID,
	   E.LOAN_NBR,
       MemberID = ISNULL(A.ACTOR_CODE_DESC,'-'),
       MemberName=ISNULL(A.TRADE_NAME_DESC, 0),
       UnpaidPrincipalBalance=ISNULL(UNPAIDP.VALUE_DATE_AMT, 0),
       --UnpaidInterestBalance=ISNULL(UNPAIDI.VALUE_DATE_AMT, 0)
	   --,LendingOrganizationID=ISNULL(PA.ACTOR_ID, 0)

	   LT_Fixed_Secured_AMT = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'            -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(UNPAIDP.VALUE_DATE_AMT, 0) ELSE NULL END),

       LT_Fixed_Secured_NBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'            -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(E.LOAN_NBR, 0) ELSE NULL END),
      
	  LT_Fixed_Secured_MBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'            -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(A.ACTOR_ID, 0) ELSE NULL END),

       LT_Variable_Secured_AMT = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Long Term'            -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR' -- Interest Rate = 'Variable'
	 ) THEN ISNULL(UNPAIDP.VALUE_DATE_AMT, 0) ELSE NULL END),

      LT_Variable_Secured_NBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Long Term'            -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR' -- Interest Rate = 'Variable'
	 ) THEN ISNULL(E.LOAN_NBR, 0) ELSE NULL END),

      LT_Variable_Secured_MBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Long Term'            -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR' -- Interest Rate = 'Variable'
	 ) THEN ISNULL(A.ACTOR_ID, 0) ELSE NULL END),

       LT_Fixed_Unsecured_AMT = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'           -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF' -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(UNPAIDP.VALUE_DATE_AMT, 0) ELSE NULL END),

       LT_Fixed_Unsecured_NBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'           -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF' -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(E.LOAN_NBR, 0) ELSE NULL END), 
     
	    LT_Fixed_Unsecured_MBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'           -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF' -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(A.ACTOR_ID, 0) ELSE NULL END), 

       LT_Variable_Unsecured_AMT = (CASE WHEN (SecI.STRING_VALUE_DESC  = 'UNSECURED'           -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR' -- Interest Rate = 'Variable'
	 ) THEN ISNULL(UNPAIDP.VALUE_DATE_AMT, 0) ELSE NULL END),
       
	   LT_Variable_Unsecured_NBR = (CASE WHEN (SecI.STRING_VALUE_DESC  = 'UNSECURED'           -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR' -- Interest Rate = 'Variable'
	 ) THEN ISNULL(E.LOAN_NBR, 0) ELSE NULL END),

       LT_Variable_Unsecured_MBR = (CASE WHEN (SecI.STRING_VALUE_DESC  = 'UNSECURED'           -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Long Term'           -- Product Type = 'Long Term Loan'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR' -- Interest Rate = 'Variable'
	 ) THEN ISNULL(A.ACTOR_ID, 0) ELSE NULL END),

       LOC_Fixed_Secured_AMT = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(UNPAIDP.VALUE_DATE_AMT, 0) ELSE NULL END),

       LOC_Fixed_Secured_NBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(E.LOAN_NBR, 0) ELSE NULL END),

      LOC_Fixed_Secured_MBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(A.ACTOR_ID, 0) ELSE NULL END),

      LOC_Variable_Secured_AMT = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'         -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR'          -- Interest Rate = 'Variable'
	 ) THEN ISNULL(UNPAIDP.VALUE_DATE_AMT, 0) ELSE NULL END),
 
      LOC_Variable_Secured_NBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'         -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR'          -- Interest Rate = 'Variable'
	 ) THEN ISNULL(E.LOAN_NBR, 0) ELSE NULL END),

       LOC_Variable_Secured_MBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'SECURED'           -- Secure Indicator = 'Secured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'         -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR'          -- Interest Rate = 'Variable'
	 ) THEN ISNULL(A.ACTOR_ID, 0) ELSE NULL END),

	   LOC_Fixed_Unsecured_AMT = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'       -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(UNPAIDP.VALUE_DATE_AMT, 0) ELSE NULL END),

       LOC_Fixed_Unsecured_NBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'       -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(E.LOAN_NBR, 0) ELSE NULL END),

      LOC_Fixed_Unsecured_MBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'       -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='TF'       -- Interest Rate = 'Fixed'
	 ) THEN ISNULL(A.ACTOR_ID, 0) ELSE NULL END),


	   LOC_Variable_Unsecured_AMT = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'       -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR'       -- Interest Rate = 'Variable'
	 ) THEN ISNULL(UNPAIDP.VALUE_DATE_AMT, 0) ELSE NULL END),
	 
	  LOC_Variable_Unsecured_NBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'       -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR'       -- Interest Rate = 'Variable'
	 ) THEN ISNULL(E.LOAN_NBR, 0) ELSE NULL END),
	 	 
	  LOC_Variable_Unsecured_MBR = (CASE WHEN (SecI.STRING_VALUE_DESC = 'UNSECURED'       -- Secure Indicator = 'Unsecured'
	                                     AND U.PRODUCT_DESC = 'Line of Credit'      -- Product Type = 'Line of Credit'  
	 AND E.INTEREST_RATE_NATURE_CODE='VR'       -- Interest Rate = 'Variable'
	 ) THEN ISNULL(A.ACTOR_ID, 0) ELSE NULL END)	 
	 	 	 	

FROM DW_ELEMENTS E


LEFT JOIN DW_ELEMENT_VARIABLE_RATES EV
	ON EV.ELEMENT_ORDER_NBR=E.ORDER_NBR
	AND EV.ELEMENT_ORDER_NBR = E.ORDER_NBR
	  AND EV.CONTRACT_ID = E.CONTRACT_ID
              AND EV.DIM_DATE_KEY = E.DIM_DATE_KEY
              AND EV.RUN_ID = E.RUN_ID
	
LEFT JOIN DW_ELEMENT_CHARACTERISTICS BRC
       ON E.CONTRACT_ID = BRC.CONTRACT_ID
	   AND E.ORDER_NBR = BRC.ELEMENT_ORDER_NBR
              AND E.DIM_DATE_KEY = BRC.DIM_DATE_KEY
              AND E.RUN_ID = BRC.RUN_ID
              AND BRC.[CHARACTERISTIC_CODE] = 'LNBRTCD'
LEFT JOIN DW_ELEMENT_CHARACTERISTICS NRD
       ON E.CONTRACT_ID = NRD.CONTRACT_ID
	   AND E.ORDER_NBR = NRD.ELEMENT_ORDER_NBR
              AND E.DIM_DATE_KEY = NRD.DIM_DATE_KEY
              AND E.RUN_ID = NRD.RUN_ID
              AND NRD.[CHARACTERISTIC_CODE] = 'REPEFFDT'
INNER JOIN DW_CONTRACTS U
       ON E.CONTRACT_ID = U.CONTRACT_ID
              AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND E.RUN_ID = U.RUN_ID
LEFT JOIN DW_CONTRACT_ACTORS CA 
       ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
LEFT JOIN DW_ACTORS PA
ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
 AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
              AND U.RUN_ID = PA.RUN_ID
LEFT JOIN DW_ACTORS A 
       ON CA.ACTOR_ID = A.ACTOR_ID
              AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
              AND CA.RUN_ID = A.RUN_ID
LEFT JOIN DW_CONTRACT_CHARACTERISTICS SecI
	ON U.CONTRACT_ID = SecI.CONTRACT_ID
	AND U.DIM_DATE_KEY = SecI.DIM_DATE_KEY
	AND U.RUN_ID = SecI.RUN_ID
	and SecI.CHARACTERISTIC_CODE ='FACCHAR'
	
LEFT JOIN DW_ELEMENT_SCHEDULE es 
       ON e.CONTRACT_ID = es.CONTRACT_ID
                     AND e.ORDER_NBR = es.ELEMENT_ORDER_NBR
                     AND e.DIM_DATE_KEY = es.DIM_DATE_KEY
                     AND e.RUN_ID = es.RUN_ID 

LEFT JOIN ElementBalances UNPAIDP 
       ON E.CONTRACT_ID = UNPAIDP.CONTRACT_ID
	      AND E.ORDER_NBR = UNPAIDP.ELEMENT_ORDER_NBR
          AND UNPAIDP.BALANCE_TYPE_DESC = 'PRINCIPAL'
	  AND UNPAIDP.ROW_RANK = 1

LEFT JOIN ElementBalances UNPAIDI 
       ON E.CONTRACT_ID = UNPAIDI.CONTRACT_ID
	    AND E.ORDER_NBR = UNPAIDI.ELEMENT_ORDER_NBR
        AND UNPAIDI.BALANCE_TYPE_DESC = 'INTEREST'
	AND UNPAIDI.ROW_RANK = 1

WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND @ReportDate BETWEEN ES.ACCRUAL_PERIOD_START_DT AND ES.ACCRUAL_PERIOD_END_DT
	AND E.ELEMENT_CLASS_CODE = 'F'
	AND E.ELEMENT_TYPE_CODE IN ('F', 'P')
	AND U.RUN_ID = @RunID

--GROUP BY 
--PA.SHORT_NAME_DESC + ' - ' + PA.TRADE_NAME_DESC,
--PA.ACTOR_ID,
--LEFT(A.ACTOR_CODE_DESC,2), 
--A.ACTOR_CODE_DESC,
--A.TRADE_NAME_DESC,
--A.ACTOR_ID

END


GO
/****** Object:  StoredProcedure [rpt].[RPT0290Conversions&RepricingRecap]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [rpt].[RPT0290Conversions&RepricingRecap]
(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)

AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE   @RunID NUMERIC(10,0), @ReportDate DATE, @FiscalYearStartDate DATE, @FiscalYearEndDate DATE

    SELECT @RunID = @RunID_PAR, @ReportDate = @ReportDate_PAR, 
@FiscalYearStartDate = DATEADD(MONTH, 5, DATEADD(YEAR, DATEDIFF(YEAR, 0, DATEADD(MONTH,-5,@ReportDate)),0)),
@FiscalYearStartDate = DATEADD(MONTH, -7, DATEADD(YEAR, DATEDIFF(YEAR, -1, DATEADD(MONTH,7,@ReportDate)),-1))

SELECT DISTINCT 
	
	EffectiveRepricingDate = CASE WHEN	E.START_DT BETWEEN @FiscalYearStartDate AND @FiscalYearEndDate 
	AND E.START_DT = ED.DATE_VALUE_DT
	   THEN ED.DATE_VALUE_DT
	END,
	LoanID = ISNULL(E.LOAN_NBR, '-'),
	UnpaidPrincipalBalance= E.INITIAL_BASIS_AMT

FROM DW_ELEMENTS E

INNER JOIN DW_ELEMENT_CHARACTERISTICS ED
       ON E.CONTRACT_ID = ED.CONTRACT_ID
	AND E.ORDER_NBR = ED.ELEMENT_ORDER_NBR              
	AND E.DIM_DATE_KEY = ED.DIM_DATE_KEY
        AND E.RUN_ID = ED.RUN_ID
        AND ED.[CHARACTERISTIC_CODE] = 'LNCNEFDT'


--INNER JOIN DW_ELEMENT_CHARACTERISTICS ER
--       ON E.CONTRACT_ID = ER.CONTRACT_ID
--	AND E.ORDER_NBR = ER.ELEMENT_ORDER_NBR              
--	AND E.DIM_DATE_KEY = ER.DIM_DATE_KEY
--        AND E.RUN_ID = ER.RUN_ID
--        AND ER.[CHARACTERISTIC_CODE] = 'LNREPRIC'
	--AND ER.STRING_VALUE_DESC = 01 THEN FtoF
	--if 04 FtoV

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0300LoanMaturity]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/*
PURPOSE:-This procedure is used to build the report RPT_0300_Loan Maturity
CREATED BY:- SAI KRISHNA
CREATED DATE:-03/25/2016
---------------------------------------------------------REVISION HISTORY-----------------------------
MODIFIED BY:
MODIFIED DATE:
BASE VERSION:
TAG USED:
*/
--EXEC [rpt].[RPT0300LoanMaturity] 623, '07/19/2016', '07/18/2016', '12/31/2016'
--SELECT * FROM ETL_CONTROL
CREATE PROCEDURE [rpt].[RPT0300LoanMaturity]

(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR Date, @BeginDT_PAR date, @EndDT_PAR date)
AS
BEGIN
	
	SET NOCOUNT ON;

-----------Declaring new set of varibles to pass report parameter values-----------------------
	DECLARE  @RunID NUMERIC(10,0), @ReportDate Date, @BeginDT date, @EndDT date

----------Passing Report Parameter values to procedure Parameters------------------------------
SELECT @RunID = @RunID_PAR, @ReportDate = @ReportDate_PAR,  @BeginDT = @BeginDT_PAR, @EndDT = @EndDT_PAR

;with CTE1       
       AS
              (
                     SELECT        DISTINCT     MemberID = A.ACTOR_CODE_DESC
                                           , UnderlyingFacilityID = U.CONTRACT_NUMBER_DESC
                                                          , UnderlyingFacilityMaturityDate = U.CONTRACT_END_DT
                                           , UnpaidPrincipalBalance  = UNPAIDP.VALUE_DATE_AMT
                                           ,LoanID = E.LOAN_NBR
                                                          ,LoanMaturityDate = E.END_DT
                                                          , E.ORDER_NBR
                                                          ,UnderlyingFacilityAvailableBalance = AVAILBAL.VALUE_DATE_AMT
                                                          ,UnderlyingFacilityUsedBalance = USED.VALUE_DATE_AMT
                                                          ,LendingOrganizationID=PA.ACTOR_ID
                                                          , LendingOrganization=PA.SHORT_NAME_DESC
         
                     FROM DW_ELEMENTS E
                     INNER  JOIN DW_CONTRACTS u 
                                           ON U.CONTRACT_ID = E.CONTRACT_ID
                                                       AND U.DIM_DATE_KEY = E.DIM_DATE_KEY
                                                       AND U.RUN_ID = E.RUN_ID 
                     INNER JOIN DW_CONTRACT_ACTORS CA 
                                           ON U.CONTRACT_ID = CA.CONTRACT_ID
                                                       AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
                                                       AND U.RUN_ID = CA.RUN_ID
                                                       AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
                     INNER JOIN DW_ACTORS PA
                                           ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
                                                                 AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
                                           AND U.RUN_ID = PA.RUN_ID
                     INNER JOIN DW_ACTORS A 
                                           ON CA.ACTOR_ID = A.ACTOR_ID
                                                       AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
                                                       AND CA.RUN_ID = A.RUN_ID
                     LEFT JOIN DW_ELEMENT_BALANCES UNPAIDP 
                                                         ON E.CONTRACT_ID = UNPAIDP.CONTRACT_ID
                                           AND E.DIM_DATE_KEY = UNPAIDP.DIM_DATE_KEY
                                                              AND E.ORDER_NBR = UNPAIDP.ELEMENT_ORDER_NBR
                                           AND E.RUN_ID = UNPAIDP.RUN_ID
                                           AND UNPAIDP.BALANCE_TYPE_DESC = 'PRINCIPAL'
                     LEFT JOIN DW_CONTRACT_BALANCES AVAILBAL 
                                           ON U.CONTRACT_ID = AVAILBAL.CONTRACT_ID
                                                       AND U.DIM_DATE_KEY = AVAILBAL.DIM_DATE_KEY
                                                       AND U.RUN_ID = AVAILBAL.RUN_ID
                                                       AND AVAILBAL.BALANCE_TYPE_DESC = 'AVAILABLE'
                     LEFT JOIN DW_CONTRACT_BALANCES USED 
                                           ON U.CONTRACT_ID = USED.CONTRACT_ID
                                                       AND U.DIM_DATE_KEY = USED.DIM_DATE_KEY
                                                       AND U.RUN_ID = USED.RUN_ID
                                                       AND USED.BALANCE_TYPE_DESC = 'USED_BALANCE'
                    
              WHERE U.RUN_ID = @RunID
              AND  E.END_DT BETWEEN @BeginDT and @EndDT
              AND E.ELEMENT_CLASS_CODE = 'F'
	  AND E.ELEMENT_TYPE_CODE IN ('F', 'P')
	  
	  
      
              ),
	
       CTE2
              as     (
                           select *, ROW_NUMBER() over(partition by LoanID order by LoanMaturityDate desc) as 'Row_num' from CTE1 )

              select DISTINCT MemberID , 
                           UnderlyingFacilityID , 
                           UnderlyingFacilityMaturityDate , 
                           UnpaidPrincipalBalance ,
                           LoanID ,
                           LoanMaturityDate,
                           ORDER_NBR,
                           UnderlyingFacilityAvailableBalance ,
                           UnderlyingFacilityUsedBalance ,
                           LendingOrganizationID, 
                           LendingOrganization 
                           from CTE2 
                           where Row_num = 1
ORDER BY MemberID, LoanMaturityDate

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0320ForecastReport]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
PURPOSE:-This procedure is used to build the report RPT0320ForecastReport
CREATED BY:- RAVITEJA
CREATED DATE:-05/05/2016
Functions Used:- This procedure uses the function dbo.fn_MVParam to split the Report Parameters into comma seperated values
---------------------------------------------------------REVISION HISTORY-----------------------------
MODIFIED BY:
MODIFIED DATE:
BASE VERSION:
TAG USED:
*/
CREATE PROCEDURE [rpt].[RPT0320ForecastReport]
(@RunID_PAR NUMERIC(10,0),@LendingOrg_PAR Varchar(2000),@MemberID_PAR Varchar(Max),@FacilityID_PAR Varchar(MAX), @PaymentCycleBeginDT_PAR DATE, @PaymentCycleEndDT_PAR DATE, @NumberOfYears_PAR Int)
AS
BEGIN
	
	SET NOCOUNT ON;

-----------Declaring new set of varibles to pass report parameter values-----------------------
	DECLARE  @RunID NUMERIC(10,0), @PaymentCycleBeginDT DATE, @PaymentCycleEndDT DATE, @NumberOfYears Int,@LendingOrg Varchar(2000),@MemberID Varchar(Max),@FacilityID Varchar(MAX)

----------Passing current dates to @PaymentCycleBeginDT_PAR and @PaymentCycleEndDT_PAR if they are null----------------

	DECLARE @PaymentCycleBeginDT_Working date, @PaymentCycleEndDT_Working date

	IF (@PaymentCycleBeginDT_PAR Is Not Null and @PaymentCycleEndDT_PAR Is Not Null)
	Begin
	Select	@PaymentCycleBeginDT_Working = @PaymentCycleBeginDT_PAR, 
	@PaymentCycleEndDT_Working = @PaymentCycleEndDT_PAR 
	End
	Else
	Begin
	Select @PaymentCycleBeginDT_Working = Getdate(),
	   @PaymentCycleEndDT_Working =  DATEADD(YYYY,@NumberOfYears_PAR,GETDATE())
	End
----------Declaring Flag variables
	DECLARE @LendingOrg_Flag Int = 0,@MemberID_Flag Int = 0,@FacilityID_Flag Int = 0
	
----------Passing Report Parameter values to procedure Parameters------------------------------
	SELECT  @RunID = @RunID_PAR, 
	@PaymentCycleBeginDT = @PaymentCycleBeginDT_Working,
	@PaymentCycleEndDT = @PaymentCycleEndDT_Working, 
	@NumberOfYears = @NumberOfYears_PAR,
	@LendingOrg = @LendingOrg_PAR,
	@MemberID = @MemberID_PAR,
	@FacilityID = @FacilityID_PAR
/* Setting Flag to fetch for all Customers/Facility/Loans if They select Nulls in report*/
IF @LendingOrg_PAR IS NULL OR @LendingOrg_PAR LIKE '%NULL%'
	Begin
	set @LendingOrg_Flag = 1
	End
IF @MemberID_PAR IS NULL OR @MemberID_PAR LIKE '%Null%'
	Begin
	set @MemberID_Flag  = 1
	End
IF @FacilityID_PAR IS NULL OR @FacilityID_PAR LIKE '%Null%'
	BEGIN
	SET @FacilityID_Flag = 1
	END

----------------------------------Uncomment below commands for testing--------------------------------------------------
--SELECT  @RunID = 82, 
--	@PaymentCycleBeginDT = '2011-01-01',--@PaymentCycleBeginDT_PAR, 
--	@PaymentCycleEndDT = '2015-01-01',--@PaymentCycleEndDT_PAR, 
--	@NumberOfYears = Null,--@NumberOfYears_PAR,
--	@LendingOrg = 'RTFC',--@LendingOrg_PAR,
--	@MemberID = Null--@MemberID_PAR

--Print '@RunID' + Convert(varchar,@RunID) 
--Print '@PaymentCycleBeginDT' + Convert(Varchar,@PaymentCycleBeginDT)
--Print '@PaymentCycleEndDT' + Convert(Varchar,@PaymentCycleEndDT)
--Print '@NumberOfYears' + Convert(Varchar,@NumberOfYears)
--Print '@LendingOrg' + @LendingOrg
--Print '@MemberID' + @MemberID
------------------------------------------------------Comment above block once testing is done----------------------------
/* Creating table #MonthTable to display all the months in the final repoart. The data will be blank if we dont have value for particular month*/

Create table #MonthTable	
	(	MemberName	Varchar(200),
	MemberId	Varchar(15),
	UnderlyingFac	Varchar(15),
	LendingOrg	Varchar(200),
	YearName	Int,
	Month_Name	Char(4),
	Principal_Amt	Numeric(15,2),
	Interest_Amt	Numeric(15,2)
)
-- Loading all months to the temp table------------
Insert into #MonthTable (Month_Name) Values ('Jan'),('Feb'),('Mar'),('Apr'),('May'),('Jun'),('Jul'),('Aug'),('Sep'),('Oct'),('Nov'),('Dec')

--Using existing DW_DIM_DATE table, i am making cross join to year for specified time frame------------------
Insert into #MonthTable(MemberName,MemberId,UnderlyingFac,LendingOrg,YearName,Month_Name,Principal_Amt,Interest_Amt)  
	Select TRADE_NAME_DESC ,ACTOR_CODE_DESC,CONTRACT_NUMBER_DESC,SHORT_NAME_DESC,DIM_DATE.YEAR4,Month_Name,0.00,0.00 from #MonthTable
cross join 
(select distinct Year4 from [dbo].[DW_DIM_DATE] 
where (Year4 >= Datepart(YYYY,@PaymentCycleBeginDT) And Year4 <= Datepart(YYYY,@PaymentCycleEndDT)))DIM_DATE

Cross Join

(Select distinct DA_BORR.TRADE_NAME_DESC,DA_BORR.ACTOR_CODE_DESC,DC.CONTRACT_NUMBER_DESC, DA.SHORT_NAME_DESC From DW_CONTRACTS DC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID
	Left JOIN [dbo].[DW_ELEMENTS] DE 
	ON  DC.CONTRACT_ID = DE.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.RUN_ID = DE.RUN_ID
	Left JOIN DW_ELEMENT_SCHEDULE DESH
	ON  DE.CONTRACT_ID = DESH.CONTRACT_ID
	AND DE.ORDER_NBR = DESH.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DESH.DIM_DATE_KEY
	AND DE.RUN_ID = DESH.RUN_ID
WHERE DC.RUN_ID = @RunID
	AND	(DESH.PAYMENT_DUE_DT >=  @PaymentCycleBeginDT AND DESH.PAYMENT_DUE_DT <= @PaymentCycleEndDT)
	AND (@LendingOrg_Flag = 1 OR DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	AND (@MemberID_Flag = 1   OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@MemberID,',')))
	AND (@FacilityID_Flag = 1 OR Substring(DC.CONTRACT_NUMBER_DESC,6,4) IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	AND DESH.PAYMENT_TYPE_CODE <> 'INV' -- EXCLUDING INVESTMENTS
	--AND EXTERNAL_TERM_NBR IS NOT NULL -- EXCLUDING INVESTMENTS AND ESTIMATED PAYOFF DATE
	AND DE.ELEMENT_CLASS_CODE = 'F' AND DE.ELEMENT_TYPE_CODE = 'F' -- EXCLUDING FEE
	AND DC.PRODUCT_CODE = 'P1P'-- FOR LONG TERM LOANS
	AND DE.INTEREST_RATE_NATURE_CODE = 'TF' -- FOR ONLY FIXED LOANS
) Facility_Details
;


----------------------Using CTE1 to create the main extract by spinning through all the tables--------------------
With CTE1
 AS
  (
	SELECT DISTINCT
	DA_BORR.TRADE_NAME_DESC AS [Member Name],
	DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	DC.CONTRACT_NUMBER_DESC AS [Underlying Facility ID],
	DA.SHORT_NAME_DESC AS [Lending Organization],
	DATEPART(Year,DESH.PAYMENT_DUE_DT) AS [Year_Name],
	SUBSTRING(DATENAME(MONTH,DESH.PAYMENT_DUE_DT),1,3) AS [Month_Name],
	SUM(DESH.PRINCIPAL_AMT) AS [PRINCIPAL_AMOUNT],
	SUM(DESH.INTEREST_AMT) AS [INTEREST_AMOUNT]
	FROM DW_CONTRACTS DC
	INNER JOIN DW_ACTORS DA 
	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
                   AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
                   AND  DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID
	Left JOIN [dbo].[DW_ELEMENTS] DE 
	ON  DC.CONTRACT_ID = DE.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND DC.RUN_ID = DE.RUN_ID
	Left JOIN DW_ELEMENT_SCHEDULE DESH
	ON  DE.CONTRACT_ID = DESH.CONTRACT_ID
	AND DE.ORDER_NBR = DESH.ELEMENT_ORDER_NBR
	AND DE.DIM_DATE_KEY = DESH.DIM_DATE_KEY
	AND DE.RUN_ID = DESH.RUN_ID
	
	WHERE DC.RUN_ID = @RunID
	AND	(DESH.PAYMENT_DUE_DT >=  @PaymentCycleBeginDT AND DESH.PAYMENT_DUE_DT <= @PaymentCycleEndDT)
	AND (@LendingOrg_Flag = 1 OR DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,',')))
	AND (@MemberID_Flag = 1   OR DA_BORR.ACTOR_CODE_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@MemberID,',')))
	AND (@FacilityID_Flag = 1 OR Substring(DC.CONTRACT_NUMBER_DESC,6,4) IN (Select Param from [rpt_prm].[GetMVParam] (@FacilityID,',')))
	AND DESH.PAYMENT_TYPE_CODE = 'LOYER' -- EXCLUDING INVESTMENTS
	--AND EXTERNAL_TERM_NBR IS NOT NULL -- EXCLUDING INVESTMENTS AND ESTIMATED PAYOFF DATE
	AND DE.ELEMENT_CLASS_CODE = 'F' AND DE.ELEMENT_TYPE_CODE = 'F' -- EXCLUDING FEE
	AND DC.PRODUCT_CODE = 'P1P'-- FOR LONG TERM LOANS
	AND DE.INTEREST_RATE_NATURE_CODE = 'TF' -- FOR ONLY FIXED LOANS
	
	GROUP BY DA_BORR.TRADE_NAME_DESC ,	DA_BORR.ACTOR_CODE_DESC, DC.CONTRACT_NUMBER_DESC , DA.SHORT_NAME_DESC ,	DATEPART(Year,DESH.PAYMENT_DUE_DT), DATENAME(MONTH,DESH.PAYMENT_DUE_DT)
	
	Union
	 Select MemberName,	MemberId,UnderlyingFac,LendingOrg,YearName,ltrim(rtrim(Month_Name)),Principal_Amt,Interest_Amt from #MonthTable WHERE YearName is not null 
)
	SELECT [Member Name],[Member ID],[Underlying Facility ID],[Lending Organization],[Year_Name], Ltrim(Rtrim([Month_Name])) AS Month_Name,SUM(PRINCIPAL_AMOUNT) AS 'PRINCIPAL AMOUNT',SUM(INTEREST_AMOUNT) AS 'INTEREST AMOUNT' FROM CTE1 
	GROUP BY [Member Name],[Member ID],[Underlying Facility ID],[Lending Organization],[Year_Name], [Month_Name]
	
	Drop table #MonthTable;

END



--EXEC [rpt].[RPT0320ForecastReport] 460,'RTFC,cfc',Null,Null,Null,Null,30
--EXEC [rpt].[RPT0320ForecastReport] 162,Null,Null,5,'RTFC,cfc','AK001,AK002,AK003,AK005'




GO
/****** Object:  StoredProcedure [rpt].[RPT0350LongTermLoanAdvanceByMem]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/*
PURPOSE:-This procedure is used to build the report [rpt].[RPT0350LongTermLoanAdvanceByMem] that is Long Term Loan Advance Summary by Member ID	
CREATED BY:- RAVITEJA
CREATED DATE:-6/09/2016
Functions Used:- This procedure uses the function dbo.fn_MVParam to split the Report Parameters into comma seperated values
---------------------------------------------------------REVISION HISTORY-----------------------------
MODIFIED BY:
MODIFIED DATE:
BASE VERSION:
TAG USED:
*/
CREATE PROCEDURE [rpt].[RPT0350LongTermLoanAdvanceByMem]
(@RunID_PAR NUMERIC(10,0),@LendingOrg_PAR Varchar(Max), @ToDateAmounts_PAR CHAR(3),@AccountingDateBegin_PAR Date,@AccountingDateEnd_PAR Date,@ProductType_PAR Varchar(max))
AS
BEGIN
	
	SET NOCOUNT ON;

-----------Declaring new set of varibles to pass report parameter values-----------------------
	DECLARE  @RunID NUMERIC(10,0), @LendingOrg Varchar(Max),@ToDateAmounts CHAR(3),@AccountingDateBegin Date,@AccountingDateEnd Date,@ProductType Varchar(max)

----------Passing Report Parameter values to procedure Parameters------------------------------
	SELECT  @RunID = @RunID_PAR, 
	@LendingOrg= @LendingOrg_PAR,
	@ToDateAmounts = @ToDateAmounts_PAR,
	@AccountingDateBegin = @AccountingDateBegin_PAR, 
	@AccountingDateEnd = @AccountingDateEnd_PAR,
	@ProductType = @ProductType_PAR

-----------------Main Query to fetch the data from the underlying tables
SELECT DISTINCT

	DA.SHORT_NAME_DESC AS [Lending Organization],
	DA_BORR.TRADE_NAME_DESC AS [Member Name],
	DA_BORR.ACTOR_CODE_DESC AS [Member ID],
	DC.CONTRACT_NUMBER_DESC AS [Facility ID],
	DE.Loan_NBR AS [Loan ID],
	DC.PRODUCT_DESC AS [Product Type],
	DE.INTEREST_RATE_NATURE_DESC AS [Interest Rate Type],
	CASE  
          WHEN DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL THEN 'Performing' ELSE 'Non Performing' End AS [Performance Ind],
	DEV.EFFECTIVE_DT AS [Loan Advance Effective Date],
	--DGR.ACCOUNTING_DT AS [Accounting Date],
	DT.VALUE_DT AS [Accounting Date],
	DT.PAYMENT_METHOD_DESC AS [Disbursement Method],
	SUM(PRE_TAX_AMT) AS [Loan Advance Amount],
	DEB.VALUE_DATE_AMT AS [Unpaid Principal Balance]
	
	FROM  [dbo].[DW_EVENTS] DEV
	--SELECT * FROM [dbo].[DW_EVENTS] DEV
	INNER JOIN (SELECT RUN_ID, DIM_DATE_KEY,CONTRACT_ID,
	CONTRACT_NUMBER_DESC,PRODUCT_DESC,BAD_DEBT_IND,	/* JOINED DW_CONTRACTS TO GET THE LONG TERM CONTRACTS LOANS*/
	COMPANY_ACTOR_ID,PRODUCT_CODE FROM [dbo].[DW_CONTRACTS] 
	WHERE PRODUCT_CODE IN (Select Param from [rpt_prm].[GetMVParam] (@ProductType,','))
	  AND PRODUCT_CODE NOT LIKE 'AUT%') DC
	ON  DEV.RUN_ID = DC.RUN_ID
	AND DEV.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DEV.CONTRACT_ID = DC.CONTRACT_ID	/* GETTING Disburse loan payment EVENTS*/
	AND DEV.FUNCTION_CODE = 'EVD_DEBLOCFOND'
	INNER JOIN [dbo].[DW_PAYABLES] DP
	ON  DEV.EVENT_ID = DP.EVENT_ID
	AND	DEV.RUN_ID = DP.RUN_ID
	AND DEV.DIM_DATE_KEY = DP.DIM_DATE_KEY
	INNER JOIN DW_TRANSACTION_LINE_ITEMS TLI
	ON DP.PAYABLE_ID = TLI.PAYABLE_ID
	   AND DP.RUN_ID = TLI.RUN_ID
	   AND DP.DIM_DATE_KEY = TLI.DIM_DATE_KEY
	INNER JOIN [dbo].[DW_TRANSACTIONS] DT
	ON TLI.TRANSACTION_ID = DT.TRANSACTION_ID
	   AND TLI.DIM_DATE_KEY = DT.DIM_DATE_KEY
	   AND  TLI.RUN_ID = DT.RUN_ID
	--INNER JOIN [dbo].[DW_GL_REGISTER] DGR
	--	ON	DEV.EVENT_ID = DGR.EVENT_ID	/* JOINED GL REGISTER TO GET ACCOUNTING DATE*/
	--	AND DEV.DIM_DATE_KEY = DGR.DIM_DATE_KEY
	--	AND DEV.RUN_ID = DGR.RUN_ID
	--AND DEV.PAYABLE_ID = DGR.PAYABLE_ID
	INNER JOIN [dbo].[DW_LK_ELEMENT_EVENT] LKElement_Event
	ON  DEV.EVENT_ID = LKElement_Event.EVENT_ID
	AND DEV.DIM_DATE_KEY = LKElement_Event.DIM_DATE_KEY
	AND DEV.RUN_ID = LKElement_Event.RUN_ID
	INNER JOIN [dbo].[DW_ELEMENTS] DE 
	ON  LKElement_Event.RUN_ID = DE.RUN_ID
	AND LKElement_Event.CONTRACT_ID = DE.CONTRACT_ID
	AND LKElement_Event.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND LKElement_Event.ELEMENT_ORDER_NBR = DE.ORDER_NBR 
	INNER JOIN [dbo].[DW_ELEMENT_BALANCES] DEB 
	ON  DE.RUN_ID = DEB.RUN_ID
	AND DE.CONTRACT_ID = DEB.CONTRACT_ID
	AND DE.DIM_DATE_KEY = DEB.DIM_DATE_KEY	/*TO GET THE UNPAID PRINCIPAL BALANCE*/
	AND DE.ORDER_NBR = DEB.ELEMENT_ORDER_NBR
	AND DEB.BALANCE_TYPE_DESC = 'PRINCIPAL'
	INNER JOIN DW_ACTORS DA 
	ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
	AND DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
	AND DC.RUN_ID = DA.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID

	WHERE DE.RUN_ID = @RunID
	AND	DA.SHORT_NAME_DESC IN (Select Param from [rpt_prm].[GetMVParam] (@LendingOrg,','))
	AND DE.ELEMENT_CLASS_CODE = 'F' AND DE.ELEMENT_TYPE_CODE IN ('F') -- EXCLUDING FEE
	AND (DT.VALUE_DT>= @AccountingDateBegin And DT.VALUE_DT <= @AccountingDateEnd)
	AND DE.Loan_NBR IS NOT NULL
	
	GROUP BY DA.SHORT_NAME_DESC,DA_BORR.TRADE_NAME_DESC ,DA_BORR.ACTOR_CODE_DESC ,DC.CONTRACT_NUMBER_DESC,DE.Loan_NBR ,DC.PRODUCT_DESC ,
	 DE.INTEREST_RATE_NATURE_DESC ,DC.BAD_DEBT_IND,EFFECTIVE_DT,DT.VALUE_DT,DT.PAYMENT_METHOD_DESC,DEB.VALUE_DATE_AMT
	ORDER BY [Lending Organization],[Member ID],[Facility ID],[Loan ID]	

End

--exec [rpt].[RPT0350LongTermLoanAdvanceByMem] 623,'RTFC,CFC','ytd','2013-01-01','2017-01-01'
GO
/****** Object:  StoredProcedure [rpt].[RPT0360FeeWaivers]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0360FeeWaivers]
	(@RunID_PAR NUMERIC(10,0))
	--, @StartDate_PAR DATE, @EndDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	      , @ReportDate DATE
	  , @StartDate DATE
	  , @EndDate DATE

	SELECT @RunID = @RunID_PAR
	--, @StartDate = @StartDate_PAR
	--, @EndDate = @EndDate_PAR

SELECT  
DISTINCT
           Member_ID = A.ACTOR_CODE_DESC
         , MemberName = A.SHORT_NAME_DESC
	 , UnderlyingFacilityID = ISNULL(U.CONTRACT_NUMBER_DESC, '-')
	 , LoanID = ISNULL(E.LOAN_NBR, '-')
	-- , PA.PROCESS_ALLOCATION_CODE
         , FeeType = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  LIKE 'FEE%') THEN ISNULL(PA.PROCESS_ALLOCATION_DESC, '-') ELSE PA.PROCESS_ALLOCATION_DESC END)
	 , Fee_Assessed_Date=R.PROCESSING_DT
	 , FeeAmount = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  LIKE 'FEE%') THEN ISNULL(RLI.PRE_TAX_AMT, 0) ELSE 0 END)
	 , FeeWaivedAmount = TR.TAX_EXCLUDED_AMT-ISNULL(TR.PRINCIPAL_AMT,0)
	 , FeeDueAmount = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  LIKE 'FEE%') THEN ISNULL(RLI.PRE_TAX_AMT, 0) ELSE 0 END)-( TR.TAX_EXCLUDED_AMT-ISNULL(TR.PRINCIPAL_AMT,0))
	 , RequestedBy = EV.CREATED_BY_DESC
	 , ApprovedBy = EV.VALIDATED_BY_DESC
	 , Fee_waived_reason = (CASE WHEN (EV.FUNCTION_CODE = 'EVREG_VAL') THEN ISNULL(T.COMMENT_DESC, '-') ELSE '-' END)
	 , FeeApprovalDate= EV.VALIDATION_DT
	 , FeeWaivedDate = EV.EFFECTIVE_DT
	 , Associate_Vice_President=IU.USER_BY_DESC
	
FROM 
DW_ELEMENTS E
INNER	 JOIN DW_CONTRACTS U 
              ON U.CONTRACT_ID = E.CONTRACT_ID
                     AND U.DIM_DATE_KEY = E.DIM_DATE_KEY
                     AND U.RUN_ID = E.RUN_ID 

      LEFT JOIN DW_INVOLVED_USER IU
	          ON U.CONTRACT_ID=IU.CONTRACT_ID AND
	     U.RUN_ID= IU.RUN_ID AND 
	 U.DIM_DATE_KEY=IU.DIM_DATE_KEY AND
	 IU.BUSINESS_CODE='AVP'

      LEFT JOIN DW_RECEIVABLE_DETAILS RD        
                ON U.CONTRACT_ID=RD.CONTRACT_ID
              AND  U.DIM_DATE_KEY=RD.DIM_DATE_KEY
              AND  U.RUN_ID=RD.RUN_ID
	 
      LEFT JOIN DW_RECEIVABLE_LINE_ITEMS RLI
                ON RD.RECEIVABLE_ID=RLI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RLI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RLI.RUN_ID
	  AND  RD.ORDER_NBR = RLI.RECEIVABLE_LINE_ITEM_NBR

      LEFT JOIN DW_TRANSACTION_LINE_ITEMS TLI
	          ON TLI.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
	     TLI.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND 
	 TLI.RUN_ID = RLI.RUN_ID AND
	 TLI.TRANSACTION_LINE_ITEM_NBR= RLI.RECEIVABLE_LINE_ITEM_NBR
       
	   LEFT JOIN DW_TRANSACTIONS T
	        ON TLI.TRANSACTION_ID = T.TRANSACTION_ID AND
	   TLI.RUN_ID=T.RUN_ID AND
	   TLI.DIM_DATE_KEY=T.DIM_DATE_KEY AND
	   T.VALID_IND=1 AND
	   T.REJECTION_DT IS NULL

       LEFT JOIN DW_EVENTS EV
	        ON EV.EVENT_ID=T.EVENT_ID AND
	   EV.DIM_DATE_KEY=T.DIM_DATE_KEY AND
	   EV.RUN_ID=T.RUN_ID
	   
        LEFT JOIN DW_LK_TRANS_RECEIVABLES TR
      ON RLI.RECEIVABLE_ID = TR.RECEIVABLE_ID
      AND RLI.RECEIVABLE_LINE_ITEM_NBR = TR.RECEIVABLE_LINE_ITEM_NBR
      AND RLI.RUN_ID = TR.RUN_ID
      AND RLI.DIM_DATE_KEY = TR.DIM_DATE_KEY
	     
       LEFT JOIN DW_RECEIVABLE_PAYMENT_INFO RPI
	             ON  RD.RECEIVABLE_ID=RPI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RPI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RPI.RUN_ID

       LEFT JOIN DW_PROCESS_ALLOCATIONS PA
              ON PA.RUN_ID=RLI.RUN_ID 
            AND PA.DIM_DATE_KEY=RLI.DIM_DATE_KEY 
            AND PA.PROCESS_ALLOCATION_ID=RLI.PROCESS_ALLOCATION_ID

     LEFT JOIN DW_RECEIVABLES R
             ON R.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
                R.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND
                R.RUN_ID=RLI.RUN_ID

      LEFT JOIN DW_CONTRACT_ACTORS CA 
                 ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

      LEFT JOIN DW_ACTORS A
	              ON CA.ACTOR_ID = A.ACTOR_ID
	  AND  CA.DIM_DATE_KEY = A.DIM_DATE_KEY	   
	          AND  CA.RUN_ID = A.RUN_ID 

	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	    AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'

	LEFT JOIN DW_CONTRACT_BALANCES INTR 
	ON U.CONTRACT_ID = INTR.CONTRACT_ID
	AND U.DIM_DATE_KEY = INTR.DIM_DATE_KEY
	AND U.RUN_ID = INTR.RUN_ID
	AND INTR.BALANCE_TYPE_DESC = 'INTEREST'

	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 

	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND CP.STEP_DESC = 'Active'
	AND T.PAYMENT_TYPE_CODE <> 'O'
	AND RPI.PAYMENT_DT IS NULL
	AND PA.PROCESS_ALLOCATION_CODE  LIKE 'FEE%' OR PA.PROCESS_ALLOCATION_CODE='PANDL'
	--AND  EV.EFFECTIVE_DT BETWEEN @StartDate and @EndDate
	AND U.RUN_ID = @RunID
	   

END

GO
/****** Object:  StoredProcedure [rpt].[RPT0360FeeWaivers1]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


--EXEC [rpt].[RPT0360FeeWaivers] @RunID_PAR,@StartDate_PAR,@EndDate_PAR

--EXEC [rpt].[RPT0360FeeWaivers1]

CREATE PROCEDURE [rpt].[RPT0360FeeWaivers1]
	--(@RunID_PAR NUMERIC(10,0))
	--, @StartDate_PAR DATE, @EndDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	----DECLARE @RunID NUMERIC(10,0)
	----      , @ReportDate DATE
	----	  , @StartDate DATE
	----	  , @EndDate DATE

	----SELECT @RunID = @RunID_PAR
	--, @StartDate = @StartDate_PAR
	--, @EndDate = @EndDate_PAR

SELECT  
DISTINCT
           ProcessAllocationCode = PA.PROCESS_ALLOCATION_CODE
          , Member_ID = A.ACTOR_CODE_DESC
         , MemberName = A.SHORT_NAME_DESC
	 , UnderlyingFacilityID = ISNULL(U.CONTRACT_NUMBER_DESC, '-')
	 , LoanID = ISNULL(E.LOAN_NBR, '-')
	-- , PA.PROCESS_ALLOCATION_CODE
         , FeeType = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  LIKE 'FEE%') THEN ISNULL(PA.PROCESS_ALLOCATION_DESC, '-') ELSE PA.PROCESS_ALLOCATION_DESC END)
	 , Fee_Assessed_Date=R.PROCESSING_DT
	 , FeeAmount = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  LIKE 'FEE%') THEN ISNULL(RLI.PRE_TAX_AMT, 0) ELSE 0 END)
	 , FeeWaivedAmount = TR.TAX_EXCLUDED_AMT-ISNULL(TR.PRINCIPAL_AMT,0)
	 , FeeDueAmount = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  LIKE 'FEE%') THEN ISNULL(RLI.PRE_TAX_AMT, 0) ELSE 0 END)-( TR.TAX_EXCLUDED_AMT-ISNULL(TR.PRINCIPAL_AMT,0))
	 , RequestedBy = EV.CREATED_BY_DESC
	 , ApprovedBy = EV.VALIDATED_BY_DESC
	 ---, Fee_waived_reason = (CASE WHEN (EV.FUNCTION_CODE = 'EVREG_VAL') THEN ISNULL(T.COMMENT_DESC, '-') ELSE '-' END)
	 , FeeApprovalDate= EV.VALIDATION_DT
	 , FeeWaivedDate = EV.EFFECTIVE_DT
	 , Associate_Vice_President=IU.USER_BY_DESC
	
FROM 
DW_ELEMENTS E
INNER	 JOIN DW_CONTRACTS U 
              ON U.CONTRACT_ID = E.CONTRACT_ID
                     AND U.DIM_DATE_KEY = E.DIM_DATE_KEY
                     AND U.RUN_ID = E.RUN_ID 

      LEFT JOIN DW_INVOLVED_USER IU
	          ON U.CONTRACT_ID=IU.CONTRACT_ID AND
	     U.RUN_ID= IU.RUN_ID AND 
	 U.DIM_DATE_KEY=IU.DIM_DATE_KEY AND
	 IU.BUSINESS_CODE='AVP'

      LEFT JOIN DW_RECEIVABLE_DETAILS RD        
                ON U.CONTRACT_ID=RD.CONTRACT_ID
              AND  U.DIM_DATE_KEY=RD.DIM_DATE_KEY
              AND  U.RUN_ID=RD.RUN_ID
	 
      LEFT JOIN DW_RECEIVABLE_LINE_ITEMS RLI
                ON RD.RECEIVABLE_ID=RLI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RLI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RLI.RUN_ID
	  AND  RD.ORDER_NBR = RLI.RECEIVABLE_LINE_ITEM_NBR

      LEFT JOIN DW_TRANSACTION_LINE_ITEMS TLI
	          ON TLI.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
	     TLI.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND 
	 TLI.RUN_ID = RLI.RUN_ID AND
	 TLI.TRANSACTION_LINE_ITEM_NBR= RLI.RECEIVABLE_LINE_ITEM_NBR
       
	   LEFT JOIN DW_TRANSACTIONS T
	        ON TLI.TRANSACTION_ID = T.TRANSACTION_ID AND
	   TLI.RUN_ID=T.RUN_ID AND
	   TLI.DIM_DATE_KEY=T.DIM_DATE_KEY AND
	   T.VALID_IND=1 AND
	   T.REJECTION_DT IS NULL

       LEFT JOIN DW_EVENTS EV
	        ON EV.EVENT_ID=T.EVENT_ID AND
	   EV.DIM_DATE_KEY=T.DIM_DATE_KEY AND
	   EV.RUN_ID=T.RUN_ID
	   
        LEFT JOIN DW_LK_TRANS_RECEIVABLES TR
      ON RLI.RECEIVABLE_ID = TR.RECEIVABLE_ID
      AND RLI.RECEIVABLE_LINE_ITEM_NBR = TR.RECEIVABLE_LINE_ITEM_NBR
      AND RLI.RUN_ID = TR.RUN_ID
      AND RLI.DIM_DATE_KEY = TR.DIM_DATE_KEY
	     
       LEFT JOIN DW_RECEIVABLE_PAYMENT_INFO RPI
	             ON  RD.RECEIVABLE_ID=RPI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RPI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RPI.RUN_ID

       LEFT JOIN DW_PROCESS_ALLOCATIONS PA
              ON PA.RUN_ID=RLI.RUN_ID 
            AND PA.DIM_DATE_KEY=RLI.DIM_DATE_KEY 
            AND PA.PROCESS_ALLOCATION_ID=RLI.PROCESS_ALLOCATION_ID

     LEFT JOIN DW_RECEIVABLES R
             ON R.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
                R.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND
                R.RUN_ID=RLI.RUN_ID

      LEFT JOIN DW_CONTRACT_ACTORS CA 
                 ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

      LEFT JOIN DW_ACTORS A
	              ON CA.ACTOR_ID = A.ACTOR_ID
	  AND  CA.DIM_DATE_KEY = A.DIM_DATE_KEY	   
	          AND  CA.RUN_ID = A.RUN_ID 

	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	    AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'

	LEFT JOIN DW_CONTRACT_BALANCES INTR 
	ON U.CONTRACT_ID = INTR.CONTRACT_ID
	AND U.DIM_DATE_KEY = INTR.DIM_DATE_KEY
	AND U.RUN_ID = INTR.RUN_ID
	AND INTR.BALANCE_TYPE_DESC = 'INTEREST'

	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 

	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND CP.STEP_DESC = 'Active'
	AND T.PAYMENT_TYPE_CODE <> 'O'
	AND RPI.PAYMENT_DT IS NULL
	--AND PA.PROCESS_ALLOCATION_CODE  LIKE 'FEE%' OR PA.PROCESS_ALLOCATION_CODE='PANDL'
	--AND  EV.EFFECTIVE_DT BETWEEN @StartDate and @EndDate
	--AND U.RUN_ID = @RunID
	AND PA.PROCESS_ALLOCATION_CODE IS NOT NULL
	   

END

GO
/****** Object:  StoredProcedure [rpt].[RPT0370PrepaymentAmountsDue]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


-------------------------------------------------------------
--EXEC [rpt].[RPT0370PrepaymentAmountsDue] 623
-------------------------------------------------------------

--SELECT TOP 10 * FROM DW_ACTORS


CREATE PROCEDURE [rpt].[RPT0370PrepaymentAmountsDue]
(@RunID_PAR NUMERIC(10,0))

AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE   @RunID NUMERIC(10,0),
	          @ReportDate DATE

       SELECT @RunID = @RunID_PAR
	 
	 SELECT  DISTINCT 
         --  LendingOrganization = A.SHORT_NAME_DESC
	      -- Member_ID = CA.ACTOR_ID
	    MemberName =  A.SHORT_NAME_DESC
         ,  MemberID= A.ACTOR_CODE_DESC
	 ,  LoanID=E.LOAN_NBR
         , UnderlyingFacilityID = ISNULL(U.CONTRACT_NUMBER_DESC, '-')
	 , UnpaidPrincipalBalance = ISNULL(UNPAID.VALUE_DATE_AMT,0)
	 , PrePaymentDate = R.INVOICE_DT
	 , UnpaidInterestBalance  =  ISNULL(INTR.VALUE_DATE_AMT,0)
        -- , PrePaymentPrincipalAmt=ISNULL(TR.PRINCIPAL_AMT, 0)
	 , PrePaymentPrincipalAmt = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')) THEN ISNULL(RLI.PRINCIPAL_AMT, 0) ELSE 0 END)
	 , RLI.PRINCIPAL_AMT
	 , PA.PROCESS_ALLOCATION_CODE
         , PrePaymentFeeAmt = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('FEEPREP', 'FEEPREA')) THEN ISNULL(RLI.PRE_TAX_AMT, 0) ELSE 0 END)
	 , RLI.PRE_TAX_AMT
	 , PA.PROCESS_ALLOCATION_CODE
	 , RemainingUnpaidPrincipalBalance = ISNULL(UNPAID.VALUE_DATE_AMT,0)-(CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')) THEN ISNULL(RLI.PRINCIPAL_AMT, 0) ELSE 0 END)
	 --, ProcessAllocationCode =  PA.PROCESS_ALLOCATION_CODE  
	
FROM DW_ELEMENTS E 

INNER JOIN DW_CONTRACTS U
       ON E.CONTRACT_ID = U.CONTRACT_ID
              AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND E.RUN_ID = U.RUN_ID

      LEFT JOIN DW_RECEIVABLE_DETAILS RD        
                ON U.CONTRACT_ID=RD.CONTRACT_ID
              AND  U.DIM_DATE_KEY=RD.DIM_DATE_KEY
              AND  U.RUN_ID=RD.RUN_ID

      LEFT JOIN DW_RECEIVABLE_LINE_ITEMS RLI
                ON RD.RECEIVABLE_ID=RLI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RLI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RLI.RUN_ID
	  --AND RLI.PROCESS_ALLOCATION_ID IN ('860','1114')
            --  AND  RD.ORDER_NBR=RLI.RECEIVABLE_DETAILS_ORDER_NBR
    
	  --LEFT JOIN DW_REC_LINE_ITEM_BALANCES RLIB 
   --            ON RLIB.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
   --             RLIB.RECEIVABLE_LINE_ITEM_NBR=RLI.RECEIVABLE_LINE_ITEM_NBR AND
   --             RLIB.RUN_ID=RLI.RUN_ID AND
   --             RLIB.DIM_DATE_KEY=RLI.DIM_DATE_KEY 

  ----------------------------------------------------------------------------------
  
      --LEFT JOIN DW_LK_TRANS_RECEIVABLES TR
      --ON RLI.RECEIVABLE_ID = TR.RECEIVABLE_ID
      -- AND RLI.RECEIVABLE_LINE_ITEM_NBR = TR.RECEIVABLE_LINE_ITEM_NBR
      -- AND RLI.RUN_ID = TR.RUN_ID
      -- AND RLI.DIM_DATE_KEY = TR.DIM_DATE_KEY
	     
  ---------------------------------------------------------------------------------- 
       LEFT JOIN DW_RECEIVABLE_PAYMENT_INFO RPI
	             ON  RD.RECEIVABLE_ID=RPI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RPI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RPI.RUN_ID

       LEFT JOIN DW_PROCESS_ALLOCATIONS PA
              ON PA.RUN_ID=RLI.RUN_ID 
            AND PA.DIM_DATE_KEY=RLI.DIM_DATE_KEY 
            AND PA.PROCESS_ALLOCATION_ID=RLI.PROCESS_ALLOCATION_ID

     LEFT JOIN DW_RECEIVABLES R
             ON R.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
                R.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND
                R.RUN_ID=RLI.RUN_ID

      LEFT JOIN DW_CONTRACT_ACTORS CA 
                 ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

      LEFT JOIN DW_ACTORS A
	              ON CA.ACTOR_ID = A.ACTOR_ID
	  AND  CA.DIM_DATE_KEY = A.DIM_DATE_KEY	   
	          AND  CA.RUN_ID = A.RUN_ID 

	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	--	AND UNPAID.BALANCE_TYPE_DESC = 'ACTUAL_OPB'
	    AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'

	LEFT JOIN DW_CONTRACT_BALANCES INTR 
	ON U.CONTRACT_ID = INTR.CONTRACT_ID
	AND U.DIM_DATE_KEY = INTR.DIM_DATE_KEY
	AND U.RUN_ID = INTR.RUN_ID
	AND INTR.BALANCE_TYPE_DESC = 'INTEREST'

	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 

	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND CP.STEP_DESC = 'Active'
	AND RPI.PAYMENT_DT IS NULL
	--AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )
	AND U.RUN_ID =@RunID
	AND PA.PROCESS_ALLOCATION_DESC LIKE '%Prepayment%'
        --AND  RLI.BALANCE_TYPE_DESC='UNPAID'
       --AND PA.PROCESS_ALLOCATION_DESC LIKE '%Prepayment%'









/*

SELECT 
         --  LendingOrganization = A.SHORT_NAME_DESC
	      -- Member_ID = CA.ACTOR_ID
	   Member_ID = A.ACTOR_CODE_DESC
	 , UnpaidPrincipalBalance = SUM(ISNULL(UNPAID.VALUE_DATE_AMT,0))
	 , PrePaymentDate = MAX(D.DATE_VALUE)
	 , UnpaidInterestBalance  =  SUM(ISNULL(INTR.VALUE_DATE_AMT,0))
         , PrePaymentPrincipalAmt = SUM((CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')) THEN ISNULL(RLIB.ENTRY_DATE_AMT, 0) ELSE 0 END))
         , PrePaymentFeeAmt = SUM((CASE WHEN (PA.PROCESS_ALLOCATION_CODE  LIKE ('FEE%') AND RLIB.ENTRY_DATE_AMT<>'0.00') THEN ISNULL(RLIB.ENTRY_DATE_AMT, 0) ELSE 0 END))
	 , RemainingUnpaidPrincipalBalance = SUM(ISNULL(UNPAID.VALUE_DATE_AMT,0))-SUM((CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')) THEN ISNULL(RLIB.ENTRY_DATE_AMT, 0) ELSE 0 END))
	 --, ProcessAllocationCode =  PA.PROCESS_ALLOCATION_CODE  
	
FROM DW_CONTRACTS U
      LEFT JOIN DW_RECEIVABLE_DETAILS RD        
                ON U.CONTRACT_ID=RD.CONTRACT_ID
              AND  U.DIM_DATE_KEY=RD.DIM_DATE_KEY
              AND  U.RUN_ID=RD.RUN_ID
      LEFT JOIN DW_RECEIVABLE_LINE_ITEMS RLI
                ON RD.RECEIVABLE_ID=RLI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RLI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RLI.RUN_ID
            --  AND  RD.ORDER_NBR=RLI.RECEIVABLE_DETAILS_ORDER_NBR   
	  LEFT JOIN DW_REC_LINE_ITEM_BALANCES RLIB 
               ON RLIB.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
                RLIB.RECEIVABLE_LINE_ITEM_NBR=RLI.RECEIVABLE_LINE_ITEM_NBR AND
                RLIB.RUN_ID=RLI.RUN_ID AND
                RLIB.DIM_DATE_KEY=RLI.DIM_DATE_KEY 
      LEFT JOIN DW_DIM_DATE D 
	            ON RLIB.EFFECTIVE_DATE_KEY=D.DIM_DATE_KEY
     LEFT JOIN DW_PROCESS_ALLOCATIONS PA
              ON PA.RUN_ID=RLIB.RUN_ID 
            AND PA.DIM_DATE_KEY=RLIB.DIM_DATE_KEY 
            AND PA.PROCESS_ALLOCATION_ID=RLI.PROCESS_ALLOCATION_ID
     LEFT JOIN DW_RECEIVABLES R
             ON R.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
                R.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND
                R.RUN_ID=RLI.RUN_ID
      LEFT JOIN DW_CONTRACT_ACTORS CA 
                 ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
      LEFT JOIN DW_ACTORS A
	              ON CA.ACTOR_ID = A.ACTOR_ID
	  AND  CA.DIM_DATE_KEY = A.DIM_DATE_KEY	   
	          AND  CA.RUN_ID = A.RUN_ID 
	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	--	AND UNPAID.BALANCE_TYPE_DESC = 'ACTUAL_OPB'
	    AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'
	LEFT JOIN DW_CONTRACT_BALANCES INTR 
	ON U.CONTRACT_ID = INTR.CONTRACT_ID
	AND U.DIM_DATE_KEY = INTR.DIM_DATE_KEY
	AND U.RUN_ID = INTR.RUN_ID
	AND INTR.BALANCE_TYPE_DESC = 'INTEREST'
	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	--AND CP.STEP_DESC = 'Active'
	AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )
	AND U.RUN_ID = @RunID
        AND  RLIB.BALANCE_TYPE_DESC='UNPAID'
       --AND PA.PROCESS_ALLOCATION_DESC LIKE '%Prepayment%'
              -- AND PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')
GROUP BY 
A.ACTOR_CODE_DESC
--A.SHORT_NAME_DESC,
--CA.ACTOR_ID
--AND PA.PROCESS_ALLOCATION_CODE  LIKE ('FEE%')
--AND RLIB.ENTRY_DATE_AMT<>'0.00';
*/

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0370PrepaymentAmountsDue1]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



-------------------------------------------------------------
--EXEC [rpt].[RPT0370PrepaymentAmountsDue] 623
-------------------------------------------------------------

--SELECT TOP 10 * FROM DW_ACTORS


CREATE PROCEDURE [rpt].[RPT0370PrepaymentAmountsDue1]
(@RunID_PAR NUMERIC(10,0))

AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE   @RunID NUMERIC(10,0),
	          @ReportDate DATE

       SELECT @RunID = @RunID_PAR
	 
	 SELECT  DISTINCT 
         --  LendingOrganization = A.SHORT_NAME_DESC
	      -- Member_ID = CA.ACTOR_ID
	    MemberName =  A.SHORT_NAME_DESC
         ,  MemberID= A.ACTOR_CODE_DESC
	 ,  LoanID=E.LOAN_NBR
         , UnderlyingFacilityID = ISNULL(U.CONTRACT_NUMBER_DESC, '-')
	 , UnpaidPrincipalBalance = ISNULL(UNPAID.VALUE_DATE_AMT,0)
	 , PrePaymentDate = R.INVOICE_DT
	 , UnpaidInterestBalance  =  ISNULL(INTR.VALUE_DATE_AMT,0)
        -- , PrePaymentPrincipalAmt=ISNULL(TR.PRINCIPAL_AMT, 0)
	 , PrePaymentPrincipalAmt = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')) THEN ISNULL(RLI.PRINCIPAL_AMT, 0) ELSE 0 END)
	 , RLI.PRINCIPAL_AMT
	 , PA.PROCESS_ALLOCATION_CODE
         , PrePaymentFeeAmt = (CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('FEEPREP', 'FEEPREA')) THEN ISNULL(RLI.PRE_TAX_AMT, 0) ELSE 0 END)
	 , RLI.PRE_TAX_AMT
	 , PA.PROCESS_ALLOCATION_CODE
	 , RemainingUnpaidPrincipalBalance = ISNULL(UNPAID.VALUE_DATE_AMT,0)-(CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')) THEN ISNULL(RLI.PRINCIPAL_AMT, 0) ELSE 0 END)
	 --, ProcessAllocationCode =  PA.PROCESS_ALLOCATION_CODE  
	
FROM DW_ELEMENTS E 

INNER JOIN DW_CONTRACTS U
       ON E.CONTRACT_ID = U.CONTRACT_ID
              AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND E.RUN_ID = U.RUN_ID

      LEFT JOIN DW_RECEIVABLE_DETAILS RD        
                ON U.CONTRACT_ID=RD.CONTRACT_ID
              AND  U.DIM_DATE_KEY=RD.DIM_DATE_KEY
              AND  U.RUN_ID=RD.RUN_ID

      LEFT JOIN DW_RECEIVABLE_LINE_ITEMS RLI
                ON RD.RECEIVABLE_ID=RLI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RLI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RLI.RUN_ID
	  --AND RLI.PROCESS_ALLOCATION_ID IN ('860','1114')
            --  AND  RD.ORDER_NBR=RLI.RECEIVABLE_DETAILS_ORDER_NBR
    
	  --LEFT JOIN DW_REC_LINE_ITEM_BALANCES RLIB 
   --            ON RLIB.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
   --             RLIB.RECEIVABLE_LINE_ITEM_NBR=RLI.RECEIVABLE_LINE_ITEM_NBR AND
   --             RLIB.RUN_ID=RLI.RUN_ID AND
   --             RLIB.DIM_DATE_KEY=RLI.DIM_DATE_KEY 

  ----------------------------------------------------------------------------------
  
      --LEFT JOIN DW_LK_TRANS_RECEIVABLES TR
      --ON RLI.RECEIVABLE_ID = TR.RECEIVABLE_ID
      -- AND RLI.RECEIVABLE_LINE_ITEM_NBR = TR.RECEIVABLE_LINE_ITEM_NBR
      -- AND RLI.RUN_ID = TR.RUN_ID
      -- AND RLI.DIM_DATE_KEY = TR.DIM_DATE_KEY
	     
  ---------------------------------------------------------------------------------- 
       LEFT JOIN DW_RECEIVABLE_PAYMENT_INFO RPI
	             ON  RD.RECEIVABLE_ID=RPI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RPI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RPI.RUN_ID

       LEFT JOIN DW_PROCESS_ALLOCATIONS PA
              ON PA.RUN_ID=RLI.RUN_ID 
            AND PA.DIM_DATE_KEY=RLI.DIM_DATE_KEY 
            AND PA.PROCESS_ALLOCATION_ID=RLI.PROCESS_ALLOCATION_ID

     LEFT JOIN DW_RECEIVABLES R
             ON R.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
                R.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND
                R.RUN_ID=RLI.RUN_ID

      LEFT JOIN DW_CONTRACT_ACTORS CA 
                 ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

      LEFT JOIN DW_ACTORS A
	              ON CA.ACTOR_ID = A.ACTOR_ID
	  AND  CA.DIM_DATE_KEY = A.DIM_DATE_KEY	   
	          AND  CA.RUN_ID = A.RUN_ID 

	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	--	AND UNPAID.BALANCE_TYPE_DESC = 'ACTUAL_OPB'
	    AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'

	LEFT JOIN DW_CONTRACT_BALANCES INTR 
	ON U.CONTRACT_ID = INTR.CONTRACT_ID
	AND U.DIM_DATE_KEY = INTR.DIM_DATE_KEY
	AND U.RUN_ID = INTR.RUN_ID
	AND INTR.BALANCE_TYPE_DESC = 'INTEREST'

	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 

	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND CP.STEP_DESC = 'Active'
	AND RPI.PAYMENT_DT IS NULL
	--AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )
	AND U.RUN_ID =@RunID
	AND PA.PROCESS_ALLOCATION_DESC LIKE '%Prepayment%'
        --AND  RLI.BALANCE_TYPE_DESC='UNPAID'
       --AND PA.PROCESS_ALLOCATION_DESC LIKE '%Prepayment%'









/*

SELECT 
         --  LendingOrganization = A.SHORT_NAME_DESC
	      -- Member_ID = CA.ACTOR_ID
	   Member_ID = A.ACTOR_CODE_DESC
	 , UnpaidPrincipalBalance = SUM(ISNULL(UNPAID.VALUE_DATE_AMT,0))
	 , PrePaymentDate = MAX(D.DATE_VALUE)
	 , UnpaidInterestBalance  =  SUM(ISNULL(INTR.VALUE_DATE_AMT,0))
         , PrePaymentPrincipalAmt = SUM((CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')) THEN ISNULL(RLIB.ENTRY_DATE_AMT, 0) ELSE 0 END))
         , PrePaymentFeeAmt = SUM((CASE WHEN (PA.PROCESS_ALLOCATION_CODE  LIKE ('FEE%') AND RLIB.ENTRY_DATE_AMT<>'0.00') THEN ISNULL(RLIB.ENTRY_DATE_AMT, 0) ELSE 0 END))
	 , RemainingUnpaidPrincipalBalance = SUM(ISNULL(UNPAID.VALUE_DATE_AMT,0))-SUM((CASE WHEN (PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')) THEN ISNULL(RLIB.ENTRY_DATE_AMT, 0) ELSE 0 END))
	 --, ProcessAllocationCode =  PA.PROCESS_ALLOCATION_CODE  
	
FROM DW_CONTRACTS U
      LEFT JOIN DW_RECEIVABLE_DETAILS RD        
                ON U.CONTRACT_ID=RD.CONTRACT_ID
              AND  U.DIM_DATE_KEY=RD.DIM_DATE_KEY
              AND  U.RUN_ID=RD.RUN_ID
      LEFT JOIN DW_RECEIVABLE_LINE_ITEMS RLI
                ON RD.RECEIVABLE_ID=RLI.RECEIVABLE_ID
              AND  RD.DIM_DATE_KEY=RLI.DIM_DATE_KEY  
              AND  RD.RUN_ID=RLI.RUN_ID
            --  AND  RD.ORDER_NBR=RLI.RECEIVABLE_DETAILS_ORDER_NBR   
	  LEFT JOIN DW_REC_LINE_ITEM_BALANCES RLIB 
               ON RLIB.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
                RLIB.RECEIVABLE_LINE_ITEM_NBR=RLI.RECEIVABLE_LINE_ITEM_NBR AND
                RLIB.RUN_ID=RLI.RUN_ID AND
                RLIB.DIM_DATE_KEY=RLI.DIM_DATE_KEY 
      LEFT JOIN DW_DIM_DATE D 
	            ON RLIB.EFFECTIVE_DATE_KEY=D.DIM_DATE_KEY
     LEFT JOIN DW_PROCESS_ALLOCATIONS PA
              ON PA.RUN_ID=RLIB.RUN_ID 
            AND PA.DIM_DATE_KEY=RLIB.DIM_DATE_KEY 
            AND PA.PROCESS_ALLOCATION_ID=RLI.PROCESS_ALLOCATION_ID
     LEFT JOIN DW_RECEIVABLES R
             ON R.RECEIVABLE_ID=RLI.RECEIVABLE_ID AND
                R.DIM_DATE_KEY=RLI.DIM_DATE_KEY AND
                R.RUN_ID=RLI.RUN_ID
      LEFT JOIN DW_CONTRACT_ACTORS CA 
                 ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
      LEFT JOIN DW_ACTORS A
	              ON CA.ACTOR_ID = A.ACTOR_ID
	  AND  CA.DIM_DATE_KEY = A.DIM_DATE_KEY	   
	          AND  CA.RUN_ID = A.RUN_ID 
	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	--	AND UNPAID.BALANCE_TYPE_DESC = 'ACTUAL_OPB'
	    AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'
	LEFT JOIN DW_CONTRACT_BALANCES INTR 
	ON U.CONTRACT_ID = INTR.CONTRACT_ID
	AND U.DIM_DATE_KEY = INTR.DIM_DATE_KEY
	AND U.RUN_ID = INTR.RUN_ID
	AND INTR.BALANCE_TYPE_DESC = 'INTEREST'
	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	--AND CP.STEP_DESC = 'Active'
	AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )
	AND U.RUN_ID = @RunID
        AND  RLIB.BALANCE_TYPE_DESC='UNPAID'
       --AND PA.PROCESS_ALLOCATION_DESC LIKE '%Prepayment%'
              -- AND PA.PROCESS_ALLOCATION_CODE  IN ('PRINCUR', 'DSPCUR')
GROUP BY 
A.ACTOR_CODE_DESC
--A.SHORT_NAME_DESC,
--CA.ACTOR_ID
--AND PA.PROCESS_ALLOCATION_CODE  LIKE ('FEE%')
--AND RLIB.ENTRY_DATE_AMT<>'0.00';
*/

END

GO
/****** Object:  StoredProcedure [rpt].[RPT0380SuspenseGLAccountActivity&Balance]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0380SuspenseGLAccountActivity&Balance]
(@RunID_PAR NUMERIC(10,0), @AccountingYearMonth_PAR Varchar(6))
AS
BEGIN
	
SET NOCOUNT ON;

DECLARE @RunID NUMERIC(10,0), @AccountingYearMonth VARCHAR(6)
SELECT  @RunID = @RunID_PAR , @AccountingYearMonth = @AccountingYearMonth_PAR

--EXEC [RPT].[RPT0380SuspenseGLAccountActivity&Balance] 441, '201607'

Select Distinct 
AccountingDate = GLE.ACCOUNTING_DT,
MemberID = A.ACTOR_CODE_DESC,
UnderlyingFacilityID = RIGHT(U.CONTRACT_NUMBER_DESC, 4),
LoanID = E.LOAN_NBR,
LoansGL.ProductType,
AccountNumber = COA.GL_ACCOUNT_NUMBER_DESC,
--FormattedYearValue = CAST(YEAR(GLE.ACCOUNTING_DT) AS char(4) ) ,
--FormattedMonthValue = CAST (DATEPART(MM,GLE.ACCOUNTING_DT) AS char(2))
--FormattedMonthValue = SUBSTRING(CONVERT(varchar(6),GLE.ACCOUNTING_DT, 112),5,2),

--CASE WHEN LEN(MONTH(GLE.ACCOUNTING_DT)) = 1 THEN CAST(YEAR(GLE.ACCOUNTING_DT) AS char(4) )+'0'+CAST (DATEPART(MONTH,GLE.ACCOUNTING_DT) AS char(2)) ELSE CAST (DATEPART(MONTH,GLE.ACCOUNTING_DT) AS char(2)) END,
CASE WHEN GLE.DEBIT_CREDIT_DESC = 'C' THEN SUM(GLE.ACCOUNTING_CURRENCY_AMT) ELSE 0 END as [Suspense Credit Amount],
CASE WHEN GLE.DEBIT_CREDIT_DESC = 'D' THEN SUM(GLE.ACCOUNTING_CURRENCY_AMT) ELSE 0 END as [Suspense Debit Amount],
SUM(EB.VALUE_DATE_AMT) AS  [Suspense Balance],
LendingOrganizationID = PA.ACTOR_ID,
LendingOrganization = PA.SHORT_NAME_DESC
	  
FROM DW_ELEMENTS E
INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] EB
	ON  E.CONTRACT_ID = EB.CONTRACT_ID
	AND E.RUN_ID = EB.RUN_ID
	AND E.DIM_DATE_KEY = EB.DIM_DATE_KEY
	AND E.ORDER_NBR = EB.ELEMENT_ORDER_NBR
	AND EB.BALANCE_TYPE_DESC = 'PRINCIPAL'
INNER JOIN [dbo].[DW_CONTRACTS] U
	ON  E.RUN_ID = U.RUN_ID
	AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
	AND E.CONTRACT_ID = U.CONTRACT_ID

INNER JOIN (select U.RUN_ID,U.DIM_DATE_KEY,U.CONTRACT_ID, E.LOAN_NBR, E.ORDER_NBR, 
	           ProductType=U.PRODUCT_DESC,
	   InterestRateType=E.INTEREST_RATE_NATURE_DESC,
	Case when E.INTEREST_RATE_NATURE_CODE = 'TF' AND U.PRODUCT_CODE = 'P1P' AND (U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LT Loan)'
	 when E.INTEREST_RATE_NATURE_CODE = 'TF' AND U.PRODUCT_CODE = 'P1P' AND (U.BAD_DEBT_IND <> '0' AND U.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LT NonPerform'
	 WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' AND U.PRODUCT_CODE = 'LCS' AND (U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LOC Loan)'
	 WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' AND U.PRODUCT_CODE = 'LCS' AND (U.BAD_DEBT_IND <> '0' AND U.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LOC NonPerform'
	-------------------
	 when E.INTEREST_RATE_NATURE_CODE = 'VR' AND U.PRODUCT_CODE = 'P1P' AND (U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LT Loan)'
	 when E.INTEREST_RATE_NATURE_CODE = 'VR' AND U.PRODUCT_CODE = 'P1P' AND (U.BAD_DEBT_IND <> '0' AND U.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate  LT NonPerform'
	 WHEN E.INTEREST_RATE_NATURE_CODE = 'VR' AND U.PRODUCT_CODE = 'LCS' AND (U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LOC Loan)'
	 WHEN E.INTEREST_RATE_NATURE_CODE = 'VR' AND U.PRODUCT_CODE = 'LCS' AND (U.BAD_DEBT_IND <> '0' AND U.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate LOC NonPerform'
	 END AS 'GL_Name' 
	FROM [dbo].[DW_CONTRACTS] U
	INNER JOIN [dbo].[DW_ELEMENTS] E
	ON  U.RUN_ID = E.RUN_ID
	AND U.DIM_DATE_KEY = E.DIM_DATE_KEY
	AND U.CONTRACT_ID = E.CONTRACT_ID
	INNER JOIN [DBO].[DW_PROCESS_ALLOCATIONS] PA
	ON  E.RUN_ID = PA.RUN_ID
	AND E.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND E.PROCESS_ALLOCATION_ID = PA.PROCESS_ALLOCATION_ID
	WHERE U.RUN_ID = @RunID 
	 ) LoansGL
	ON E.RUN_ID = LoansGL.RUN_ID
	AND E.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY
	AND E.CONTRACT_ID = LoansGL.CONTRACT_ID
	AND E.LOAN_NBR = LoansGL.LOAN_NBR

INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] COA
	ON  LoansGL.RUN_ID = COA.RUN_ID
	AND LoansGL.DIM_DATE_KEY = COA.DIM_DATE_KEY
	AND LoansGL.GL_Name = COA.GL_ACCOUNT_DESC

INNER JOIN DW_GL_ENTRIES GLE
	           ON GLE.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY AND
	      GLE.RUN_ID = LoansGL.RUN_ID AND 
	  GLE.CONTRACT_ID = LoansGL.CONTRACT_ID AND
	  GLE.LOAN_NBR=LoansGL.LOAN_NBR AND
	  GLE.ELEMENT_ORDER_NBR=LoansGL.ORDER_NBR  
	
	
INNER JOIN DW_CONTRACT_ACTORS CA 
       ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

INNER JOIN DW_ACTORS PA
	ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
	AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND U.RUN_ID = PA.RUN_ID

INNER JOIN DW_ACTORS A 
       ON CA.ACTOR_ID = A.ACTOR_ID
              AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
              AND CA.RUN_ID = A.RUN_ID

WHERE GLE.RUN_ID = @RunID
AND CAST(YEAR(GLE.ACCOUNTING_DT) AS VARCHAR(4) ) +  SUBSTRING(CONVERT(varchar(6),GLE.ACCOUNTING_DT, 112),5,2) = @AccountingYearMonth
AND COA.GL_ACCOUNT_NUMBER_DESC LIKE '%297185%'
	--AND GLE.ACCOUNTING_DT <= @AccountingYearMonth

	  ----WHERE MONTH(GLE.ACCOUNTING_DT) = @month
	  ----      AND YEAR(GLE.ACCOUNTING_DT) = @year
	
	
GROUP BY 
GLE.ACCOUNTING_DT,
A.ACTOR_CODE_DESC,
E.LOAN_NBR,
U.CONTRACT_NUMBER_DESC,
LoansGL.ProductType,
GL_ACCOUNT_NUMBER_DESC,
GLE.DEBIT_CREDIT_DESC,
PA.ACTOR_ID,
PA.SHORT_NAME_DESC

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0380SuspenseGLAccountActivityAndBalance]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


--EXEC  [rpt].[RPT0540GeneralLedgerTransactions] 1,'2016-04-01','2016-04-30'

CREATE  PROC [rpt].[RPT0380SuspenseGLAccountActivityAndBalance]
(@RunID_PAR NUMERIC(10,0),@AccountingDateBegin_PAR DATE,@AccountingDateEnd_PAR DATE)
AS

BEGIN
	SET NOCOUNT ON;

DECLARE @AccountingDateBegin DATE, @AccountingDateEnd DATE, @RunID NUMERIC(10,0)

SELECT @AccountingDateBegin=@AccountingDateBegin_PAR, @AccountingDateEnd=@AccountingDateEnd_PAR, @RunID=@RunID_PAR

SELECT 

DISTINCT 
	
	
	DC.PRODUCT_DESC AS [Product Type],
	DE.INTEREST_RATE_NATURE_DESC AS [Interest Rate Type],
	CASE WHEN DC.BAD_DEBT_IND = '0' or DC.BAD_DEBT_IND IS NULL THEN 'Performing' ELSE 'Non Performing' End AS [Performance Ind],
	DE.Loan_NBR AS [Loan ID],
	GLE1.ACCOUNTING_DT AS [Accounting Date],
	GLE.GL_ACCOUNT_NBR_DESC AS [GL Account],
	COA.GL_ACCOUNT_DESC AS [GL Account Description],
	GLE.ELEMENT_DESC AS [Transaction Name],
	DCB_PRINCIPAL.VALUE_DATE_AMT AS [Unpaid Principal Balance],
	CASE WHEN GLE.DEBIT_CREDIT_DESC = 'D' THEN GLE.ACCOUNTING_CURRENCY_AMT ELSE 0 END AS [Debit Amount],
	CASE WHEN GLE.DEBIT_CREDIT_DESC = 'C' THEN GLE.ACCOUNTING_CURRENCY_AMT ELSE 0 END AS [Credit Amount],
	0 AS [Net Change]
	
	FROM  [dbo].[DW_TRANSACTIONS] DT
	  INNER JOIN DW_TRANSACTION_LINE_ITEMS TLI
	ON DT.TRANSACTION_ID = TLI.TRANSACTION_ID
	AND  DT.DIM_DATE_KEY = TLI.DIM_DATE_KEY
	AND  DT.RUN_ID = TLI.RUN_ID
	  INNER JOIN DW_PAYABLES DP
	ON TLI.PAYABLE_ID = DP.PAYABLE_ID
	and TLI.RUN_ID = DP.RUN_ID
	AND TLI.DIM_DATE_KEY = DP.DIM_DATE_KEY
	      INNER JOIN DW_PAYABLE_LINE_ITEMS PLI
	ON DP.PAYABLE_ID = PLI.PAYABLE_ID
	AND DP.RUN_ID = PLI.RUN_ID
	AND DP.DIM_DATE_KEY = PLI.DIM_DATE_KEY
	--AND PLI.PROCESS_ALLOCATION_ID = 859
          LEFT JOIN DW_GL_ENTRIES GLE1 
	             ON GLE1.VOUCHER_REFERENCE_DESC = DT.REFERENCE_DESC   
          
	  LEFT JOIN DW_RECEIVABLES DR
	             ON DR.RECEIVABLE_ID=TLI.RECEIVABLE_ID AND
	    DR.RUN_ID=TLI.RUN_ID AND
	DR.DIM_DATE_KEY=TLI.DIM_DATE_KEY
          
	  LEFT JOIN DW_RECEIVABLE_LINE_ITEMS RLI 
	             ON RLI.RECEIVABLE_ID=DR.RECEIVABLE_ID AND
	    RLI.RUN_ID=DR.RUN_ID AND
	RLI.DIM_DATE_KEY=DR.DIM_DATE_KEY AND
	RLI.RECEIVABLE_LINE_ITEM_NBR = TLI.TRANSACTION_LINE_ITEM_NBR


	 INNER JOIN ( SELECT RUN_ID,DIM_DATE_KEY,CONTRACT_ID ,EVENT_ID,MIN(ELEMENT_ORDER_NBR) AS ELEMENT_ORDER_NBR
	FROM DW_LK_ELEMENT_EVENT
	GROUP BY RUN_ID,DIM_DATE_KEY,CONTRACT_ID,EVENT_ID
	   ) LKElement_Event 


	ON  DP.EVENT_ID = LKElement_Event.EVENT_ID
	AND DP.DIM_DATE_KEY = LKElement_Event.DIM_DATE_KEY
	AND DP.RUN_ID = LKElement_Event.RUN_ID
	  INNER JOIN DW_ELEMENTS DE 
	ON  LKElement_Event.RUN_ID = DE.RUN_ID
	AND LKElement_Event.CONTRACT_ID = DE.CONTRACT_ID
	AND LKElement_Event.DIM_DATE_KEY = DE.DIM_DATE_KEY
	AND LKElement_Event.ELEMENT_ORDER_NBR = DE.ORDER_NBR 
	  INNER JOIN [dbo].[DW_CONTRACTS] DC 
	ON  DE.CONTRACT_ID = DC.CONTRACT_ID
	AND DE.DIM_DATE_KEY = DC.DIM_DATE_KEY
	AND DE.RUN_ID = DC.RUN_ID

          LEFT JOIN DW_GL_ENTRIES GLE
	           ON GLE.DIM_DATE_KEY = DC.DIM_DATE_KEY AND
	      GLE.RUN_ID = DC.RUN_ID AND 
	  GLE.CONTRACT_ID = DC.CONTRACT_ID
	 -- AND U.RUN_ID = 162
         LEFT JOIN DW_GL_REGISTER GLR
	                       ON GLR.GLREG_ID=GLE.GLREG_ID AND
	      GLR.RUN_ID=GLE.RUN_ID AND
	  GLR.DIM_DATE_KEY=GLE.DIM_DATE_KEY	  

         LEFT JOIN DW_CHART_OF_ACCOUNTS COA 
	           ON COA.GL_ACCOUNT_NUMBER_DESC= GLE.GL_ACCOUNT_NBR_DESC AND
	      COA.RUN_ID = GLE.RUN_ID AND
	  COA.DIM_DATE_KEY = GLE.DIM_DATE_KEY
	  --AND U.RUN_ID = 162
    	 LEFT JOIN [dbo].[DW_CONTRACT_BALANCES] DCB_USED

	ON  DC.CONTRACT_ID = DCB_USED.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCB_USED.DIM_DATE_KEY
	AND DC.RUN_ID = DCB_USED.RUN_ID
	AND DCB_USED.BALANCE_TYPE_DESC = 'USED_BALANCE'
	  LEFT JOIN [dbo].[DW_CONTRACT_BALANCES] DCB_PRINCIPAL
	ON  DC.CONTRACT_ID = DCB_PRINCIPAL.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCB_PRINCIPAL.DIM_DATE_KEY
	AND DC.RUN_ID = DCB_PRINCIPAL.RUN_ID
	AND DCB_PRINCIPAL.BALANCE_TYPE_DESC = 'PRINCIPAL'
	  INNER JOIN DW_ACTORS DA 
	ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
	AND DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
	AND DC.RUN_ID = DA.RUN_ID
	  INNER JOIN DW_CONTRACT_ACTORS DCA
	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	AND DC.RUN_ID = DCA.RUN_ID
	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	  INNER JOIN DW_ACTORS DA_BORR
	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	AND DCA.RUN_ID = DA_BORR.RUN_ID
	
	---------------------------------------------------------------------------------	 
	--FROM DW_CONTRACTS DC
	--	INNER JOIN [dbo].[DW_ELEMENTS] DE 
	--	ON  DC.CONTRACT_ID = DE.CONTRACT_ID
	--	AND DC.DIM_DATE_KEY = DE.DIM_DATE_KEY
	--	AND DC.RUN_ID = DE.RUN_ID
	--	LEFT JOIN [dbo].[DW_CONTRACT_BALANCES] DCB_USED
	--	ON  DC.CONTRACT_ID = DCB_USED.CONTRACT_ID
	--	AND DC.DIM_DATE_KEY = DCB_USED.DIM_DATE_KEY
	--	AND DC.RUN_ID = DCB_USED.RUN_ID
	--	AND DCB_USED.BALANCE_TYPE_DESC = 'USED_BALANCE'
	--	LEFT JOIN [dbo].[DW_CONTRACT_BALANCES] DCB_PRINCIPAL
	--	ON  DC.CONTRACT_ID = DCB_PRINCIPAL.CONTRACT_ID
	--	AND DC.DIM_DATE_KEY = DCB_PRINCIPAL.DIM_DATE_KEY
	--	AND DC.RUN_ID = DCB_PRINCIPAL.RUN_ID
	--	AND DCB_PRINCIPAL.BALANCE_TYPE_DESC = 'PRINCIPAL'
	--	INNER JOIN DW_ACTORS DA 
	--	    ON  DC.COMPANY_ACTOR_ID = DA.ACTOR_ID
  --                 AND  DC.DIM_DATE_KEY = DA.DIM_DATE_KEY
  --                 AND  DC.RUN_ID = DA.RUN_ID
	--	INNER JOIN DW_CONTRACT_ACTORS DCA
	--	ON  DC.CONTRACT_ID = DCA.CONTRACT_ID
	--	AND DC.DIM_DATE_KEY = DCA.DIM_DATE_KEY
	--	AND DC.RUN_ID = DCA.RUN_ID
	--	AND DCA.ACTOR_ROLE_CODE = 'EMPRUNT'
	--	INNER JOIN DW_ACTORS DA_BORR
	--	ON  DCA.ACTOR_ID = DA_BORR.ACTOR_ID
	--	AND DCA.DIM_DATE_KEY = DA_BORR.DIM_DATE_KEY
	--	AND DCA.RUN_ID = DA_BORR.RUN_ID
---------------------------------------------------------------------------------
	WHERE DE.Loan_NBR IS NOT NULL
	AND GLE1.ACCOUNTING_DT BETWEEN @AccountingDateBegin AND @AccountingDateEnd 
	AND DC.PRODUCT_CODE NOT LIKE 'AUT%' --- TO EXCLUDE MASTER FACILITY
	AND DE.ELEMENT_CLASS_CODE = 'F' 
	AND DE.ELEMENT_TYPE_CODE IN ('F','P') 
	AND DT.PAYMENT_TYPE_CODE = 'D'
	
END
GO
/****** Object:  StoredProcedure [rpt].[RPT0400LoanLossReport]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--EXEC [rpt].[RPT0400LoanLossReport] 505, '05/31/2015'

CREATE PROCEDURE [rpt].[RPT0400LoanLossReport]
(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)
AS
BEGIN
	
SET NOCOUNT ON;

DECLARE  @RunID NUMERIC(10,0), @ReportDate DATE

SELECT @RunID = @RunID_PAR, @ReportDate = @ReportDate_PAR

;with CTE1       
       AS
              (

SELECT DISTINCT MemberID = A.ACTOR_CODE_DESC,
       MemberName = A.TRADE_NAME_DESC, 
	   LoanID = E.LOAN_NBR,
	   LoanMaturityDate = E.END_DT, 
	   AmortizationMethod = E.FINANCIAL_PMT_SCHED_TYPE_DESC,
	   UnpaidPrincipalBalance = CONVERT(DECIMAL(19,2),UNPAIDP.VALUE_DATE_AMT),
	   ProductType = U.PRODUCT_DESC,
	   InterestRateType = E.INTEREST_RATE_NATURE_DESC, 
	   PerformanceIndicator= CASE  
	WHEN U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL
	THEN 'Performing' 
	ELSE 'Non Performing'
	END,
	   BusinessType = BT.STRING_VALUE_DESC,
	   AllInRate = CONVERT(DECIMAL(19,2),E.USED_FIXED_RATE_PCT),
	   BorrowerRiskRating = RR.RATING_CODE,
	   TruncatedBorrowerRiskRating = SUBSTRING(RR.RATING_CODE, 1, 1),
	   NumberOfDaysDifference = DATEDIFF(DAY, @ReportDate, E.END_DT),
	   DATEDIFF(DAY, @ReportDate, E.END_DT)*UNPAIDP.VALUE_DATE_AMT AS [NumberofDaysDifference*UnpaidPrincipalBalance],
	   CONVERT(DECIMAL(19,4),DATEDIFF(DAY, @ReportDate, E.END_DT)/365) AS [WeightedAverageMaturity],
	   WeightedAverageRate = CASE 
	WHEN SUM(UNPAIDP.VALUE_DATE_AMT) = '0' 
	THEN '0' 
	ELSE CONVERT(DECIMAL(19,4),UNPAIDP.VALUE_DATE_AMT*E.USED_FIXED_RATE_PCT/DENOM.AMT)
	END,
	   TransactionAccountingDate = @ReportDate,
	   LendingOrganizationID = PA.ACTOR_ID,
	   LendingOrganization = PA.SHORT_NAME_DESC,
	   ProductCode = U.PRODUCT_CODE


FROM DW_ELEMENTS E 


INNER JOIN DW_CONTRACTS U
       ON E.CONTRACT_ID = U.CONTRACT_ID
              AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND E.RUN_ID = U.RUN_ID

INNER JOIN DW_CONTRACT_ACTORS CA 
       ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

INNER JOIN DW_ACTORS PA
	ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
	AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
        AND U.RUN_ID = PA.RUN_ID

INNER JOIN DW_ACTORS A 
       ON CA.ACTOR_ID = A.ACTOR_ID
              AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
              AND CA.RUN_ID = A.RUN_ID

INNER JOIN DW_ACTOR_CHARACTERISTICS BT 
              ON A.ACTOR_ID = BT. ACTOR_ID
              AND A.DIM_DATE_KEY = BT.DIM_DATE_KEY
              AND A.RUN_ID = BT.RUN_ID
              AND BT.CHARACTERISTIC_CODE='BORBTYP'

INNER JOIN DW_ELEMENT_BALANCES UNPAIDP 
       ON E.CONTRACT_ID = UNPAIDP.CONTRACT_ID
              AND E.DIM_DATE_KEY = UNPAIDP.DIM_DATE_KEY
	   AND E.ORDER_NBR = UNPAIDP.ELEMENT_ORDER_NBR
              AND E.RUN_ID = UNPAIDP.RUN_ID
              AND UNPAIDP.BALANCE_TYPE_DESC = 'PRINCIPAL'
	

LEFT JOIN DW_ACTOR_RISK_RATING RR
              ON CA.ACTOR_ID = RR.ACTOR_ID 
              AND CA.DIM_DATE_KEY = RR.DIM_DATE_KEY
              AND CA.RUN_ID =RR.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT' 
              AND RR.END_DT IS NULL      

LEFT JOIN (SELECT RR1.rating_code, SUM(EB.VALUE_DATE_AMT) AS AMT
	FROM DW_CONTRACTS C
	LEFT JOIN DW_ELEMENTS E1
	ON C.CONTRACT_ID = E1.CONTRACT_ID 
	AND C.RUN_ID = E1.RUN_ID 
	AND C.DIM_DATE_KEY =E1.DIM_DATE_KEY
	LEFT JOIN DW_CONTRACT_ACTORS CA1
	ON C.CONTRACT_ID = CA1.CONTRACT_ID
	AND C.DIM_DATE_KEY = CA1.DIM_DATE_KEY
	AND C.RUN_ID = CA1.RUN_ID
	AND CA1.ACTOR_ROLE_CODE = 'EMPRUNT'
	LEFT JOIN DW_ACTOR_RISK_RATING RR1
	ON CA1.ACTOR_ID = RR1.ACTOR_ID 
                AND CA1.DIM_DATE_KEY = RR1.DIM_DATE_KEY
	AND CA1.RUN_ID =RR1.RUN_ID
	AND CA1.ACTOR_ROLE_CODE = 'EMPRUNT' 
	AND RR1.END_DT IS NULL      
	LEFT JOIN DW_ELEMENT_BALANCES EB
	ON E1.CONTRACT_ID = EB.CONTRACT_ID
	AND E1.DIM_DATE_KEY = EB.DIM_DATE_KEY
	AND E1.ORDER_NBR = EB.ELEMENT_ORDER_NBR
	AND E1.RUN_ID = EB.RUN_ID
	AND EB.BALANCE_TYPE_DESC = 'PRINCIPAL'
	 GROUP BY RR1.RATING_CODE
	  	
) DENOM
ON DENOM.RATING_CODE = RR.RATING_CODE


WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND E.ELEMENT_CLASS_CODE = 'F'--Financial and Incidental
	AND E.ELEMENT_TYPE_CODE IN ('F','P')--F is for Long Term P is for line of credit
	AND U.RUN_ID = @RunID
GROUP BY 
A.ACTOR_CODE_DESC, A.TRADE_NAME_DESC, E.LOAN_NBR, E.END_DT, E.FINANCIAL_PMT_SCHED_TYPE_DESC, UNPAIDP.VALUE_DATE_AMT, U.PRODUCT_DESC, E.INTEREST_RATE_NATURE_DESC, U.BAD_DEBT_IND, BT.STRING_VALUE_DESC,
E.USED_FIXED_RATE_PCT, RR.RATING_CODE, PA.ACTOR_ID, PA.SHORT_NAME_DESC, DENOM.AMT, U.PRODUCT_CODE
 ),
	
       CTE2
              as     (
                           SELECT *, ROW_NUMBER() OVER(PARTITION BY LoanID ORDER BY LoanMaturityDate DESC) AS 'Row_num' FROM CTE1 )
	   
	   Select Distinct MemberID,
	   MemberName,
	   LoanID,
	   LoanMaturityDate,
	   AmortizationMethod,
	   UnpaidPrincipalBalance,
	   ProductType,
	   InterestRateType,
	   PerformanceIndicator,
	   BusinessType,
	   AllInRate,
	   BorrowerRiskRating,
	   TruncatedBorrowerRiskRating,
	   NumberOfDaysDifference,
	   [NumberofDaysDifference*UnpaidPrincipalBalance],
	   WeightedAverageMaturity,
	   WeightedAverageRate,
	   TransactionAccountingDate,
	   LendingOrganizationID,
	   LendingOrganization,
	   ProductCode
	   from CTE2 
                           where Row_num = 1

ORDER BY LendingOrganization, MemberID, LoanID

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0420PurposeAndFacilityType]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0420PurposeAndFacilityType]
	(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @ReportDate DATE

	SELECT @RunID = @RunID_PAR
	, @ReportDate = @ReportDate_PAR

	
	SELECT DISTINCT 
	     LendingOrganization= C.SHORT_NAME_DESC 
	    , MemberID =  ISNULL(A.ACTOR_CODE_DESC, '-')
	, MemberName = ISNULL(A.SHORT_NAME_DESC ,'-')
	, UnderlyingFacilityID = ISNULL(U.CONTRACT_NUMBER_DESC, '-')
	, FacilityPurpose = ISNULL(CC.STRING_VALUE_DESC,'-')
	, UnderlyingFacilityEffectiveDate = U.CONTRACT_1ST_ENTRY_DT
	, UnderlyingFacilityMaturityDate = U.CONTRACT_END_DT
	, UnderlyingFacilityCommitmentAmount = ISNULL(u.SIGNED_AMT, 0)
	, UnpaidPrincipalBalance = ISNULL(UNPAID.VALUE_DATE_AMT, 0)
	, CurrentAvailableAmount  =  ISNULL(AVAIL.VALUE_DATE_AMT, 0)
	FROM DW_CONTRACTS U
	LEFT JOIN DW_CONTRACT_ACTORS CA 
	ON U.CONTRACT_ID = CA.CONTRACT_ID
	AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
	AND U.RUN_ID = CA.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
	LEFT JOIN DW_ACTORS A 
	ON CA.ACTOR_ID = A.ACTOR_ID
	AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND CA.RUN_ID = A.RUN_ID
    LEFT JOIN DW_ACTORS C 
	ON U.COMPANY_ACTOR_ID = C.ACTOR_ID
	AND U.DIM_DATE_KEY = C.DIM_DATE_KEY
	AND U.RUN_ID = C.RUN_ID
	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'
	LEFT JOIN DW_CONTRACT_BALANCES AVAIL 
	ON U.CONTRACT_ID = AVAIL.CONTRACT_ID
	AND U.DIM_DATE_KEY = AVAIL.DIM_DATE_KEY
	AND U.RUN_ID = AVAIL.RUN_ID
	AND AVAIL.BALANCE_TYPE_DESC = 'AVAILABLE'
	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 
  LEFT JOIN DW_CONTRACT_CHARACTERISTICS CC
	ON U.CONTRACT_ID = CC.CONTRACT_ID
	AND U.DIM_DATE_KEY = CC.DIM_DATE_KEY
	AND U.RUN_ID = CC.RUN_ID 
	    AND CC.CHARACTERISTIC_CODE='LNPURP'	
	 
 	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	--AND CP.STEP_DESC = 'Active'
	AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT
	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )
	AND U.RUN_ID = @RunID
--	ORDER BY U.CONTRACT_END_DT
--	, A.ACTOR_CODE_DESC
--	, U.CONTRACT_NUMBER_DESC
END

GO
/****** Object:  StoredProcedure [rpt].[RPT0430LoanDataDownload]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


/****** Object:  StoredProcedure [rpt].[RPT0430LoanDataDownload]    Script Date: 7/26/2016 10:00:34 AM ******/

-- =============================================
-- Author:	<Sai Krishna>
-- Create date: <03/21/2016>
-- =============================================
CREATE PROCEDURE [rpt].[RPT0430LoanDataDownload]
(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)


--EXEC [rpt].[RPT0430LoanDataDownload] 49, '05/31/2016'


AS
BEGIN
	
SET NOCOUNT ON;

DECLARE   @RunID NUMERIC(10,0),
	      @ReportDate DATE

SELECT @RunID = @RunID_PAR, @ReportDate = @ReportDate_PAR

SELECT DISTINCT AccrualMethod = CASE E.INT_NUMERATOR_COUNT_CODE WHEN '365/366' THEN 'ACTUAL' ELSE E.INT_NUMERATOR_COUNT_CODE END+'/'+CASE E.INT_DENOMINATOR_COUNT_CODE WHEN '365/366' THEN 'ACTUAL' ELSE E.INT_DENOMINATOR_COUNT_CODE END,
       AllInRate = E.USED_FIXED_RATE_PCT,
       AmortizationMethod = E.FINANCIAL_PMT_SCHED_TYPE_DESC,
       RateFormula = EV.VARIABLE_RATE_FORMULA_DESC,
       InterestIncomeYTD = INTYTD.VALUE_DATE_AMT,
       InterestIncomeMTD = INTMTD.VALUE_DATE_AMT,
       InterestRateType = E.INTEREST_RATE_NATURE_DESC,
       LoanAdvanceAmount = E.INITIAL_BASIS_AMT,
       LoanAdvanceEffectiveDate = E.START_DT,
       LoanID = E.LOAN_NBR,
	   LoanMaturityDate = E.END_DT, 
       MemberID = A.ACTOR_CODE_DESC,
       MemberName=A.TRADE_NAME_DESC,
       NextReprisingDate= NRD.DATE_VALUE_DT,
	   PerformanceIndicator= CASE  WHEN U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL THEN 'Performing' ELSE 'Non Performing' END,
       ProductType=U.PRODUCT_DESC,
	   ScheduledPrincipalBalance=ES.POST_PRINCIPAL_BALANCE_AMT,
	   SecuredIndicator= SecI.STRING_VALUE_DESC,
       Spread=EV.MARGIN_PCT,
	   StatedInterestRate= E.USED_FIXED_RATE_PCT,
       UnpaidPrincipalBalance=UNPAIDP.VALUE_DATE_AMT,
       UnpaidInterestBalance = CASE WHEN SUM(EB.VALUE_DATE_AMT) IS NULL AND SUM(RLB.VALUE_DATE_AMT) IS NULL THEN NULL
	   ELSE SUM(ISNULL(EB.VALUE_DATE_AMT, 0)) - SUM(ISNULL(RLB.VALUE_DATE_AMT, 0))
	   END,
	   LendingOrganizationID=PA.ACTOR_ID,
	   LendingOrganization=PA.SHORT_NAME_DESC

 
FROM DW_ELEMENTS E


LEFT JOIN DW_ELEMENT_VARIABLE_RATES EV
	ON EV.ELEMENT_ORDER_NBR=E.ORDER_NBR
	  AND EV.CONTRACT_ID = E.CONTRACT_ID
              AND EV.DIM_DATE_KEY = E.DIM_DATE_KEY
              AND EV.RUN_ID = E.RUN_ID

	
LEFT JOIN DW_ELEMENT_CHARACTERISTICS NRD
       ON E.CONTRACT_ID = NRD.CONTRACT_ID
	   AND E.ORDER_NBR = NRD.ELEMENT_ORDER_NBR
              AND E.DIM_DATE_KEY = NRD.DIM_DATE_KEY
              AND E.RUN_ID = NRD.RUN_ID
              AND NRD.[CHARACTERISTIC_CODE] = 'REPEFFDT'

LEFT JOIN DW_ELEMENT_BALANCES INTYTD
	ON E.CONTRACT_ID = INTYTD.CONTRACT_ID
	AND E.ORDER_NBR = INTYTD.ELEMENT_ORDER_NBR
	AND E.DIM_DATE_KEY = INTYTD.DIM_DATE_KEY
	AND E.RUN_ID = INTYTD.RUN_ID
	AND INTYTD.BALANCE_TYPE_DESC = 'INT_PAID_FYTD'

LEFT JOIN DW_ELEMENT_BALANCES INTMTD
	ON E.CONTRACT_ID = INTMTD.CONTRACT_ID
	AND E.ORDER_NBR = INTMTD.ELEMENT_ORDER_NBR
	AND E.DIM_DATE_KEY = INTMTD.DIM_DATE_KEY
	AND E.RUN_ID = INTMTD.RUN_ID
	AND INTMTD.BALANCE_TYPE_DESC = 'INT_PAID_MTD'


INNER JOIN DW_CONTRACTS U
       ON E.CONTRACT_ID = U.CONTRACT_ID
              AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND E.RUN_ID = U.RUN_ID
INNER JOIN DW_CONTRACT_ACTORS CA 
       ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

INNER JOIN DW_ACTORS PA
	ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
	AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND U.RUN_ID = PA.RUN_ID

INNER JOIN DW_ACTORS A 
       ON CA.ACTOR_ID = A.ACTOR_ID
              AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
              AND CA.RUN_ID = A.RUN_ID

LEFT JOIN DW_CONTRACT_CHARACTERISTICS SecI
	ON U.CONTRACT_ID = SecI.CONTRACT_ID
	AND U.DIM_DATE_KEY = SecI.DIM_DATE_KEY
	AND U.RUN_ID = SecI.RUN_ID
	AND SecI.CHARACTERISTIC_CODE ='FACCHAR'

LEFT JOIN DW_ELEMENT_BALANCES EB
	ON EB.RUN_ID = E.RUN_ID
	AND EB.CONTRACT_ID = E.CONTRACT_ID
	AND EB.DIM_DATE_KEY = E.DIM_DATE_KEY
	AND EB.ELEMENT_ORDER_NBR = E.ORDER_NBR
	AND EB.CURRENT_IND = 1 
	AND EB.BALANCE_TYPE_DESC = 'ACCRUED_INT'

INNER JOIN DW_RECEIVABLE_LINE_ITEMS RL 
	ON RL.LOAN_DESC = E.LOAN_NBR
	AND RL.RUN_ID = E.RUN_ID 
	AND RL.DIM_DATE_KEY = E.DIM_DATE_KEY 
	AND RL.CONTRACT_ID = E.CONTRACT_ID
	
LEFT JOIN DW_RECEIVABLE_LINE_BALANCE RLB
	ON RLB.RECEIVABLE_ID = RL.RECEIVABLE_ID
	AND RLB.RECEIVABLE_LINE_ITEM_NBR = RL.RECEIVABLE_LINE_ITEM_NBR
	AND RLB.DIM_DATE_KEY = RL.DIM_DATE_KEY
	AND RLB.RUN_ID = RL.RUN_ID 
	AND RLB.BALANCE_TYPE_DESC = 'PAID_INTEREST' 


INNER JOIN DW_ELEMENT_SCHEDULE ES 
       ON E.CONTRACT_ID = ES.CONTRACT_ID
                     AND E.ORDER_NBR = ES.ELEMENT_ORDER_NBR
                     AND E.DIM_DATE_KEY = ES.DIM_DATE_KEY
                     AND E.RUN_ID = ES.RUN_ID 

LEFT JOIN DW_ELEMENT_BALANCES UNPAIDP 
       ON E.CONTRACT_ID = UNPAIDP.CONTRACT_ID
              AND E.DIM_DATE_KEY = UNPAIDP.DIM_DATE_KEY
	  AND E.ORDER_NBR = UNPAIDP.ELEMENT_ORDER_NBR
              AND E.RUN_ID = UNPAIDP.RUN_ID
              AND UNPAIDP.BALANCE_TYPE_DESC = 'PRINCIPAL'

Where U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND @ReportDate BETWEEN ES.ACCRUAL_PERIOD_START_DT AND ES.ACCRUAL_PERIOD_END_DT
	AND E.ELEMENT_CLASS_CODE = 'F'
	AND E.ELEMENT_TYPE_CODE IN ('F', 'P')
	AND U.RUN_ID = @RunID
	AND ES.PAYMENT_TYPE_CODE = 'LOYER'
	AND E.LOAN_NBR IS NOT NULL

GROUP BY CASE E.INT_NUMERATOR_COUNT_CODE WHEN '365/366' THEN 'ACTUAL' ELSE E.INT_NUMERATOR_COUNT_CODE END+'/'+CASE E.INT_DENOMINATOR_COUNT_CODE WHEN '365/366' THEN 'ACTUAL' ELSE E.INT_DENOMINATOR_COUNT_CODE END,
        E.USED_FIXED_RATE_PCT, E.FINANCIAL_PMT_SCHED_TYPE_DESC, EV.VARIABLE_RATE_FORMULA_DESC,
	INTYTD.VALUE_DATE_AMT,
	INTMTD.VALUE_DATE_AMT,
	E.INTEREST_RATE_NATURE_DESC,
	E.INITIAL_BASIS_AMT,
	E.START_DT,
	E.LOAN_NBR,
	    E.END_DT, 
	A.ACTOR_CODE_DESC,
	A.TRADE_NAME_DESC,
       NRD.DATE_VALUE_DT,
	   CASE  WHEN U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL THEN 'Performing' ELSE 'Non Performing' END,
	U.PRODUCT_DESC,
	 ES.POST_PRINCIPAL_BALANCE_AMT,
	SecI.STRING_VALUE_DESC,
       EV.MARGIN_PCT,
	   E.USED_FIXED_RATE_PCT,
	UNPAIDP.VALUE_DATE_AMT,
	EB.VALUE_DATE_AMT,
	RLB.VALUE_DATE_AMT,
    -- CASE WHEN EB.VALUE_DATE_AMT IS NULL AND RLB.VALUE_DATE_AMT IS NULL THEN NULL
	   --ELSE SUM(ISNULL(EB.VALUE_DATE_AMT, 0)) - SUM(ISNULL(RLB.VALUE_DATE_AMT, 0))
	   --END,
	   PA.ACTOR_ID,
	   PA.SHORT_NAME_DESC

ORDER BY A.ACTOR_CODE_DESC, E.LOAN_NBR

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0440HistoryOfPayments]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [rpt].[RPT0440HistoryOfPayments]
(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR Date, @PeriodStartDate_PAR date, @PeriodEndDate_PAR date, @DateType char(1))
AS

DECLARE  @RunID NUMERIC(10,0), @ReportDate Date, @PeriodStartDate date, @PeriodEndDate date
SELECT @RunID = @RunID_PAR, @ReportDate = @ReportDate_PAR, @PeriodStartDate = @PeriodStartDate_PAR, @PeriodEndDate = @PeriodEndDate_PAR


	
SET NOCOUNT ON;



SELECT  DISTINCT
	   LoanID = RLI.LOAN_DESC,
	   MemberName = A.TRADE_NAME_DESC,
	   ProductType = U.PRODUCT_DESC,
	   InterestRateType= RLI.INTERST_RATE_TYPE_DESC,
	   PerformanceIndicator= CASE  
	   WHEN U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL THEN 'Performing' ELSE 'Non Performing' 
	   END,
	   PaymentEffectiveDate = DT.PAYMENT_DT,
	   TransactionAccountingDate = DT.VALUE_DT,
	   PrincipalAmountPaid = TR.PRINCIPAL_AMT,
	   InterestAmountPaid = (TR.TAX_EXCLUDED_AMT- TR.PRINCIPAL_AMT),
	   TotalPrincipalandInterestAmountPaid = TR.PRINCIPAL_AMT + (TR.TAX_EXCLUDED_AMT- TR.PRINCIPAL_AMT),
	   CollectionPaymentMethod = DT.PAYMENT_METHOD_DESC,
	   LendingOrganizationID = LO.ACTOR_ID,
	   LendingOrganization = LO.SHORT_NAME_DESC
  
FROM  DW_TRANSACTIONS DT

INNER JOIN DW_TRANSACTION_LINE_ITEMS TLI
ON DT.TRANSACTION_ID = TLI.TRANSACTION_ID
AND  DT.DIM_DATE_KEY = TLI.DIM_DATE_KEY
AND  DT.RUN_ID = TLI.RUN_ID

INNER JOIN DW_RECEIVABLES DR
ON TLI.RECEIVABLE_ID = DR.RECEIVABLE_ID
and TLI.RUN_ID = DR.RUN_ID
AND TLI.DIM_DATE_KEY = DR.DIM_DATE_KEY

INNER JOIN DW_RECEIVABLE_LINE_ITEMS RLI
ON DR.RECEIVABLE_ID = RLI.RECEIVABLE_ID
AND DR.RUN_ID = RLI.RUN_ID
AND DR.DIM_DATE_KEY = RLI.DIM_DATE_KEY
--AND RLI.PROCESS_ALLOCATION_ID IN ('856','857','858','860','881')

INNER JOIN [DW_PROCESS_ALLOCATIONS] PA
ON RLI.DIM_DATE_KEY = PA.DIM_DATE_KEY
AND RLI.RUN_ID = PA.RUN_ID
AND RLI.PROCESS_ALLOCATION_ID = PA.PROCESS_ALLOCATION_ID
AND PA.PROCESS_ALLOCATION_CODE IN ('DSLEVEL','DSINTON','DSINTSC','DSPCUR','DSPAYO')


INNER JOIN DW_RECEIVABLE_DETAILS RD
ON RLI.RECEIVABLE_ID = RD.RECEIVABLE_ID
AND RLI.RUN_ID = RD.RUN_ID
AND RLI.DIM_DATE_KEY = RD.DIM_DATE_KEY
AND RLI.RECEIVABLE_LINE_ITEM_NBR = RD.ORDER_NBR

INNER JOIN DW_LK_TRANS_RECEIVABLES TR
ON RLI.RECEIVABLE_ID = TR.RECEIVABLE_ID
AND RLI.RECEIVABLE_LINE_ITEM_NBR = TR.RECEIVABLE_LINE_ITEM_NBR
AND RLI.RUN_ID = TR.RUN_ID
AND RLI.DIM_DATE_KEY = TR.DIM_DATE_KEY

INNER JOIN DW_CONTRACTS U
       ON	  RD.CONTRACT_ID = U.CONTRACT_ID
              AND RD.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND RD.RUN_ID = U.RUN_ID
LEFT JOIN DW_CONTRACT_ACTORS CA 
       ON U.CONTRACT_ID = CA.CONTRACT_ID
              AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
              AND U.RUN_ID = CA.RUN_ID
              AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

LEFT JOIN DW_ACTORS A 
       ON CA.ACTOR_ID = A.ACTOR_ID
              AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
              AND CA.RUN_ID = A.RUN_ID


LEFT JOIN DW_ACTORS LO
ON U.COMPANY_ACTOR_ID=LO.ACTOR_ID
 AND U.DIM_DATE_KEY = LO.DIM_DATE_KEY
              AND U.RUN_ID = LO.RUN_ID

Where U.PRODUCT_CODE NOT LIKE 'AUT%' 	
	  AND U.RUN_ID = @RunID
	  AND DT.PAYMENT_TYPE_CODE = 'E'
	  AND ((@DateType = 1 AND DT.PAYMENT_DT BETWEEN @PeriodStartDate and @PeriodEndDate) 
	OR
	(@DateType = 2 AND DT.VALUE_DT BETWEEN @PeriodStartDate and @PeriodEndDate) 
	  )
	  AND RLI.LOAN_DESC IS NOT NULL
--AND RLI.ELEMENT_CLASS_CODE = 'F'


--ORDER BY 
--CASE WHEN @DateType = 1 THEN DT.PAYMENT_DT 
--ELSE DT.VALUE_DT 
--END,
--A.TRADE_NAME_DESC,
--RLI.LOAN_DESC

GO
/****** Object:  StoredProcedure [rpt].[RPT0450HistoryOfLoanAdvances]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0450HistoryOfLoanAdvances]
(@RunID_PAR NUMERIC(10,0), @TransactionAccountingBeginDT_PAR date, @TransactionAccountingEndDT_PAR date)
AS
BEGIN
	
	SET NOCOUNT ON;

	DECLARE  @RunID NUMERIC(10,0), @TransactionAccountingBeginDT date, @TransactionAccountingEndDT date   

SELECT @RunID = @RunID_PAR, @TransactionAccountingBeginDT = @TransactionAccountingBeginDT_PAR, @TransactionAccountingEndDT = @TransactionAccountingEndDT_PAR

Select DISTINCT LoanID = ISNULL(E.LOAN_NBR, '-'),
	   MemberName=ISNULL(A.TRADE_NAME_DESC, 0),
	   ProductType=ISNULL(U.PRODUCT_DESC, 0),
	   InterestRateType=ISNULL(E.INTEREST_RATE_NATURE_CODE, 0),
	   PerformanceIndicator= CASE  WHEN U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL THEN 'Performing' ELSE 'Non Performing' END,
	   LoanAdvanceAmount = ISNULL(E.INITIAL_BASIS_AMT, 0),
       LoanAdvanceEffectiveDate = E.START_DT,
	   AccountingDate = DT.VALUE_DT,
	   DisbursementMethod = DT.PAYMENT_METHOD_DESC 

FROM  [dbo].[DW_TRANSACTIONS] DT

INNER JOIN DW_TRANSACTION_LINE_ITEMS TLI
ON DT.TRANSACTION_ID = TLI.TRANSACTION_ID
AND  DT.DIM_DATE_KEY = TLI.DIM_DATE_KEY
AND  DT.RUN_ID = TLI.RUN_ID

INNER JOIN DW_PAYABLES DP
ON TLI.PAYABLE_ID = DP.PAYABLE_ID
and TLI.RUN_ID = DP.RUN_ID
AND TLI.DIM_DATE_KEY = DP.DIM_DATE_KEY

INNER JOIN DW_PAYABLE_LINE_ITEMS PLI
ON DP.PAYABLE_ID = PLI.PAYABLE_ID
AND DP.RUN_ID = PLI.RUN_ID
AND DP.DIM_DATE_KEY = PLI.DIM_DATE_KEY
AND PLI.PROCESS_ALLOCATION_ID = 859

INNER JOIN ( SELECT RUN_ID,DIM_DATE_KEY,CONTRACT_ID ,EVENT_ID,MIN(ELEMENT_ORDER_NBR) AS ELEMENT_ORDER_NBR
    FROM DW_LK_ELEMENT_EVENT
	GROUP BY RUN_ID,DIM_DATE_KEY,CONTRACT_ID,EVENT_ID
   ) G 
	ON  DP.EVENT_ID = G.EVENT_ID
	AND DP.DIM_DATE_KEY = G.DIM_DATE_KEY
	AND DP.RUN_ID = G.RUN_ID

INNER JOIN DW_ELEMENTS E 
ON E.RUN_ID = G.RUN_ID AND
E.CONTRACT_ID= G.CONTRACT_ID AND
E.DIM_DATE_KEY = G.DIM_DATE_KEY AND
E.ORDER_NBR = G.ELEMENT_ORDER_NBR


INNER JOIN DW_ACTORS A 
	ON DT.ACTOR_ID = A.ACTOR_ID
	AND DT.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND DT.RUN_ID = A.RUN_ID

INNER JOIN DW_CONTRACTS U
       ON E.CONTRACT_ID = U.CONTRACT_ID
              AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
              AND E.RUN_ID = U.RUN_ID

Where U.PRODUCT_CODE NOT LIKE 'AUT%' 	
	AND DT.PAYMENT_TYPE_CODE = 'D'	
	    AND U.RUN_ID = @RunID
	  AND  DT.VALUE_DT BETWEEN @TransactionAccountingBeginDT and @TransactionAccountingEndDT
	  AND E.ELEMENT_CLASS_CODE = 'F'
	  AND E.ELEMENT_TYPE_CODE = 'F'

ORDER BY DT.VALUE_DT

END
GO
/****** Object:  StoredProcedure [rpt].[RPT0500ActiveFacilities]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0500ActiveFacilities]
	(@RunID_PAR NUMERIC(10,0), @ReportDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @ReportDate DATE

	SELECT @RunID = @RunID_PAR
	, @ReportDate = @ReportDate_PAR

SELECT MemberID =  A.ACTOR_CODE_DESC
	    , ActorID = A.ACTOR_ID
	, ContractID = U.CONTRACT_ID
	, UnderlyingFacilityID = RIGHT(U.CONTRACT_NUMBER_DESC, 4)
	, ProductType = U.PRODUCT_DESC
	, UnderlyingFacilityCommitmentAmount = u.SIGNED_AMT
	, UnpaidPrincipalBalance = UNPAID.VALUE_DATE_AMT
	, StopOrderBalance = SO.STOP_ORDER_AMOUNT
	, CurrentAvailableAmount  =  AVAIL.VALUE_DATE_AMT
	, UnderlyingFacilityMaturityDate = U.CONTRACT_END_DT
	, LendingOrganization = PA.SHORT_NAME_DESC
	, LendingOrganizationID = PA.ACTOR_ID
	FROM DW_CONTRACTS U
	LEFT JOIN DW_CONTRACT_ACTORS CA 
	ON U.CONTRACT_ID = CA.CONTRACT_ID
	AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
	AND U.RUN_ID = CA.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
	LEFT JOIN DW_ACTORS A 
	ON CA.ACTOR_ID = A.ACTOR_ID
	AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND CA.RUN_ID = A.RUN_ID
	LEFT JOIN DW_ACTORS PA
	ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
	AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND U.RUN_ID = PA.RUN_ID
	LEFT JOIN DW_CONTRACT_BALANCES UNPAID 
	ON U.CONTRACT_ID = UNPAID.CONTRACT_ID
	AND U.DIM_DATE_KEY = UNPAID.DIM_DATE_KEY
	AND U.RUN_ID = UNPAID.RUN_ID
	AND UNPAID.BALANCE_TYPE_DESC = 'PRINCIPAL'
	AND UNPAID.CURRENT_IND = 1
	LEFT JOIN DW_CONTRACT_BALANCES AVAIL 
	ON U.CONTRACT_ID = AVAIL.CONTRACT_ID
	AND U.DIM_DATE_KEY = AVAIL.DIM_DATE_KEY
	AND U.RUN_ID = AVAIL.RUN_ID
	AND AVAIL.BALANCE_TYPE_DESC = 'AVAILABLE'
	AND AVAIL.CURRENT_IND = 1
	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.CONTRACT_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID
	LEFT JOIN (SELECT CONTRACT_ID, DIM_DATE_KEY, RUN_ID, STOP_ORDER_AMOUNT = SUM(STOP_ORDER_AMOUNT) 
	FROM rpt.VW_DW_STOP_ORDER 
	WHERE @ReportDate BETWEEN STOP_ORDER_START_DT
	AND ISNULL(STOP_ORDER_END_DT, @ReportDate)
	AND STOP_ORDER_GROUP = 'External Reporting'
	AND STOP_ORDER_AMOUNT > 0
	GROUP BY CONTRACT_ID, DIM_DATE_KEY, RUN_ID
	 ) SO
	ON U.CONTRACT_ID = SO.CONTRACT_ID
	AND U.DIM_DATE_KEY = SO.DIM_DATE_KEY
	AND U.RUN_ID = SO.RUN_ID
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND CP.STEP_DESC = 'Active'
	AND (@ReportDate BETWEEN CP.PHASE_EFFECTIVE_DT
	AND ISNULL(CP.PHASE_END_DT, @ReportDate) )
	AND U.RUN_ID = @RunID
	ORDER BY U.CONTRACT_END_DT
	, A.ACTOR_CODE_DESC
	, RIGHT(U.CONTRACT_NUMBER_DESC, 4)
END
GO
/****** Object:  StoredProcedure [rpt].[RPT0540GeneralLedgerTransactions]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt].[RPT0540GeneralLedgerTransactions]
(@RunID_PAR NUMERIC(10,0), @AccountingYearMonth_PAR Varchar(6))
AS
BEGIN
	
SET NOCOUNT ON;

DECLARE @RunID NUMERIC(10,0), @AccountingYearMonth VARCHAR(6)
SELECT  @RunID = @RunID_PAR , @AccountingYearMonth = @AccountingYearMonth_PAR

--EXEC [rpt].[RPT0540GeneralLedgerTransactions] 49, '201605'

Select Distinct 
ProductType=LoansGL.ProductType,
InterestRateType=LoansGL.InterestRateType,
CompleteGLNumber=GLE.GL_ACCOUNT_NBR_DESC, 
LoanID = E.LOAN_NBR,
AccountingDate = GLE.ACCOUNTING_DT,
PerformanceInd=LoansGL.PerformanceInd,
TransactionName=GLE.ELEMENT_DESC,
TransactionNumber=GLE.ENTRY_ID,
CASE WHEN GLE.DEBIT_CREDIT_DESC = 'C' THEN SUM(GLE.ACCOUNTING_CURRENCY_AMT) ELSE 0 END as [Credit Amount],
CASE WHEN GLE.DEBIT_CREDIT_DESC = 'D' THEN SUM(GLE.ACCOUNTING_CURRENCY_AMT) ELSE 0 END as [Debit Amount],
SUM(EB.VALUE_DATE_AMT) AS  [Ending Period Balance],
---
MemberID = A.ACTOR_CODE_DESC,
UnderlyingFacilityID = RIGHT(U.CONTRACT_NUMBER_DESC, 4)
	  
FROM DW_ELEMENTS E
INNER JOIN  [dbo].[DW_ELEMENT_BALANCES] EB
	ON  E.CONTRACT_ID = EB.CONTRACT_ID
	AND E.RUN_ID = EB.RUN_ID
	AND E.DIM_DATE_KEY = EB.DIM_DATE_KEY
	AND E.ORDER_NBR = EB.ELEMENT_ORDER_NBR
	AND EB.BALANCE_TYPE_DESC = 'PRINCIPAL'
INNER JOIN [dbo].[DW_CONTRACTS] U
	ON  E.RUN_ID = U.RUN_ID
	AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
	AND E.CONTRACT_ID = U.CONTRACT_ID

INNER JOIN (select U.RUN_ID,U.DIM_DATE_KEY,U.CONTRACT_ID, E.LOAN_NBR, E.ORDER_NBR, 
	           ProductType=U.PRODUCT_DESC,
	   InterestRateType=E.INTEREST_RATE_NATURE_DESC,
	   PerformanceInd=CASE WHEN U.BAD_DEBT_IND = '0' OR U.BAD_DEBT_IND IS NULL THEN 'Performing' ELSE 'Non Performing' END,
	Case when E.INTEREST_RATE_NATURE_CODE = 'TF' AND U.PRODUCT_CODE = 'P1P' AND (U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LT Loan)'
	 when E.INTEREST_RATE_NATURE_CODE = 'TF' AND U.PRODUCT_CODE = 'P1P' AND (U.BAD_DEBT_IND <> '0' AND U.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LT NonPerform'
	 WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' AND U.PRODUCT_CODE = 'LCS' AND (U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Fixed Rate (LOC Loan)'
	 WHEN E.INTEREST_RATE_NATURE_CODE = 'TF' AND U.PRODUCT_CODE = 'LCS' AND (U.BAD_DEBT_IND <> '0' AND U.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Fixed Rate LOC NonPerform'
	-------------------
	 when E.INTEREST_RATE_NATURE_CODE = 'VR' AND U.PRODUCT_CODE = 'P1P' AND (U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LT Loan)'
	 when E.INTEREST_RATE_NATURE_CODE = 'VR' AND U.PRODUCT_CODE = 'P1P' AND (U.BAD_DEBT_IND <> '0' AND U.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate  LT NonPerform'
	 WHEN E.INTEREST_RATE_NATURE_CODE = 'VR' AND U.PRODUCT_CODE = 'LCS' AND (U.BAD_DEBT_IND = '0' or U.BAD_DEBT_IND IS NULL)
	THEN 'Loans to Members - Var Rate (LOC Loan)'
	 WHEN E.INTEREST_RATE_NATURE_CODE = 'VR' AND U.PRODUCT_CODE = 'LCS' AND (U.BAD_DEBT_IND <> '0' AND U.BAD_DEBT_IND IS NOT NULL)
	THEN 'Loans to Members - Var Rate LOC NonPerform'
	 END AS 'GL_Name' 
	FROM [dbo].[DW_CONTRACTS] U
	INNER JOIN [dbo].[DW_ELEMENTS] E
	ON  U.RUN_ID = E.RUN_ID
	AND U.DIM_DATE_KEY = E.DIM_DATE_KEY
	AND U.CONTRACT_ID = E.CONTRACT_ID
	INNER JOIN [DBO].[DW_PROCESS_ALLOCATIONS] PA
	ON  E.RUN_ID = PA.RUN_ID
	AND E.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND E.PROCESS_ALLOCATION_ID = PA.PROCESS_ALLOCATION_ID
	WHERE U.RUN_ID = @RunID 
	 ) LoansGL
	ON E.RUN_ID = LoansGL.RUN_ID
	AND E.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY
	AND E.CONTRACT_ID = LoansGL.CONTRACT_ID
	AND E.LOAN_NBR = LoansGL.LOAN_NBR


	INNER JOIN [dbo].[DW_CHART_OF_ACCOUNTS] COA
	ON  LoansGL.RUN_ID = COA.RUN_ID
	AND LoansGL.DIM_DATE_KEY = COA.DIM_DATE_KEY
	AND LoansGL.GL_Name = COA.GL_ACCOUNT_DESC

       INNER JOIN DW_GL_ENTRIES GLE
	           ON GLE.DIM_DATE_KEY = LoansGL.DIM_DATE_KEY AND
	      GLE.RUN_ID = LoansGL.RUN_ID AND 
	  GLE.CONTRACT_ID = LoansGL.CONTRACT_ID AND
	  GLE.LOAN_NBR=LoansGL.LOAN_NBR AND
	  GLE.ELEMENT_ORDER_NBR=LoansGL.ORDER_NBR  
	
	
	INNER JOIN DW_ACTORS A 
	    ON  U.COMPANY_ACTOR_ID = A.ACTOR_ID
                   AND  U.DIM_DATE_KEY = A.DIM_DATE_KEY
                   AND  U.RUN_ID = A.RUN_ID
	INNER JOIN DW_CONTRACT_ACTORS CA
	ON  U.CONTRACT_ID = CA.CONTRACT_ID
	AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
	AND U.RUN_ID = CA.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'

WHERE GLE.RUN_ID = @RunID
	            AND CAST(YEAR(GLE.ACCOUNTING_DT) AS VARCHAR(4) ) +  SUBSTRING(CONVERT(varchar(6),GLE.ACCOUNTING_DT, 112),5,2) = @AccountingYearMonth
	 
	
GROUP BY 
GLE.ACCOUNTING_DT,
GLE.DEBIT_CREDIT_DESC,
GLE.GL_ACCOUNT_NBR_DESC,
LoansGL.ProductType,
LoansGL.InterestRateType,
LoansGL.PerformanceInd,
GLE.ELEMENT_DESC,
GLE.ENTRY_ID,
A.ACTOR_CODE_DESC,
E.LOAN_NBR,
U.CONTRACT_NUMBER_DESC
END
GO
/****** Object:  StoredProcedure [rpt].[RPT130CashManagement]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [rpt].[RPT130CashManagement]
	(@RunID_PAR NUMERIC(10,0), @LoanAdvanceEffectiveBeginDate_PAR DATE, @LoanAdvanceEffectiveEndDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	, @LoanAdvanceEffectiveBeginDate DATE
	, @LoanAdvanceEffectiveEndDate DATE

	SELECT @RunID = @RunID_PAR
	, @LoanAdvanceEffectiveBeginDate = @LoanAdvanceEffectiveBeginDate_PAR
	, @LoanAdvanceEffectiveEndDate = @LoanAdvanceEffectiveEndDate_PAR

SELECT LoanAdvanceEffectiveDate = E.START_DT
	, LoanAdvanceStatus = CASE WHEN  NULLIF(EV.CREATED_DT, '') IS NOT NULL
	AND NULLIF(EV.VALIDATION_DT, '') IS NULL
	AND NULLIF(EV.DELETE_DT, '') IS NULL
	THEN 'Scheduled'
	WHEN  NULLIF(EV.CREATED_DT, '') IS NOT NULL
	AND NULLIF(EV.VALIDATION_DT, '') IS NOT NULL
	AND NULLIF(EV.DELETE_DT, '') IS NULL
	THEN 'Approved Not Wired'
	WHEN  NULLIF(EV.VALIDATION_DT, '') IS NOT NULL
	AND NULLIF(EV.DELETE_DT, '') IS NULL
	AND PPI.PAYMENT_DT IS NOT NULL
	THEN 'Approved and Wired'
	END
	, MemberID = A.ACTOR_CODE_DESC
	, ActorID = A.ACTOR_ID
	, LoanID = E.LOAN_NBR
	, DisbursementAmount = E.INITIAL_BASIS_AMT
	, LoanAdvanceScheduledBy = EV.CREATED_BY_DESC
	, LoanAdvanceApprovedBy = EV.VALIDATED_BY_DESC
	, FileDownloadedBy = NULL	
	, LendingOrganization = PA.SHORT_NAME_DESC
	, LendingOrganizationID = PA.ACTOR_ID
FROM DW_PAYABLES P
	LEFT JOIN DW_PAYABLE_PAYMENT_INFO PPI
	ON P.PAYABLE_ID = PPI.PAYABLE_ID
	AND P.DIM_DATE_KEY = PPI.DIM_DATE_KEY
	AND P.RUN_ID = PPI.RUN_ID
	INNER JOIN DW_LK_ELEMENT_EVENT EE
	ON  P.EVENT_ID = EE.EVENT_ID
	AND P.DIM_DATE_KEY = EE.DIM_DATE_KEY
	AND P.RUN_ID = EE.RUN_ID
	INNER JOIN DW_EVENTS EV
	ON EE.EVENT_ID = EV.EVENT_ID
	AND EE.DIM_DATE_KEY = EV.DIM_DATE_KEY
	AND EE.RUN_ID = EV.RUN_ID 
	AND EV.FUNCTION_CODE = 'EVD_DEBLOCFOND'
	INNER JOIN DW_TRANSACTIONS T
	ON EV.EVENT_ID = T.EVENT_ID
	AND  EV.DIM_DATE_KEY = T.DIM_DATE_KEY
	AND  EV.RUN_ID = T.RUN_ID
	--INNER JOIN DW_BATCH_TRANSACTION BT
	--	ON T.BATCH_TRANS_RUN_ID = BT.BATCH_RUN_ID
	--	AND T.DIM_DATE_KEY = BT.DIM_DATE_KEY
	--	AND T.RUN_ID = BT.RUN_ID
	INNER JOIN DW_ELEMENTS E 
	ON E.CONTRACT_ID= EE.CONTRACT_ID
	AND E.ORDER_NBR = EE.ELEMENT_ORDER_NBR
	AND E.DIM_DATE_KEY = EE.DIM_DATE_KEY
	AND E.RUN_ID = EE.RUN_ID
	INNER JOIN DW_CONTRACTS U
	ON E.CONTRACT_ID= U.CONTRACT_ID
	AND E.DIM_DATE_KEY = U.DIM_DATE_KEY
	AND E.RUN_ID = U.RUN_ID
	LEFT JOIN DW_CONTRACT_ACTORS CA 
	ON U.CONTRACT_ID = CA.CONTRACT_ID
	AND U.DIM_DATE_KEY = CA.DIM_DATE_KEY
	AND U.RUN_ID = CA.RUN_ID
	AND CA.ACTOR_ROLE_CODE = 'EMPRUNT'
	LEFT JOIN DW_ACTORS A 
	ON CA.ACTOR_ID = A.ACTOR_ID
	AND CA.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND CA.RUN_ID = A.RUN_ID
	LEFT JOIN DW_ACTORS PA
	ON U.COMPANY_ACTOR_ID=PA.ACTOR_ID
	AND U.DIM_DATE_KEY = PA.DIM_DATE_KEY
	AND U.RUN_ID = PA.RUN_ID
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND EV.DELETE_DT IS NULL
	AND P.RUN_ID = @RunID
	AND E.START_DT BETWEEN @LoanAdvanceEffectiveBeginDate AND @LoanAdvanceEffectiveEndDate
	AND E.ELEMENT_CLASS_CODE = 'F' 
	AND E.ELEMENT_TYPE_CODE IN ('F', 'P')

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetAccountingMonthEndInfo]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [rpt_prm].[GetAccountingMonthEndInfo]
	(@YearMonthNumber_PAR VARCHAR(6))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @YearMonthNumber VARCHAR(6)

	SELECT @YearMonthNumber = @YearMonthNumber_PAR

	SELECT MonthEndRunID = MAX(EC.RUN_ID)
	, MonthEndDate = Max(TO_DATE)
	FROM ETL_CONTROL EC
	WHERE EC.JOB_STATUS = 'COMPLETED - SUCCESS'
	AND RUN_TYPE = 'FULL'
	AND LEFT(CONVERT(VARCHAR(8), TO_DATE, 112), 6) = @YearMonthNumber
	--AND MonthEndFlagSet   --Pick the months where Month End load is completed.

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetCOA]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt_prm].[GetCOA]
	
AS
BEGIN
	SET NOCOUNT ON;

	
SELECT DISTINCT 
CASE WHEN GL_ACCOUNT_DESC LIKE 'Int Receivable%' THEN 'Interest Receivable' 
     WHEN GL_ACCOUNT_DESC LIKE 'Interest Income%' THEN 'Interest Income'
	 WHEN GL_ACCOUNT_DESC LIKE 'Late Fees%' THEN 'Late Fees'
	 WHEN GL_ACCOUNT_DESC LIKE 'Loans to Members%' THEN 'Loans to Members'
	 WHEN GL_ACCOUNT_DESC LIKE 'Non-accrual%' THEN 'Non-accrual'
     ELSE GL_ACCOUNT_DESC END AS GL_ACCOUNT_TYPE1 ,
GL_ACCOUNT_DESC, 
GL_ACCOUNT_NUMBER_DESC FROM DW_CHART_OF_ACCOUNTS	


END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetContractAVPNames]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




Create PROCEDURE [rpt_prm].[GetContractAVPNames]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT AVP.USER_BY_CODE, AVP.USER_BY_DESC
	FROM DW_INVOLVED_USER AVP
	WHERE AVP.RUN_ID = @RunID
	AND AVP.BUSINESS_CODE = 'AVP'
	ORDER BY AVP.USER_BY_DESC

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetContractRVPNames]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE PROCEDURE [rpt_prm].[GetContractRVPNames]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT AVP.USER_BY_CODE, AVP.USER_BY_DESC
	FROM DW_INVOLVED_USER AVP
	WHERE AVP.RUN_ID = @RunID
	AND AVP.BUSINESS_CODE = 'RVP'
	ORDER BY AVP.USER_BY_DESC

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetDealAVPNames]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE PROCEDURE [rpt_prm].[GetDealAVPNames]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT AVP.CREATED_BY_CODE, AVP.CREATED_BY_DESC
	FROM DW_DEAL_INVOLVED_USERS_FO AVP
	WHERE AVP.RUN_ID = @RunID
	AND AVP.BUSINESS_CODE = 'AVP'
	--ORDER BY AVP.CREATED_BY_DESC
	UNION
	SELECT CREATED_BY_CODE='-',CREATED_BY_DESC='-';

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetDealRVPNames]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [rpt_prm].[GetDealRVPNames]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT AVP.CREATED_BY_CODE, AVP.CREATED_BY_DESC
	FROM DW_DEAL_INVOLVED_USERS_FO AVP
	WHERE AVP.RUN_ID = @RunID
	AND AVP.BUSINESS_CODE = 'RVP'
	ORDER BY AVP.CREATED_BY_DESC

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetETLMonths]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE PROCEDURE [rpt_prm].[GetETLMonths]
	(@AsOfYear_PAR INT)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @AsOfYear INT

	SELECT @AsOfYear = @AsOfYear_PAR

	SELECT DISTINCT YearMonthNumber = LEFT(CONVERT(VARCHAR(8), TO_DATE, 112), 6)
	, MonthLabel = DATENAME(MONTH, TO_DATE)
	FROM ETL_CONTROL
	WHERE YEAR(TO_DATE) = @AsOfYear
	--AND MonthEndFlagSet   --Pick the months where Month End load is completed.
	ORDER BY LEFT(CONVERT(VARCHAR(8), TO_DATE, 112), 6)
	

END

GO
/****** Object:  StoredProcedure [rpt_prm].[GetETLYears]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE PROCEDURE [rpt_prm].[GetETLYears]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT DISTINCT YearNumber = YEAR(TO_DATE) 
	FROM ETL_CONTROL
	ORDER BY YEAR(TO_DATE) 

END

GO
/****** Object:  StoredProcedure [rpt_prm].[GetFacilityPurposes]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE PROCEDURE [rpt_prm].[GetFacilityPurposes]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	

	SELECT @RunID = @RunID_PAR
	

	
	SELECT DISTINCT 
	  
	       FacilityPurpose = ISNULL(CC.STRING_VALUE_DESC,'-')
	
  FROM DW_CONTRACTS U
  LEFT JOIN DW_CONTRACT_CHARACTERISTICS CC
	ON U.CONTRACT_ID = CC.CONTRACT_ID
	AND U.DIM_DATE_KEY = CC.DIM_DATE_KEY
	AND U.RUN_ID = @RunID
--WHERE CC.CHARACTERISTIC_CODE IN  ('LNRUP')
	
	END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetLendingOrganizations]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE PROCEDURE [rpt_prm].[GetLendingOrganizations]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT A.SHORT_NAME_DESC
	, A.TRADE_NAME_DESC
	, A.ACTOR_ID 
	FROM DW_COMPANIES C
	INNER JOIN DW_ACTORS A
	ON C.ACTOR_ID = A.ACTOR_ID
	AND C.DIM_DATE_KEY = A.DIM_DATE_KEY
	AND C.RUN_ID = A.RUN_ID
	WHERE C.RUN_ID = @RunID
	ORDER BY A.SHORT_NAME_DESC
	, A.TRADE_NAME_DESC

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetLoans]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE PROCEDURE [rpt_prm].[GetLoans]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	SELECT @RunID = @RunID_PAR
	
	SELECT DISTINCT E.LOAN_NBR
	FROM DW_ELEMENTS E
	WHERE E.RUN_ID = @RunID
	AND E.LOAN_NBR IS NOT NULL
	ORDER BY E.LOAN_NBR

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetMembers]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt_prm].[GetMembers]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT A.SHORT_NAME_DESC AS MEMBER_NAME, A.ACTOR_ID AS MEMBER_ID, A.ACTOR_CODE_DESC AS COOPID
	FROM DW_ACTORS A
	WHERE A.RUN_ID = @RunID
	ORDER BY  A.SHORT_NAME_DESC


END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetMemberStates]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt_prm].[GetMemberStates]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT 
	
	ISNULL(LEFT(A.ACTOR_CODE_DESC,2), '-') AS MEMBER_STATES

	FROM DW_ACTORS A
	
	WHERE A.RUN_ID = @RunID
	AND LEFT(A.ACTOR_CODE_DESC,2)<>'10'
	ORDER BY ISNULL(LEFT(A.ACTOR_CODE_DESC,2), '-') ASC


END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetMostRecentRunID]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE PROCEDURE [rpt_prm].[GetMostRecentRunID]
AS
BEGIN
	SET NOCOUNT ON;

	SELECT RUN_ID = MAX(EC.RUN_ID)
	FROM ETL_CONTROL EC
	WHERE EC.JOB_STATUS = 'COMPLETED - SUCCESS'
	AND RUN_TYPE = 'FULL'

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetPipelineUnderlyingFacilityIDs]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt_prm].[GetPipelineUnderlyingFacilityIDs]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT U.DEAL_ID, U.DEAL_NUMBER_DESC
	FROM DW_DEALS_FO U
	INNER JOIN DW_DEAL_PHASE_FO DP
	ON u.DEAL_ID = DP.DEAL_ID
	AND u.DEAL_VERSION_CODE = DP.DEAL_VERSION_CODE
	AND u.DIM_DATE_KEY = DP.DIM_DATE_KEY
	AND u.RUN_ID = DP.RUN_ID	
	LEFT JOIN DW_CONTRACT_PHASES CP
	ON U.DEAL_ID = CP.CONTRACT_ID
	AND U.DIM_DATE_KEY = CP.DIM_DATE_KEY
	AND U.RUN_ID = CP.RUN_ID 
	AND CP.PHASE_END_DT IS NULL
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND U.RUN_ID = @RunID
	AND DP.END_DT IS NULL
	AND (CP.STEP_DESC IN ('New')
	OR CP.STEP_DESC IS NULL)
	ORDER BY U.DEAL_NUMBER_DESC

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetProductTypes]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE PROCEDURE [rpt_prm].[GetProductTypes]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)
	

	SELECT @RunID = @RunID_PAR
	

	
SELECT DISTINCT 
	 
	 ProductType = ISNULL(U.PRODUCT_DESC, 0),
	 ProductTypeDesc = ISNULL(U.PRODUCT_CODE, 0)
FROM DW_CONTRACTS U

WHERE U.RUN_ID = @RunID

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetRecentRunID]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [rpt_prm].[GetRecentRunID]
	(@ReportDate_PAR DATE)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @ReportDate DATE

	SELECT @ReportDate = @ReportDate_PAR

	SELECT RUN_ID = MAX(EC.RUN_ID)
	FROM ETL_CONTROL EC
	WHERE EC.JOB_STATUS = 'COMPLETED - SUCCESS'
	AND RUN_TYPE = 'FULL'
	AND TO_DATE <= @ReportDate

END
GO
/****** Object:  StoredProcedure [rpt_prm].[GetUnderlyingFacilityIDs]    Script Date: 8/24/2016 11:31:11 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE PROCEDURE [rpt_prm].[GetUnderlyingFacilityIDs]
	(@RunID_PAR NUMERIC(10,0))
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @RunID NUMERIC(10,0)

	SELECT @RunID = @RunID_PAR

	SELECT DISTINCT U.CONTRACT_ID, U.CONTRACT_NUMBER_DESC
	FROM DW_CONTRACTS U	
	WHERE U.PRODUCT_CODE NOT LIKE 'AUT%'
	AND U.RUN_ID = @RunID
	ORDER BY U.CONTRACT_NUMBER_DESC

END

GO
USE [master]
GO
ALTER DATABASE SRCUAT_old SET  READ_WRITE 
GO
